<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="在 Dubbo 中开发 REST 风格的远程调用"><link rel="shortcut icon" href=../../../../assets/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.5.3"><title>在 Dubbo 中开发 REST 风格的远程调用（RESTful Remoting） - Apache Dubbo</title><link rel=stylesheet href=../../../../assets/stylesheets/main.6fb40bf7.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.cef4c379.min.css><meta name=theme-color content=#3f51b5><link rel=stylesheet href=../../../../css/dropdown.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#dubbo-rest-restful-remoting class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Application header --> <header class=md-header data-md-component=header> <!-- Top-level navigation --> <nav class="md-header-nav md-grid" aria-label=Header> <!-- Link to home --> <a href=../../../.. title="Apache Dubbo" class="md-header-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> <!-- Button to open drawer --> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <!-- Header title --> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Apache Dubbo </span> <span class="md-header-nav__topic md-ellipsis"> 在 Dubbo 中开发 REST 风格的远程调用（RESTful Remoting） </span> </div> </div> <!-- Button to open search dialogue --> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div> <div class=langChange id=translate title=中文|English> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"> <path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"/> </svg> </div> <script>
    var translate = document.getElementById('translate');
    translate.addEventListener('click', changeHref, false);
    function changeHref() {
        if (window.location.href.search('en-us') !== -1) {
            var changeHref = window.location.href.replace('en-us', 'zh-cn');

        } else {
            var changeHref = window.location.href.replace('zh-cn', 'en-us');
        }
        window.location.href = changeHref
    }
</script> <style>
    .langChange {
        display: inline-block;
        width: 2.4rem;
        height: 2.4rem;
        vertical-align: middle;
        margin-left: .5rem;
    }

    .langChange svg {
        fill: rgba(255, 255, 255, 0.548);
        display: block;
        width: 1.2rem;
        height: 1.2rem;
        margin: 0 auto;
        margin-top: .6rem;
        margin-left: .6rem;
    }

    .langChange :hover {
        fill: white;
        cursor: pointer;
    }
</style> </div> <!-- Repository containing source --> <div class=md-header-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <!-- Home page --> <li class=md-tabs__item> <a href=../../../.. class="md-tabs__link md-tabs__link--active"> 首页 </a> </li> <!-- Main navigation item with nested items --> <!-- Home page --> <li class="md-tabs__item md-tabs_csr"> <a class="md-tabs__link md-tabs__link--active">文档</a> <ul class="md-tabs__list md-sub-tabs_bn"> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../preface/background/ class=md-tabs__link>2.7</a> </li> <!-- Render item --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../3.0/user/preface/background/ class=md-tabs__link>3.0</a> </li> <!-- Render item --> </ul> </li> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../../blog/apache-dubbo-2019-2020/ class=md-sub-tabs_link>博客</a> </li> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../../developers/developers_dev/ class=md-sub-tabs_link>开发者指南</a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Main navigation --> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <!-- Site title --> <label class=md-nav__title for=__drawer> <a href=../../../.. title="Apache Dubbo" class="md-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> Apache Dubbo </label> <!-- Repository containing source --> <div class=md-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <!-- Render item list --> <ul class=md-nav__list data-md-scrollfix> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../.. title=首页 class=md-nav__link> 首页 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 2.7 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=2.7 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 2.7 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../preface/requirements/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../quick-start/ title=快速启动 class=md-nav__link> 快速启动 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../dependencies/ title=依赖 class=md-nav__link> 依赖 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../maturity/ title=成熟度 class=md-nav__link> 成熟度 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-5 type=checkbox id=nav-1-1-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-5> 配置 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=配置 data-md-level=3> <label class=md-nav__title for=nav-1-1-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../configuration/xml/ title="XML 配置" class=md-nav__link> XML 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../configuration/api/ title="API 配置" class=md-nav__link> API 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../configuration/annotation/ title="Annotation 配置" class=md-nav__link> Annotation 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../configuration/annotation/ title=动态配置中心 class=md-nav__link> 动态配置中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../configuration/configuration-load-process/ title=配置加载流程 class=md-nav__link> 配置加载流程 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../configuration/environment-variables/ title=自动加载环境变量 class=md-nav__link> 自动加载环境变量 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-6 type=checkbox id=nav-1-1-6> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-6> 示例 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=示例 data-md-level=3> <label class=md-nav__title for=nav-1-1-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 示例 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/preflight-check/ title=启动时检查 class=md-nav__link> 启动时检查 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/fault-tolerent-strategy/ title=集群容错 class=md-nav__link> 集群容错 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/loadbalance/ title=负载均衡 class=md-nav__link> 负载均衡 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/thread-model/ title=线程模型 class=md-nav__link> 线程模型 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/explicit-target/ title=直连提供者 class=md-nav__link> 直连提供者 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/subscribe-only/ title=只订阅 class=md-nav__link> 只订阅 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/registry-only/ title=只注册 class=md-nav__link> 只注册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/static-service/ title=静态服务 class=md-nav__link> 静态服务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/multi-protocols/ title=多协议 class=md-nav__link> 多协议 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/multi-registry/ title=多注册中心 class=md-nav__link> 多注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/service-group/ title=服务分组 class=md-nav__link> 服务分组 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/multi-versions/ title=多版本 class=md-nav__link> 多版本 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/group-merger/ title=分组聚合 class=md-nav__link> 分组聚合 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/parameter-validation/ title=参数验证 class=md-nav__link> 参数验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/result-cache/ title=结果缓存 class=md-nav__link> 结果缓存 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/generic-reference/ title=泛化引用 class=md-nav__link> 泛化引用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/generic-service/ title=泛化实现 class=md-nav__link> 泛化实现 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/echo-service/ title=回声测试 class=md-nav__link> 回声测试 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/context/ title=上下文信息 class=md-nav__link> 上下文信息 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/attachment/ title=隐式参数 class=md-nav__link> 隐式参数 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/async-call/ title=异步调用 class=md-nav__link> 异步调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/async-execute-on-provider/ title=服务端异步 class=md-nav__link> 服务端异步 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/local-call/ title=本地调用 class=md-nav__link> 本地调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/callback-parameter/ title=参数回调 class=md-nav__link> 参数回调 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/events-notify/ title=事件通知 class=md-nav__link> 事件通知 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/local-stub/ title=本地存根 class=md-nav__link> 本地存根 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/local-mock/ title=本地伪装 class=md-nav__link> 本地伪装 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/delay-publish/ title=延迟暴露 class=md-nav__link> 延迟暴露 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/concurrency-control/ title=并发控制 class=md-nav__link> 并发控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/config-connection.md title=连接控制 class=md-nav__link> 连接控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/lazy-connect/ title=延迟连接 class=md-nav__link> 延迟连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/stickiness/ title=粘滞连接 class=md-nav__link> 粘滞连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/token-authorization/ title=令牌验证 class=md-nav__link> 令牌验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/routing-rule/ title=路由规则 class=md-nav__link> 路由规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/config-rule/ title=配置规则 class=md-nav__link> 配置规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/service-downgrade/ title=服务降级 class=md-nav__link> 服务降级 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/graceful-shutdown/ title=优雅停机 class=md-nav__link> 优雅停机 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/hostname-binding/ title=主机绑定 class=md-nav__link> 主机绑定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/logger-strategy/ title=日志适配 class=md-nav__link> 日志适配 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/accesslog/ title=访问日志 class=md-nav__link> 访问日志 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/service-container/ title=服务容器 class=md-nav__link> 服务容器 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/distributed-transaction/ title=分布式事务 class=md-nav__link> 分布式事务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/dump/ title=线程栈自动dump class=md-nav__link> 线程栈自动dump </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/netty4/ title=Netty4 class=md-nav__link> Netty4 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/serialization/ title=Kryo和FST序列化 class=md-nav__link> Kryo和FST序列化 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/simplify-registry-data/ title=简化注册中心URL class=md-nav__link> 简化注册中心URL </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../demos/api.md title="API 参考手册" class=md-nav__link> API 参考手册 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-7 type=checkbox id=nav-1-1-7> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-7> schema 配置参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="schema 配置参考手册" data-md-level=3> <label class=md-nav__title for=nav-1-1-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> schema 配置参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-service/ title=dubbo:service class=md-nav__link> dubbo:service </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-reference/ title=dubbo:reference class=md-nav__link> dubbo:reference </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-protocol/ title=dubbo:protocol class=md-nav__link> dubbo:protocol </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-registry/ title=dubbo:registry class=md-nav__link> dubbo:registry </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-monitor/ title=dubbo:monitor class=md-nav__link> dubbo:monitor </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-application/ title=dubbo:application class=md-nav__link> dubbo:application </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-module/ title=dubbo:module class=md-nav__link> dubbo:module </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-provider/ title=dubbo:provider class=md-nav__link> dubbo:provider </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-consumer/ title=dubbo:consumer class=md-nav__link> dubbo:consumer </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-method/ title=dubbo:method class=md-nav__link> dubbo:method </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-argument/ title=dubbo:argument class=md-nav__link> dubbo:argument </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-parameter/ title=dubbo:parameter class=md-nav__link> dubbo:parameter </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/xml/dubbo-config-center/ title=dubbo:config-center class=md-nav__link> dubbo:config-center </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-8 type=checkbox id=nav-1-1-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-8> 协议参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=协议参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 协议参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/protocol/dubbo/ title=dubbo:// class=md-nav__link> dubbo:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/protocol/rmi/ title=rmi:// class=md-nav__link> rmi:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/protocol/hessian/ title=hessian:// class=md-nav__link> hessian:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/protocol/http/ title=http:// class=md-nav__link> http:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/protocol/thrift/ title=thrift:// class=md-nav__link> thrift:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/protocol/rest/ title=rest:// class=md-nav__link> rest:// </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-9 type=checkbox id=nav-1-1-9> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-9> 注册中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=注册中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 注册中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/registry/multicast/ title="Multicast 注册中心" class=md-nav__link> Multicast 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/registry/zookeeper/ title="Zookeeper 注册中心" class=md-nav__link> Zookeeper 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/registry/redis/ title="Redis 注册中心" class=md-nav__link> Redis 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/registry/simple/ title="Simple 注册中心" class=md-nav__link> Simple 注册中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-10 type=checkbox id=nav-1-1-10> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-10> 元数据中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=元数据中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-10> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 元数据中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/metadata/metadata-redis/ title="Redis 元数据中心" class=md-nav__link> Redis 元数据中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/metadata/metadata-zookeeper/ title="Zookeeper 元数据中心" class=md-nav__link> Zookeeper 元数据中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/telnet/ title="telnet 命令参考手册" class=md-nav__link> telnet 命令参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/qos/ title=在线运维命令-QOS class=md-nav__link> 在线运维命令-QOS </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../references/maven/ title="maven 插件参考手册" class=md-nav__link> maven 插件参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../best-practice/ title=服务化最佳实践 class=md-nav__link> 服务化最佳实践 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../recommend/ title=推荐用法 class=md-nav__link> 推荐用法 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../capacity-plan/ title=容量规划 class=md-nav__link> 容量规划 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../perf-test/ title=性能测试报告 class=md-nav__link> 性能测试报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../covergence.md title=测试覆盖率报告 class=md-nav__link> 测试覆盖率报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-19 type=checkbox id=nav-1-1-19> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-19> 版本与升级 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=版本与升级 data-md-level=3> <label class=md-nav__title for=nav-1-1-19> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 版本与升级 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../versions/version-270/ title=2.7.x升级步骤及注意事项 class=md-nav__link> 2.7.x升级步骤及注意事项 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2> 开发手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=开发手册 data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 开发手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/build.md title=源码构建 class=md-nav__link> 源码构建 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/design.md title=框架设计 class=md-nav__link> 框架设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/SPI.md title=扩展点加载 class=md-nav__link> 扩展点加载 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/implementation.md title=实现细节 class=md-nav__link> 实现细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-5 type=checkbox id=nav-1-2-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-5> SPI 扩展实现 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="SPI 扩展实现" data-md-level=3> <label class=md-nav__title for=nav-1-2-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> SPI 扩展实现 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/protocol.md title=协议扩展 class=md-nav__link> 协议扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/filter.md title=调用拦截扩展 class=md-nav__link> 调用拦截扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/invoker-listener.md title=引用监听扩展 class=md-nav__link> 引用监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/exporter-listener.md title=暴露监听扩展 class=md-nav__link> 暴露监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/cluster.md title=集群扩展 class=md-nav__link> 集群扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/router.md title=路由扩展 class=md-nav__link> 路由扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/load-balance.md title=负载均衡扩展 class=md-nav__link> 负载均衡扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/merger.md title=合并结果扩展 class=md-nav__link> 合并结果扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/registry.md title=注册中心扩展 class=md-nav__link> 注册中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/monitor.md title=监控中心扩展 class=md-nav__link> 监控中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/extension-factory.md title=扩展点加载扩展 class=md-nav__link> 扩展点加载扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/proxy-factory.md title=动态代理扩展 class=md-nav__link> 动态代理扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/compiler.md title=编译器扩展 class=md-nav__link> 编译器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/dispatcher.md title=消息派发扩展 class=md-nav__link> 消息派发扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/threadpool.md title=线程池扩展 class=md-nav__link> 线程池扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/serialize.md title=序列化扩展 class=md-nav__link> 序列化扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/remoting.md title=网络传输扩展 class=md-nav__link> 网络传输扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/exchanger.md title=信息交换扩展 class=md-nav__link> 信息交换扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/networker.md title=组网扩展 class=md-nav__link> 组网扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/telnet-handler.md title="Telnet 命令扩展" class=md-nav__link> Telnet 命令扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/status-checker.md title=状态检查扩展 class=md-nav__link> 状态检查扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/container.md title=容器扩展 class=md-nav__link> 容器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/page.md title=页面扩展 class=md-nav__link> 页面扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/cache.md title=缓存扩展 class=md-nav__link> 缓存扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/validation.md title=验证扩展 class=md-nav__link> 验证扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/logger-adapter.md title=日志适配扩展 class=md-nav__link> 日志适配扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/config-center.md title=配置中心 class=md-nav__link> 配置中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/contract.md title=公共契约 class=md-nav__link> 公共契约 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/coding.md title=编码约定 class=md-nav__link> 编码约定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-8 type=checkbox id=nav-1-2-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-8> 设计原则 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=设计原则 data-md-level=3> <label class=md-nav__title for=nav-1-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 设计原则 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/code-detail.md title=魔鬼在细节 class=md-nav__link> 魔鬼在细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/general-knowledge.md title=一些设计上的基本常识 class=md-nav__link> 一些设计上的基本常识 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/expansibility.md title=谈谈扩充式扩展与增量式扩展 class=md-nav__link> 谈谈扩充式扩展与增量式扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/configuration.md title=配置设计 class=md-nav__link> 配置设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/robustness.md title=设计实现的健壮性 class=md-nav__link> 设计实现的健壮性 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/dummy.md title=防痴呆设计 class=md-nav__link> 防痴呆设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/extension.md title=扩展点重构 class=md-nav__link> 扩展点重构 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/release.md title=版本发布 class=md-nav__link> 版本发布 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/contribution.md title=贡献代码 class=md-nav__link> 贡献代码 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/checklist.md title=检查列表 class=md-nav__link> 检查列表 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/code-smell.md title=坏味道 class=md-nav__link> 坏味道 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/TCK.md title=兼容性测试 class=md-nav__link> 兼容性测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-3> 管理者文档 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=管理者文档 data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 管理者文档 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/introduction.md title="Dubbo Admin介绍" class=md-nav__link> Dubbo Admin介绍 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/serviceSearch.md title=服务搜索和详情 class=md-nav__link> 服务搜索和详情 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/serviceGovernance.md title=服务治理 class=md-nav__link> 服务治理 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/serviceTest.md title=服务测试 class=md-nav__link> 服务测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 3.0 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=3.0 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 3.0 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../3.0/user/preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../3.0/user/preface/background/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../3.0/user/preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../3.0/user/preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 博客 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=博客 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 博客 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/apache-dubbo-2019-2020/ title="2019-2020 回顾" class=md-nav__link> 2019-2020 回顾 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 开发者指南 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=开发者指南 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 开发者指南 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/developers_dev/ title=开发者指引 class=md-nav__link> 开发者指引 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 目录 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 概述 </a> </li> <li class=md-nav__item> <a href=#rest class=md-nav__link> REST的优点 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 应用场景 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 快速入门 </a> <nav class=md-nav aria-label=快速入门> <ul class=md-nav__list> <li class=md-nav__item> <a href=#annotation class=md-nav__link> Annotation放在接口类还是实现类 </a> </li> <li class=md-nav__item> <a href=#jsonxml class=md-nav__link> JSON、XML等多数据格式的支持 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 中文字符支持 </a> </li> <li class=md-nav__item> <a href=#xml class=md-nav__link> XML数据格式的额外要求 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 定制序列化 </a> </li> <li class=md-nav__item> <a href=#rest-server class=md-nav__link> 配置REST Server的实现 </a> </li> <li class=md-nav__item> <a href=#context class=md-nav__link> 获取上下文（Context）信息 </a> </li> <li class=md-nav__item> <a href=#context-path class=md-nav__link> 配置端口号和Context Path </a> </li> <li class=md-nav__item> <a href=#io class=md-nav__link> 配置线程数和IO线程数 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 配置长连接 </a> </li> <li class=md-nav__item> <a href=#http class=md-nav__link> 配置最大的HTTP连接数 </a> </li> <li class=md-nav__item> <a href=#http_1 class=md-nav__link> 配置每个消费端的超时时间和HTTP连接数 </a> </li> <li class=md-nav__item> <a href=#gzip class=md-nav__link> GZIP数据压缩 </a> </li> <li class=md-nav__item> <a href=#annotationspring-xml class=md-nav__link> 用Annotation取代部分Spring XML配置 </a> </li> <li class=md-nav__item> <a href=#filterinterceptor class=md-nav__link> 添加自定义的Filter、Interceptor等 </a> </li> <li class=md-nav__item> <a href=#exception class=md-nav__link> 添加自定义的Exception处理 </a> </li> <li class=md-nav__item> <a href=#http_2 class=md-nav__link> 配置HTTP日志输出 </a> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 输入参数的校验 </a> </li> <li class=md-nav__item> <a href=#rest_1 class=md-nav__link> 是否应该透明发布REST服务 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rest_2 class=md-nav__link> REST服务消费端详解 </a> <nav class=md-nav aria-label=REST服务消费端详解> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1dubbodubborest class=md-nav__link> 场景1：非dubbo的消费端调用dubbo的REST服务 </a> </li> <li class=md-nav__item> <a href=#2dubbodubborest class=md-nav__link> 场景2：dubbo消费端调用dubbo的REST服务 </a> </li> <li class=md-nav__item> <a href=#3dubbodubborest class=md-nav__link> 场景3：dubbo的消费端调用非dubbo的REST服务 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#dubbojax-rs class=md-nav__link> Dubbo中JAX-RS的限制 </a> </li> <li class=md-nav__item> <a href=#restrest-faq class=md-nav__link> REST常见问题解答（REST FAQ） </a> <nav class=md-nav aria-label="REST常见问题解答（REST FAQ）"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dubbo-restdubbo class=md-nav__link> Dubbo REST的服务能和Dubbo注册中心、监控中心集成吗？ </a> </li> <li class=md-nav__item> <a href=#dubbo-restfailover class=md-nav__link> Dubbo REST中如何实现负载均衡和容错（failover）？ </a> </li> <li class=md-nav__item> <a href=#jax-rsurl class=md-nav__link> JAX-RS中重载的方法能够映射到同一URL地址吗？ </a> </li> <li class=md-nav__item> <a href=#jax-rspost class=md-nav__link> JAX-RS中作POST的方法能够接收多个参数吗？ </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#dubborest class=md-nav__link> Dubbo当前体系的不足之处（与REST相关的） </a> <nav class=md-nav aria-label=Dubbo当前体系的不足之处（与REST相关的）> <ul class=md-nav__list> <li class=md-nav__item> <a href=#rpccontext class=md-nav__link> RpcContext的侵入性 </a> </li> <li class=md-nav__item> <a href=#protocol class=md-nav__link> Protocol配置的局限性 </a> </li> <li class=md-nav__item> <a href=#xmlspring class=md-nav__link> XML命名不符合spring规范 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#rest_3 class=md-nav__link> REST最佳实践 </a> </li> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 性能基准测试 </a> <nav class=md-nav aria-label=性能基准测试> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 测试环境 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 测试脚本 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 测试结果 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 性能优化建议 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 扩展讨论 </a> <nav class=md-nav aria-label=扩展讨论> <ul class=md-nav__list> <li class=md-nav__item> <a href=#restthriftprotobuf class=md-nav__link> REST与Thrift、Protobuf等的对比 </a> </li> <li class=md-nav__item> <a href=#restwebservices class=md-nav__link> REST与传统WebServices的对比 </a> </li> <li class=md-nav__item> <a href=#jax-rsspring-mvc class=md-nav__link> JAX-RS与Spring MVC的对比 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 未来 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/apache/dubbo-website/edit/master/zh-cn/docs/2.7/user/rest.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=dubbo-rest-restful-remoting>在 Dubbo 中开发 REST 风格的远程调用（RESTful Remoting）<a class=headerlink href=#dubbo-rest-restful-remoting title="Permanent link">&para;</a></h1> <p><strong>作者：沈理</strong></p> <p><strong>文档版权：<a href=http://www.apache.org/licenses/LICENSE-2.0>Apache 2.0许可证 署名-禁止演绎</a></strong></p> <p>完善中……</p> <blockquote> <p>本文篇幅较长，因为REST本身涉及面较多。另外，本文参照Spring等的文档风格，不仅仅局限于框架用法的阐述，同时也努力呈现框架的设计理念和优良应用的架构思想。</p> <p>对于想粗略了解dubbo和REST的人，只需浏览 <code>概述</code> 至 <code>标准Java REST API：JAX-RS简介</code> 几节即可。</p> </blockquote> <p>TODO 生成可点击的目录</p> <h2 id=_1>目录<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <ul> <li>概述</li> <li>REST的优点</li> <li>应用场景</li> <li>快速入门</li> <li>标准Java REST API：JAX-RS简介</li> <li>REST服务提供端详解<ul> <li>HTTP POST/GET的实现</li> <li>Annotation放在接口类还是实现类</li> <li>JSON、XML等多数据格式的支持</li> <li>中文字符支持</li> <li>XML数据格式的额外要求</li> <li>定制序列化</li> <li>配置REST Server的实现</li> <li>获取上下文（Context）信息</li> <li>配置端口号和Context Path </li> <li>配置线程数和IO线程数 </li> <li>配置长连接 </li> <li>配置最大的HTTP连接数</li> <li>配置每个消费端的超时时间和HTTP连接数 </li> <li>GZIP数据压缩 </li> <li>用Annotation取代部分Spring XML配置 </li> <li>添加自定义的Filter、Interceptor等</li> <li>添加自定义的Exception处理 </li> <li>配置HTTP日志输出</li> <li>输入参数的校验</li> <li>是否应该透明发布REST服务 </li> </ul> </li> <li>REST服务消费端详解 <ul> <li>场景1：非dubbo的消费端调用dubbo的REST服务 </li> <li>场景2：dubbo消费端调用dubbo的REST服务 </li> <li>场景3：dubbo的消费端调用非dubbo的REST服务 </li> </ul> </li> <li>Dubbo中JAX-RS的限制 </li> <li>REST常见问题解答（REST FAQ）<ul> <li>Dubbo REST的服务能和Dubbo注册中心、监控中心集成吗？</li> <li>Dubbo REST中如何实现负载均衡和容错（failover）？</li> <li>JAX-RS中重载的方法能够映射到同一URL地址吗？</li> <li>JAX-RS中作POST的方法能够接收多个参数吗？</li> </ul> </li> <li>Dubbo当前体系可能的不足之处（与REST相关的） <ul> <li>RpcContext的侵入性 </li> <li>Protocol配置的局限性 </li> <li>XML命名不符合spring规范 </li> </ul> </li> <li>REST最佳实践 </li> <li>性能基准测试 <ul> <li>测试环境 </li> <li>测试脚本 </li> <li>测试结果</li> </ul> </li> <li>扩展讨论<ul> <li>REST与Thrift、Protobuf等的对比 </li> <li>REST与传统WebServices的对比 </li> <li>JAX-RS与Spring MVC的对比 </li> </ul> </li> <li>未来 </li> </ul> <h2 id=_2>概述<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <p>dubbo支持多种远程调用方式，例如dubbo RPC（二进制序列化 + tcp协议）、http invoker（二进制序列化 + http协议，至少在开源版本没发现对文本序列化的支持）、hessian（二进制序列化 + http协议）、WebServices （文本序列化 + http协议）等等，但缺乏对当今特别流行的REST风格远程调用（文本序列化 + http协议）的支持。</p> <p>有鉴于此，我们基于标准的Java REST API——JAX-RS 2.0（Java API for RESTful Web Services的简写），为dubbo提供了接近透明的REST调用支持。由于完全兼容Java标准API，所以为dubbo开发的所有REST服务，未来脱离dubbo或者任何特定的REST底层实现一般也可以正常运行。</p> <p>特别值得指出的是，我们并不需要完全严格遵守REST的原始定义和架构风格。即使著名的Twitter REST API也会根据情况做适度调整，而不是机械的遵守原始的REST风格。</p> <blockquote> <p>附注：我们将这个功能称之为REST风格的远程调用，即RESTful Remoting（抽象的远程处理或者调用），而不是叫RESTful RPC（具体的远程“过程”调用），是因为REST和RPC本身可以被认为是两种不同的风格。在dubbo的REST实现中，可以说有两个面向，其一是提供或消费正常的REST服务，其二是将REST作为dubbo RPC体系中一种协议实现，而RESTful Remoting同时涵盖了这两个面向。</p> </blockquote> <h2 id=rest>REST的优点<a class=headerlink href=#rest title="Permanent link">&para;</a></h2> <p>以下摘自维基百科：</p> <ul> <li>可更高效利用缓存来提高响应速度</li> <li>通讯本身的无状态性可以让不同的服务器的处理一系列请求中的不同请求，提高服务器的扩展性</li> <li>浏览器即可作为客户端，简化软件需求</li> <li>相对于其他叠加在HTTP协议之上的机制，REST的软件依赖性更小</li> <li>不需要额外的资源发现机制</li> <li>在软件技术演进中的长期的兼容性更好</li> </ul> <p>这里我还想特别补充REST的显著优点：基于简单的文本格式消息和通用的HTTP协议，使它具备极广的适用性，几乎所有语言和平台都对它提供支持，同时其学习和使用的门槛也较低。</p> <h2 id=_3>应用场景<a class=headerlink href=#_3 title="Permanent link">&para;</a></h2> <p>正是由于REST在适用性方面的优点，所以在dubbo中支持REST，可以为当今多数主流的远程调用场景都带来（显著）好处：</p> <ol> <li> <p>显著简化企业内部的异构系统之间的（跨语言）调用。此处主要针对这种场景：dubbo的系统做服务提供端，其他语言的系统（也包括某些不基于dubbo的java系统）做服务消费端，两者通过HTTP和文本消息进行通信。即使相比Thrift、ProtoBuf等二进制跨语言调用方案，REST也有自己独特的优势（详见后面讨论）</p> </li> <li> <p>显著简化对外Open API（开放平台）的开发。既可以用dubbo来开发专门的Open API应用，也可以将原内部使用的dubbo service直接“透明”发布为对外的Open REST API（当然dubbo本身未来最好可以较透明的提供诸如权限控制、频次控制、计费等诸多功能）</p> </li> <li> <p>显著简化手机（平板）APP或者PC桌面客户端开发。类似于2，既可以用dubbo来开发专门针对无线或者桌面的服务器端，也可以将原内部使用的dubbo service直接”透明“的暴露给手机APP或桌面程序。当然在有些项目中，手机或桌面程序也可以直接访问以上场景2中所述的Open API。</p> </li> <li> <p>显著简化浏览器AJAX应用的开发。类似于2，既可以用dubbo来开发专门的AJAX服务器端，也可以将原内部使用的dubbo service直接”透明“的暴露给浏览器中JavaScript。当然，很多AJAX应用更适合与web框架协同工作，所以直接访问dubbo service在很多web项目中未必是一种非常优雅的架构。</p> </li> <li> <p>为企业内部的dubbo系统之间（即服务提供端和消费端都是基于dubbo的系统）提供一种基于文本的、易读的远程调用方式。</p> </li> <li> <p>一定程度简化dubbo系统对其它异构系统的调用。可以用类似dubbo的简便方式“透明”的调用非dubbo系统提供的REST服务（不管服务提供端是在企业内部还是外部）</p> </li> </ol> <p>需要指出的是，我认为1～3是dubbo的REST调用最有价值的三种应用场景，并且我们为dubbo添加REST调用，其最主要到目的也是面向服务的提供端，即开发REST服务来提供给非dubbo的（异构）消费端。</p> <p>归纳起来，所有应用场景如下图所示： <img alt="no image found" src=../sources/images/rest.jpg></p> <p>借用Java过去最流行的宣传语，为dubbo添加REST调用后，可以实现服务的”一次编写，到处访问“，理论上可以面向全世界开放，从而真正实现比较理想化的面向服务架构（SOA）。</p> <p>当然，传统的WebServices（WSDL/SOAP）也基本同样能满足以上场景（除了场景4）的要求（甚至还能满足那些需要企业级特性的场景），但由于其复杂性等问题，现在已经越来越少被实际采用了。</p> <h2 id=_4>快速入门<a class=headerlink href=#_4 title="Permanent link">&para;</a></h2> <p>在dubbo中开发一个REST风格的服务会比较简单，下面以一个注册用户的简单服务为例说明。</p> <p>这个服务要实现的功能是提供如下URL（注：这个URL不是完全符合REST的风格，但是更简单实用）：</p> <div class=highlight><pre><span></span><code>http://localhost:8080/users/register
</code></pre></div> <p>而任何客户端都可以将包含用户信息的JSON字符串POST到以上URL来完成用户注册。</p> <p>首先，开发服务的接口：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserService</span> <span class=p>{</span>    
   <span class=kt>void</span> <span class=nf>registerUser</span><span class=p>(</span><span class=n>User</span> <span class=n>user</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>然后，开发服务的实现：</p> <p><div class=highlight><pre><span></span><code><span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;users&quot;</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserServiceImpl</span> <span class=kd>implements</span> <span class=n>UserService</span> <span class=p>{</span>

    <span class=nd>@POST</span>
    <span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;register&quot;</span><span class=p>)</span>
    <span class=nd>@Consumes</span><span class=p>({</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>})</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>registerUser</span><span class=p>(</span><span class=n>User</span> <span class=n>user</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// save the user...</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> 上面的服务实现代码非常简单，但是由于REST服务是要被发布到特定HTTP URL，供任意语言客户端甚至浏览器来访问，所以这里要额外添加了几个JAX-RS的标准annotation来做相关的配置：</p> <p><a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Path title="GitHub User: Path">@Path</a>("users")：指定访问UserService的URL相对路径是/users，即http://localhost:8080/users</p> <p><a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Path title="GitHub User: Path">@Path</a>("register")：指定访问registerUser()方法的URL相对路径是/register，再结合上一个@Path为UserService指定的路径，则调用UserService.register()的完整路径为http://localhost:8080/users/register</p> <p><a class="magiclink magiclink-github magiclink-mention" href=https://github.com/POST title="GitHub User: POST">@POST</a>：指定访问registerUser()用HTTP POST方法</p> <p><a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Consumes title="GitHub User: Consumes">@Consumes</a>({MediaType.APPLICATION_JSON})：指定registerUser()接收JSON格式的数据。REST框架会自动将JSON数据反序列化为User对象</p> <p>最后，在spring配置文件中添加此服务，即完成所有服务开发工作：</p> <p>```xml <!-- 用rest协议在8080端口暴露服务 --></p> <p><dubbo:protocol name=rest port=8080 /></p> <!-- 声明需要暴露的服务接口 --> <p><dubbo:service interface=xxx.UserService ref=userService /></p> <!-- 和本地bean一样实现服务 --> <p><bean id=userService class=xxx.UserServiceImpl /> <div class=highlight><pre><span></span><code>## 标准Java REST API：JAX-RS简介

JAX-RS是标准的Java REST API，得到了业界的广泛支持和应用，其著名的开源实现就有很多，包括Oracle的Jersey，RedHat的RestEasy，Apache的CXF和Wink，以及restlet等等。另外，所有支持JavaEE 6.0以上规范的商用JavaEE应用服务器都对JAX-RS提供了支持。因此，JAX-RS是一种已经非常成熟的解决方案，并且采用它没有任何所谓vendor lock-in的问题。

JAX-RS在网上的资料非常丰富，例如下面的入门教程：

* Oracle官方的tutorial：http://docs.oracle.com/javaee/7/tutorial/doc/jaxrs.htm
* IBM developerWorks中国站文章：http://www.ibm.com/developerworks/cn/java/j-lo-jaxrs/

更多的资料请自行google或者百度一下。就学习JAX-RS来说，一般主要掌握其各种annotation的用法即可。

&gt; 注意：dubbo是基于JAX-RS 2.0版本的，有时候需要注意一下资料或REST实现所涉及的版本。

## REST服务提供端详解

下面我们扩充“快速入门”中的UserService，进一步展示在dubbo中REST服务提供端的开发要点。

### HTTP POST/GET的实现

REST服务中虽然建议使用HTTP协议中四种标准方法POST、DELETE、PUT、GET来分别实现常见的“增删改查”，但实际中，我们一般情况直接用POST来实现“增改”，GET来实现“删查”即可（DELETE和PUT甚至会被一些防火墙阻挡）。

前面已经简单演示了POST的实现，在此，我们为UserService添加一个获取注册用户资料的功能，来演示GET的实现。

这个功能就是要实现客户端通过访问如下不同URL来获取不同ID的用户资料：
</code></pre></div> <a href=http://localhost:8080/users/1001>http://localhost:8080/users/1001</a> <a href=http://localhost:8080/users/1002>http://localhost:8080/users/1002</a> <a href=http://localhost:8080/users/1003>http://localhost:8080/users/1003</a> <div class=highlight><pre><span></span><code>当然，也可以通过其他形式的URL来访问不同ID的用户资料，例如：
</code></pre></div> <a href="http://localhost:8080/users/load?id=1001">http://localhost:8080/users/load?id=1001</a> <div class=highlight><pre><span></span><code>JAX-RS本身可以支持所有这些形式。但是上面那种在URL路径中包含查询参数的形式（http://localhost:8080/users/1001） 更符合REST的一般习惯，所以更推荐大家来使用。下面我们就为UserService添加一个getUser()方法来实现这种形式的URL访问：

```java
@GET
@Path(&quot;{id : \\d+}&quot;)
@Produces({MediaType.APPLICATION_JSON})
public User getUser(@PathParam(&quot;id&quot;) Long id) {
    // ...
}
</code></pre></div></p> <p><a class="magiclink magiclink-github magiclink-mention" href=https://github.com/GET title="GitHub User: GET">@GET</a>：指定用HTTP GET方法访问</p> <p><a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Path title="GitHub User: Path">@Path</a>("{id : \d+}")：根据上面的功能需求，访问getUser()的URL应当是“<a href=http://localhost:8080/users/ >http://localhost:8080/users/</a> + 任意数字"，并且这个数字要被做为参数传入getUser()方法。 这里的annotation配置中，@Path中间的{id: xxx}指定URL相对路径中包含了名为id参数，而它的值也将被自动传递给下面用<a class="magiclink magiclink-github magiclink-mention" href=https://github.com/PathParam title="GitHub User: PathParam">@PathParam</a>("id")修饰的方法参数id。{id:后面紧跟的\d+是一个正则表达式，指定了id参数必须是数字。</p> <p><a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Produces title="GitHub User: Produces">@Produces</a>({MediaType.APPLICATION_JSON})：指定getUser()输出JSON格式的数据。框架会自动将User对象序列化为JSON数据。</p> <h3 id=annotation>Annotation放在接口类还是实现类<a class=headerlink href=#annotation title="Permanent link">&para;</a></h3> <p>在Dubbo中开发REST服务主要都是通过JAX-RS的annotation来完成配置的，在上面的示例中，我们都是将annotation放在服务的实现类中。但其实，我们完全也可以将annotation放到服务的接口上，这两种方式是完全等价的，例如：</p> <div class=highlight><pre><span></span><code><span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;users&quot;</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>UserService</span> <span class=p>{</span>

    <span class=nd>@GET</span>
    <span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;{id : \\d+}&quot;</span><span class=p>)</span>
    <span class=nd>@Produces</span><span class=p>({</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>})</span>
    <span class=n>User</span> <span class=nf>getUser</span><span class=p>(</span><span class=nd>@PathParam</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span> <span class=n>Long</span> <span class=n>id</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>在一般应用中，我们建议将annotation放到服务实现类，这样annotation和java实现代码位置更接近，更便于开发和维护。另外更重要的是，我们一般倾向于避免对接口的污染，保持接口的纯净性和广泛适用性。</p> <p>但是，如后文所述，如果我们要用dubbo直接开发的消费端来访问此服务，则annotation必须放到接口上。</p> <p>如果接口和实现类都同时添加了annotation，则实现类的annotation配置会生效，接口上的annotation被直接忽略。</p> <h3 id=jsonxml>JSON、XML等多数据格式的支持<a class=headerlink href=#jsonxml title="Permanent link">&para;</a></h3> <p>在dubbo中开发的REST服务可以同时支持传输多种格式的数据，以给客户端提供最大的灵活性。其中我们目前对最常用的JSON和XML格式特别添加了额外的功能。</p> <p>比如，我们要让上例中的getUser()方法支持分别返回JSON和XML格式的数据，只需要在annotation中同时包含两种格式即可：</p> <div class=highlight><pre><span></span><code><span class=nd>@Produces</span><span class=p>({</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>,</span> <span class=n>MediaType</span><span class=p>.</span><span class=na>TEXT_XML</span><span class=p>})</span>
<span class=n>User</span> <span class=nf>getUser</span><span class=p>(</span><span class=nd>@PathParam</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span> <span class=n>Long</span> <span class=n>id</span><span class=p>);</span>
</code></pre></div> <p>或者也可以直接用字符串（还支持通配符）表示MediaType： </p> <div class=highlight><pre><span></span><code><span class=nd>@Produces</span><span class=p>({</span><span class=s>&quot;application/json&quot;</span><span class=p>,</span> <span class=s>&quot;text/xml&quot;</span><span class=p>})</span>
<span class=n>User</span> <span class=nf>getUser</span><span class=p>(</span><span class=nd>@PathParam</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span> <span class=n>Long</span> <span class=n>id</span><span class=p>);</span>
</code></pre></div> <p>如果所有方法都支持同样类型的输入输出数据格式，则我们无需在每个方法上做配置，只需要在服务类上添加annotation即可：</p> <div class=highlight><pre><span></span><code><span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;users&quot;</span><span class=p>)</span>
<span class=nd>@Consumes</span><span class=p>({</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>,</span> <span class=n>MediaType</span><span class=p>.</span><span class=na>TEXT_XML</span><span class=p>})</span>
<span class=nd>@Produces</span><span class=p>({</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>,</span> <span class=n>MediaType</span><span class=p>.</span><span class=na>TEXT_XML</span><span class=p>})</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserServiceImpl</span> <span class=kd>implements</span> <span class=n>UserService</span> <span class=p>{</span>
    <span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div> <p>在一个REST服务同时对多种数据格式支持的情况下，根据JAX-RS标准，一般是通过HTTP中的MIME header（content-type和accept）来指定当前想用的是哪种格式的数据。</p> <p>但是在dubbo中，我们还自动支持目前业界普遍使用的方式，即用一个URL后缀（.json和.xml）来指定想用的数据格式。例如，在添加上述annotation后，直接访问http://localhost:8888/users/1001.json则表示用json格式，直接访问http://localhost:8888/users/1002.xml则表示用xml格式，比用HTTP Header更简单直观。Twitter、微博等的REST API都是采用这种方式。</p> <p>如果你既不加HTTP header，也不加后缀，则dubbo的REST会优先启用在以上annotation定义中排位最靠前的那种数据格式。</p> <blockquote> <p>注意：这里要支持XML格式数据，在annotation中既可以用MediaType.TEXT_XML，也可以用MediaType.APPLICATION_XML，但是TEXT_XML是更常用的，并且如果要利用上述的URL后缀方式来指定数据格式，只能配置为TEXT_XML才能生效。</p> </blockquote> <h3 id=_5>中文字符支持<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>为了在dubbo REST中正常输出中文字符，和通常的Java web应用一样，我们需要将HTTP响应的contentType设置为UTF-8编码。</p> <p>基于JAX-RS的标准用法，我们只需要做如下annotation配置即可：</p> <div class=highlight><pre><span></span><code><span class=nd>@Produces</span><span class=p>({</span><span class=s>&quot;application/json; charset=UTF-8&quot;</span><span class=p>,</span> <span class=s>&quot;text/xml; charset=UTF-8&quot;</span><span class=p>})</span>
<span class=n>User</span> <span class=nf>getUser</span><span class=p>(</span><span class=nd>@PathParam</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span> <span class=n>Long</span> <span class=n>id</span><span class=p>);</span>
</code></pre></div> <p>为了方便用户，我们在dubbo REST中直接添加了一个支持类，来定义以上的常量，可以直接使用，减少出错的可能性。</p> <div class=highlight><pre><span></span><code><span class=nd>@Produces</span><span class=p>({</span><span class=n>ContentType</span><span class=p>.</span><span class=na>APPLICATION_JSON_UTF_8</span><span class=p>,</span> <span class=n>ContentType</span><span class=p>.</span><span class=na>TEXT_XML_UTF_8</span><span class=p>})</span>
<span class=n>User</span> <span class=nf>getUser</span><span class=p>(</span><span class=nd>@PathParam</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span> <span class=n>Long</span> <span class=n>id</span><span class=p>);</span>
</code></pre></div> <h3 id=xml>XML数据格式的额外要求<a class=headerlink href=#xml title="Permanent link">&para;</a></h3> <p>由于JAX-RS的实现一般都用标准的JAXB（Java API for XML Binding）来序列化和反序列化XML格式数据，所以我们需要为每一个要用XML传输的对象添加一个类级别的JAXB annotation，否则序列化将报错。例如为getUser()中返回的User添加如下：</p> <div class=highlight><pre><span></span><code><span class=nd>@XmlRootElement</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>User</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=p>{</span>
    <span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div> <p>此外，如果service方法中的返回值是Java的 primitive类型（如int，long，float，double等），最好为它们添加一层wrapper对象，因为JAXB不能直接序列化primitive类型。</p> <p>例如，我们想让前述的registerUser()方法返回服务器端为用户生成的ID号：</p> <div class=highlight><pre><span></span><code><span class=kt>long</span> <span class=nf>registerUser</span><span class=p>(</span><span class=n>User</span> <span class=n>user</span><span class=p>);</span>
</code></pre></div> <p>由于primitive类型不被JAXB序列化支持，所以添加一个wrapper对象：</p> <div class=highlight><pre><span></span><code><span class=nd>@XmlRootElement</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RegistrationResult</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=p>{</span>

    <span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=p>;</span>

    <span class=kd>public</span> <span class=nf>RegistrationResult</span><span class=p>()</span> <span class=p>{</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=nf>RegistrationResult</span><span class=p>(</span><span class=n>Long</span> <span class=n>id</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>id</span> <span class=o>=</span> <span class=n>id</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=n>Long</span> <span class=nf>getId</span><span class=p>()</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>id</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setId</span><span class=p>(</span><span class=n>Long</span> <span class=n>id</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>id</span> <span class=o>=</span> <span class=n>id</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>并修改service方法：</p> <div class=highlight><pre><span></span><code><span class=n>RegistrationResult</span> <span class=nf>registerUser</span><span class=p>(</span><span class=n>User</span> <span class=n>user</span><span class=p>);</span>
</code></pre></div> <p>这样不但能够解决XML序列化的问题，而且使得返回的数据都符合XML和JSON的规范。例如，在JSON中，返回的将是如下形式：</p> <div class=highlight><pre><span></span><code><span class=p>{</span><span class=s2>&quot;id&quot;</span><span class=o>:</span> <span class=mf>1001</span><span class=p>}</span>
</code></pre></div> <p>如果不加wrapper，JSON返回值将直接是</p> <div class=highlight><pre><span></span><code>1001    
</code></pre></div> <p>而在XML中，加wrapper后返回值将是：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;registrationResult&gt;</span>
    <span class=nt>&lt;id&gt;</span>1002<span class=nt>&lt;/id&gt;</span>
<span class=nt>&lt;/registrationResult&gt;</span>
</code></pre></div> <p>这种wrapper对象其实利用所谓Data Transfer Object（DTO）模式，采用DTO还能对传输数据做更多有用的定制。 </p> <h3 id=_6>定制序列化<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <p>如上所述，REST的底层实现会在service的对象和JSON/XML数据格式之间自动做序列化/反序列化。但有些场景下，如果觉得这种自动转换不满足要求，可以对其做定制。</p> <p>Dubbo中的REST实现是用JAXB做XML序列化，用Jackson做JSON序列化，所以在对象上添加JAXB或Jackson的annotation即可以定制映射。</p> <p>例如，定制对象属性映射到XML元素的名字：</p> <div class=highlight><pre><span></span><code><span class=nd>@XmlRootElement</span>
<span class=nd>@XmlAccessorType</span><span class=p>(</span><span class=n>XmlAccessType</span><span class=p>.</span><span class=na>FIELD</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>User</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=p>{</span>

    <span class=nd>@XmlElement</span><span class=p>(</span><span class=n>name</span><span class=o>=</span><span class=s>&quot;username&quot;</span><span class=p>)</span> 
    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=p>;</span>  
<span class=p>}</span>
</code></pre></div> <p>定制对象属性映射到JSON字段的名字：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>User</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=p>{</span>

    <span class=nd>@JsonProperty</span><span class=p>(</span><span class=s>&quot;username&quot;</span><span class=p>)</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>更多资料请参考JAXB和Jackson的官方文档，或自行google。</p> <h3 id=rest-server>配置REST Server的实现<a class=headerlink href=#rest-server title="Permanent link">&para;</a></h3> <p>目前在dubbo中，我们支持5种嵌入式rest server的实现，并同时支持采用外部应用服务器来做rest server的实现。rest server的实现是通过如下server这个XML属性来选择的：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>server=</span><span class=s>&quot;jetty&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>以上配置选用了嵌入式的jetty来做rest server，同时，如果不配置server属性，rest协议默认也是选用jetty。jetty是非常成熟的java servlet容器，并和dubbo已经有较好的集成（目前5种嵌入式server中只有jetty和后面所述的tomcat、tjws，与dubbo监控系统等完成了无缝的集成），所以，如果你的dubbo系统是单独启动的进程，你可以直接默认采用jetty即可。</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>server=</span><span class=s>&quot;tomcat&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>以上配置选用了嵌入式的tomcat来做rest server。在嵌入式tomcat上，REST的性能比jetty上要好得多（参见后面的基准测试），建议在需要高性能的场景下采用tomcat。</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>server=</span><span class=s>&quot;netty&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>以上配置选用嵌入式的netty来做rest server。（TODO more contents to add）</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>server=</span><span class=s>&quot;tjws&quot;</span><span class=nt>/&gt;</span> (tjws is now deprecated)
<span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>server=</span><span class=s>&quot;sunhttp&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>以上配置选用嵌入式的tjws或Sun HTTP server来做rest server。这两个server实现非常轻量级，非常方便在集成测试中快速启动使用，当然也可以在负荷不高的生产环境中使用。 注：tjws目前已经被deprecated掉了，因为它不能很好的和servlet 3.1 API工作。</p> <p>如果你的dubbo系统不是单独启动的进程，而是部署到了Java应用服务器中，则建议你采用以下配置：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>server=</span><span class=s>&quot;servlet&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>通过将server设置为servlet，dubbo将采用外部应用服务器的servlet容器来做rest server。同时，还要在dubbo系统的web.xml中添加如下配置：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;web-app&gt;</span>
    <span class=nt>&lt;context-param&gt;</span>
        <span class=nt>&lt;param-name&gt;</span>contextConfigLocation<span class=nt>&lt;/param-name&gt;</span>
        <span class=nt>&lt;param-value&gt;</span>/WEB-INF/classes/META-INF/spring/dubbo-demo-provider.xml<span class=nt>&lt;/param-value&gt;</span>
    <span class=nt>&lt;/context-param&gt;</span>

    <span class=nt>&lt;listener&gt;</span>
        <span class=nt>&lt;listener-class&gt;</span>org.apache.dubbo.remoting.http.servlet.BootstrapListener<span class=nt>&lt;/listener-class&gt;</span>
    <span class=nt>&lt;/listener&gt;</span>

    <span class=nt>&lt;listener&gt;</span>
        <span class=nt>&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class=nt>&lt;/listener-class&gt;</span>
    <span class=nt>&lt;/listener&gt;</span>

    <span class=nt>&lt;servlet&gt;</span>
        <span class=nt>&lt;servlet-name&gt;</span>dispatcher<span class=nt>&lt;/servlet-name&gt;</span>
        <span class=nt>&lt;servlet-class&gt;</span>org.apache.dubbo.remoting.http.servlet.DispatcherServlet<span class=nt>&lt;/servlet-class&gt;</span>
        <span class=nt>&lt;load-on-startup&gt;</span>1<span class=nt>&lt;/load-on-startup&gt;</span>
    <span class=nt>&lt;/servlet&gt;</span>

    <span class=nt>&lt;servlet-mapping&gt;</span>
        <span class=nt>&lt;servlet-name&gt;</span>dispatcher<span class=nt>&lt;/servlet-name&gt;</span>
        <span class=nt>&lt;url-pattern&gt;</span>/*<span class=nt>&lt;/url-pattern&gt;</span>
    <span class=nt>&lt;/servlet-mapping&gt;</span>
<span class=nt>&lt;/web-app&gt;</span>
</code></pre></div> <p>即必须将dubbo的BootstrapListener和DispatherServlet添加到web.xml，以完成dubbo的REST功能与外部servlet容器的集成。</p> <blockquote> <p>注意：如果你是用spring的ContextLoaderListener来加载spring，则必须保证BootstrapListener配置在ContextLoaderListener之前，否则dubbo初始化会出错。</p> </blockquote> <p>其实，这种场景下你依然可以坚持用嵌入式server，但外部应用服务器的servlet容器往往比嵌入式server更加强大（特别是如果你是部署到更健壮更可伸缩的WebLogic，WebSphere等），另外有时也便于在应用服务器做统一管理、监控等等。</p> <h3 id=context>获取上下文（Context）信息<a class=headerlink href=#context title="Permanent link">&para;</a></h3> <p>在远程调用中，值得获取的上下文信息可能有很多种，这里特别以获取客户端IP为例。</p> <p>在dubbo的REST中，我们有两种方式获取客户端IP。</p> <p>第一种方式，用JAX-RS标准的<a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Context title="GitHub User: Context">@Context</a> annotation：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>User</span> <span class=nf>getUser</span><span class=p>(</span><span class=nd>@PathParam</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span> <span class=n>Long</span> <span class=n>id</span><span class=p>,</span> <span class=nd>@Context</span> <span class=n>HttpServletRequest</span> <span class=n>request</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Client address is &quot;</span> <span class=o>+</span> <span class=n>request</span><span class=p>.</span><span class=na>getRemoteAddr</span><span class=p>());</span>
<span class=p>}</span> 
</code></pre></div> <p>用Context修饰getUser()的一个方法参数后，就可以将当前的HttpServletRequest注入进来，然后直接调用servlet api获取IP。</p> <blockquote> <p>注意：这种方式只能在设置server="tjws"或者server="tomcat"或者server="jetty"或者server="servlet"的时候才能工作，因为只有这几种REST server的实现才提供了servlet容器。另外，标准的JAX-RS还支持用@Context修饰service类的一个实例字段来获取HttpServletRequest，但在dubbo中我们没有对此作出支持。</p> </blockquote> <p>第二种方式，用dubbo中常用的RpcContext：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>User</span> <span class=nf>getUser</span><span class=p>(</span><span class=nd>@PathParam</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span> <span class=n>Long</span> <span class=n>id</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Client address is &quot;</span> <span class=o>+</span> <span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getRemoteAddressString</span><span class=p>());</span>
<span class=p>}</span> 
</code></pre></div> <blockquote> <p>注意：这种方式只能在设置server="jetty"或者server="tomcat"或者server="servlet"或者server="tjws"的时候才能工作。另外，目前dubbo的RpcContext是一种比较有侵入性的用法，未来我们很可能会做出重构。</p> </blockquote> <p>如果你想保持你的项目对JAX-RS的兼容性，未来脱离dubbo也可以运行，请选择第一种方式。如果你想要更优雅的服务接口定义，请选用第二种方式。</p> <p>此外，在最新的dubbo rest中，还支持通过RpcContext来获取HttpServletRequest和HttpServletResponse，以提供更大的灵活性来方便用户实现某些复杂功能，比如在dubbo标准的filter中访问HTTP Header。用法示例如下：</p> <div class=highlight><pre><span></span><code><span class=k>if</span> <span class=p>(</span><span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getRequest</span><span class=p>()</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getRequest</span><span class=p>()</span> <span class=k>instanceof</span> <span class=n>HttpServletRequest</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Client address is &quot;</span> <span class=o>+</span> <span class=p>((</span><span class=n>HttpServletRequest</span><span class=p>)</span> <span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getRequest</span><span class=p>()).</span><span class=na>getRemoteAddr</span><span class=p>());</span>
<span class=p>}</span>

<span class=k>if</span> <span class=p>(</span><span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getResponse</span><span class=p>()</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getResponse</span><span class=p>()</span> <span class=k>instanceof</span> <span class=n>HttpServletResponse</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Response object from RpcContext: &quot;</span> <span class=o>+</span> <span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getResponse</span><span class=p>());</span>
<span class=p>}</span>
</code></pre></div> <blockquote> <p>注意：为了保持协议的中立性，RpcContext.getRequest()和RpcContext.getResponse()返回的仅仅是一个Object类，而且可能为null。所以，你必须自己做null和类型的检查。</p> <p>注意：只有在设置server="jetty"或者server="tomcat"或者server="servlet"的时候，你才能通过以上方法正确的得到HttpServletRequest和HttpServletResponse，因为只有这几种server实现了servlet容器。</p> </blockquote> <p>为了简化编程，在此你也可以用泛型的方式来直接获取特定类型的request/response：</p> <div class=highlight><pre><span></span><code><span class=k>if</span> <span class=p>(</span><span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getRequest</span><span class=p>(</span><span class=n>HttpServletRequest</span><span class=p>.</span><span class=na>class</span><span class=p>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Client address is &quot;</span> <span class=o>+</span> <span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getRequest</span><span class=p>(</span><span class=n>HttpServletRequest</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getRemoteAddr</span><span class=p>());</span>
<span class=p>}</span>

<span class=k>if</span> <span class=p>(</span><span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getResponse</span><span class=p>(</span><span class=n>HttpServletResponse</span><span class=p>.</span><span class=na>class</span><span class=p>)</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Response object from RpcContext: &quot;</span> <span class=o>+</span> <span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getResponse</span><span class=p>(</span><span class=n>HttpServletResponse</span><span class=p>.</span><span class=na>class</span><span class=p>));</span>
<span class=p>}</span>
</code></pre></div> <p>如果request/response不符合指定的类型，这里也会返回null。</p> <h3 id=context-path>配置端口号和Context Path<a class=headerlink href=#context-path title="Permanent link">&para;</a></h3> <p>dubbo中的rest协议默认将采用80端口，如果想修改端口，直接配置：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>port=</span><span class=s>&quot;8888&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>另外，如前所述，我们可以用@Path来配置单个rest服务的URL相对路径。但其实，我们还可以设置一个所有rest服务都适用的基础相对路径，即java web应用中常说的context path。</p> <p>只需要添加如下contextpath属性即可：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>port=</span><span class=s>&quot;8888&quot;</span> <span class=na>contextpath=</span><span class=s>&quot;services&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>以前面代码为例：</p> <div class=highlight><pre><span></span><code><span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;users&quot;</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserServiceImpl</span> <span class=kd>implements</span> <span class=n>UserService</span> <span class=p>{</span>

    <span class=nd>@POST</span>
    <span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;register&quot;</span><span class=p>)</span>
    <span class=nd>@Consumes</span><span class=p>({</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>})</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>registerUser</span><span class=p>(</span><span class=n>User</span> <span class=n>user</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// save the user...</span>
    <span class=p>}</span>   
<span class=p>}</span>
</code></pre></div> <p>现在registerUser()的完整访问路径为：</p> <div class=highlight><pre><span></span><code>http://localhost:8888/services/users/register
</code></pre></div> <p>注意：如果你是选用外部应用服务器做rest server，即配置:</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>port=</span><span class=s>&quot;8888&quot;</span> <span class=na>contextpath=</span><span class=s>&quot;services&quot;</span> <span class=na>server=</span><span class=s>&quot;servlet&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>则必须保证这里设置的port、contextpath，与外部应用服务器的端口、DispatcherServlet的上下文路径（即webapp path加上servlet url pattern）保持一致。例如，对于部署为tomcat ROOT路径的应用，这里的contextpath必须与web.xml中DispacherServlet的<code>&lt;url-pattern/&gt;</code>完全一致：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;servlet-mapping&gt;</span>
     <span class=nt>&lt;servlet-name&gt;</span>dispatcher<span class=nt>&lt;/servlet-name&gt;</span>
     <span class=nt>&lt;url-pattern&gt;</span>/services/*<span class=nt>&lt;/url-pattern&gt;</span>
<span class=nt>&lt;/servlet-mapping&gt;</span>
</code></pre></div> <h3 id=io>配置线程数和IO线程数<a class=headerlink href=#io title="Permanent link">&para;</a></h3> <p>可以为rest服务配置线程池大小：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>threads=</span><span class=s>&quot;500&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <blockquote> <p>注意：目前线程池的设置只有当server="netty"或者server="jetty"或者server="tomcat"的时候才能生效。另外，如果server="servlet"，由于这时候启用的是外部应用服务器做rest server，不受dubbo控制，所以这里的线程池设置也无效。</p> </blockquote> <p>如果是选用netty server，还可以配置Netty的IO worker线程数：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>iothreads=</span><span class=s>&quot;5&quot;</span> <span class=na>threads=</span><span class=s>&quot;100&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <h3 id=_7>配置长连接<a class=headerlink href=#_7 title="Permanent link">&para;</a></h3> <p>Dubbo中的rest服务默认都是采用http长连接来访问，如果想切换为短连接，直接配置：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>keepalive=</span><span class=s>&quot;false&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <blockquote> <p>注意：这个配置目前只对server="netty"和server="tomcat"才能生效。</p> </blockquote> <h3 id=http>配置最大的HTTP连接数<a class=headerlink href=#http title="Permanent link">&para;</a></h3> <p>可以配置服务器提供端所能同时接收的最大HTTP连接数，防止REST server被过多连接撑爆，以作为一种最基本的自我保护机制：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>accepts=</span><span class=s>&quot;500&quot;</span> <span class=na>server=</span><span class=s>&quot;tomcat/</span><span class=nt>&gt;</span>
</code></pre></div> <blockquote> <p>注意：这个配置目前只对server="tomcat"才能生效。</p> </blockquote> <h3 id=http_1>配置每个消费端的超时时间和HTTP连接数<a class=headerlink href=#http_1 title="Permanent link">&para;</a></h3> <p>如果rest服务的消费端也是dubbo系统，可以像其他dubbo RPC机制一样，配置消费端调用此rest服务的最大超时时间以及每个消费端所能启动的最大HTTP连接数。</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:service</span> <span class=na>interface=</span><span class=s>&quot;xxx&quot;</span> <span class=na>ref=</span><span class=s>&quot;xxx&quot;</span> <span class=na>protocol=</span><span class=s>&quot;rest&quot;</span> <span class=na>timeout=</span><span class=s>&quot;2000&quot;</span> <span class=na>connections=</span><span class=s>&quot;10&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>当然，由于这个配置针对消费端生效的，所以也可以在消费端配置：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:reference</span> <span class=na>id=</span><span class=s>&quot;xxx&quot;</span> <span class=na>interface=</span><span class=s>&quot;xxx&quot;</span> <span class=na>timeout=</span><span class=s>&quot;2000&quot;</span> <span class=na>connections=</span><span class=s>&quot;10&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>但是，通常我们建议配置在服务提供端提供此类配置。按照dubbo官方文档的说法：“Provider上尽量多配置Consumer端的属性，让Provider实现者一开始就思考Provider服务特点、服务质量的问题。”</p> <blockquote> <p>注意：如果dubbo的REST服务是发布给非dubbo的客户端使用，则这里<code>&lt;dubbo:service/&gt;</code>上的配置完全无效，因为这种客户端不受dubbo控制。</p> </blockquote> <h3 id=gzip>GZIP数据压缩<a class=headerlink href=#gzip title="Permanent link">&para;</a></h3> <p>Dubbo的REST支持用GZIP压缩请求和响应的数据，以减少网络传输时间和带宽占用，但这种方式会也增加CPU开销。</p> <p>TODO more contents to add</p> <h3 id=annotationspring-xml>用Annotation取代部分Spring XML配置<a class=headerlink href=#annotationspring-xml title="Permanent link">&para;</a></h3> <p>以上所有的讨论都是基于dubbo在spring中的xml配置。但是，dubbo/spring本身也支持用annotation来作配置，所以我们也可以按dubbo官方文档中的步骤，把相关annotation加到REST服务的实现中，取代一些xml配置，例如：</p> <div class=highlight><pre><span></span><code><span class=nd>@Service</span><span class=p>(</span><span class=n>protocol</span> <span class=o>=</span> <span class=s>&quot;rest&quot;</span><span class=p>)</span>
<span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;users&quot;</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>UserServiceImpl</span> <span class=kd>implements</span> <span class=n>UserService</span> <span class=p>{</span>

    <span class=nd>@Autowired</span>
    <span class=kd>private</span> <span class=n>UserRepository</span> <span class=n>userRepository</span><span class=p>;</span>

    <span class=nd>@POST</span>
    <span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;register&quot;</span><span class=p>)</span>
    <span class=nd>@Consumes</span><span class=p>({</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>})</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>registerUser</span><span class=p>(</span><span class=n>User</span> <span class=n>user</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// save the user</span>
        <span class=n>userRepository</span><span class=p>.</span><span class=na>save</span><span class=p>(</span><span class=n>user</span><span class=p>);</span>
    <span class=p>}</span>   
<span class=p>}</span>
</code></pre></div> <p>annotation的配置更简单更精确，经常也更便于维护（当然现代IDE都可以在xml中支持比如类名重构，所以就这里的特定用例而言，xml的维护性也很好）。而xml对代码的侵入性更小一些，尤其有利于动态修改配置，特别是比如你要针对单个服务配置连接超时时间、每客户端最大连接数、集群策略、权重等等。另外，特别对复杂应用或者模块来说，xml提供了一个中心点来涵盖的所有组件和配置，更一目了然，一般更便于项目长时期的维护。</p> <p>当然，选择哪种配置方式没有绝对的优劣，和个人的偏好也不无关系。</p> <h3 id=filterinterceptor>添加自定义的Filter、Interceptor等<a class=headerlink href=#filterinterceptor title="Permanent link">&para;</a></h3> <p>Dubbo的REST也支持JAX-RS标准的Filter和Interceptor，以方便对REST的请求与响应过程做定制化的拦截处理。</p> <p>其中，Filter主要用于访问和设置HTTP请求和响应的参数、URI等等。例如，设置HTTP响应的cache header：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CacheControlFilter</span> <span class=kd>implements</span> <span class=n>ContainerResponseFilter</span> <span class=p>{</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>filter</span><span class=p>(</span><span class=n>ContainerRequestContext</span> <span class=n>req</span><span class=p>,</span> <span class=n>ContainerResponseContext</span> <span class=n>res</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>req</span><span class=p>.</span><span class=na>getMethod</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;GET&quot;</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>res</span><span class=p>.</span><span class=na>getHeaders</span><span class=p>().</span><span class=na>add</span><span class=p>(</span><span class=s>&quot;Cache-Control&quot;</span><span class=p>,</span> <span class=s>&quot;someValue&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>Interceptor主要用于访问和修改输入与输出字节流，例如，手动添加GZIP压缩：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>GZIPWriterInterceptor</span> <span class=kd>implements</span> <span class=n>WriterInterceptor</span> <span class=p>{</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>aroundWriteTo</span><span class=p>(</span><span class=n>WriterInterceptorContext</span> <span class=n>context</span><span class=p>)</span>
                    <span class=kd>throws</span> <span class=n>IOException</span><span class=p>,</span> <span class=n>WebApplicationException</span> <span class=p>{</span>
        <span class=n>OutputStream</span> <span class=n>outputStream</span> <span class=o>=</span> <span class=n>context</span><span class=p>.</span><span class=na>getOutputStream</span><span class=p>();</span>
        <span class=n>context</span><span class=p>.</span><span class=na>setOutputStream</span><span class=p>(</span><span class=k>new</span> <span class=n>GZIPOutputStream</span><span class=p>(</span><span class=n>outputStream</span><span class=p>));</span>
        <span class=n>context</span><span class=p>.</span><span class=na>proceed</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>在标准JAX-RS应用中，我们一般是为Filter和Interceptor添加<a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Provider title="GitHub User: Provider">@Provider</a> annotation，然后JAX-RS runtime会自动发现并启用它们。而在dubbo中，我们是通过添加XML配置的方式来注册Filter和Interceptor：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>port=</span><span class=s>&quot;8888&quot;</span> <span class=na>extension=</span><span class=s>&quot;xxx.TraceInterceptor, xxx.TraceFilter&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>在此，我们可以将Filter、Interceptor和DynamicFeature这三种类型的对象都添加到<code>extension</code>属性上，多个之间用逗号分隔。（DynamicFeature是另一个接口，可以方便我们更动态的启用Filter和Interceptor，感兴趣请自行google。）</p> <p>当然，dubbo自身也支持Filter的概念，但我们这里讨论的Filter和Interceptor更加接近协议实现的底层，相比dubbo的filter，可以做更底层的定制化。</p> <blockquote> <p>注：这里的XML属性叫extension，而不是叫interceptor或者filter，是因为除了Interceptor和Filter，未来我们还会添加更多的扩展类型。</p> </blockquote> <p>如果REST的消费端也是dubbo系统（参见下文的讨论），则也可以用类似方式为消费端配置Interceptor和Filter。但注意，JAX-RS中消费端的Filter和提供端的Filter是两种不同的接口。例如前面例子中服务端是ContainerResponseFilter接口，而消费端对应的是ClientResponseFilter:</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LoggingFilter</span> <span class=kd>implements</span> <span class=n>ClientResponseFilter</span> <span class=p>{</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>filter</span><span class=p>(</span><span class=n>ClientRequestContext</span> <span class=n>reqCtx</span><span class=p>,</span> <span class=n>ClientResponseContext</span> <span class=n>resCtx</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;status: &quot;</span> <span class=o>+</span> <span class=n>resCtx</span><span class=p>.</span><span class=na>getStatus</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;date: &quot;</span> <span class=o>+</span> <span class=n>resCtx</span><span class=p>.</span><span class=na>getDate</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;last-modified: &quot;</span> <span class=o>+</span> <span class=n>resCtx</span><span class=p>.</span><span class=na>getLastModified</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;location: &quot;</span> <span class=o>+</span> <span class=n>resCtx</span><span class=p>.</span><span class=na>getLocation</span><span class=p>());</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;headers:&quot;</span><span class=p>);</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>Entry</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>header</span> <span class=p>:</span> <span class=n>resCtx</span><span class=p>.</span><span class=na>getHeaders</span><span class=p>().</span><span class=na>entrySet</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;\t&quot;</span> <span class=o>+</span> <span class=n>header</span><span class=p>.</span><span class=na>getKey</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot; :&quot;</span><span class=p>);</span>
            <span class=k>for</span> <span class=p>(</span><span class=n>String</span> <span class=n>value</span> <span class=p>:</span> <span class=n>header</span><span class=p>.</span><span class=na>getValue</span><span class=p>())</span> <span class=p>{</span>
                <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=n>value</span> <span class=o>+</span> <span class=s>&quot;, &quot;</span><span class=p>);</span>
            <span class=p>}</span>
            <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>print</span><span class=p>(</span><span class=s>&quot;\n&quot;</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;media-type: &quot;</span> <span class=o>+</span> <span class=n>resCtx</span><span class=p>.</span><span class=na>getMediaType</span><span class=p>().</span><span class=na>getType</span><span class=p>());</span>
    <span class=p>}</span> 
<span class=p>}</span>
</code></pre></div> <h3 id=exception>添加自定义的Exception处理<a class=headerlink href=#exception title="Permanent link">&para;</a></h3> <p>Dubbo的REST也支持JAX-RS标准的ExceptionMapper，可以用来定制特定exception发生后应该返回的HTTP响应。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>CustomExceptionMapper</span> <span class=kd>implements</span> <span class=n>ExceptionMapper</span><span class=o>&lt;</span><span class=n>NotFoundException</span><span class=o>&gt;</span> <span class=p>{</span>

    <span class=kd>public</span> <span class=n>Response</span> <span class=nf>toResponse</span><span class=p>(</span><span class=n>NotFoundException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>     
        <span class=k>return</span> <span class=n>Response</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>Response</span><span class=p>.</span><span class=na>Status</span><span class=p>.</span><span class=na>NOT_FOUND</span><span class=p>).</span><span class=na>entity</span><span class=p>(</span><span class=s>&quot;Oops! the requested resource is not found!&quot;</span><span class=p>).</span><span class=na>type</span><span class=p>(</span><span class=s>&quot;text/plain&quot;</span><span class=p>).</span><span class=na>build</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>和Interceptor、Filter类似，将其添加到XML配置文件中即可启用：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>port=</span><span class=s>&quot;8888&quot;</span> <span class=na>extension=</span><span class=s>&quot;xxx.CustomExceptionMapper&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <h3 id=http_2>配置HTTP日志输出<a class=headerlink href=#http_2 title="Permanent link">&para;</a></h3> <p>Dubbo rest支持输出所有HTTP请求/响应中的header字段和body消息体。</p> <p>在XML配置中添加如下自带的REST filter：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>port=</span><span class=s>&quot;8888&quot;</span> <span class=na>extension=</span><span class=s>&quot;org.apache.dubbo.rpc.protocol.rest.support.LoggingFilter&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p><strong>然后在logging配置中至少为org.apache.dubbo.rpc.protocol.rest.support打开INFO级别日志输出</strong>，例如，在log4j.xml中配置：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;logger</span> <span class=na>name=</span><span class=s>&quot;org.apache.dubbo.rpc.protocol.rest.support&quot;</span><span class=nt>&gt;</span>
    <span class=nt>&lt;level</span> <span class=na>value=</span><span class=s>&quot;INFO&quot;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;appender-ref</span> <span class=na>ref=</span><span class=s>&quot;CONSOLE&quot;</span><span class=nt>/&gt;</span>
<span class=nt>&lt;/logger&gt;</span>
</code></pre></div> <p>当然，你也可以直接在ROOT logger打开INFO级别日志输出：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;root&gt;</span>
    <span class=nt>&lt;level</span> <span class=na>value=</span><span class=s>&quot;INFO&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;appender-ref</span> <span class=na>ref=</span><span class=s>&quot;CONSOLE&quot;</span><span class=nt>/&gt;</span>
<span class=nt>&lt;/root&gt;</span>
</code></pre></div> <p>然后在日志中会有类似如下的内容输出：</p> <div class=highlight><pre><span></span><code>The HTTP headers are: 
accept: application/json;charset=UTF-8
accept-encoding: gzip, deflate
connection: Keep-Alive
content-length: 22
content-type: application/json
host: 192.168.1.100:8888
user-agent: Apache-HttpClient/4.2.1 (java 1.5)
</code></pre></div> <div class=highlight><pre><span></span><code>The contents of request body is: 
{&quot;id&quot;:1,&quot;name&quot;:&quot;dang&quot;}
</code></pre></div> <p>打开HTTP日志输出后，除了正常日志输出的性能开销外，也会在比如HTTP请求解析时产生额外的开销，因为需要建立额外的内存缓冲区来为日志的输出做数据准备。</p> <h3 id=_8>输入参数的校验<a class=headerlink href=#_8 title="Permanent link">&para;</a></h3> <p>dubbo的rest支持采用Java标准的bean validation annotation（JSR 303)来做输入校验http://beanvalidation.org/</p> <p>为了和其他dubbo远程调用协议保持一致，在rest中作校验的annotation必须放在服务的接口上，例如：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>UserService</span> <span class=p>{</span>

    <span class=n>User</span> <span class=nf>getUser</span><span class=p>(</span><span class=nd>@Min</span><span class=p>(</span><span class=n>value</span><span class=o>=</span><span class=mi>1L</span><span class=p>,</span> <span class=n>message</span><span class=o>=</span><span class=s>&quot;User ID must be greater than 1&quot;</span><span class=p>)</span> <span class=n>Long</span> <span class=n>id</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>当然，在很多其他的bean validation的应用场景都是将annotation放到实现类而不是接口上。把annotation放在接口上至少有一个好处是，dubbo的客户端可以共享这个接口的信息，dubbo甚至不需要做远程调用，在本地就可以完成输入校验。</p> <p>然后按照dubbo的标准方式在XML配置中打开验证：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:service</span> <span class=na>interface=</span><span class=s>xxx.UserService&quot;</span> <span class=na>ref=</span><span class=s>&quot;userService&quot;</span> <span class=na>protocol=</span><span class=s>&quot;rest&quot;</span> <span class=na>validation=</span><span class=s>&quot;true&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>在dubbo的其他很多远程调用协议中，如果输入验证出错，是直接将<code>RpcException</code>抛向客户端，而在rest中由于客户端经常是非dubbo，甚至非java的系统，所以不便直接抛出Java异常。因此，目前我们将校验错误以XML的格式返回：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;violationReport&gt;</span>
    <span class=nt>&lt;constraintViolations&gt;</span>
        <span class=nt>&lt;path&gt;</span>getUserArgument0<span class=nt>&lt;/path&gt;</span>
        <span class=nt>&lt;message&gt;</span>User ID must be greater than 1<span class=nt>&lt;/message&gt;</span>
        <span class=nt>&lt;value&gt;</span>0<span class=nt>&lt;/value&gt;</span>
    <span class=nt>&lt;/constraintViolations&gt;</span>
<span class=nt>&lt;/violationReport&gt;</span>
</code></pre></div> <p>稍后也会支持其他数据格式的返回值。至于如何对验证错误消息作国际化处理，直接参考bean validation的相关文档即可。</p> <p>如果你认为默认的校验错误返回格式不符合你的要求，可以如上面章节所述，添加自定义的ExceptionMapper来自由的定制错误返回格式。需要注意的是，这个ExceptionMapper必须用泛型声明来捕获dubbo的RpcException，才能成功覆盖dubbo rest默认的异常处理策略。为了简化操作，其实这里最简单的方式是直接继承dubbo rest的RpcExceptionMapper，并覆盖其中处理校验异常的方法即可：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyValidationExceptionMapper</span> <span class=kd>extends</span> <span class=n>RpcExceptionMapper</span> <span class=p>{</span>

    <span class=kd>protected</span> <span class=n>Response</span> <span class=nf>handleConstraintViolationException</span><span class=p>(</span><span class=n>ConstraintViolationException</span> <span class=n>cve</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>ViolationReport</span> <span class=n>report</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ViolationReport</span><span class=p>();</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>ConstraintViolation</span> <span class=n>cv</span> <span class=p>:</span> <span class=n>cve</span><span class=p>.</span><span class=na>getConstraintViolations</span><span class=p>())</span> <span class=p>{</span>
            <span class=n>report</span><span class=p>.</span><span class=na>addConstraintViolation</span><span class=p>(</span><span class=k>new</span> <span class=n>RestConstraintViolation</span><span class=p>(</span>
                    <span class=n>cv</span><span class=p>.</span><span class=na>getPropertyPath</span><span class=p>().</span><span class=na>toString</span><span class=p>(),</span>
                    <span class=n>cv</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span>
                    <span class=n>cv</span><span class=p>.</span><span class=na>getInvalidValue</span><span class=p>()</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=s>&quot;null&quot;</span> <span class=p>:</span> <span class=n>cv</span><span class=p>.</span><span class=na>getInvalidValue</span><span class=p>().</span><span class=na>toString</span><span class=p>()));</span>
        <span class=p>}</span>
        <span class=c1>// 采用json输出代替xml输出</span>
        <span class=k>return</span> <span class=n>Response</span><span class=p>.</span><span class=na>status</span><span class=p>(</span><span class=n>Response</span><span class=p>.</span><span class=na>Status</span><span class=p>.</span><span class=na>INTERNAL_SERVER_ERROR</span><span class=p>).</span><span class=na>entity</span><span class=p>(</span><span class=n>report</span><span class=p>).</span><span class=na>type</span><span class=p>(</span><span class=n>ContentType</span><span class=p>.</span><span class=na>APPLICATION_JSON_UTF_8</span><span class=p>).</span><span class=na>build</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>然后将这个ExceptionMapper添加到XML配置中即可：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;rest&quot;</span> <span class=na>port=</span><span class=s>&quot;8888&quot;</span> <span class=na>extension=</span><span class=s>&quot;xxx.MyValidationExceptionMapper&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <h3 id=rest_1>是否应该透明发布REST服务<a class=headerlink href=#rest_1 title="Permanent link">&para;</a></h3> <p>Dubbo的REST调用和dubbo中其它某些RPC不同的是，需要在服务代码中添加JAX-RS的annotation（以及JAXB、Jackson的annotation），如果你觉得这些annotation一定程度“污染”了你的服务代码，你可以考虑编写额外的Facade和DTO类，在Facade和DTO上添加annotation，而Facade将调用转发给真正的服务实现类。当然事实上，直接在服务代码中添加annotation基本没有任何负面作用，而且这本身是Java EE的标准用法，另外JAX-RS和JAXB的annotation是属于java标准，比我们经常使用的spring、dubbo等等annotation更没有vendor lock-in的问题，所以一般没有必要因此而引入额外对象。</p> <p>另外，如果你想用前述的<a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Context title="GitHub User: Context">@Context</a> annotation，通过方法参数注入HttpServletRequest（如<code>public User getUser(@PathParam("id") Long id, @Context HttpServletRequest request)</code>），这时候由于改变了服务的方法签名，并且HttpServletRequest是REST特有的参数，<strong>所以如果你的服务要支持多种RPC机制的话</strong>，则引入额外的Facade类是比较适当的。</p> <p>当然，在没有添加REST调用之前，你的服务代码可能本身已经就充当了Facade和DTO的角色（至于为什么有些场景需要这些角色，有兴趣可参考<a href=http://www.infoq.com/cn/articles/micro-soa-1>微观SOA：服务设计原则及其实践方式</a>）。这种情况下，在添加REST之后，如果你再额外添加与REST相关的Facade和DTO，就相当于对原有代码对再一次包装，即形成如下调用链：</p> <p><code>RestFacade/RestDTO -&gt; Facade/DTO -&gt; Service</code></p> <p>这种体系比较繁琐，数据转换之类的工作量也不小，所以一般应尽量避免如此。</p> <h2 id=rest_2>REST服务消费端详解<a class=headerlink href=#rest_2 title="Permanent link">&para;</a></h2> <p>这里我们用三种场景来分别讨论：</p> <ol> <li>非dubbo的消费端调用dubbo的REST服务（non-dubbo &rarr; dubbo）</li> <li>dubbo消费端调用dubbo的REST服务 （dubbo &rarr; dubbo）</li> <li>dubbo的消费端调用非dubbo的REST服务 （dubbo &rarr; non-dubbo）</li> </ol> <h3 id=1dubbodubborest>场景1：非dubbo的消费端调用dubbo的REST服务<a class=headerlink href=#1dubbodubborest title="Permanent link">&para;</a></h3> <p>这种场景的客户端与dubbo本身无关，直接选用相应语言和框架中合适的方式即可。</p> <p>如果是还是java的客户端（但没用dubbo），可以考虑直接使用标准的JAX-RS Client API或者特定REST实现的Client API来调用REST服务。下面是用JAX-RS Client API来访问上述的UserService的registerUser()：</p> <div class=highlight><pre><span></span><code><span class=n>User</span> <span class=n>user</span> <span class=o>=</span> <span class=k>new</span> <span class=n>User</span><span class=p>();</span>
<span class=n>user</span><span class=p>.</span><span class=na>setName</span><span class=p>(</span><span class=s>&quot;Larry&quot;</span><span class=p>);</span>

<span class=n>Client</span> <span class=n>client</span> <span class=o>=</span> <span class=n>ClientBuilder</span><span class=p>.</span><span class=na>newClient</span><span class=p>();</span>
<span class=n>WebTarget</span> <span class=n>target</span> <span class=o>=</span> <span class=n>client</span><span class=p>.</span><span class=na>target</span><span class=p>(</span><span class=s>&quot;http://localhost:8080/services/users/register.json&quot;</span><span class=p>);</span>
<span class=n>Response</span> <span class=n>response</span> <span class=o>=</span> <span class=n>target</span><span class=p>.</span><span class=na>request</span><span class=p>().</span><span class=na>post</span><span class=p>(</span><span class=n>Entity</span><span class=p>.</span><span class=na>entity</span><span class=p>(</span><span class=n>user</span><span class=p>,</span> <span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON_TYPE</span><span class=p>));</span>

<span class=k>try</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=na>getStatus</span><span class=p>()</span> <span class=o>!=</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=s>&quot;Failed with HTTP error code : &quot;</span> <span class=o>+</span> <span class=n>response</span><span class=p>.</span><span class=na>getStatus</span><span class=p>());</span>
    <span class=p>}</span>
    <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;The generated id is &quot;</span> <span class=o>+</span> <span class=n>response</span><span class=p>.</span><span class=na>readEntity</span><span class=p>(</span><span class=n>RegistrationResult</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getId</span><span class=p>());</span>
<span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
    <span class=n>response</span><span class=p>.</span><span class=na>close</span><span class=p>();</span>
    <span class=n>client</span><span class=p>.</span><span class=na>close</span><span class=p>();</span> <span class=c1>// 在真正开发中不要每次关闭client，比如HTTP长连接是由client持有的</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码片段中的User和RegistrationResult类都是消费端自己编写的，JAX-RS Client API会自动对它们做序列化/反序列化。</p> <p>当然，在java中也可以直接用自己熟悉的比如HttpClient，FastJson，XStream等等各种不同技术来实现REST客户端，在此不再详述。</p> <h3 id=2dubbodubborest>场景2：dubbo消费端调用dubbo的REST服务<a class=headerlink href=#2dubbodubborest title="Permanent link">&para;</a></h3> <p>这种场景下，和使用其他dubbo的远程调用方式一样，直接在服务提供端和服务消费端共享Java服务接口，并添加spring xml配置（当然也可以用spring/dubbo的annotation配置），即可透明的调用远程REST服务：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:reference</span> <span class=na>id=</span><span class=s>&quot;userService&quot;</span> <span class=na>interface=</span><span class=s>&quot;xxx.UserService&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>如前所述，这种场景下必须把JAX-RS的annotation添加到服务接口上，这样在dubbo在消费端才能共享相应的REST配置信息，并据之做远程调用:</p> <div class=highlight><pre><span></span><code><span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;users&quot;</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>UserService</span> <span class=p>{</span>

    <span class=nd>@GET</span>
    <span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;{id : \\d+}&quot;</span><span class=p>)</span>
    <span class=nd>@Produces</span><span class=p>({</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>,</span> <span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_XML</span><span class=p>})</span>
    <span class=n>User</span> <span class=nf>getUser</span><span class=p>(</span><span class=nd>@PathParam</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span> <span class=n>Long</span> <span class=n>id</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>如果服务接口的annotation中配置了多种数据格式，这里由于两端都是dubbo系统，REST的大量细节被屏蔽了，所以不存在用前述URL后缀之类选择数据格式的可能。目前在这种情况下，排名最靠前的数据格式将直接被使用。</p> <p>因此，我们建议你在定义annotation的时候最好把最合适的数据格式放到前面，比如以上我们是把json放在xml前面，因为json的传输性能优于xml。 </p> <h3 id=3dubbodubborest>场景3：dubbo的消费端调用非dubbo的REST服务<a class=headerlink href=#3dubbodubborest title="Permanent link">&para;</a></h3> <p>这种场景下，可以直接用场景1中描述的Java的方式来调用REST服务。但其实也可以采用场景2中描述的方式，即更透明的调用REST服务，即使这个服务并不是dubbo提供的。</p> <p>如果用场景2的方式，由于这里REST服务并非dubbo提供，一般也就没有前述的共享的Java服务接口，所以在此我们需要根据外部REST服务的情况，自己来编写Java接口以及相应参数类，并添加JAX-RS、JAXB、Jackson等的annotation，dubbo的REST底层实现会据此去自动生成请求消息，自动解析响应消息等等，从而透明的做远程调用。或者这种方式也可以理解为，我们尝试用JAX-RS的方式去仿造实现一遍外部的REST服务提供端，然后把写成服务接口放到客户端来直接使用，dubbo的REST底层实现就能像调用dubbo的REST服务一样调用其他REST服务。</p> <p>例如，我们要调用如下的外部服务</p> <div class=highlight><pre><span></span><code>http://api.foo.com/services/users/1001
http://api.foo.com/services/users/1002
</code></pre></div> <p>获取不同ID的用户资料，返回格式是JSON</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
    <span class=s2>&quot;id&quot;</span><span class=o>:</span> <span class=mf>1001</span><span class=p>,</span>
    <span class=s2>&quot;name&quot;</span><span class=o>:</span> <span class=s2>&quot;Larry&quot;</span>
<span class=p>}</span>
</code></pre></div> <p>我们可根据这些信息，编写服务接口和参数类即可：</p> <div class=highlight><pre><span></span><code><span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;users&quot;</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>UserService</span> <span class=p>{</span>

    <span class=nd>@GET</span>
    <span class=nd>@Path</span><span class=p>(</span><span class=s>&quot;{id : \\d+}&quot;</span><span class=p>)</span>
    <span class=nd>@Produces</span><span class=p>({</span><span class=n>MediaType</span><span class=p>.</span><span class=na>APPLICATION_JSON</span><span class=p>})</span>
    <span class=n>User</span> <span class=nf>getUser</span><span class=p>(</span><span class=nd>@PathParam</span><span class=p>(</span><span class=s>&quot;id&quot;</span><span class=p>)</span> <span class=n>Long</span> <span class=n>id</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>User</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=p>{</span>

    <span class=kd>private</span> <span class=n>Long</span> <span class=n>id</span><span class=p>;</span>

    <span class=kd>private</span> <span class=n>String</span> <span class=n>name</span><span class=p>;</span>

    <span class=c1>// …</span>
<span class=p>}</span>
</code></pre></div> <p>对于spring中的配置，因为这里的REST服务不是dubbo提供的，所以无法使用dubbo的注册中心，直接配置外部REST服务的url地址即可（如多个地址用逗号分隔）：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:reference</span> <span class=na>id=</span><span class=s>&quot;userService&quot;</span> <span class=na>interface=</span><span class=s>&quot;xxx.UserService&quot;</span> <span class=na>url=</span><span class=s>&quot;rest://api.foo.com/services/&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <blockquote> <p>注意：这里协议必须用rest://而不是http://之类。如果外部的REST服务有context path，则在url中也必须添加上（除非你在每个服务接口的<a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Path title="GitHub User: Path">@Path</a> annotation中都带上context path），例如上面的/services/。同时这里的services后面必须带上/，这样才能使dubbo正常工作。</p> </blockquote> <p>另外，这里依然可以配置客户端可启动的最大连接数和超时时间：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:reference</span> <span class=na>id=</span><span class=s>&quot;userService&quot;</span> <span class=na>interface=</span><span class=s>&quot;xxx.UserService&quot;</span> <span class=na>url=</span><span class=s>&quot;rest://api.foo.com/services/&quot;</span> <span class=na>timeout=</span><span class=s>&quot;2000&quot;</span> <span class=na>connections=</span><span class=s>&quot;10&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <h2 id=dubbojax-rs>Dubbo中JAX-RS的限制<a class=headerlink href=#dubbojax-rs title="Permanent link">&para;</a></h2> <p>Dubbo中的REST开发是完全兼容标准JAX-RS的，但其支持的功能目前是完整JAX-RS的一个子集，部分因为它要受限于dubbo和spring的特定体系。</p> <p>在dubbo中使用的JAX-RS的局限包括但不限于：</p> <ol> <li>服务实现只能是singleton的，不能支持per-request scope和per-lookup scope</li> <li>不支持用<a class="magiclink magiclink-github magiclink-mention" href=https://github.com/Context title="GitHub User: Context">@Context</a> annotation对服务的实例字段注入 ServletConfig、ServletContext、HttpServletRequest、HttpServletResponse等等，但可以支持对服务方法参数的注入。但对某些特定REST server实现，（祥见前面的叙述），也不支持对服务方法参数的注入。</li> </ol> <h2 id=restrest-faq>REST常见问题解答（REST FAQ）<a class=headerlink href=#restrest-faq title="Permanent link">&para;</a></h2> <h3 id=dubbo-restdubbo>Dubbo REST的服务能和Dubbo注册中心、监控中心集成吗？<a class=headerlink href=#dubbo-restdubbo title="Permanent link">&para;</a></h3> <p>可以的，而且是自动集成的，也就是你在dubbo中开发的所有REST服务都会自动注册到注册中心和监控中心，可以通过它们做管理。</p> <p>但是，只有当REST的消费端也是基于dubbo的时候，注册中心中的许多服务治理操作才能完全起作用。而如果消费端是非dubbo的，自然不受注册中心管理，所以其中很多操作是不会对消费端起作用的。</p> <h3 id=dubbo-restfailover>Dubbo REST中如何实现负载均衡和容错（failover）？<a class=headerlink href=#dubbo-restfailover title="Permanent link">&para;</a></h3> <p>如果dubbo REST的消费端也是dubbo的，则Dubbo REST和其他dubbo远程调用协议基本完全一样，由dubbo框架透明的在消费端做load balance、failover等等。</p> <p>如果dubbo REST的消费端是非dubbo的，甚至是非java的，则最好配置服务提供端的软负载均衡机制，目前可考虑用LVS、HAProxy、 Nginx等等对HTTP请求做负载均衡。</p> <h3 id=jax-rsurl>JAX-RS中重载的方法能够映射到同一URL地址吗？<a class=headerlink href=#jax-rsurl title="Permanent link">&para;</a></h3> <p><a href=http://stackoverflow.com/questions/17196766/can-resteasy-choose-method-based-on-query-params>http://stackoverflow.com/questions/17196766/can-resteasy-choose-method-based-on-query-params</a></p> <h3 id=jax-rspost>JAX-RS中作POST的方法能够接收多个参数吗？<a class=headerlink href=#jax-rspost title="Permanent link">&para;</a></h3> <p><a href=http://stackoverflow.com/questions/5553218/jax-rs-post-multiple-objects>http://stackoverflow.com/questions/5553218/jax-rs-post-multiple-objects</a></p> <h2 id=dubborest>Dubbo当前体系的不足之处（与REST相关的）<a class=headerlink href=#dubborest title="Permanent link">&para;</a></h2> <p>我认为dubbo当前体系中显然也有不少不足之处，这里列出几个与REST有关的、并影响用户使用的问题（不包括内部实现的问题），供参考评论，为下一步重构作准备。</p> <h3 id=rpccontext>RpcContext的侵入性<a class=headerlink href=#rpccontext title="Permanent link">&para;</a></h3> <p>在前文，前面我们已经提到过RpcContext用法的侵入性，由于它是用单例的方式来访问上下文信息，这完全不符合spring应用的一般风格，不利于应用扩展和单元测试。未来我们可能用依赖注入方式注入一个接口，再用它去访问ThreadLocal中的上下文信息。</p> <h3 id=protocol>Protocol配置的局限性<a class=headerlink href=#protocol title="Permanent link">&para;</a></h3> <p>dubbo支持多种远程调用方式，但所有调用方式都是用<code>&lt;dubbo:protocol/&gt;</code>来配置的，例如：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;dubbo&quot;</span> <span class=na>port=</span><span class=s>&quot;9090&quot;</span> <span class=na>server=</span><span class=s>&quot;netty&quot;</span> <span class=na>client=</span><span class=s>&quot;netty&quot;</span> <span class=na>codec=</span><span class=s>&quot;dubbo&quot;</span> <span class=na>serialization=</span><span class=s>&quot;hessian2&quot;</span> 
    <span class=na>charset=</span><span class=s>&quot;UTF-8&quot;</span> <span class=na>threadpool=</span><span class=s>&quot;fixed&quot;</span> <span class=na>threads=</span><span class=s>&quot;100&quot;</span> <span class=na>queues=</span><span class=s>&quot;0&quot;</span> <span class=na>iothreads=</span><span class=s>&quot;9&quot;</span> <span class=na>buffer=</span><span class=s>&quot;8192&quot;</span> <span class=na>accepts=</span><span class=s>&quot;1000&quot;</span> <span class=na>payload=</span><span class=s>&quot;8388608&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>其实，上面很多属性实际上dubbo RPC远程调用方式特有的，很多dubbo中的其它远程调用方式根本就不支持例如server, client, codec, iothreads, accepts, payload等等（当然，有的是条件所限不支持，有的是根本没有必要支持）。这给用户的使用徒增很多困惑，用户也并不知道有些属性（比如做性能调优）添加了实际上是不起作用的。</p> <p>另一方面，各种远程调用方式往往有大量自己独特的配置需要，特别是我们逐步为每种远程调用方式都添加更丰富、更高级的功能，这就不可避免的扩展<code>&lt;protocol/&gt;</code>中的属性（例如目前我们在REST中已经添加了keepalive和extension两个属性），到最后会导致<code>&lt;protocol/&gt;</code>臃肿不堪，用户的使用也更加困惑。</p> <p>当然，dubbo中有一种扩展<code>&lt;protocol/&gt;</code>的方式是用<code>&lt;dubbo:parameter/&gt;</code>，但这种方式显然很有局限性，而且用法复杂，缺乏schema校验。</p> <p>所以，最好的方式是为每种远程调用方式设置自己的protocol元素，比如<code>&lt;protocol-dubbo/&gt;</code>，<code>&lt;protocol-rest/&gt;</code>等等，每种元素用XML schema规定自己的属性（当然属性在各种远程调用方式之间能通用是最好的）。</p> <p>如此一来，例如前面提到过的extension配置也可以用更自由的方式，从而更清楚更可扩展（以下只是举例，当然也许有更好的方式）:</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol-rest</span> <span class=na>port=</span><span class=s>&quot;8080&quot;</span><span class=nt>&gt;</span>
    <span class=nt>&lt;dubbo:extension&gt;</span>someInterceptor<span class=nt>&lt;/dubbo:extension&gt;</span>
    <span class=nt>&lt;dubbo:extension&gt;</span>someFilter<span class=nt>&lt;/dubbo:extension&gt;</span>
    <span class=nt>&lt;dubbo:extension&gt;</span>someDynamicFeature<span class=nt>&lt;/dubbo:extension&gt;</span>
    <span class=nt>&lt;dubbo:extension&gt;</span>someEntityProvider<span class=nt>&lt;/dubbo:extension&gt;</span>
<span class=nt>&lt;/dubbo:protocol-rest&gt;</span>
</code></pre></div> <h3 id=xmlspring>XML命名不符合spring规范<a class=headerlink href=#xmlspring title="Permanent link">&para;</a></h3> <p>dubbo的XML配置中大量命名都不符合spring规范，比如：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;dubbo&quot;</span> <span class=na>port=</span><span class=s>&quot;9090&quot;</span> <span class=na>server=</span><span class=s>&quot;netty&quot;</span> <span class=na>client=</span><span class=s>&quot;netty&quot;</span> <span class=na>codec=</span><span class=s>&quot;dubbo&quot;</span> <span class=na>serialization=</span><span class=s>&quot;hessian2&quot;</span> 
    <span class=na>charset=</span><span class=s>&quot;UTF-8&quot;</span> <span class=na>threadpool=</span><span class=s>&quot;fixed&quot;</span> <span class=na>threads=</span><span class=s>&quot;100&quot;</span> <span class=na>queues=</span><span class=s>&quot;0&quot;</span> <span class=na>iothreads=</span><span class=s>&quot;9&quot;</span> <span class=na>buffer=</span><span class=s>&quot;8192&quot;</span> <span class=na>accepts=</span><span class=s>&quot;1000&quot;</span> <span class=na>payload=</span><span class=s>&quot;8388608&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>上面threadpool应该改为thread-pool，iothreads应该改为io-threads，单词之间应该用"-"分隔。这虽然看起来是个小问题，但也涉及到了可读性，特别是可扩展性，因为有时候我们不可避免要用更多单词来描述XML元素和属性。</p> <p>其实dubbo本身也是建议遵守spring到XML的命名规范。</p> <h2 id=rest_3>REST最佳实践<a class=headerlink href=#rest_3 title="Permanent link">&para;</a></h2> <p>TODO</p> <h2 id=_9>性能基准测试<a class=headerlink href=#_9 title="Permanent link">&para;</a></h2> <h3 id=_10>测试环境<a class=headerlink href=#_10 title="Permanent link">&para;</a></h3> <p>粗略如下：</p> <ul> <li>两台独立服务器</li> <li>4核Intel(R) Xeon(R) CPU E5-2603 0 @ 1.80GHz</li> <li>8G内存</li> <li>服务器之间网络通过百兆交换机</li> <li>CentOS 5</li> <li>JDK 7</li> <li>Tomcat 7</li> <li>JVM参数-server -Xms1g -Xmx1g -XX:PermSize=64M -XX:+UseConcMarkSweepGC</li> </ul> <h3 id=_11>测试脚本<a class=headerlink href=#_11 title="Permanent link">&para;</a></h3> <p>和dubbo自身的基准测试保持接近：</p> <p>10个并发客户端持续不断发出请求：</p> <ul> <li>传入嵌套复杂对象（但单个数据量很小），不做任何处理，原样返回</li> <li>传入50K字符串，不做任何处理，原样返回（TODO：结果尚未列出）</li> </ul> <p>进行5分钟性能测试。（引用dubbo自身测试的考虑：“主要考察序列化和网络IO的性能，因此服务端无任何业务逻辑。取10并发是考虑到http协议在高并发下对CPU的使用率较高可能会先打到瓶颈。”）</p> <h3 id=_12>测试结果<a class=headerlink href=#_12 title="Permanent link">&para;</a></h3> <p>下面的结果主要对比的是REST和dubbo RPC两种远程调用方式，并对它们作不同的配置，例如：</p> <ul> <li>“REST: Jetty + XML + GZIP”的意思是：测试REST，并采用jetty server，XML数据格式，启用GZIP压缩。</li> <li>“Dubbo: hessian2”的意思是：测试dubbo RPC，并采用hessian2序列化方式。</li> </ul> <p>针对复杂对象的结果如下（响应时间越小越好，TPS越大越好）：</p> <table> <thead> <tr> <th>远程调用方式</th> <th>平均响应时间</th> <th>平均TPS（每秒事务数）</th> </tr> </thead> <tbody> <tr> <td>REST: Jetty + JSON</td> <td>7.806</td> <td>1280</td> </tr> <tr> <td>REST: Jetty + JSON + GZIP</td> <td>TODO</td> <td>TODO</td> </tr> <tr> <td>REST: Jetty + XML</td> <td>TODO</td> <td>TODO</td> </tr> <tr> <td>REST: Jetty + XML + GZIP</td> <td>TODO</td> <td>TODO</td> </tr> <tr> <td>REST: Tomcat + JSON</td> <td>2.082</td> <td>4796</td> </tr> <tr> <td>REST: Netty + JSON</td> <td>2.182</td> <td>4576</td> </tr> <tr> <td>Dubbo: FST</td> <td>1.211</td> <td>8244</td> </tr> <tr> <td>Dubbo: kyro</td> <td>1.182</td> <td>8444</td> </tr> <tr> <td>Dubbo: dubbo serialization</td> <td>1.43</td> <td>6982</td> </tr> <tr> <td>Dubbo: hessian2</td> <td>1.49</td> <td>6701</td> </tr> <tr> <td>Dubbo: fastjson</td> <td>1.572</td> <td>6352</td> </tr> </tbody> </table> <p><img alt="no image found" src=../sources/images/rt.png></p> <p><img alt="no image found" src=../sources/images/tps.png></p> <p>仅就目前的结果，一点简单总结：</p> <ul> <li>dubbo RPC（特别是基于高效java序列化方式如kryo，fst）比REST的响应时间和吞吐量都有较显著优势，内网的dubbo系统之间优先选择dubbo RPC。</li> <li>在REST的实现选择上，仅就性能而言，目前tomcat7和netty最优（当然目前使用的jetty和netty版本都较低）。tjws和sun http server在性能测试中表现极差，平均响应时间超过200ms，平均tps只有50左右（为了避免影响图片效果，没在上面列出）。</li> <li>在REST中JSON数据格式性能优于XML（数据暂未在以上列出）。</li> <li>在REST中启用GZIP对企业内网中的小数据量复杂对象帮助不大，性能反而有下降（数据暂未在以上列出）。</li> </ul> <h2 id=_13>性能优化建议<a class=headerlink href=#_13 title="Permanent link">&para;</a></h2> <p>如果将dubbo REST部署到外部Tomcat上，并配置server="servlet"，即启用外部的tomcat来做为rest server的底层实现，则最好在tomcat上添加如下配置：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;Connector</span> <span class=na>port=</span><span class=s>&quot;8080&quot;</span> <span class=na>protocol=</span><span class=s>&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span>
               <span class=na>connectionTimeout=</span><span class=s>&quot;20000&quot;</span>
               <span class=na>redirectPort=</span><span class=s>&quot;8443&quot;</span>
               <span class=na>minSpareThreads=</span><span class=s>&quot;20&quot;</span>
               <span class=na>enableLookups=</span><span class=s>&quot;false&quot;</span>
               <span class=na>maxThreads=</span><span class=s>&quot;100&quot;</span>
               <span class=na>maxKeepAliveRequests=</span><span class=s>&quot;-1&quot;</span>
               <span class=na>keepAliveTimeout=</span><span class=s>&quot;60000&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <p>特别是maxKeepAliveRequests="-1"，这个配置主要是保证tomcat一直启用http长连接，以提高REST调用性能。但是请注意，如果REST消费端不是持续的调用REST服务，则一直启用长连接未必是最好的做法。另外，一直启用长连接的方式一般不适合针对普通webapp，更适合这种类似rpc的场景。所以为了高性能，在tomcat中，dubbo REST应用和普通web应用最好不要混合部署，而应该用单独的实例。</p> <p>TODO more contents to add</p> <h2 id=_14>扩展讨论<a class=headerlink href=#_14 title="Permanent link">&para;</a></h2> <h3 id=restthriftprotobuf>REST与Thrift、Protobuf等的对比<a class=headerlink href=#restthriftprotobuf title="Permanent link">&para;</a></h3> <p>TODO</p> <h3 id=restwebservices>REST与传统WebServices的对比<a class=headerlink href=#restwebservices title="Permanent link">&para;</a></h3> <p>TODO</p> <h3 id=jax-rsspring-mvc>JAX-RS与Spring MVC的对比<a class=headerlink href=#jax-rsspring-mvc title="Permanent link">&para;</a></h3> <p>初步看法，摘自http://<a href="http://www.infoq.com/cn/news/2014/10/dubbox-open-source?utm_source=infoq&utm_medium=popular_links_homepage#theCommentsSection">www.infoq.com/cn/news/2014/10/dubbox-open-source?utm_source=infoq&amp;utm_medium=popular_links_homepage#theCommentsSection</a></p> <blockquote> <p>谢谢，对于jax-rs和spring mvc，其实我对spring mvc的rest支持还没有太深入的看过，说点初步想法，请大家指正：</p> <p>spring mvc也支持annotation的配置，其实和jax-rs看起来是非常非常类似的。</p> <p>我个人认为spring mvc相对更适合于面向web应用的restful服务，比如被AJAX调用，也可能输出HTML之类的，应用中还有页面跳转流程之类，spring mvc既可以做好正常的web页面请求也可以同时处理rest请求。但总的来说这个restful服务是在展现层或者叫web层之类实现的</p> <p>而jax-rs相对更适合纯粹的服务化应用，也就是传统Java EE中所说的中间层服务，比如它可以把传统的EJB发布成restful服务。在spring应用中，也就把spring中充当service之类的bean直接发布成restful服务。总的来说这个restful服务是在业务、应用层或者facade层。而MVC层次和概念在这种做比如（后台）服务化的应用中通常是没有多大价值的。</p> <p>当然jax-rs的有些实现比如jersey，也试图提供mvc支持，以更好的适应上面所说的web应用，但应该是不如spring mvc。</p> <p>在dubbo应用中，我想很多人都比较喜欢直接将一个本地的spring service bean（或者叫manager之类的）完全透明的发布成远程服务，则这里用JAX-RS是更自然更直接的，不必额外的引入MVC概念。当然，先不讨论透明发布远程服务是不是最佳实践，要不要添加facade之类。</p> <p>当然，我知道在dubbo不支持rest的情况下，很多朋友采用的架构是spring mvc restful调用dubbo (spring) service来发布restful服务的。这种方式我觉得也非常好，只是如果不修改spring mvc并将其与dubbo深度集成，restful服务不能像dubbo中的其他远程调用协议比如webservices、dubbo rpc、hessian等等那样，享受诸多高级的服务治理的功能，比如：注册到dubbo的服务注册中心，通过dubbo监控中心监控其调用次数、TPS、响应时间之类，通过dubbo的统一的配置方式控制其比如线程池大小、最大连接数等等，通过dubbo统一方式做服务流量控制、权限控制、频次控制。另外spring mvc仅仅负责服务端，而在消费端，通常是用spring restTemplate，如果restTemplate不和dubbo集成，有可能像dubbo服务客户端那样自动或者人工干预做服务降级。如果服务端消费端都是dubbo系统，通过spring的rest交互，如果spring rest不深度整合dubbo，则不能用dubbo统一的路由分流等功能。</p> <p>当然，其实我个人认为这些东西不必要非此即彼的。我听说spring创始人rod johnson总是爱说一句话，the customer is always right，其实与其非要探讨哪种方式更好，不如同时支持两种方式就是了，所以原来在文档中也写过计划支持spring rest annoation，只是不知道具体可行性有多高。</p> </blockquote> <h2 id=_15>未来<a class=headerlink href=#_15 title="Permanent link">&para;</a></h2> <p>稍后可能要实现的功能：</p> <ul> <li>spring mvc的rest annotation支持</li> <li>安全</li> <li>OAuth</li> <li>异步调用</li> <li>完善gzip</li> <li>最大payload限制</li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/squidfunk target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://gitter.im/squidfunk/mkdocs-material target=_blank rel=noopener title=gitter.im class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"/></svg> </a> <a href=https://hub.docker.com/r/squidfunk/mkdocs-material/ target=_blank rel=noopener title=hub.docker.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=https://twitter.com/squidfunk target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/squidfunk/ target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://instagram.com/squidfunk target=_blank rel=noopener title=instagram.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../../../assets/javascripts/vendor.c3dc8c49.min.js></script> <script src=../../../../assets/javascripts/bundle.30071cf1.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script> <script>
        app = initialize({
          base: "../../../..",
          features: ["tabs", "search.highlight"],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>