<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=本文介绍了自适应拓展的原理和实现细节><link rel="shortcut icon" href=../../../../assets/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.5.3"><title>SPI 自适应拓展 - Apache Dubbo</title><link rel=stylesheet href=../../../../assets/stylesheets/main.6fb40bf7.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.cef4c379.min.css><meta name=theme-color content=#3f51b5><link rel=stylesheet href=../../../../css/dropdown.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Application header --> <header class=md-header data-md-component=header> <!-- Top-level navigation --> <nav class="md-header-nav md-grid" aria-label=Header> <!-- Link to home --> <a href=../../../.. title="Apache Dubbo" class="md-header-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> <!-- Button to open drawer --> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <!-- Header title --> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Apache Dubbo </span> <span class="md-header-nav__topic md-ellipsis"> SPI 自适应拓展 </span> </div> </div> <!-- Button to open search dialogue --> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div> <div class=langChange id=translate title=中文|English> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"> <path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"/> </svg> </div> <script>
    var translate = document.getElementById('translate');
    translate.addEventListener('click', changeHref, false);
    function changeHref() {
        if (window.location.href.search('en-us') !== -1) {
            var changeHref = window.location.href.replace('en-us', 'zh-cn');

        } else {
            var changeHref = window.location.href.replace('zh-cn', 'en-us');
        }
        window.location.href = changeHref
    }
</script> <style>
    .langChange {
        display: inline-block;
        width: 2.4rem;
        height: 2.4rem;
        vertical-align: middle;
        margin-left: .5rem;
    }

    .langChange svg {
        fill: rgba(255, 255, 255, 0.548);
        display: block;
        width: 1.2rem;
        height: 1.2rem;
        margin: 0 auto;
        margin-top: .6rem;
        margin-left: .6rem;
    }

    .langChange :hover {
        fill: white;
        cursor: pointer;
    }
</style> </div> <!-- Repository containing source --> <div class=md-header-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <!-- Home page --> <li class=md-tabs__item> <a href=../../../.. class="md-tabs__link md-tabs__link--active"> 首页 </a> </li> <!-- Main navigation item with nested items --> <!-- Home page --> <li class="md-tabs__item md-tabs_csr"> <a class="md-tabs__link md-tabs__link--active">文档</a> <ul class="md-tabs__list md-sub-tabs_bn"> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../user/preface/background/ class=md-tabs__link>2.7</a> </li> <!-- Render item --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../3.0/user/preface/background/ class=md-tabs__link>3.0</a> </li> <!-- Render item --> </ul> </li> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../../blog/apache-dubbo-2019-2020/ class=md-sub-tabs_link>Blog</a> </li> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../../developers/user-guide/faq_dev/ class=md-sub-tabs_link>Developers</a> </li> <!-- Render item --> <!-- Home page --> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Main navigation --> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <!-- Site title --> <label class=md-nav__title for=__drawer> <a href=../../../.. title="Apache Dubbo" class="md-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> Apache Dubbo </label> <!-- Repository containing source --> <div class=md-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <!-- Render item list --> <ul class=md-nav__list data-md-scrollfix> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../.. title=首页 class=md-nav__link> 首页 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 2.7 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=2.7 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 2.7 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/preface/requirements/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/quick-start/ title=快速启动 class=md-nav__link> 快速启动 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/dependencies/ title=依赖 class=md-nav__link> 依赖 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/maturity/ title=成熟度 class=md-nav__link> 成熟度 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-5 type=checkbox id=nav-1-1-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-5> 配置 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=配置 data-md-level=3> <label class=md-nav__title for=nav-1-1-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/configuration/xml/ title="XML 配置" class=md-nav__link> XML 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/configuration/api/ title="API 配置" class=md-nav__link> API 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/configuration/annotation/ title="Annotation 配置" class=md-nav__link> Annotation 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/configuration/annotation/ title=动态配置中心 class=md-nav__link> 动态配置中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/configuration/configuration-load-process/ title=配置加载流程 class=md-nav__link> 配置加载流程 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/configuration/environment-variables/ title=自动加载环境变量 class=md-nav__link> 自动加载环境变量 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-6 type=checkbox id=nav-1-1-6> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-6> 示例 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=示例 data-md-level=3> <label class=md-nav__title for=nav-1-1-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 示例 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/preflight-check/ title=启动时检查 class=md-nav__link> 启动时检查 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/fault-tolerent-strategy/ title=集群容错 class=md-nav__link> 集群容错 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/loadbalance/ title=负载均衡 class=md-nav__link> 负载均衡 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/thread-model/ title=线程模型 class=md-nav__link> 线程模型 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/explicit-target/ title=直连提供者 class=md-nav__link> 直连提供者 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/subscribe-only/ title=只订阅 class=md-nav__link> 只订阅 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/registry-only/ title=只注册 class=md-nav__link> 只注册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/static-service/ title=静态服务 class=md-nav__link> 静态服务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/multi-protocols/ title=多协议 class=md-nav__link> 多协议 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/multi-registry/ title=多注册中心 class=md-nav__link> 多注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/service-group/ title=服务分组 class=md-nav__link> 服务分组 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/multi-versions/ title=多版本 class=md-nav__link> 多版本 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/group-merger/ title=分组聚合 class=md-nav__link> 分组聚合 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/parameter-validation/ title=参数验证 class=md-nav__link> 参数验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/result-cache/ title=结果缓存 class=md-nav__link> 结果缓存 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/generic-reference/ title=泛化引用 class=md-nav__link> 泛化引用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/generic-service/ title=泛化实现 class=md-nav__link> 泛化实现 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/echo-service/ title=回声测试 class=md-nav__link> 回声测试 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/context/ title=上下文信息 class=md-nav__link> 上下文信息 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/attachment/ title=隐式参数 class=md-nav__link> 隐式参数 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/async-call/ title=异步调用 class=md-nav__link> 异步调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/async-execute-on-provider/ title=服务端异步 class=md-nav__link> 服务端异步 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/local-call/ title=本地调用 class=md-nav__link> 本地调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/callback-parameter/ title=参数回调 class=md-nav__link> 参数回调 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/events-notify/ title=事件通知 class=md-nav__link> 事件通知 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/local-stub/ title=本地存根 class=md-nav__link> 本地存根 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/local-mock/ title=本地伪装 class=md-nav__link> 本地伪装 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/delay-publish/ title=延迟暴露 class=md-nav__link> 延迟暴露 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/concurrency-control/ title=并发控制 class=md-nav__link> 并发控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/config-connection.md title=连接控制 class=md-nav__link> 连接控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/lazy-connect/ title=延迟连接 class=md-nav__link> 延迟连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/stickiness/ title=粘滞连接 class=md-nav__link> 粘滞连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/token-authorization/ title=令牌验证 class=md-nav__link> 令牌验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/routing-rule/ title=路由规则 class=md-nav__link> 路由规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/config-rule/ title=配置规则 class=md-nav__link> 配置规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/service-downgrade/ title=服务降级 class=md-nav__link> 服务降级 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/graceful-shutdown/ title=优雅停机 class=md-nav__link> 优雅停机 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/hostname-binding/ title=主机绑定 class=md-nav__link> 主机绑定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/logger-strategy/ title=日志适配 class=md-nav__link> 日志适配 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/accesslog/ title=访问日志 class=md-nav__link> 访问日志 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/service-container/ title=服务容器 class=md-nav__link> 服务容器 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/distributed-transaction/ title=分布式事务 class=md-nav__link> 分布式事务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/dump/ title=线程栈自动dump class=md-nav__link> 线程栈自动dump </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/netty4/ title=Netty4 class=md-nav__link> Netty4 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/serialization/ title=Kryo和FST序列化 class=md-nav__link> Kryo和FST序列化 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/simplify-registry-data/ title=简化注册中心URL class=md-nav__link> 简化注册中心URL </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/demos/api.md title="API 参考手册" class=md-nav__link> API 参考手册 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-7 type=checkbox id=nav-1-1-7> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-7> schema 配置参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="schema 配置参考手册" data-md-level=3> <label class=md-nav__title for=nav-1-1-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> schema 配置参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-service/ title=dubbo:service class=md-nav__link> dubbo:service </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-reference/ title=dubbo:reference class=md-nav__link> dubbo:reference </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-protocol/ title=dubbo:protocol class=md-nav__link> dubbo:protocol </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-registry/ title=dubbo:registry class=md-nav__link> dubbo:registry </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-monitor/ title=dubbo:monitor class=md-nav__link> dubbo:monitor </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-application/ title=dubbo:application class=md-nav__link> dubbo:application </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-module/ title=dubbo:module class=md-nav__link> dubbo:module </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-provider/ title=dubbo:provider class=md-nav__link> dubbo:provider </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-consumer/ title=dubbo:consumer class=md-nav__link> dubbo:consumer </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-method/ title=dubbo:method class=md-nav__link> dubbo:method </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-argument/ title=dubbo:argument class=md-nav__link> dubbo:argument </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-parameter/ title=dubbo:parameter class=md-nav__link> dubbo:parameter </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/xml/dubbo-config-center/ title=dubbo:config-center class=md-nav__link> dubbo:config-center </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-8 type=checkbox id=nav-1-1-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-8> 协议参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=协议参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 协议参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/protocol/dubbo/ title=dubbo:// class=md-nav__link> dubbo:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/protocol/rmi/ title=rmi:// class=md-nav__link> rmi:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/protocol/hessian/ title=hessian:// class=md-nav__link> hessian:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/protocol/http/ title=http:// class=md-nav__link> http:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/protocol/thrift/ title=thrift:// class=md-nav__link> thrift:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/protocol/rest/ title=rest:// class=md-nav__link> rest:// </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-9 type=checkbox id=nav-1-1-9> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-9> 注册中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=注册中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 注册中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/registry/multicast/ title="Multicast 注册中心" class=md-nav__link> Multicast 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/registry/zookeeper/ title="Zookeeper 注册中心" class=md-nav__link> Zookeeper 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/registry/redis/ title="Redis 注册中心" class=md-nav__link> Redis 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/registry/simple/ title="Simple 注册中心" class=md-nav__link> Simple 注册中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-10 type=checkbox id=nav-1-1-10> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-10> 元数据中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=元数据中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-10> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 元数据中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/metadata/metadata-redis/ title="Redis 元数据中心" class=md-nav__link> Redis 元数据中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/metadata/metadata-zookeeper/ title="Zookeeper 元数据中心" class=md-nav__link> Zookeeper 元数据中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/telnet/ title="telnet 命令参考手册" class=md-nav__link> telnet 命令参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/qos/ title=在线运维命令-QOS class=md-nav__link> 在线运维命令-QOS </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/references/maven/ title="maven 插件参考手册" class=md-nav__link> maven 插件参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/best-practice/ title=服务化最佳实践 class=md-nav__link> 服务化最佳实践 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/recommend/ title=推荐用法 class=md-nav__link> 推荐用法 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/capacity-plan/ title=容量规划 class=md-nav__link> 容量规划 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/perf-test/ title=性能测试报告 class=md-nav__link> 性能测试报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/covergence.md title=测试覆盖率报告 class=md-nav__link> 测试覆盖率报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-19 type=checkbox id=nav-1-1-19> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-19> 版本与升级 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=版本与升级 data-md-level=3> <label class=md-nav__title for=nav-1-1-19> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 版本与升级 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/versions/version-270/ title=2.7.x升级步骤及注意事项 class=md-nav__link> 2.7.x升级步骤及注意事项 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2> 开发手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=开发手册 data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 开发手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/build.md title=源码构建 class=md-nav__link> 源码构建 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/design.md title=框架设计 class=md-nav__link> 框架设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/SPI.md title=扩展点加载 class=md-nav__link> 扩展点加载 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/implementation.md title=实现细节 class=md-nav__link> 实现细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-5 type=checkbox id=nav-1-2-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-5> SPI 扩展实现 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="SPI 扩展实现" data-md-level=3> <label class=md-nav__title for=nav-1-2-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> SPI 扩展实现 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/protocol.md title=协议扩展 class=md-nav__link> 协议扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/filter.md title=调用拦截扩展 class=md-nav__link> 调用拦截扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/invoker-listener.md title=引用监听扩展 class=md-nav__link> 引用监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/exporter-listener.md title=暴露监听扩展 class=md-nav__link> 暴露监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/cluster.md title=集群扩展 class=md-nav__link> 集群扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/router.md title=路由扩展 class=md-nav__link> 路由扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/load-balance.md title=负载均衡扩展 class=md-nav__link> 负载均衡扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/merger.md title=合并结果扩展 class=md-nav__link> 合并结果扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/registry.md title=注册中心扩展 class=md-nav__link> 注册中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/monitor.md title=监控中心扩展 class=md-nav__link> 监控中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/extension-factory.md title=扩展点加载扩展 class=md-nav__link> 扩展点加载扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/proxy-factory.md title=动态代理扩展 class=md-nav__link> 动态代理扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/compiler.md title=编译器扩展 class=md-nav__link> 编译器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/dispatcher.md title=消息派发扩展 class=md-nav__link> 消息派发扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/threadpool.md title=线程池扩展 class=md-nav__link> 线程池扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/serialize.md title=序列化扩展 class=md-nav__link> 序列化扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/remoting.md title=网络传输扩展 class=md-nav__link> 网络传输扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/exchanger.md title=信息交换扩展 class=md-nav__link> 信息交换扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/networker.md title=组网扩展 class=md-nav__link> 组网扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/telnet-handler.md title="Telnet 命令扩展" class=md-nav__link> Telnet 命令扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/status-checker.md title=状态检查扩展 class=md-nav__link> 状态检查扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/container.md title=容器扩展 class=md-nav__link> 容器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/page.md title=页面扩展 class=md-nav__link> 页面扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/cache.md title=缓存扩展 class=md-nav__link> 缓存扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/validation.md title=验证扩展 class=md-nav__link> 验证扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/logger-adapter.md title=日志适配扩展 class=md-nav__link> 日志适配扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/config-center.md title=配置中心 class=md-nav__link> 配置中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/contract.md title=公共契约 class=md-nav__link> 公共契约 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/coding.md title=编码约定 class=md-nav__link> 编码约定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-8 type=checkbox id=nav-1-2-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-8> 设计原则 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=设计原则 data-md-level=3> <label class=md-nav__title for=nav-1-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 设计原则 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/code-detail.md title=魔鬼在细节 class=md-nav__link> 魔鬼在细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/general-knowledge.md title=一些设计上的基本常识 class=md-nav__link> 一些设计上的基本常识 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/expansibility.md title=谈谈扩充式扩展与增量式扩展 class=md-nav__link> 谈谈扩充式扩展与增量式扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/configuration.md title=配置设计 class=md-nav__link> 配置设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/robustness.md title=设计实现的健壮性 class=md-nav__link> 设计实现的健壮性 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/dummy.md title=防痴呆设计 class=md-nav__link> 防痴呆设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/extension.md title=扩展点重构 class=md-nav__link> 扩展点重构 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/release.md title=版本发布 class=md-nav__link> 版本发布 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/contribution.md title=贡献代码 class=md-nav__link> 贡献代码 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/checklist.md title=检查列表 class=md-nav__link> 检查列表 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/code-smell.md title=坏味道 class=md-nav__link> 坏味道 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/TCK.md title=兼容性测试 class=md-nav__link> 兼容性测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-3> 管理者文档 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=管理者文档 data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 管理者文档 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/introduction.md title="Dubbo Admin介绍" class=md-nav__link> Dubbo Admin介绍 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/serviceSearch.md title=服务搜索和详情 class=md-nav__link> 服务搜索和详情 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/serviceGovernance.md title=服务治理 class=md-nav__link> 服务治理 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/serviceTest.md title=服务测试 class=md-nav__link> 服务测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 3.0 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=3.0 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 3.0 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../3.0/user/preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../3.0/user/preface/background/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../3.0/user/preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../3.0/user/preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> Blog <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Blog data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/apache-dubbo-2019-2020/ title=2019-2020 class=md-nav__link> 2019-2020 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/service-test/ title=服务测试 class=md-nav__link> 服务测试 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubboAsync_server/ title="Implementation background and practice of Dubbo server asynchronous interface" class=md-nav__link> Implementation background and practice of Dubbo server asynchronous interface </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubboAsync_client/ title="Implementation background and practice of Dubbo client asynchronous interface" class=md-nav__link> Implementation background and practice of Dubbo client asynchronous interface </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-fescar/ title="How to use Fescar to ensure consistency between Dubbo Microservices" class=md-nav__link> How to use Fescar to ensure consistency between Dubbo Microservices </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/prepare-an-apache-release/ title="Prepare an Apache Release" class=md-nav__link> Prepare an Apache Release </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-protocol/ title="Dubbo protocol" class=md-nav__link> Dubbo protocol </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-101/ title="Your First Dubbo Demo" class=md-nav__link> Your First Dubbo Demo </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/first-dubbo-filter/ title="Your First Dubbo filter" class=md-nav__link> Your First Dubbo filter </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-zk/ title="Using Zookeeper in Dubbo" class=md-nav__link> Using Zookeeper in Dubbo </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-annotation/ title="Using annotation in Dubbo" class=md-nav__link> Using annotation in Dubbo </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/introduction-to-dubbo-spi/ title="Introduction to Dubbo spi" class=md-nav__link> Introduction to Dubbo spi </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/spring-boot-dubbo-start-stop-analysis/ title="Source code analysis of spring-boot+Dubbo App start and stop" class=md-nav__link> Source code analysis of spring-boot+Dubbo App start and stop </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/introduction-to-dubbo-spi-2/ title="Dubbo extensible mechanism source code analysis" class=md-nav__link> Dubbo extensible mechanism source code analysis </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/introduction-to-dubbo-qos/ title="Manipulating Services Dynamically via QoS" class=md-nav__link> Manipulating Services Dynamically via QoS </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-loadbalance/ title="Dubbo Loadbalance" class=md-nav__link> Dubbo Loadbalance </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/sentinel-introduction-for-dubbo/ title="Sentinel: The flow sentinel of Dubbo service" class=md-nav__link> Sentinel: The flow sentinel of Dubbo service </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/pinpoint/ title="Tracking with Pinpoint" class=md-nav__link> Tracking with Pinpoint </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> Developers <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Developers data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Developers </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> User Guide <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="User Guide" data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/user-guide/faq_dev/ title=faq class=md-nav__link> faq </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2> Contributor Guide <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Contributor Guide" data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Contributor Guide </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/new-contributor-guide_dev/ title="New contributor guide" class=md-nav__link> New contributor guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/software-donation-guide_dev/ title="Software donation guide" class=md-nav__link> Software donation guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/test-coverage-guide_dev/ title="Test coverage guide" class=md-nav__link> Test coverage guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/mailing-list-subscription-guide_dev/ title="Mailing list subscription guide" class=md-nav__link> Mailing list subscription guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/cla-signing-guide_dev/ title="CLA Signing Guide" class=md-nav__link> CLA Signing Guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/dubbo-extension-guide_dev/ title="Extension guide" class=md-nav__link> Extension guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/become-a-committer_dev/ title="How to become a committer" class=md-nav__link> How to become a committer </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/reporting-security-issues_dev.md title="How to report security issues" class=md-nav__link> How to report security issues </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-3> Committer Guide <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Committer Guide" data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Committer Guide </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/new-committer-guide_dev/ title="New Committer guide" class=md-nav__link> New Committer guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href="../../../../developers/Label an Issue.md" title="Label an Issue" class=md-nav__link> Label an Issue </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/website-guide_dev/ title="Website Guide" class=md-nav__link> Website Guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/apache-dubbo-page_dev/ title="Apache Dubbo Page Maintenance" class=md-nav__link> Apache Dubbo Page Maintenance </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/release-guide_dev/ title="Release Guide" class=md-nav__link> Release Guide </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/guide_dev/ title="How to contribute" class=md-nav__link> How to contribute </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/developers_dev/ title=Developers class=md-nav__link> Developers </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/downloads.md title=Downloads class=md-nav__link> Downloads </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1.原理 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2.源码分析 </a> <nav class=md-nav aria-label=2.源码分析> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21 class=md-nav__link> 2.1 获取自适应拓展 </a> </li> <li class=md-nav__item> <a href=#22 class=md-nav__link> 2.2 自适应拓展类代码生成 </a> <nav class=md-nav aria-label="2.2 自适应拓展类代码生成"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#221-adaptive class=md-nav__link> 2.2.1 Adaptive 注解检测 </a> </li> <li class=md-nav__item> <a href=#222 class=md-nav__link> 2.2.2 生成类 </a> </li> <li class=md-nav__item> <a href=#223 class=md-nav__link> 2.2.3 生成方法 </a> <nav class=md-nav aria-label="2.2.3 生成方法"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#2231-adaptive class=md-nav__link> 2.2.3.1 无 Adaptive 注解方法代码生成逻辑 </a> </li> <li class=md-nav__item> <a href=#2232-url class=md-nav__link> 2.2.3.2 获取 URL 数据 </a> </li> <li class=md-nav__item> <a href=#2233-adaptive class=md-nav__link> 2.2.3.3 获取 Adaptive 注解值 </a> </li> <li class=md-nav__item> <a href=#2234-invocation class=md-nav__link> 2.2.3.4 检测 Invocation 参数 </a> </li> <li class=md-nav__item> <a href=#2235 class=md-nav__link> 2.2.3.5 生成拓展名获取逻辑 </a> </li> <li class=md-nav__item> <a href=#2236 class=md-nav__link> 2.2.3.6 生成拓展加载与目标方法调用逻辑 </a> </li> <li class=md-nav__item> <a href=#2237 class=md-nav__link> 2.2.3.7 生成完整的方法 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3.总结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/apache/dubbo-website/edit/master/zh-cn/docs/2.7/source_code_guide/adaptive-extension.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>SPI 自适应拓展</h1> <h2 id=1>1.原理<a class=headerlink href=#1 title="Permanent link">&para;</a></h2> <p>在 Dubbo 中，很多拓展都是通过 SPI 机制进行加载的，比如 Protocol、Cluster、LoadBalance 等。有时，有些拓展并不想在框架启动阶段被加载，而是希望在拓展方法被调用时，根据运行时参数进行加载。这听起来有些矛盾。拓展未被加载，那么拓展方法就无法被调用（静态方法除外）。拓展方法未被调用，拓展就无法被加载。对于这个矛盾的问题，Dubbo 通过自适应拓展机制很好的解决了。自适应拓展机制的实现逻辑比较复杂，首先 Dubbo 会为拓展接口生成具有代理功能的代码。然后通过 javassist 或 jdk 编译这段代码，得到 Class 类。最后再通过反射创建代理类，整个过程比较复杂。为了让大家对自适应拓展有一个感性的认识，下面我们通过一个示例进行演示。这是一个与汽车相关的例子，我们有一个车轮制造厂接口 WheelMaker：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>WheelMaker</span> <span class=p>{</span>
    <span class=n>Wheel</span> <span class=nf>makeWheel</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>WheelMaker 接口的自适应实现类如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>AdaptiveWheelMaker</span> <span class=kd>implements</span> <span class=n>WheelMaker</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=n>Wheel</span> <span class=nf>makeWheel</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>url</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;url == null&quot;</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// 1.从 URL 中获取 WheelMaker 名称</span>
        <span class=n>String</span> <span class=n>wheelMakerName</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;Wheel.maker&quot;</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>wheelMakerName</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;wheelMakerName == null&quot;</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// 2.通过 SPI 加载具体的 WheelMaker</span>
        <span class=n>WheelMaker</span> <span class=n>wheelMaker</span> <span class=o>=</span> <span class=n>ExtensionLoader</span>
            <span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>WheelMaker</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getExtension</span><span class=p>(</span><span class=n>wheelMakerName</span><span class=p>);</span>

        <span class=c1>// 3.调用目标方法</span>
        <span class=k>return</span> <span class=n>wheelMaker</span><span class=p>.</span><span class=na>makeWheel</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>AdaptiveWheelMaker 是一个代理类，与传统的代理逻辑不同，AdaptiveWheelMaker 所代理的对象是在 makeWheel 方法中通过 SPI 加载得到的。makeWheel 方法主要做了三件事情：</p> <ol> <li>从 URL 中获取 WheelMaker 名称</li> <li>通过 SPI 加载具体的 WheelMaker 实现类</li> <li>调用目标方法</li> </ol> <p>接下来，我们来看看汽车制造厂 CarMaker 接口与其实现类。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>CarMaker</span> <span class=p>{</span>
    <span class=n>Car</span> <span class=nf>makeCar</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>);</span>
<span class=p>}</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>RaceCarMaker</span> <span class=kd>implements</span> <span class=n>CarMaker</span> <span class=p>{</span>
    <span class=n>WheelMaker</span> <span class=n>wheelMaker</span><span class=p>;</span>

    <span class=c1>// 通过 setter 注入 AdaptiveWheelMaker</span>
    <span class=kd>public</span> <span class=nf>setWheelMaker</span><span class=p>(</span><span class=n>WheelMaker</span> <span class=n>wheelMaker</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>wheelMaker</span> <span class=o>=</span> <span class=n>wheelMaker</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=n>Car</span> <span class=nf>makeCar</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Wheel</span> <span class=n>wheel</span> <span class=o>=</span> <span class=n>wheelMaker</span><span class=p>.</span><span class=na>makeWheel</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
        <span class=k>return</span> <span class=k>new</span> <span class=n>RaceCar</span><span class=p>(</span><span class=n>wheel</span><span class=p>,</span> <span class=p>...);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>RaceCarMaker 持有一个 WheelMaker 类型的成员变量，在程序启动时，我们可以将 AdaptiveWheelMaker 通过 setter 方法注入到 RaceCarMaker 中。在运行时，假设有这样一个 url 参数传入：</p> <div class=highlight><pre><span></span><code>dubbo://192.168.0.101:20880/XxxService?wheel.maker=MichelinWheelMaker
</code></pre></div> <p>RaceCarMaker 的 makeCar 方法将上面的 url 作为参数传给 AdaptiveWheelMaker 的 makeWheel 方法，makeWheel 方法从 url 中提取 wheel.maker 参数，得到 MichelinWheelMaker。之后再通过 SPI 加载配置名为 MichelinWheelMaker 的实现类，得到具体的 WheelMaker 实例。</p> <p>上面的示例展示了自适应拓展类的核心实现 ---- 在拓展接口的方法被调用时，通过 SPI 加载具体的拓展实现类，并调用拓展对象的同名方法。接下来，我们深入到源码中，探索自适应拓展类生成的过程。</p> <h2 id=2>2.源码分析<a class=headerlink href=#2 title="Permanent link">&para;</a></h2> <p>在对自适应拓展生成过程进行深入分析之前，我们先来看一下与自适应拓展息息相关的一个注解，即 Adaptive 注解。该注解的定义如下：</p> <div class=highlight><pre><span></span><code><span class=nd>@Documented</span>
<span class=nd>@Retention</span><span class=p>(</span><span class=n>RetentionPolicy</span><span class=p>.</span><span class=na>RUNTIME</span><span class=p>)</span>
<span class=nd>@Target</span><span class=p>({</span><span class=n>ElementType</span><span class=p>.</span><span class=na>TYPE</span><span class=p>,</span> <span class=n>ElementType</span><span class=p>.</span><span class=na>METHOD</span><span class=p>})</span>
<span class=kd>public</span> <span class=nd>@interface</span> <span class=n>Adaptive</span> <span class=p>{</span>
    <span class=n>String</span><span class=o>[]</span> <span class=nf>value</span><span class=p>()</span> <span class=k>default</span> <span class=p>{};</span>
<span class=p>}</span>
</code></pre></div> <p>从上面的代码中可知，Adaptive 可注解在类或方法上。当 Adaptive 注解在类上时，Dubbo 不会为该类生成代理类。注解在方法（接口方法）上时，Dubbo 则会为该方法生成代理逻辑。Adaptive 注解在类上的情况很少，在 Dubbo 中，仅有两个类被 Adaptive 注解了，分别是 AdaptiveCompiler 和 AdaptiveExtensionFactory。此种情况，表示拓展的加载逻辑由人工编码完成。更多时候，Adaptive 是注解在接口方法上的，表示拓展的加载逻辑需由框架自动生成。Adaptive 注解的地方不同，相应的处理逻辑也是不同的。注解在类上时，处理逻辑比较简单，本文就不分析了。注解在接口方法上时，处理逻辑较为复杂，本章将会重点分析此块逻辑。</p> <h3 id=21>2.1 获取自适应拓展<a class=headerlink href=#21 title="Permanent link">&para;</a></h3> <p>getAdaptiveExtension 方法是获取自适应拓展的入口方法，因此下面我们从这个方法进行分析。相关代码如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>T</span> <span class=nf>getAdaptiveExtension</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// 从缓存中获取自适应拓展</span>
    <span class=n>Object</span> <span class=n>instance</span> <span class=o>=</span> <span class=n>cachedAdaptiveInstance</span><span class=p>.</span><span class=na>get</span><span class=p>();</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>    <span class=c1>// 缓存未命中</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>createAdaptiveInstanceError</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=kd>synchronized</span> <span class=p>(</span><span class=n>cachedAdaptiveInstance</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>instance</span> <span class=o>=</span> <span class=n>cachedAdaptiveInstance</span><span class=p>.</span><span class=na>get</span><span class=p>();</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>instance</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>try</span> <span class=p>{</span>
                        <span class=c1>// 创建自适应拓展</span>
                        <span class=n>instance</span> <span class=o>=</span> <span class=n>createAdaptiveExtension</span><span class=p>();</span>
                        <span class=c1>// 设置自适应拓展到缓存中</span>
                        <span class=n>cachedAdaptiveInstance</span><span class=p>.</span><span class=na>set</span><span class=p>(</span><span class=n>instance</span><span class=p>);</span>
                    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Throwable</span> <span class=n>t</span><span class=p>)</span> <span class=p>{</span>
                        <span class=n>createAdaptiveInstanceError</span> <span class=o>=</span> <span class=n>t</span><span class=p>;</span>
                        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;fail to create adaptive instance: ...&quot;</span><span class=p>);</span>
                    <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;fail to create adaptive instance:  ...&quot;</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=k>return</span> <span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=n>instance</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>getAdaptiveExtension 方法首先会检查缓存，缓存未命中，则调用 createAdaptiveExtension 方法创建自适应拓展。下面，我们看一下 createAdaptiveExtension 方法的代码。</p> <p><div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=n>T</span> <span class=nf>createAdaptiveExtension</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// 获取自适应拓展类，并通过反射实例化</span>
        <span class=k>return</span> <span class=n>injectExtension</span><span class=p>((</span><span class=n>T</span><span class=p>)</span> <span class=n>getAdaptiveExtensionClass</span><span class=p>().</span><span class=na>newInstance</span><span class=p>());</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;Can not create adaptive extension ...&quot;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> createAdaptiveExtension 方法的代码比较少，但却包含了三个逻辑，分别如下：</p> <ol> <li>调用 getAdaptiveExtensionClass 方法获取自适应拓展 Class 对象</li> <li>通过反射进行实例化</li> <li>调用 injectExtension 方法向拓展实例中注入依赖</li> </ol> <p>前两个逻辑比较好理解，第三个逻辑用于向自适应拓展对象中注入依赖。这个逻辑看似多余，但有存在的必要，这里简单说明一下。前面说过，Dubbo 中有两种类型的自适应拓展，一种是手工编码的，一种是自动生成的。手工编码的自适应拓展中可能存在着一些依赖，而自动生成的 Adaptive 拓展则不会依赖其他类。这里调用 injectExtension 方法的目的是为手工编码的自适应拓展注入依赖，这一点需要大家注意一下。关于 injectExtension 方法，前文已经分析过了，这里不再赘述。接下来，分析 getAdaptiveExtensionClass 方法的逻辑。</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>getAdaptiveExtensionClass</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// 通过 SPI 获取所有的拓展类</span>
    <span class=n>getExtensionClasses</span><span class=p>();</span>
    <span class=c1>// 检查缓存，若缓存不为空，则直接返回缓存</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>cachedAdaptiveClass</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>cachedAdaptiveClass</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=c1>// 创建自适应拓展类</span>
    <span class=k>return</span> <span class=n>cachedAdaptiveClass</span> <span class=o>=</span> <span class=n>createAdaptiveExtensionClass</span><span class=p>();</span>
<span class=p>}</span>
</code></pre></div> <p>getAdaptiveExtensionClass 方法同样包含了三个逻辑，如下：</p> <ol> <li>调用 getExtensionClasses 获取所有的拓展类</li> <li>检查缓存，若缓存不为空，则返回缓存</li> <li>若缓存为空，则调用 createAdaptiveExtensionClass 创建自适应拓展类</li> </ol> <p>这三个逻辑看起来平淡无奇，似乎没有多讲的必要。但是这些平淡无奇的代码中隐藏了着一些细节，需要说明一下。首先从第一个逻辑说起，getExtensionClasses 这个方法用于获取某个接口的所有实现类。比如该方法可以获取 Protocol 接口的 DubboProtocol、HttpProtocol、InjvmProtocol 等实现类。在获取实现类的过程中，如果某个实现类被 Adaptive 注解修饰了，那么该类就会被赋值给 cachedAdaptiveClass 变量。此时，上面步骤中的第二步条件成立（缓存不为空），直接返回 cachedAdaptiveClass 即可。如果所有的实现类均未被 Adaptive 注解修饰，那么执行第三步逻辑，创建自适应拓展类。相关代码如下：</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>createAdaptiveExtensionClass</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// 构建自适应拓展代码</span>
    <span class=n>String</span> <span class=n>code</span> <span class=o>=</span> <span class=n>createAdaptiveExtensionClassCode</span><span class=p>();</span>
    <span class=n>ClassLoader</span> <span class=n>classLoader</span> <span class=o>=</span> <span class=n>findClassLoader</span><span class=p>();</span>
    <span class=c1>// 获取编译器实现类</span>
    <span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>compiler</span><span class=p>.</span><span class=na>Compiler</span> <span class=n>compiler</span> <span class=o>=</span> <span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>compiler</span><span class=p>.</span><span class=na>Compiler</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getAdaptiveExtension</span><span class=p>();</span>
    <span class=c1>// 编译代码，生成 Class</span>
    <span class=k>return</span> <span class=n>compiler</span><span class=p>.</span><span class=na>compile</span><span class=p>(</span><span class=n>code</span><span class=p>,</span> <span class=n>classLoader</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>createAdaptiveExtensionClass 方法用于生成自适应拓展类，该方法首先会生成自适应拓展类的源码，然后通过 Compiler 实例（Dubbo 默认使用 javassist 作为编译器）编译源码，得到代理类 Class 实例。接下来，我们把重点放在代理类代码生成的逻辑上，其他逻辑大家自行分析。</p> <h3 id=22>2.2 自适应拓展类代码生成<a class=headerlink href=#22 title="Permanent link">&para;</a></h3> <p>createAdaptiveExtensionClassCode 方法代码略多，约有两百行代码。因此本节将会对该方法的代码进行拆分分析，以帮助大家更好的理解代码逻辑。</p> <h4 id=221-adaptive>2.2.1 Adaptive 注解检测<a class=headerlink href=#221-adaptive title="Permanent link">&para;</a></h4> <p>在生成代理类源码之前，createAdaptiveExtensionClassCode 方法首先会通过反射检测接口方法是否包含 Adaptive 注解。对于要生成自适应拓展的接口，Dubbo 要求该接口至少有一个方法被 Adaptive 注解修饰。若不满足此条件，就会抛出运行时异常。相关代码如下：</p> <div class=highlight><pre><span></span><code><span class=c1>// 通过反射获取所有的方法</span>
<span class=n>Method</span><span class=o>[]</span> <span class=n>methods</span> <span class=o>=</span> <span class=n>type</span><span class=p>.</span><span class=na>getMethods</span><span class=p>();</span>
<span class=kt>boolean</span> <span class=n>hasAdaptiveAnnotation</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
<span class=c1>// 遍历方法列表</span>
<span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>m</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 检测方法上是否有 Adaptive 注解</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>isAnnotationPresent</span><span class=p>(</span><span class=n>Adaptive</span><span class=p>.</span><span class=na>class</span><span class=p>))</span> <span class=p>{</span>
        <span class=n>hasAdaptiveAnnotation</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
        <span class=k>break</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>hasAdaptiveAnnotation</span><span class=p>)</span>
    <span class=c1>// 若所有的方法上均无 Adaptive 注解，则抛出异常</span>
    <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;No adaptive method on extension ...&quot;</span><span class=p>);</span>
</code></pre></div> <h4 id=222>2.2.2 生成类<a class=headerlink href=#222 title="Permanent link">&para;</a></h4> <p>通过 Adaptive 注解检测后，即可开始生成代码。代码生成的顺序与 Java 文件内容顺序一致，首先会生成 package 语句，然后生成 import 语句，紧接着生成类名等代码。整个逻辑如下：</p> <div class=highlight><pre><span></span><code><span class=c1>// 生成 package 代码：package + type 所在包</span>
<span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;package &quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>type</span><span class=p>.</span><span class=na>getPackage</span><span class=p>().</span><span class=na>getName</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;;&quot;</span><span class=p>);</span>
<span class=c1>// 生成 import 代码：import + ExtensionLoader 全限定名</span>
<span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\nimport &quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;;&quot;</span><span class=p>);</span>
<span class=c1>// 生成类代码：public class + type简单名称 + $Adaptive + implements + type全限定名 + {</span>
<span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\npublic class &quot;</span><span class=p>)</span>
    <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>type</span><span class=p>.</span><span class=na>getSimpleName</span><span class=p>())</span>
    <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;$Adaptive&quot;</span><span class=p>)</span>
    <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; implements &quot;</span><span class=p>)</span>
    <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>type</span><span class=p>.</span><span class=na>getCanonicalName</span><span class=p>())</span>
    <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; {&quot;</span><span class=p>);</span>

<span class=c1>// ${生成方法}</span>

<span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\n}&quot;</span><span class=p>);</span>
</code></pre></div> <p>这里使用 ${...} 占位符代表其他代码的生成逻辑，该部分逻辑将在随后进行分析。上面代码不是很难理解，下面直接通过一个例子展示该段代码所生成的内容。以 Dubbo 的 Protocol 接口为例，生成的代码如下：</p> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>com.alibaba.dubbo.rpc</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>com.alibaba.dubbo.common.extension.ExtensionLoader</span><span class=p>;</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Protocol$Adaptive</span> <span class=kd>implements</span> <span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>Protocol</span> <span class=p>{</span>
    <span class=c1>// 省略方法代码</span>
<span class=p>}</span>
</code></pre></div> <h4 id=223>2.2.3 生成方法<a class=headerlink href=#223 title="Permanent link">&para;</a></h4> <p>一个方法可以被 Adaptive 注解修饰，也可以不被修饰。这里将未被 Adaptive 注解修饰的方法称为“无 Adaptive 注解方法”，下面我们先来看看此种方法的代码生成逻辑是怎样的。</p> <h5 id=2231-adaptive>2.2.3.1 无 Adaptive 注解方法代码生成逻辑<a class=headerlink href=#2231-adaptive title="Permanent link">&para;</a></h5> <p>对于接口方法，我们可以按照需求标注 Adaptive 注解。以 Protocol 接口为例，该接口的 destroy 和 getDefaultPort 未标注 Adaptive 注解，其他方法均标注了 Adaptive 注解。Dubbo 不会为没有标注 Adaptive 注解的方法生成代理逻辑，对于该种类型的方法，仅会生成一句抛出异常的代码。生成逻辑如下：</p> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>method</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>

    <span class=c1>// 省略无关逻辑</span>

    <span class=n>Adaptive</span> <span class=n>adaptiveAnnotation</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>Adaptive</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=n>StringBuilder</span> <span class=n>code</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=mi>512</span><span class=p>);</span>
    <span class=c1>// 如果方法上无 Adaptive 注解，则生成 throw new UnsupportedOperationException(...) 代码</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>adaptiveAnnotation</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 生成的代码格式如下：</span>
        <span class=c1>// throw new UnsupportedOperationException(</span>
        <span class=c1>//     &quot;method &quot; + 方法签名 + of interface + 全限定接口名 + is not adaptive method!”)</span>
        <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;throw new UnsupportedOperationException(\&quot;method &quot;</span><span class=p>)</span>
            <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>method</span><span class=p>.</span><span class=na>toString</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; of interface &quot;</span><span class=p>)</span>
            <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>type</span><span class=p>.</span><span class=na>getName</span><span class=p>()).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; is not adaptive method!\&quot;);&quot;</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// 省略无关逻辑</span>
    <span class=p>}</span>

    <span class=c1>// 省略无关逻辑</span>
<span class=p>}</span>
</code></pre></div> <p>以 Protocol 接口的 destroy 方法为例，上面代码生成的内容如下：</p> <div class=highlight><pre><span></span><code><span class=k>throw</span> <span class=k>new</span> <span class=n>UnsupportedOperationException</span><span class=p>(</span>
            <span class=s>&quot;method public abstract void com.alibaba.dubbo.rpc.Protocol.destroy() of interface com.alibaba.dubbo.rpc.Protocol is not adaptive method!&quot;</span><span class=p>);</span>
</code></pre></div> <h5 id=2232-url>2.2.3.2 获取 URL 数据<a class=headerlink href=#2232-url title="Permanent link">&para;</a></h5> <p>前面说过方法代理逻辑会从 URL 中提取目标拓展的名称，因此代码生成逻辑的一个重要的任务是从方法的参数列表或者其他参数中获取 URL 数据。举例说明一下，我们要为 Protocol 接口的 refer 和 export 方法生成代理逻辑。在运行时，通过反射得到的方法定义大致如下：</p> <div class=highlight><pre><span></span><code><span class=n>Invoker</span> <span class=nf>refer</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>arg0</span><span class=p>,</span> <span class=n>URL</span> <span class=n>arg1</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RpcException</span><span class=p>;</span>
<span class=n>Exporter</span> <span class=nf>export</span><span class=p>(</span><span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>arg0</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RpcException</span><span class=p>;</span>
</code></pre></div> <p>对于 refer 方法，通过遍历 refer 的参数列表即可获取 URL 数据，这个还比较简单。对于 export 方法，获取 URL 数据则要麻烦一些。export 参数列表中没有 URL 参数，因此需要从 Invoker 参数中获取 URL 数据。获取方式是调用 Invoker 中可返回 URL 的 getter 方法，比如 getUrl。如果 Invoker 中无相关 getter 方法，此时则会抛出异常。整个逻辑如下：</p> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>method</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>rt</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>pts</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>ets</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getExceptionTypes</span><span class=p>();</span>

    <span class=n>Adaptive</span> <span class=n>adaptiveAnnotation</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>Adaptive</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=n>StringBuilder</span> <span class=n>code</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=mi>512</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>adaptiveAnnotation</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// ${无 Adaptive 注解方法代码生成逻辑}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=kt>int</span> <span class=n>urlTypeIndex</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
        <span class=c1>// 遍历参数列表，确定 URL 参数位置</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>pts</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>pts</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>URL</span><span class=p>.</span><span class=na>class</span><span class=p>))</span> <span class=p>{</span>
                <span class=n>urlTypeIndex</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>

        <span class=c1>// urlTypeIndex != -1，表示参数列表中存在 URL 参数</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>urlTypeIndex</span> <span class=o>!=</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 为 URL 类型参数生成判空代码，格式如下：</span>
            <span class=c1>// if (arg + urlTypeIndex == null) </span>
            <span class=c1>//     throw new IllegalArgumentException(&quot;url == null&quot;);</span>
            <span class=n>String</span> <span class=n>s</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;\nif (arg%d == null) throw new IllegalArgumentException(\&quot;url == null\&quot;);&quot;</span><span class=p>,</span>
                                     <span class=n>urlTypeIndex</span><span class=p>);</span>
            <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>

            <span class=c1>// 为 URL 类型参数生成赋值代码，形如 URL url = arg1</span>
            <span class=n>s</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;\n%s url = arg%d;&quot;</span><span class=p>,</span> <span class=n>URL</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>(),</span> <span class=n>urlTypeIndex</span><span class=p>);</span>
            <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>

        <span class=c1>// 参数列表中不存在 URL 类型参数</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=n>String</span> <span class=n>attribMethod</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>

<span class=nl>            LBL_PTS:</span>
            <span class=c1>// 遍历方法的参数类型列表</span>
            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>pts</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// 获取某一类型参数的全部方法</span>
                <span class=n>Method</span><span class=o>[]</span> <span class=n>ms</span> <span class=o>=</span> <span class=n>pts</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getMethods</span><span class=p>();</span>
                <span class=c1>// 遍历方法列表，寻找可返回 URL 的 getter 方法</span>
                <span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>m</span> <span class=p>:</span> <span class=n>ms</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>String</span> <span class=n>name</span> <span class=o>=</span> <span class=n>m</span><span class=p>.</span><span class=na>getName</span><span class=p>();</span>
                    <span class=c1>// 1. 方法名以 get 开头，或方法名大于3个字符</span>
                    <span class=c1>// 2. 方法的访问权限为 public</span>
                    <span class=c1>// 3. 非静态方法</span>
                    <span class=c1>// 4. 方法参数数量为0</span>
                    <span class=c1>// 5. 方法返回值类型为 URL</span>
                    <span class=k>if</span> <span class=p>((</span><span class=n>name</span><span class=p>.</span><span class=na>startsWith</span><span class=p>(</span><span class=s>&quot;get&quot;</span><span class=p>)</span> <span class=o>||</span> <span class=n>name</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>3</span><span class=p>)</span>
                        <span class=o>&amp;&amp;</span> <span class=n>Modifier</span><span class=p>.</span><span class=na>isPublic</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>())</span>
                        <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>Modifier</span><span class=p>.</span><span class=na>isStatic</span><span class=p>(</span><span class=n>m</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>())</span>
                        <span class=o>&amp;&amp;</span> <span class=n>m</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>().</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span>
                        <span class=o>&amp;&amp;</span> <span class=n>m</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>()</span> <span class=o>==</span> <span class=n>URL</span><span class=p>.</span><span class=na>class</span><span class=p>)</span> <span class=p>{</span>
                        <span class=n>urlTypeIndex</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
                        <span class=n>attribMethod</span> <span class=o>=</span> <span class=n>name</span><span class=p>;</span>

                        <span class=c1>// 结束 for (int i = 0; i &lt; pts.length; ++i) 循环</span>
                        <span class=k>break</span> <span class=n>LBL_PTS</span><span class=p>;</span>
                    <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>attribMethod</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// 如果所有参数中均不包含可返回 URL 的 getter 方法，则抛出异常</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;fail to create adaptive class for interface ...&quot;</span><span class=p>);</span>
            <span class=p>}</span>

            <span class=c1>// 为可返回 URL 的参数生成判空代码，格式如下：</span>
            <span class=c1>// if (arg + urlTypeIndex == null) </span>
            <span class=c1>//     throw new IllegalArgumentException(&quot;参数全限定名 + argument == null&quot;);</span>
            <span class=n>String</span> <span class=n>s</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;\nif (arg%d == null) throw new IllegalArgumentException(\&quot;%s argument == null\&quot;);&quot;</span><span class=p>,</span>
                                     <span class=n>urlTypeIndex</span><span class=p>,</span> <span class=n>pts</span><span class=o>[</span><span class=n>urlTypeIndex</span><span class=o>]</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>
            <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>

            <span class=c1>// 为 getter 方法返回的 URL 生成判空代码，格式如下：</span>
            <span class=c1>// if (argN.getter方法名() == null) </span>
            <span class=c1>//     throw new IllegalArgumentException(参数全限定名 + argument getUrl() == null);</span>
            <span class=n>s</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;\nif (arg%d.%s() == null) throw new IllegalArgumentException(\&quot;%s argument %s() == null\&quot;);&quot;</span><span class=p>,</span>
                              <span class=n>urlTypeIndex</span><span class=p>,</span> <span class=n>attribMethod</span><span class=p>,</span> <span class=n>pts</span><span class=o>[</span><span class=n>urlTypeIndex</span><span class=o>]</span><span class=p>.</span><span class=na>getName</span><span class=p>(),</span> <span class=n>attribMethod</span><span class=p>);</span>
            <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>

            <span class=c1>// 生成赋值语句，格式如下：</span>
            <span class=c1>// URL全限定名 url = argN.getter方法名()，比如 </span>
            <span class=c1>// com.alibaba.dubbo.common.URL url = invoker.getUrl();</span>
            <span class=n>s</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;%s url = arg%d.%s();&quot;</span><span class=p>,</span> <span class=n>URL</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>(),</span> <span class=n>urlTypeIndex</span><span class=p>,</span> <span class=n>attribMethod</span><span class=p>);</span>
            <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// 省略无关代码</span>
    <span class=p>}</span>

    <span class=c1>// 省略无关代码</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码有点多，需要耐心看一下。这段代码主要目的是为了获取 URL 数据，并为之生成判空和赋值代码。以 Protocol 的 refer 和 export 方法为例，上面的代码为它们生成如下内容（代码已格式化）：</p> <div class=highlight><pre><span></span><code><span class=nl>refer:</span>
<span class=k>if</span> <span class=p>(</span><span class=n>arg1</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> 
    <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;url == null&quot;</span><span class=p>);</span>
<span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>URL</span> <span class=n>url</span> <span class=o>=</span> <span class=n>arg1</span><span class=p>;</span>

<span class=nl>export:</span>
<span class=k>if</span> <span class=p>(</span><span class=n>arg0</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> 
    <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;com.alibaba.dubbo.rpc.Invoker argument == null&quot;</span><span class=p>);</span>
<span class=k>if</span> <span class=p>(</span><span class=n>arg0</span><span class=p>.</span><span class=na>getUrl</span><span class=p>()</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> 
    <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;com.alibaba.dubbo.rpc.Invoker argument getUrl() == null&quot;</span><span class=p>);</span>
<span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>URL</span> <span class=n>url</span> <span class=o>=</span> <span class=n>arg0</span><span class=p>.</span><span class=na>getUrl</span><span class=p>();</span>
</code></pre></div> <h5 id=2233-adaptive>2.2.3.3 获取 Adaptive 注解值<a class=headerlink href=#2233-adaptive title="Permanent link">&para;</a></h5> <p>Adaptive 注解值 value 类型为 String[]，可填写多个值，默认情况下为空数组。若 value 为非空数组，直接获取数组内容即可。若 value 为空数组，则需进行额外处理。处理过程是将类名转换为字符数组，然后遍历字符数组，并将字符放入 StringBuilder 中。若字符为大写字母，则向 StringBuilder 中添加点号，随后将字符变为小写存入 StringBuilder 中。比如 LoadBalance 经过处理后，得到 load.balance。</p> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>method</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>rt</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>pts</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>ets</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getExceptionTypes</span><span class=p>();</span>

    <span class=n>Adaptive</span> <span class=n>adaptiveAnnotation</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>Adaptive</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=n>StringBuilder</span> <span class=n>code</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=mi>512</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>adaptiveAnnotation</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// ${无 Adaptive 注解方法代码生成逻辑}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// ${获取 URL 数据}</span>

        <span class=n>String</span><span class=o>[]</span> <span class=n>value</span> <span class=o>=</span> <span class=n>adaptiveAnnotation</span><span class=p>.</span><span class=na>value</span><span class=p>();</span>
        <span class=c1>// value 为空数组</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>value</span><span class=p>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 获取类名，并将类名转换为字符数组</span>
            <span class=kt>char</span><span class=o>[]</span> <span class=n>charArray</span> <span class=o>=</span> <span class=n>type</span><span class=p>.</span><span class=na>getSimpleName</span><span class=p>().</span><span class=na>toCharArray</span><span class=p>();</span>
            <span class=n>StringBuilder</span> <span class=n>sb</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=mi>128</span><span class=p>);</span>
            <span class=c1>// 遍历字节数组</span>
            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>charArray</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// 检测当前字符是否为大写字母</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>Character</span><span class=p>.</span><span class=na>isUpperCase</span><span class=p>(</span><span class=n>charArray</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>))</span> <span class=p>{</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                        <span class=c1>// 向 sb 中添加点号</span>
                        <span class=n>sb</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;.&quot;</span><span class=p>);</span>
                    <span class=p>}</span>
                    <span class=c1>// 将字符变为小写，并添加到 sb 中</span>
                    <span class=n>sb</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>Character</span><span class=p>.</span><span class=na>toLowerCase</span><span class=p>(</span><span class=n>charArray</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>));</span>
                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                    <span class=c1>// 添加字符到 sb 中</span>
                    <span class=n>sb</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>charArray</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
            <span class=n>value</span> <span class=o>=</span> <span class=k>new</span> <span class=n>String</span><span class=o>[]</span><span class=p>{</span><span class=n>sb</span><span class=p>.</span><span class=na>toString</span><span class=p>()};</span>
        <span class=p>}</span>

        <span class=c1>// 省略无关代码</span>
    <span class=p>}</span>

    <span class=c1>// 省略无关逻辑</span>
<span class=p>}</span>
</code></pre></div> <h5 id=2234-invocation>2.2.3.4 检测 Invocation 参数<a class=headerlink href=#2234-invocation title="Permanent link">&para;</a></h5> <p>此段逻辑是检测方法列表中是否存在 Invocation 类型的参数，若存在，则为其生成判空代码和其他一些代码。相应的逻辑如下：</p> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>method</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>rt</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>pts</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>();</span>    <span class=c1>// 获取参数类型列表</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>ets</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getExceptionTypes</span><span class=p>();</span>

    <span class=n>Adaptive</span> <span class=n>adaptiveAnnotation</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>Adaptive</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=n>StringBuilder</span> <span class=n>code</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=mi>512</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>adaptiveAnnotation</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// ${无 Adaptive 注解方法代码生成逻辑}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// ${获取 URL 数据}</span>

        <span class=c1>// ${获取 Adaptive 注解值}</span>

        <span class=kt>boolean</span> <span class=n>hasInvocation</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
        <span class=c1>// 遍历参数类型列表</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>pts</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 判断当前参数名称是否等于 com.alibaba.dubbo.rpc.Invocation</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>pts</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getName</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;com.alibaba.dubbo.rpc.Invocation&quot;</span><span class=p>))</span> <span class=p>{</span>
                <span class=c1>// 为 Invocation 类型参数生成判空代码</span>
                <span class=n>String</span> <span class=n>s</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;\nif (arg%d == null) throw new IllegalArgumentException(\&quot;invocation == null\&quot;);&quot;</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
                <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
                <span class=c1>// 生成 getMethodName 方法调用代码，格式为：</span>
                <span class=c1>//    String methodName = argN.getMethodName();</span>
                <span class=n>s</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;\nString methodName = arg%d.getMethodName();&quot;</span><span class=p>,</span> <span class=n>i</span><span class=p>);</span>
                <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>

                <span class=c1>// 设置 hasInvocation 为 true</span>
                <span class=n>hasInvocation</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// 省略无关逻辑</span>
<span class=p>}</span>
</code></pre></div> <h5 id=2235>2.2.3.5 生成拓展名获取逻辑<a class=headerlink href=#2235 title="Permanent link">&para;</a></h5> <p>本段逻辑用于根据 SPI 和 Adaptive 注解值生成“获取拓展名逻辑”，同时生成逻辑也受 Invocation 类型参数影响，综合因素导致本段逻辑相对复杂。本段逻辑可能会生成但不限于下面的代码：</p> <div class=highlight><pre><span></span><code><span class=n>String</span> <span class=n>extName</span> <span class=o>=</span> <span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getProtocol</span><span class=p>()</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>?</span> <span class=s>&quot;dubbo&quot;</span> <span class=p>:</span> <span class=n>url</span><span class=p>.</span><span class=na>getProtocol</span><span class=p>());</span>
</code></pre></div> <p>或</p> <div class=highlight><pre><span></span><code><span class=n>String</span> <span class=n>extName</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getMethodParameter</span><span class=p>(</span><span class=n>methodName</span><span class=p>,</span> <span class=s>&quot;loadbalance&quot;</span><span class=p>,</span> <span class=s>&quot;random&quot;</span><span class=p>);</span>
</code></pre></div> <p>亦或是</p> <div class=highlight><pre><span></span><code><span class=n>String</span> <span class=n>extName</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;client&quot;</span><span class=p>,</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;transporter&quot;</span><span class=p>,</span> <span class=s>&quot;netty&quot;</span><span class=p>));</span>
</code></pre></div> <p>本段逻辑复杂之处在于条件分支比较多，大家在阅读源码时需要知道每个条件分支的意义是什么，否则不太容易看懂相关代码。下面开始分析本段逻辑。</p> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>method</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>rt</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>pts</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>ets</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getExceptionTypes</span><span class=p>();</span>

    <span class=n>Adaptive</span> <span class=n>adaptiveAnnotation</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>Adaptive</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=n>StringBuilder</span> <span class=n>code</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=mi>512</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>adaptiveAnnotation</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// $无 Adaptive 注解方法代码生成逻辑}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// ${获取 URL 数据}</span>

        <span class=c1>// ${获取 Adaptive 注解值}</span>

        <span class=c1>// ${检测 Invocation 参数}</span>

        <span class=c1>// 设置默认拓展名，cachedDefaultName 源于 SPI 注解值，默认情况下，</span>
        <span class=c1>// SPI 注解值为空串，此时 cachedDefaultName = null</span>
        <span class=n>String</span> <span class=n>defaultExtName</span> <span class=o>=</span> <span class=n>cachedDefaultName</span><span class=p>;</span>
        <span class=n>String</span> <span class=n>getNameCode</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>

        <span class=c1>// 遍历 value，这里的 value 是 Adaptive 的注解值，2.2.3.3 节分析过 value 变量的获取过程。</span>
        <span class=c1>// 此处循环目的是生成从 URL 中获取拓展名的代码，生成的代码会赋值给 getNameCode 变量。注意这</span>
        <span class=c1>// 个循环的遍历顺序是由后向前遍历的。</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=n>value</span><span class=p>.</span><span class=na>length</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=n>i</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>;</span> <span class=o>--</span><span class=n>i</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 当 i 为最后一个元素的坐标时</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>==</span> <span class=n>value</span><span class=p>.</span><span class=na>length</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// 默认拓展名非空</span>
                <span class=k>if</span> <span class=p>(</span><span class=kc>null</span> <span class=o>!=</span> <span class=n>defaultExtName</span><span class=p>)</span> <span class=p>{</span>
                    <span class=c1>// protocol 是 url 的一部分，可通过 getProtocol 方法获取，其他的则是从</span>
                    <span class=c1>// URL 参数中获取。因为获取方式不同，所以这里要判断 value[i] 是否为 protocol</span>
                    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=s>&quot;protocol&quot;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>value</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>))</span>
                        <span class=c1>// hasInvocation 用于标识方法参数列表中是否有 Invocation 类型参数</span>
                        <span class=k>if</span> <span class=p>(</span><span class=n>hasInvocation</span><span class=p>)</span>
                            <span class=c1>// 生成的代码功能等价于下面的代码：</span>
                            <span class=c1>//   url.getMethodParameter(methodName, value[i], defaultExtName)</span>
                            <span class=c1>// 以 LoadBalance 接口的 select 方法为例，最终生成的代码如下：</span>
                            <span class=c1>//   url.getMethodParameter(methodName, &quot;loadbalance&quot;, &quot;random&quot;)</span>
                            <span class=n>getNameCode</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;url.getMethodParameter(methodName, \&quot;%s\&quot;, \&quot;%s\&quot;)&quot;</span><span class=p>,</span> <span class=n>value</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span> <span class=n>defaultExtName</span><span class=p>);</span>
                        <span class=k>else</span>
                            <span class=c1>// 生成的代码功能等价于下面的代码：</span>
                            <span class=c1>//   url.getParameter(value[i], defaultExtName)</span>
                            <span class=n>getNameCode</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;url.getParameter(\&quot;%s\&quot;, \&quot;%s\&quot;)&quot;</span><span class=p>,</span> <span class=n>value</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span> <span class=n>defaultExtName</span><span class=p>);</span>
                    <span class=k>else</span>
                        <span class=c1>// 生成的代码功能等价于下面的代码：</span>
                        <span class=c1>//   ( url.getProtocol() == null ? defaultExtName : url.getProtocol() )</span>
                        <span class=n>getNameCode</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;( url.getProtocol() == null ? \&quot;%s\&quot; : url.getProtocol() )&quot;</span><span class=p>,</span> <span class=n>defaultExtName</span><span class=p>);</span>

                <span class=c1>// 默认拓展名为空</span>
                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=s>&quot;protocol&quot;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>value</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>))</span>
                        <span class=k>if</span> <span class=p>(</span><span class=n>hasInvocation</span><span class=p>)</span>
                            <span class=c1>// 生成代码格式同上</span>
                            <span class=n>getNameCode</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;url.getMethodParameter(methodName, \&quot;%s\&quot;, \&quot;%s\&quot;)&quot;</span><span class=p>,</span> <span class=n>value</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span> <span class=n>defaultExtName</span><span class=p>);</span>
                        <span class=k>else</span>
                            <span class=c1>// 生成的代码功能等价于下面的代码：</span>
                            <span class=c1>//   url.getParameter(value[i])</span>
                            <span class=n>getNameCode</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;url.getParameter(\&quot;%s\&quot;)&quot;</span><span class=p>,</span> <span class=n>value</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span>
                    <span class=k>else</span>
                        <span class=c1>// 生成从 url 中获取协议的代码，比如 &quot;dubbo&quot;</span>
                        <span class=n>getNameCode</span> <span class=o>=</span> <span class=s>&quot;url.getProtocol()&quot;</span><span class=p>;</span>
                <span class=p>}</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=s>&quot;protocol&quot;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>value</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>))</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>hasInvocation</span><span class=p>)</span>
                        <span class=c1>// 生成代码格式同上</span>
                        <span class=n>getNameCode</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;url.getMethodParameter(methodName, \&quot;%s\&quot;, \&quot;%s\&quot;)&quot;</span><span class=p>,</span> <span class=n>value</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span> <span class=n>defaultExtName</span><span class=p>);</span>
                    <span class=k>else</span>
                        <span class=c1>// 生成的代码功能等价于下面的代码：</span>
                        <span class=c1>//   url.getParameter(value[i], getNameCode)</span>
                        <span class=c1>// 以 Transporter 接口的 connect 方法为例，最终生成的代码如下：</span>
                        <span class=c1>//   url.getParameter(&quot;client&quot;, url.getParameter(&quot;transporter&quot;, &quot;netty&quot;))</span>
                        <span class=n>getNameCode</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;url.getParameter(\&quot;%s\&quot;, %s)&quot;</span><span class=p>,</span> <span class=n>value</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>,</span> <span class=n>getNameCode</span><span class=p>);</span>
                <span class=k>else</span>
                    <span class=c1>// 生成的代码功能等价于下面的代码：</span>
                    <span class=c1>//   url.getProtocol() == null ? getNameCode : url.getProtocol()</span>
                    <span class=c1>// 以 Protocol 接口的 connect 方法为例，最终生成的代码如下：</span>
                    <span class=c1>//   url.getProtocol() == null ? &quot;dubbo&quot; : url.getProtocol()</span>
                    <span class=n>getNameCode</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;url.getProtocol() == null ? (%s) : url.getProtocol()&quot;</span><span class=p>,</span> <span class=n>getNameCode</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=c1>// 生成 extName 赋值代码</span>
        <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\nString extName = &quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>getNameCode</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;;&quot;</span><span class=p>);</span>
        <span class=c1>// 生成 extName 判空代码</span>
        <span class=n>String</span> <span class=n>s</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;\nif(extName == null) &quot;</span> <span class=o>+</span>
                                 <span class=s>&quot;throw new IllegalStateException(\&quot;Fail to get extension(%s) name from url(\&quot; + url.toString() + \&quot;) use keys(%s)\&quot;);&quot;</span><span class=p>,</span>
                                 <span class=n>type</span><span class=p>.</span><span class=na>getName</span><span class=p>(),</span> <span class=n>Arrays</span><span class=p>.</span><span class=na>toString</span><span class=p>(</span><span class=n>value</span><span class=p>));</span>
        <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 省略无关逻辑</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码比较复杂，不是很好理解。对于这段代码，建议大家写点测试用例，对 Protocol、LoadBalance 以及 Transporter 等接口的自适应拓展类代码生成过程进行调试。这里我以 Transporter 接口的自适应拓展类代码生成过程举例说明。首先看一下 Transporter 接口的定义，如下：</p> <div class=highlight><pre><span></span><code><span class=nd>@SPI</span><span class=p>(</span><span class=s>&quot;netty&quot;</span><span class=p>)</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>Transporter</span> <span class=p>{</span>
    <span class=c1>// @Adaptive({server, transporter})</span>
    <span class=nd>@Adaptive</span><span class=p>({</span><span class=n>Constants</span><span class=p>.</span><span class=na>SERVER_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>TRANSPORTER_KEY</span><span class=p>})</span> 
    <span class=n>Server</span> <span class=nf>bind</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ChannelHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span><span class=p>;</span>

    <span class=c1>// @Adaptive({client, transporter})</span>
    <span class=nd>@Adaptive</span><span class=p>({</span><span class=n>Constants</span><span class=p>.</span><span class=na>CLIENT_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>TRANSPORTER_KEY</span><span class=p>})</span>
    <span class=n>Client</span> <span class=nf>connect</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ChannelHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>下面对 connect 方法代理逻辑生成的过程进行分析，此时生成代理逻辑所用到的变量如下：</p> <div class=highlight><pre><span></span><code><span class=n>String</span> <span class=n>defaultExtName</span> <span class=o>=</span> <span class=s>&quot;netty&quot;</span><span class=p>;</span>
<span class=kt>boolean</span> <span class=n>hasInvocation</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
<span class=n>String</span> <span class=n>getNameCode</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
<span class=n>String</span><span class=o>[]</span> <span class=n>value</span> <span class=o>=</span> <span class=o>[</span><span class=s>&quot;client&quot;</span><span class=p>,</span> <span class=s>&quot;transporter&quot;</span><span class=o>]</span><span class=p>;</span>
</code></pre></div> <p>下面对 value 数组进行遍历，此时 i = 1, value[i] = "transporter"，生成的代码如下：</p> <div class=highlight><pre><span></span><code><span class=n>getNameCode</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;transporter&quot;</span><span class=p>,</span> <span class=s>&quot;netty&quot;</span><span class=p>);</span>
</code></pre></div> <p>接下来，for 循环继续执行，此时 i = 0, value[i] = "client"，生成的代码如下：</p> <div class=highlight><pre><span></span><code><span class=n>getNameCode</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;client&quot;</span><span class=p>,</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;transporter&quot;</span><span class=p>,</span> <span class=s>&quot;netty&quot;</span><span class=p>));</span>
</code></pre></div> <p>for 循环结束运行，现在为 extName 变量生成赋值和判空代码，如下：</p> <div class=highlight><pre><span></span><code><span class=n>String</span> <span class=n>extName</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;client&quot;</span><span class=p>,</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;transporter&quot;</span><span class=p>,</span> <span class=s>&quot;netty&quot;</span><span class=p>));</span>
<span class=k>if</span> <span class=p>(</span><span class=n>extName</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span>
        <span class=s>&quot;Fail to get extension(com.alibaba.dubbo.remoting.Transporter) name from url(&quot;</span> <span class=o>+</span> <span class=n>url</span><span class=p>.</span><span class=na>toString</span><span class=p>()</span>
        <span class=o>+</span> <span class=s>&quot;) use keys([client, transporter])&quot;</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <h5 id=2236>2.2.3.6 生成拓展加载与目标方法调用逻辑<a class=headerlink href=#2236 title="Permanent link">&para;</a></h5> <p>本段代码逻辑用于根据拓展名加载拓展实例，并调用拓展实例的目标方法。相关逻辑如下：</p> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>method</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>rt</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>pts</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>ets</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getExceptionTypes</span><span class=p>();</span>

    <span class=n>Adaptive</span> <span class=n>adaptiveAnnotation</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>Adaptive</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=n>StringBuilder</span> <span class=n>code</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=mi>512</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>adaptiveAnnotation</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// $无 Adaptive 注解方法代码生成逻辑}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// ${获取 URL 数据}</span>

        <span class=c1>// ${获取 Adaptive 注解值}</span>

        <span class=c1>// ${检测 Invocation 参数}</span>

        <span class=c1>// ${生成拓展名获取逻辑}</span>

        <span class=c1>// 生成拓展获取代码，格式如下：</span>
        <span class=c1>// type全限定名 extension = (type全限定名)ExtensionLoader全限定名</span>
        <span class=c1>//     .getExtensionLoader(type全限定名.class).getExtension(extName);</span>
        <span class=c1>// Tips: 格式化字符串中的 %&lt;s 表示使用前一个转换符所描述的参数，即 type 全限定名</span>
        <span class=n>s</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;\n%s extension = (%&lt;s)%s.getExtensionLoader(%s.class).getExtension(extName);&quot;</span><span class=p>,</span>
                        <span class=n>type</span><span class=p>.</span><span class=na>getName</span><span class=p>(),</span> <span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getSimpleName</span><span class=p>(),</span> <span class=n>type</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>
        <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>

        <span class=c1>// 如果方法返回值类型非 void，则生成 return 语句。</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>rt</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=kt>void</span><span class=p>.</span><span class=na>class</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\nreturn &quot;</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// 生成目标方法调用逻辑，格式为：</span>
        <span class=c1>//     extension.方法名(arg0, arg2, ..., argN);</span>
        <span class=n>s</span> <span class=o>=</span> <span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=s>&quot;extension.%s(&quot;</span><span class=p>,</span> <span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>
        <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>s</span><span class=p>);</span>
        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>pts</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span>
                <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;, &quot;</span><span class=p>);</span>
            <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;arg&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;);&quot;</span><span class=p>);</span>   
    <span class=p>}</span>

    <span class=c1>// 省略无关逻辑</span>
<span class=p>}</span>
</code></pre></div> <p>以 Protocol 接口举例说明，上面代码生成的内容如下：</p> <div class=highlight><pre><span></span><code><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>Protocol</span> <span class=n>extension</span> <span class=o>=</span> <span class=p>(</span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>Protocol</span><span class=p>)</span> <span class=n>ExtensionLoader</span>
    <span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>Protocol</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getExtension</span><span class=p>(</span><span class=n>extName</span><span class=p>);</span>
<span class=k>return</span> <span class=n>extension</span><span class=p>.</span><span class=na>refer</span><span class=p>(</span><span class=n>arg0</span><span class=p>,</span> <span class=n>arg1</span><span class=p>);</span>
</code></pre></div> <h5 id=2237>2.2.3.7 生成完整的方法<a class=headerlink href=#2237 title="Permanent link">&para;</a></h5> <p>本节进行代码生成的收尾工作，主要用于生成方法定义的代码。相关逻辑如下：</p> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>method</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>rt</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>pts</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>();</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>ets</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getExceptionTypes</span><span class=p>();</span>

    <span class=n>Adaptive</span> <span class=n>adaptiveAnnotation</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getAnnotation</span><span class=p>(</span><span class=n>Adaptive</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
    <span class=n>StringBuilder</span> <span class=n>code</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=mi>512</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>adaptiveAnnotation</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// $无 Adaptive 注解方法代码生成逻辑}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// ${获取 URL 数据}</span>

        <span class=c1>// ${获取 Adaptive 注解值}</span>

        <span class=c1>// ${检测 Invocation 参数}</span>

        <span class=c1>// ${生成拓展名获取逻辑}</span>

        <span class=c1>// ${生成拓展加载与目标方法调用逻辑}</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=c1>// public + 返回值全限定名 + 方法名 + (</span>
<span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\npublic &quot;</span><span class=p>)</span>
    <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>rt</span><span class=p>.</span><span class=na>getCanonicalName</span><span class=p>())</span>
    <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; &quot;</span><span class=p>)</span>
    <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>())</span>
    <span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;(&quot;</span><span class=p>);</span>

<span class=c1>// 添加参数列表代码</span>
<span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>pts</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;, &quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>pts</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getCanonicalName</span><span class=p>());</span>
    <span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; &quot;</span><span class=p>);</span>
    <span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;arg&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>i</span><span class=p>);</span>
<span class=p>}</span>
<span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;)&quot;</span><span class=p>);</span>

<span class=c1>// 添加异常抛出代码</span>
<span class=k>if</span> <span class=p>(</span><span class=n>ets</span><span class=p>.</span><span class=na>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; throws &quot;</span><span class=p>);</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>ets</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>i</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;, &quot;</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>ets</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getCanonicalName</span><span class=p>());</span>
    <span class=p>}</span>
<span class=p>}</span>
<span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; {&quot;</span><span class=p>);</span>
<span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>code</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span>
<span class=n>codeBuilder</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;\n}&quot;</span><span class=p>);</span>
</code></pre></div> <p>以 Protocol 的 refer 方法为例，上面代码生成的内容如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>rpc</span><span class=p>.</span><span class=na>Invoker</span> <span class=nf>refer</span><span class=p>(</span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>Class</span> <span class=n>arg0</span><span class=p>,</span> <span class=n>com</span><span class=p>.</span><span class=na>alibaba</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>URL</span> <span class=n>arg1</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 方法体</span>
<span class=p>}</span>
</code></pre></div> <h2 id=3>3.总结<a class=headerlink href=#3 title="Permanent link">&para;</a></h2> <p>到此，关于自适应拓展的原理，实现就分析完了。总的来说自适应拓展整个逻辑还是很复杂的，并不是很容易弄懂。因此，大家在阅读该部分源码时，耐心一些。同时多进行调试，也可以通过生成好的代码思考代码的生成逻辑。好了，本篇文章就分析到这里。</p> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/squidfunk target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://gitter.im/squidfunk/mkdocs-material target=_blank rel=noopener title=gitter.im class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"/></svg> </a> <a href=https://hub.docker.com/r/squidfunk/mkdocs-material/ target=_blank rel=noopener title=hub.docker.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=https://twitter.com/squidfunk target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/squidfunk/ target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://instagram.com/squidfunk target=_blank rel=noopener title=instagram.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../../../assets/javascripts/vendor.c3dc8c49.min.js></script> <script src=../../../../assets/javascripts/bundle.30071cf1.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script> <script>
        app = initialize({
          base: "../../../..",
          features: ["tabs", "search.highlight"],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>