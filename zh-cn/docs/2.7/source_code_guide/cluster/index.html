


<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="本文介绍了集群的原理和实现细节">
      
      
      
      <link rel="shortcut icon" href="../../../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.6">
    
    
      
        <title>集群 - Dubbo 2.7.8</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.63b94e9e.min.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.7f672a1f.min.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../../css/dropdown.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

  <!-- Top-level navigation -->
  <nav class="md-header-nav md-grid" aria-label="Header">

    <!-- Link to home -->
    <a
      href="../../../.."
      title="Dubbo 2.7.8"
      class="md-header-nav__button md-logo"
      aria-label="Dubbo 2.7.8"
    >
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z" fill-opacity=".5"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z" fill-opacity=".25"/></svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Dubbo 2.7.8
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              集群
            
          </span>
        </div>
      
    </div>

    <!-- Button to open search dialogue -->
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>

      <!-- Search interface -->
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <div>
      <div class="langChange" id="translate" title="中文|English">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z" />
    </svg>
</div>

<script>
    var translate = document.getElementById('translate');
    translate.addEventListener('click', changeHref, false);
    function changeHref() {
        if (window.location.href.search('en-us') !== -1) {
            var changeHref = window.location.href.replace('en-us', 'zh-cn');

        } else {
            var changeHref = window.location.href.replace('zh-cn', 'en-us');
        }
        window.location.href = changeHref
    }
</script>

<style>
    .langChange {
        display: inline-block;
        width: 2.4rem;
        height: 2.4rem;
        vertical-align: middle;
        margin-left: .5rem;
    }

    .langChange svg {
        fill: rgba(255, 255, 255, 0.548);
        display: block;
        width: 1.2rem;
        height: 1.2rem;
        margin: 0 auto;
        margin-top: .6rem;
        margin-left: .6rem;
    }

    .langChange :hover {
        fill: white;
        cursor: pointer;
    }
</style>
    </div>

    <!-- Repository containing source -->
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/apache/dubbo-website/" title="前往 GitHub 仓库" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Home page -->

  <li class="md-tabs__item">
    
      <a
        href="../../../.."
        class="md-tabs__link md-tabs__link--active"
      >
        Home
      </a>
    
  </li>

<!-- Main navigation item with nested items -->

      
        <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Home page -->

  
  
    <li class="md-tabs__item">Docs
      <ul class="md-tabs__list">
        
          

          <!-- Recurse, if the first item has nested items -->
          
          
          <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Home page -->

  
  
    <!-- Recurse, if the first item has nested items -->
    
    
    <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Home page -->

  
  
    <!-- Recurse, if the first item has nested items -->
    
    <li class="md-tabs__item">
      
      <a
              href="../../user/preface/background/"
              class="md-tabs__link"
      >
        Docs
      </a>
      
    </li>
    
  


    <!-- Render item -->
    
  


          <!-- Render item -->
          
        
          

          <!-- Recurse, if the first item has nested items -->
          
          
          <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Home page -->

  
  
    <!-- Recurse, if the first item has nested items -->
    
    
    <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Home page -->

  
  
    <!-- Recurse, if the first item has nested items -->
    
    <li class="md-tabs__item">
      
      <a
              href="../../../3.0/user/preface/background/"
              class="md-tabs__link"
      >
        Docs
      </a>
      
    </li>
    
  


    <!-- Render item -->
    
  


          <!-- Render item -->
          
        
      </ul>
    </li>
  

      
        <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Home page -->

  
  
    <!-- Recurse, if the first item has nested items -->
    
    <li class="md-tabs__item">
      
      <a
              href="../../../../blog/apache-dubbo-2019-2020/"
              class="md-tabs__link"
      >
        Blog
      </a>
      
    </li>
    
  

      
        <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Home page -->

  
  
    <!-- Recurse, if the first item has nested items -->
    
    <li class="md-tabs__item">
      
      <a
              href="../../../../developers/developers_dev/"
              class="md-tabs__link"
      >
        Developers
      </a>
      
    </li>
    
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Main navigation -->
<nav
  class="md-nav md-nav--primary"
  aria-label="Navigation"
  data-md-level="0"
>

  <!-- Site title -->
  <label class="md-nav__title" for="__drawer">
    <a
      href="../../../.."
      title="Dubbo 2.7.8"
      class="md-nav__button md-logo"
      aria-label="Dubbo 2.7.8"
    >
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z" fill-opacity=".5"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z" fill-opacity=".25"/></svg>

    </a>
    Dubbo 2.7.8
  </label>

  <!-- Repository containing source -->
  
    <div class="md-nav__source">
      
<a href="https://github.com/apache/dubbo-website/" title="前往 GitHub 仓库" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  

  <!-- Render item list -->
  <ul class="md-nav__list" data-md-scrollfix>
    
    
      
        
        
        <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../.."
      title="Home"
      class="md-nav__link"
    >
      Home
    </a>
  </li>

      
      
    
      
        
          
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1"
        type="checkbox"
        id="nav-1"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1">
      2.7
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="2.7"
      data-md-level="1"
    >
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        2.7
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1"
        type="checkbox"
        id="nav-1-1"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1">
      用户手册
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="用户手册"
      data-md-level="2"
    >
      <label class="md-nav__title" for="nav-1-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        用户手册
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1-1"
        type="checkbox"
        id="nav-1-1-1"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1-1">
      入门
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="入门"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-1-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        入门
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/preface/background/"
      title="背景"
      class="md-nav__link"
    >
      背景
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/preface/requirements/"
      title="需求"
      class="md-nav__link"
    >
      需求
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/preface/architecture/"
      title="架构"
      class="md-nav__link"
    >
      架构
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/preface/usage/"
      title="用法"
      class="md-nav__link"
    >
      用法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/quick-start/"
      title="快速启动"
      class="md-nav__link"
    >
      快速启动
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/dependencies/"
      title="依赖"
      class="md-nav__link"
    >
      依赖
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/maturity/"
      title="成熟度"
      class="md-nav__link"
    >
      成熟度
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1-5"
        type="checkbox"
        id="nav-1-1-5"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1-5">
      配置
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="配置"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-1-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        配置
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/configuration/xml/"
      title="XML 配置"
      class="md-nav__link"
    >
      XML 配置
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/configuration/api/"
      title="API 配置"
      class="md-nav__link"
    >
      API 配置
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/configuration/annotation/"
      title="Annotation 配置"
      class="md-nav__link"
    >
      Annotation 配置
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/configuration/annotation/"
      title="动态配置中心"
      class="md-nav__link"
    >
      动态配置中心
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/configuration/configuration-load-process/"
      title="配置加载流程"
      class="md-nav__link"
    >
      配置加载流程
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/configuration/environment-variables/"
      title="自动加载环境变量"
      class="md-nav__link"
    >
      自动加载环境变量
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1-6"
        type="checkbox"
        id="nav-1-1-6"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1-6">
      示例
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="示例"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-1-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        示例
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/preflight-check/"
      title="启动时检查"
      class="md-nav__link"
    >
      启动时检查
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/fault-tolerent-strategy/"
      title="集群容错"
      class="md-nav__link"
    >
      集群容错
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/loadbalance/"
      title="负载均衡"
      class="md-nav__link"
    >
      负载均衡
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/thread-model/"
      title="线程模型"
      class="md-nav__link"
    >
      线程模型
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/explicit-target/"
      title="直连提供者"
      class="md-nav__link"
    >
      直连提供者
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/subscribe-only/"
      title="只订阅"
      class="md-nav__link"
    >
      只订阅
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/registry-only/"
      title="只注册"
      class="md-nav__link"
    >
      只注册
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/static-service/"
      title="静态服务"
      class="md-nav__link"
    >
      静态服务
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/multi-protocols/"
      title="多协议"
      class="md-nav__link"
    >
      多协议
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/multi-registry/"
      title="多注册中心"
      class="md-nav__link"
    >
      多注册中心
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/service-group/"
      title="服务分组"
      class="md-nav__link"
    >
      服务分组
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/multi-versions/"
      title="多版本"
      class="md-nav__link"
    >
      多版本
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/group-merger/"
      title="分组聚合"
      class="md-nav__link"
    >
      分组聚合
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/parameter-validation/"
      title="参数验证"
      class="md-nav__link"
    >
      参数验证
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/result-cache/"
      title="结果缓存"
      class="md-nav__link"
    >
      结果缓存
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/generic-reference/"
      title="泛化引用"
      class="md-nav__link"
    >
      泛化引用
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/generic-service/"
      title="泛化实现"
      class="md-nav__link"
    >
      泛化实现
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/echo-service/"
      title="回声测试"
      class="md-nav__link"
    >
      回声测试
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/context/"
      title="上下文信息"
      class="md-nav__link"
    >
      上下文信息
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/attachment/"
      title="隐式参数"
      class="md-nav__link"
    >
      隐式参数
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/async-call/"
      title="异步调用"
      class="md-nav__link"
    >
      异步调用
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/async-execute-on-provider/"
      title="服务端异步"
      class="md-nav__link"
    >
      服务端异步
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/local-call/"
      title="本地调用"
      class="md-nav__link"
    >
      本地调用
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/callback-parameter/"
      title="参数回调"
      class="md-nav__link"
    >
      参数回调
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/events-notify/"
      title="事件通知"
      class="md-nav__link"
    >
      事件通知
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/local-stub/"
      title="本地存根"
      class="md-nav__link"
    >
      本地存根
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/local-mock/"
      title="本地伪装"
      class="md-nav__link"
    >
      本地伪装
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/delay-publish/"
      title="延迟暴露"
      class="md-nav__link"
    >
      延迟暴露
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/concurrency-control/"
      title="并发控制"
      class="md-nav__link"
    >
      并发控制
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/config-connection.md"
      title="连接控制"
      class="md-nav__link"
    >
      连接控制
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/lazy-connect/"
      title="延迟连接"
      class="md-nav__link"
    >
      延迟连接
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/stickiness/"
      title="粘滞连接"
      class="md-nav__link"
    >
      粘滞连接
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/token-authorization/"
      title="令牌验证"
      class="md-nav__link"
    >
      令牌验证
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/routing-rule/"
      title="路由规则"
      class="md-nav__link"
    >
      路由规则
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/config-rule/"
      title="配置规则"
      class="md-nav__link"
    >
      配置规则
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/service-downgrade/"
      title="服务降级"
      class="md-nav__link"
    >
      服务降级
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/graceful-shutdown/"
      title="优雅停机"
      class="md-nav__link"
    >
      优雅停机
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/hostname-binding/"
      title="主机绑定"
      class="md-nav__link"
    >
      主机绑定
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/logger-strategy/"
      title="日志适配"
      class="md-nav__link"
    >
      日志适配
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/accesslog/"
      title="访问日志"
      class="md-nav__link"
    >
      访问日志
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/service-container/"
      title="服务容器"
      class="md-nav__link"
    >
      服务容器
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/distributed-transaction/"
      title="分布式事务"
      class="md-nav__link"
    >
      分布式事务
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/dump/"
      title="线程栈自动dump"
      class="md-nav__link"
    >
      线程栈自动dump
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/netty4/"
      title="Netty4"
      class="md-nav__link"
    >
      Netty4
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/serialization/"
      title="Kryo和FST序列化"
      class="md-nav__link"
    >
      Kryo和FST序列化
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/simplify-registry-data/"
      title="简化注册中心URL"
      class="md-nav__link"
    >
      简化注册中心URL
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/demos/api.md"
      title="API 参考手册"
      class="md-nav__link"
    >
      API 参考手册
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1-7"
        type="checkbox"
        id="nav-1-1-7"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1-7">
      schema 配置参考手册
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="schema 配置参考手册"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-1-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        schema 配置参考手册
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-service/"
      title="dubbo:service"
      class="md-nav__link"
    >
      dubbo:service
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-reference/"
      title="dubbo:reference"
      class="md-nav__link"
    >
      dubbo:reference
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-protocol/"
      title="dubbo:protocol"
      class="md-nav__link"
    >
      dubbo:protocol
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-registry/"
      title="dubbo:registry"
      class="md-nav__link"
    >
      dubbo:registry
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-monitor/"
      title="dubbo:monitor"
      class="md-nav__link"
    >
      dubbo:monitor
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-application/"
      title="dubbo:application"
      class="md-nav__link"
    >
      dubbo:application
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-module/"
      title="dubbo:module"
      class="md-nav__link"
    >
      dubbo:module
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-provider/"
      title="dubbo:provider"
      class="md-nav__link"
    >
      dubbo:provider
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-consumer/"
      title="dubbo:consumer"
      class="md-nav__link"
    >
      dubbo:consumer
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-method/"
      title="dubbo:method"
      class="md-nav__link"
    >
      dubbo:method
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-argument/"
      title="dubbo:argument"
      class="md-nav__link"
    >
      dubbo:argument
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-parameter/"
      title="dubbo:parameter"
      class="md-nav__link"
    >
      dubbo:parameter
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/xml/dubbo-config-center/"
      title="dubbo:config-center"
      class="md-nav__link"
    >
      dubbo:config-center
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1-8"
        type="checkbox"
        id="nav-1-1-8"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1-8">
      协议参考手册
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="协议参考手册"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-1-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        协议参考手册
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/protocol/dubbo/"
      title="dubbo://"
      class="md-nav__link"
    >
      dubbo://
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/protocol/rmi/"
      title="rmi://"
      class="md-nav__link"
    >
      rmi://
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/protocol/hessian/"
      title="hessian://"
      class="md-nav__link"
    >
      hessian://
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/protocol/http/"
      title="http://"
      class="md-nav__link"
    >
      http://
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/protocol/thrift/"
      title="thrift://"
      class="md-nav__link"
    >
      thrift://
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/protocol/rest/"
      title="rest://"
      class="md-nav__link"
    >
      rest://
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1-9"
        type="checkbox"
        id="nav-1-1-9"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1-9">
      注册中心参考手册
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="注册中心参考手册"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-1-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        注册中心参考手册
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/registry/multicast/"
      title="Multicast 注册中心"
      class="md-nav__link"
    >
      Multicast 注册中心
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/registry/zookeeper/"
      title="Zookeeper 注册中心"
      class="md-nav__link"
    >
      Zookeeper 注册中心
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/registry/redis/"
      title="Redis 注册中心"
      class="md-nav__link"
    >
      Redis 注册中心
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/registry/simple/"
      title="Simple 注册中心"
      class="md-nav__link"
    >
      Simple 注册中心
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1-10"
        type="checkbox"
        id="nav-1-1-10"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1-10">
      元数据中心参考手册
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="元数据中心参考手册"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-1-10">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        元数据中心参考手册
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/metadata/metadata-redis/"
      title="Redis 元数据中心"
      class="md-nav__link"
    >
      Redis 元数据中心
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/metadata/metadata-zookeeper/"
      title="Zookeeper 元数据中心"
      class="md-nav__link"
    >
      Zookeeper 元数据中心
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/telnet/"
      title="telnet 命令参考手册"
      class="md-nav__link"
    >
      telnet 命令参考手册
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/qos/"
      title="在线运维命令-QOS"
      class="md-nav__link"
    >
      在线运维命令-QOS
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/references/maven/"
      title="maven 插件参考手册"
      class="md-nav__link"
    >
      maven 插件参考手册
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/best-practice/"
      title="服务化最佳实践"
      class="md-nav__link"
    >
      服务化最佳实践
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/recommend/"
      title="推荐用法"
      class="md-nav__link"
    >
      推荐用法
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/capacity-plan/"
      title="容量规划"
      class="md-nav__link"
    >
      容量规划
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/perf-test/"
      title="性能测试报告"
      class="md-nav__link"
    >
      性能测试报告
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/covergence.md"
      title="测试覆盖率报告"
      class="md-nav__link"
    >
      测试覆盖率报告
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1-19"
        type="checkbox"
        id="nav-1-1-19"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1-19">
      版本与升级
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="版本与升级"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-1-19">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        版本与升级
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../user/versions/version-270/"
      title="2.7.x升级步骤及注意事项"
      class="md-nav__link"
    >
      2.7.x升级步骤及注意事项
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-2"
        type="checkbox"
        id="nav-1-2"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-2">
      开发手册
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="开发手册"
      data-md-level="2"
    >
      <label class="md-nav__title" for="nav-1-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        开发手册
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/build.md"
      title="源码构建"
      class="md-nav__link"
    >
      源码构建
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/design.md"
      title="框架设计"
      class="md-nav__link"
    >
      框架设计
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/SPI.md"
      title="扩展点加载"
      class="md-nav__link"
    >
      扩展点加载
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/implementation.md"
      title="实现细节"
      class="md-nav__link"
    >
      实现细节
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-2-5"
        type="checkbox"
        id="nav-1-2-5"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-2-5">
      SPI 扩展实现
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="SPI 扩展实现"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-2-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        SPI 扩展实现
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/protocol.md"
      title="协议扩展"
      class="md-nav__link"
    >
      协议扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/filter.md"
      title="调用拦截扩展"
      class="md-nav__link"
    >
      调用拦截扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/invoker-listener.md"
      title="引用监听扩展"
      class="md-nav__link"
    >
      引用监听扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/exporter-listener.md"
      title="暴露监听扩展"
      class="md-nav__link"
    >
      暴露监听扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/cluster.md"
      title="集群扩展"
      class="md-nav__link"
    >
      集群扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/router.md"
      title="路由扩展"
      class="md-nav__link"
    >
      路由扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/load-balance.md"
      title="负载均衡扩展"
      class="md-nav__link"
    >
      负载均衡扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/merger.md"
      title="合并结果扩展"
      class="md-nav__link"
    >
      合并结果扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/registry.md"
      title="注册中心扩展"
      class="md-nav__link"
    >
      注册中心扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/monitor.md"
      title="监控中心扩展"
      class="md-nav__link"
    >
      监控中心扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/extension-factory.md"
      title="扩展点加载扩展"
      class="md-nav__link"
    >
      扩展点加载扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/proxy-factory.md"
      title="动态代理扩展"
      class="md-nav__link"
    >
      动态代理扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/compiler.md"
      title="编译器扩展"
      class="md-nav__link"
    >
      编译器扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/dispatcher.md"
      title="消息派发扩展"
      class="md-nav__link"
    >
      消息派发扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/threadpool.md"
      title="线程池扩展"
      class="md-nav__link"
    >
      线程池扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/serialize.md"
      title="序列化扩展"
      class="md-nav__link"
    >
      序列化扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/remoting.md"
      title="网络传输扩展"
      class="md-nav__link"
    >
      网络传输扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/exchanger.md"
      title="信息交换扩展"
      class="md-nav__link"
    >
      信息交换扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/networker.md"
      title="组网扩展"
      class="md-nav__link"
    >
      组网扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/telnet-handler.md"
      title="Telnet 命令扩展"
      class="md-nav__link"
    >
      Telnet 命令扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/status-checker.md"
      title="状态检查扩展"
      class="md-nav__link"
    >
      状态检查扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/container.md"
      title="容器扩展"
      class="md-nav__link"
    >
      容器扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/page.md"
      title="页面扩展"
      class="md-nav__link"
    >
      页面扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/cache.md"
      title="缓存扩展"
      class="md-nav__link"
    >
      缓存扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/validation.md"
      title="验证扩展"
      class="md-nav__link"
    >
      验证扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/logger-adapter.md"
      title="日志适配扩展"
      class="md-nav__link"
    >
      日志适配扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/impls/config-center.md"
      title="配置中心"
      class="md-nav__link"
    >
      配置中心
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/contract.md"
      title="公共契约"
      class="md-nav__link"
    >
      公共契约
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/coding.md"
      title="编码约定"
      class="md-nav__link"
    >
      编码约定
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-2-8"
        type="checkbox"
        id="nav-1-2-8"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-2-8">
      设计原则
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="设计原则"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-2-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        设计原则
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/principals/code-detail.md"
      title="魔鬼在细节"
      class="md-nav__link"
    >
      魔鬼在细节
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/principals/general-knowledge.md"
      title="一些设计上的基本常识"
      class="md-nav__link"
    >
      一些设计上的基本常识
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/principals/expansibility.md"
      title="谈谈扩充式扩展与增量式扩展"
      class="md-nav__link"
    >
      谈谈扩充式扩展与增量式扩展
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/principals/configuration.md"
      title="配置设计"
      class="md-nav__link"
    >
      配置设计
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/principals/robustness.md"
      title="设计实现的健壮性"
      class="md-nav__link"
    >
      设计实现的健壮性
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/principals/dummy.md"
      title="防痴呆设计"
      class="md-nav__link"
    >
      防痴呆设计
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/principals/extension.md"
      title="扩展点重构"
      class="md-nav__link"
    >
      扩展点重构
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/release.md"
      title="版本发布"
      class="md-nav__link"
    >
      版本发布
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/contribution.md"
      title="贡献代码"
      class="md-nav__link"
    >
      贡献代码
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/checklist.md"
      title="检查列表"
      class="md-nav__link"
    >
      检查列表
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/code-smell.md"
      title="坏味道"
      class="md-nav__link"
    >
      坏味道
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../dev/TCK.md"
      title="兼容性测试"
      class="md-nav__link"
    >
      兼容性测试
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-3"
        type="checkbox"
        id="nav-1-3"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-3">
      管理者文档
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="管理者文档"
      data-md-level="2"
    >
      <label class="md-nav__title" for="nav-1-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        管理者文档
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../admin/introduction.md"
      title="Dubbo Admin介绍"
      class="md-nav__link"
    >
      Dubbo Admin介绍
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../admin/serviceSearch.md"
      title="服务搜索和详情"
      class="md-nav__link"
    >
      服务搜索和详情
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../admin/serviceGovernance.md"
      title="服务治理"
      class="md-nav__link"
    >
      服务治理
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../admin/serviceTest.md"
      title="服务测试"
      class="md-nav__link"
    >
      服务测试
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

          
        
          
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1"
        type="checkbox"
        id="nav-1"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1">
      3.0
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="3.0"
      data-md-level="1"
    >
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        3.0
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1"
        type="checkbox"
        id="nav-1-1"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1">
      用户手册
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="用户手册"
      data-md-level="2"
    >
      <label class="md-nav__title" for="nav-1-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        用户手册
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1-1-1"
        type="checkbox"
        id="nav-1-1-1"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1-1-1">
      入门
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="入门"
      data-md-level="3"
    >
      <label class="md-nav__title" for="nav-1-1-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        入门
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../3.0/user/preface/background/"
      title="背景"
      class="md-nav__link"
    >
      背景
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../3.0/user/preface/background/"
      title="需求"
      class="md-nav__link"
    >
      需求
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../3.0/user/preface/architecture/"
      title="架构"
      class="md-nav__link"
    >
      架构
    </a>
  </li>

        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../3.0/user/preface/usage/"
      title="用法"
      class="md-nav__link"
    >
      用法
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

          
        
      
      
    
      
        
        
        <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1"
        type="checkbox"
        id="nav-1"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1">
      Blog
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="Blog"
      data-md-level="1"
    >
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Blog
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../blog/apache-dubbo-2019-2020/"
      title="2019-2020 回顾"
      class="md-nav__link"
    >
      2019-2020 回顾
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

      
      
    
      
        
        
        <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item md-nav__item--nested">

    <!-- Active checkbox expands items contained within nested section -->
    
      <input
        class="md-nav__toggle md-toggle"
        data-md-toggle="nav-1"
        type="checkbox"
        id="nav-1"
      />
    

    <!-- Expand active pages -->
    <label class="md-nav__link" for="nav-1">
      Developers
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav
      class="md-nav"
      aria-label="Developers"
      data-md-level="1"
    >
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Developers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>

        <!-- Render nested item list -->
        
        
          
          
          <!-- Determine class according to level -->



<!-- Main navigation item with nested items -->

  <li class="md-nav__item">
    <a
      href="../../../../developers/developers_dev/"
      title="开发者指引"
      class="md-nav__link"
    >
      开发者指引
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

<!-- Currently active page -->

      
      
    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      目录
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    1.简介
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    2. 集群容错
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    3.源码分析
  </a>
  
    <nav class="md-nav" aria-label="3.源码分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-cluster" class="md-nav__link">
    3.1 Cluster 实现类分析
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-cluster-invoker" class="md-nav__link">
    3.2 Cluster Invoker 分析
  </a>
  
    <nav class="md-nav" aria-label="3.2 Cluster Invoker 分析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#321-failoverclusterinvoker" class="md-nav__link">
    3.2.1 FailoverClusterInvoker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#322-failbackclusterinvoker" class="md-nav__link">
    3.2.2 FailbackClusterInvoker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#323-failfastclusterinvoker" class="md-nav__link">
    3.2.3 FailfastClusterInvoker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#324-failsafeclusterinvoker" class="md-nav__link">
    3.2.4 FailsafeClusterInvoker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#325-forkingclusterinvoker" class="md-nav__link">
    3.2.5 ForkingClusterInvoker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#326-broadcastclusterinvoker" class="md-nav__link">
    3.2.6 BroadcastClusterInvoker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    4.总结
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/apache/dubbo-website/edit/master/documentations/2.7/zh-cn/docs/docs/2.7/source_code_guide/cluster.md" title="编辑此页" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                  <h1>集群</h1>
                
                <h2 id="1">1.简介<a class="headerlink" href="#1" title="Permanent link">&para;</a></h2>
<p>为了避免单点故障，现在的应用通常至少会部署在两台服务器上。对于一些负载比较高的服务，会部署更多的服务器。这样，在同一环境下的服务提供者数量会大于1。对于服务消费者来说，同一环境下出现了多个服务提供者。这时会出现一个问题，服务消费者需要决定选择哪个服务提供者进行调用。另外服务调用失败时的处理措施也是需要考虑的，是重试呢，还是抛出异常，亦或是只打印异常等。为了处理这些问题，Dubbo 定义了集群接口 Cluster 以及 Cluster Invoker。集群 Cluster 用途是将多个服务提供者合并为一个 Cluster Invoker，并将这个 Invoker 暴露给服务消费者。这样一来，服务消费者只需通过这个 Invoker 进行远程调用即可，至于具体调用哪个服务提供者，以及调用失败后如何处理等问题，现在都交给集群模块去处理。集群模块是服务提供者和服务消费者的中间层，为服务消费者屏蔽了服务提供者的情况，这样服务消费者就可以专心处理远程调用相关事宜。比如发请求，接受服务提供者返回的数据等。这就是集群的作用。</p>
<p>Dubbo 提供了多种集群实现，包含但不限于 Failover Cluster、Failfast Cluster 和 Failsafe Cluster 等。每种集群实现类的用途不同，接下来会一一进行分析。</p>
<h2 id="2">2. 集群容错<a class="headerlink" href="#2" title="Permanent link">&para;</a></h2>
<p>在对集群相关代码进行分析之前，这里有必要先来介绍一下集群容错的所有组件。包含 Cluster、Cluster Invoker、Directory、Router 和 LoadBalance 等。</p>
<p><img alt="" src="../sources/images/cluster.jpg" /></p>
<p>集群工作过程可分为两个阶段，第一个阶段是在服务消费者初始化期间，集群 Cluster 实现类为服务消费者创建 Cluster Invoker 实例，即上图中的 merge 操作。第二个阶段是在服务消费者进行远程调用时。以 FailoverClusterInvoker 为例，该类型 Cluster Invoker 首先会调用 Directory 的 list 方法列举 Invoker 列表（可将 Invoker 简单理解为服务提供者）。Directory 的用途是保存 Invoker，可简单类比为 List\&lt;Invoker>。其实现类 RegistryDirectory 是一个动态服务目录，可感知注册中心配置的变化，它所持有的 Invoker 列表会随着注册中心内容的变化而变化。每次变化后，RegistryDirectory 会动态增删 Invoker，并调用 Router 的 route 方法进行路由，过滤掉不符合路由规则的 Invoker。当 FailoverClusterInvoker 拿到 Directory 返回的 Invoker 列表后，它会通过 LoadBalance 从 Invoker 列表中选择一个 Invoker。最后 FailoverClusterInvoker 会将参数传给 LoadBalance 选择出的 Invoker 实例的 invoke 方法，进行真正的远程调用。</p>
<p>以上就是集群工作的整个流程，这里并没介绍集群是如何容错的。Dubbo 主要提供了这样几种容错方式：</p>
<ul>
<li>Failover Cluster - 失败自动切换</li>
<li>Failfast Cluster - 快速失败</li>
<li>Failsafe Cluster - 失败安全</li>
<li>Failback Cluster - 失败自动恢复</li>
<li>Forking Cluster - 并行调用多个服务提供者</li>
</ul>
<p>下面开始分析源码。</p>
<h2 id="3">3.源码分析<a class="headerlink" href="#3" title="Permanent link">&para;</a></h2>
<h3 id="31-cluster">3.1 Cluster 实现类分析<a class="headerlink" href="#31-cluster" title="Permanent link">&para;</a></h3>
<p>我们在上一章看到了两个概念，分别是集群接口 Cluster 和 Cluster Invoker，这两者是不同的。Cluster 是接口，而 Cluster Invoker 是一种 Invoker。服务提供者的选择逻辑，以及远程调用失败后的的处理逻辑均是封装在 Cluster Invoker  中。那么 Cluster 接口和相关实现类有什么用呢？用途比较简单，仅用于生成 Cluster Invoker。下面我们来看一下源码。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FailoverCluster</span> <span class="kd">implements</span> <span class="n">Cluster</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s">&quot;failover&quot;</span><span class="p">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">join</span><span class="p">(</span><span class="n">Directory</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">directory</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
        <span class="c1">// 创建并返回 FailoverClusterInvoker 对象</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">FailoverClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">directory</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>如上，FailoverCluster 总共就包含这几行代码，用于创建 FailoverClusterInvoker 对象，很简单。下面再看一个。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FailbackCluster</span> <span class="kd">implements</span> <span class="n">Cluster</span> <span class="p">{</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">NAME</span> <span class="o">=</span> <span class="s">&quot;failback&quot;</span><span class="p">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">join</span><span class="p">(</span><span class="n">Directory</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">directory</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
        <span class="c1">// 创建并返回 FailbackClusterInvoker 对象</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">FailbackClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">directory</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>

<p>如上，FailbackCluster 的逻辑也是很简单，无需解释了。所以接下来，我们把重点放在各种 Cluster Invoker 上</p>
<h3 id="32-cluster-invoker">3.2 Cluster Invoker 分析<a class="headerlink" href="#32-cluster-invoker" title="Permanent link">&para;</a></h3>
<p>我们首先从各种 Cluster Invoker 的父类 AbstractClusterInvoker 源码开始说起。前面说过，集群工作过程可分为两个阶段，第一个阶段是在服务消费者初始化期间，这个在<a href="">服务引用</a>那篇文章中分析过，就不赘述。第二个阶段是在服务消费者进行远程调用时，此时 AbstractClusterInvoker 的 invoke 方法会被调用。列举 Invoker，负载均衡等操作均会在此阶段被执行。因此下面先来看一下 invoke 方法的逻辑。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="n">Result</span> <span class="nf">invoke</span><span class="p">(</span><span class="kd">final</span> <span class="n">Invocation</span> <span class="n">invocation</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
    <span class="n">checkWhetherDestroyed</span><span class="p">();</span>
    <span class="n">LoadBalance</span> <span class="n">loadbalance</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="c1">// 绑定 attachments 到 invocation 中.</span>
    <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">contextAttachments</span> <span class="o">=</span> <span class="n">RpcContext</span><span class="p">.</span><span class="na">getContext</span><span class="p">().</span><span class="na">getAttachments</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">contextAttachments</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">contextAttachments</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">((</span><span class="n">RpcInvocation</span><span class="p">)</span> <span class="n">invocation</span><span class="p">).</span><span class="na">addAttachments</span><span class="p">(</span><span class="n">contextAttachments</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 列举 Invoker</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">invokers</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">invokers</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="c1">// 加载 LoadBalance</span>
        <span class="n">loadbalance</span> <span class="o">=</span> <span class="n">ExtensionLoader</span><span class="p">.</span><span class="na">getExtensionLoader</span><span class="p">(</span><span class="n">LoadBalance</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">getExtension</span><span class="p">(</span><span class="n">invokers</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getUrl</span><span class="p">()</span>
                <span class="p">.</span><span class="na">getMethodParameter</span><span class="p">(</span><span class="n">RpcUtils</span><span class="p">.</span><span class="na">getMethodName</span><span class="p">(</span><span class="n">invocation</span><span class="p">),</span> <span class="n">Constants</span><span class="p">.</span><span class="na">LOADBALANCE_KEY</span><span class="p">,</span> <span class="n">Constants</span><span class="p">.</span><span class="na">DEFAULT_LOADBALANCE</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="n">RpcUtils</span><span class="p">.</span><span class="na">attachInvocationIdIfAsync</span><span class="p">(</span><span class="n">getUrl</span><span class="p">(),</span> <span class="n">invocation</span><span class="p">);</span>

    <span class="c1">// 调用 doInvoke 进行后续操作</span>
    <span class="k">return</span> <span class="n">doInvoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">,</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">loadbalance</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 抽象方法，由子类实现</span>
<span class="kd">protected</span> <span class="kd">abstract</span> <span class="n">Result</span> <span class="nf">doInvoke</span><span class="p">(</span><span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span><span class="p">,</span>
                                       <span class="n">LoadBalance</span> <span class="n">loadbalance</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span><span class="p">;</span>
</code></pre></div>

<p>AbstractClusterInvoker 的 invoke 方法主要用于列举 Invoker，以及加载 LoadBalance。最后再调用模板方法 doInvoke 进行后续操作。下面我们来看一下 Invoker 列举方法 list(Invocation) 的逻辑，如下：</p>
<div class="highlight"><pre><span></span><code><span class="kd">protected</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="nf">list</span><span class="p">(</span><span class="n">Invocation</span> <span class="n">invocation</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
    <span class="c1">// 调用 Directory 的 list 方法列举 Invoker</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span> <span class="o">=</span> <span class="n">directory</span><span class="p">.</span><span class="na">list</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">invokers</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>如上，AbstractClusterInvoker 中的 list 方法做的事情很简单，只是简单的调用了 Directory 的 list 方法，没有其他更多的逻辑了。Directory 即相关实现类在前文已经分析过，这里就不多说了。接下来，我们把目光转移到 AbstractClusterInvoker 的各种实现类上，来看一下这些实现类是如何实现 doInvoke 方法逻辑的。</p>
<h4 id="321-failoverclusterinvoker">3.2.1 FailoverClusterInvoker<a class="headerlink" href="#321-failoverclusterinvoker" title="Permanent link">&para;</a></h4>
<p>FailoverClusterInvoker 在调用失败时，会自动切换 Invoker 进行重试。默认配置下，Dubbo 会使用这个类作为缺省 Cluster Invoker。下面来看一下该类的逻辑。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FailoverClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="c1">// 省略部分代码</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Result</span> <span class="nf">doInvoke</span><span class="p">(</span><span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">LoadBalance</span> <span class="n">loadbalance</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">copyinvokers</span> <span class="o">=</span> <span class="n">invokers</span><span class="p">;</span>
        <span class="n">checkInvokers</span><span class="p">(</span><span class="n">copyinvokers</span><span class="p">,</span> <span class="n">invocation</span><span class="p">);</span>
        <span class="c1">// 获取重试次数</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">getUrl</span><span class="p">().</span><span class="na">getMethodParameter</span><span class="p">(</span><span class="n">invocation</span><span class="p">.</span><span class="na">getMethodName</span><span class="p">(),</span> <span class="n">Constants</span><span class="p">.</span><span class="na">RETRIES_KEY</span><span class="p">,</span> <span class="n">Constants</span><span class="p">.</span><span class="na">DEFAULT_RETRIES</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">RpcException</span> <span class="n">le</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invoked</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">copyinvokers</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>
        <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">providers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>
        <span class="c1">// 循环调用，失败重试</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">checkWhetherDestroyed</span><span class="p">();</span>
                <span class="c1">// 在进行重试前重新列举 Invoker，这样做的好处是，如果某个服务挂了，</span>
                <span class="c1">// 通过调用 list 可得到最新可用的 Invoker 列表</span>
                <span class="n">copyinvokers</span> <span class="o">=</span> <span class="n">list</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
                <span class="c1">// 对 copyinvokers 进行判空检查</span>
                <span class="n">checkInvokers</span><span class="p">(</span><span class="n">copyinvokers</span><span class="p">,</span> <span class="n">invocation</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// 通过负载均衡选择 Invoker</span>
            <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">loadbalance</span><span class="p">,</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">copyinvokers</span><span class="p">,</span> <span class="n">invoked</span><span class="p">);</span>
            <span class="c1">// 添加到 invoker 到 invoked 列表中</span>
            <span class="n">invoked</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">invoker</span><span class="p">);</span>
            <span class="c1">// 设置 invoked 到 RPC 上下文中</span>
            <span class="n">RpcContext</span><span class="p">.</span><span class="na">getContext</span><span class="p">().</span><span class="na">setInvokers</span><span class="p">((</span><span class="n">List</span><span class="p">)</span> <span class="n">invoked</span><span class="p">);</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="c1">// 调用目标 Invoker 的 invoke 方法</span>
                <span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">invoker</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">RpcException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">isBiz</span><span class="p">())</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="n">e</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="n">le</span> <span class="o">=</span> <span class="n">e</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">le</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RpcException</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span> <span class="n">e</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
                <span class="n">providers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">invoker</span><span class="p">.</span><span class="na">getUrl</span><span class="p">().</span><span class="na">getAddress</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 若重试失败，则抛出异常</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">RpcException</span><span class="p">(...,</span> <span class="s">&quot;Failed to invoke the method ...&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>如上，FailoverClusterInvoker 的 doInvoke 方法首先是获取重试次数，然后根据重试次数进行循环调用，失败后进行重试。在 for 循环内，首先是通过负载均衡组件选择一个 Invoker，然后再通过这个 Invoker 的 invoke 方法进行远程调用。如果失败了，记录下异常，并进行重试。重试时会再次调用父类的 list 方法列举 Invoker。整个流程大致如此，不是很难理解。下面我们看一下 select 方法的逻辑。</p>
<div class="highlight"><pre><span></span><code><span class="kd">protected</span> <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">select</span><span class="p">(</span><span class="n">LoadBalance</span> <span class="n">loadbalance</span><span class="p">,</span> <span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">selected</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">invokers</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">invokers</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="c1">// 获取调用方法名</span>
    <span class="n">String</span> <span class="n">methodName</span> <span class="o">=</span> <span class="n">invocation</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="p">:</span> <span class="n">invocation</span><span class="p">.</span><span class="na">getMethodName</span><span class="p">();</span>

    <span class="c1">// 获取 sticky 配置，sticky 表示粘滞连接。所谓粘滞连接是指让服务消费者尽可能的</span>
    <span class="c1">// 调用同一个服务提供者，除非该提供者挂了再进行切换</span>
    <span class="kt">boolean</span> <span class="n">sticky</span> <span class="o">=</span> <span class="n">invokers</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="na">getUrl</span><span class="p">().</span><span class="na">getMethodParameter</span><span class="p">(</span><span class="n">methodName</span><span class="p">,</span> <span class="n">Constants</span><span class="p">.</span><span class="na">CLUSTER_STICKY_KEY</span><span class="p">,</span> <span class="n">Constants</span><span class="p">.</span><span class="na">DEFAULT_CLUSTER_STICKY</span><span class="p">);</span>
    <span class="p">{</span>
        <span class="c1">// 检测 invokers 列表是否包含 stickyInvoker，如果不包含，</span>
        <span class="c1">// 说明 stickyInvoker 代表的服务提供者挂了，此时需要将其置空</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">stickyInvoker</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">invokers</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">stickyInvoker</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">stickyInvoker</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 在 sticky 为 true，且 stickyInvoker != null 的情况下。如果 selected 包含 </span>
        <span class="c1">// stickyInvoker，表明 stickyInvoker 对应的服务提供者可能因网络原因未能成功提供服务。</span>
        <span class="c1">// 但是该提供者并没挂，此时 invokers 列表中仍存在该服务提供者对应的 Invoker。</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sticky</span> <span class="o">&amp;&amp;</span> <span class="n">stickyInvoker</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">selected</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">selected</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">stickyInvoker</span><span class="p">)))</span> <span class="p">{</span>
            <span class="c1">// availablecheck 表示是否开启了可用性检查，如果开启了，则调用 stickyInvoker 的 </span>
            <span class="c1">// isAvailable 方法进行检查，如果检查通过，则直接返回 stickyInvoker。</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">availablecheck</span> <span class="o">&amp;&amp;</span> <span class="n">stickyInvoker</span><span class="p">.</span><span class="na">isAvailable</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">stickyInvoker</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// 如果线程走到当前代码处，说明前面的 stickyInvoker 为空，或者不可用。</span>
    <span class="c1">// 此时继续调用 doSelect 选择 Invoker</span>
    <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="o">=</span> <span class="n">doSelect</span><span class="p">(</span><span class="n">loadbalance</span><span class="p">,</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">selected</span><span class="p">);</span>

    <span class="c1">// 如果 sticky 为 true，则将负载均衡组件选出的 Invoker 赋值给 stickyInvoker</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">sticky</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">stickyInvoker</span> <span class="o">=</span> <span class="n">invoker</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">invoker</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>如上，select 方法的主要逻辑集中在了对粘滞连接特性的支持上。首先是获取 sticky 配置，然后再检测 invokers 列表中是否包含 stickyInvoker，如果不包含，则认为该 stickyInvoker 不可用，此时将其置空。这里的 invokers 列表可以看做是**存活着的服务提供者**列表，如果这个列表不包含 stickyInvoker，那自然而然的认为 stickyInvoker 挂了，所以置空。如果 stickyInvoker 存在于 invokers 列表中，此时要进行下一项检测 — 检测 selected 中是否包含 stickyInvoker。如果包含的话，说明 stickyInvoker 在此之前没有成功提供服务（但其仍然处于存活状态）。此时我们认为这个服务不可靠，不应该在重试期间内再次被调用，因此这个时候不会返回该 stickyInvoker。如果 selected 不包含 stickyInvoker，此时还需要进行可用性检测，比如检测服务提供者网络连通性等。当可用性检测通过，才可返回 stickyInvoker，否则调用 doSelect 方法选择 Invoker。如果 sticky 为 true，此时会将 doSelect 方法选出的 Invoker 赋值给 stickyInvoker。</p>
<p>以上就是 select 方法的逻辑，这段逻辑看起来不是很复杂，但是信息量比较大。不搞懂 invokers 和 selected 两个入参的含义，以及粘滞连接特性，这段代码是不容易看懂的。所以大家在阅读这段代码时，不要忽略了对背景知识的理解。关于 select 方法先分析这么多，继续向下分析。</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">doSelect</span><span class="p">(</span><span class="n">LoadBalance</span> <span class="n">loadbalance</span><span class="p">,</span> <span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">selected</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">invokers</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">invokers</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span>
        <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">invokers</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">invokers</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">loadbalance</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 如果 loadbalance 为空，这里通过 SPI 加载 Loadbalance，默认为 RandomLoadBalance</span>
        <span class="n">loadbalance</span> <span class="o">=</span> <span class="n">ExtensionLoader</span><span class="p">.</span><span class="na">getExtensionLoader</span><span class="p">(</span><span class="n">LoadBalance</span><span class="p">.</span><span class="na">class</span><span class="p">).</span><span class="na">getExtension</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">DEFAULT_LOADBALANCE</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// 通过负载均衡组件选择 Invoker</span>
    <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="o">=</span> <span class="n">loadbalance</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">invokers</span><span class="p">,</span> <span class="n">getUrl</span><span class="p">(),</span> <span class="n">invocation</span><span class="p">);</span>

    <span class="c1">// 如果 selected 包含负载均衡选择出的 Invoker，或者该 Invoker 无法经过可用性检查，此时进行重选</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">selected</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">selected</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">invoker</span><span class="p">))</span>
            <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="n">invoker</span><span class="p">.</span><span class="na">isAvailable</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">getUrl</span><span class="p">()</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">availablecheck</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// 进行重选</span>
            <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">rinvoker</span> <span class="o">=</span> <span class="n">reselect</span><span class="p">(</span><span class="n">loadbalance</span><span class="p">,</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">selected</span><span class="p">,</span> <span class="n">availablecheck</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">rinvoker</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// 如果 rinvoker 不为空，则将其赋值给 invoker</span>
                <span class="n">invoker</span> <span class="o">=</span> <span class="n">rinvoker</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="c1">// rinvoker 为空，定位 invoker 在 invokers 中的位置</span>
                <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">invokers</span><span class="p">.</span><span class="na">indexOf</span><span class="p">(</span><span class="n">invoker</span><span class="p">);</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="c1">// 获取 index + 1 位置处的 Invoker，以下代码等价于：</span>
                    <span class="c1">//     invoker = invokers.get((index + 1) % invokers.size());</span>
                    <span class="n">invoker</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">invokers</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">?</span> <span class="n">invokers</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">invokers</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="s">&quot;... may because invokers list dynamic change, ignore.&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;cluster reselect fail reason is : ...&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">invoker</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>doSelect 主要做了两件事，第一是通过负载均衡组件选择 Invoker。第二是，如果选出来的 Invoker 不稳定，或不可用，此时需要调用 reselect 方法进行重选。若 reselect 选出来的 Invoker 为空，此时定位 invoker 在 invokers 列表中的位置 index，然后获取 index + 1 处的 invoker，这也可以看做是重选逻辑的一部分。下面我们来看一下 reselect 方法的逻辑。</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span> <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">reselect</span><span class="p">(</span><span class="n">LoadBalance</span> <span class="n">loadbalance</span><span class="p">,</span> <span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">selected</span><span class="p">,</span> <span class="kt">boolean</span> <span class="n">availablecheck</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>

    <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">reselectInvokers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">invokers</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">?</span> <span class="p">(</span><span class="n">invokers</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">:</span> <span class="n">invokers</span><span class="p">.</span><span class="na">size</span><span class="p">());</span>

    <span class="c1">// 下面的 if-else 分支逻辑有些冗余，pull request #2826 对这段代码进行了简化，可以参考一下</span>
    <span class="c1">// 根据 availablecheck 进行不同的处理</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">availablecheck</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// 遍历 invokers 列表</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="p">:</span> <span class="n">invokers</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 检测可用性</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">invoker</span><span class="p">.</span><span class="na">isAvailable</span><span class="p">())</span> <span class="p">{</span>
                <span class="c1">// 如果 selected 列表不包含当前 invoker，则将其添加到 reselectInvokers 中</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">selected</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">selected</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">invoker</span><span class="p">))</span> <span class="p">{</span>
                    <span class="n">reselectInvokers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">invoker</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// reselectInvokers 不为空，此时通过负载均衡组件进行选择</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reselectInvokers</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">loadbalance</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">reselectInvokers</span><span class="p">,</span> <span class="n">getUrl</span><span class="p">(),</span> <span class="n">invocation</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="c1">// 不检查 Invoker 可用性</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="p">:</span> <span class="n">invokers</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 如果 selected 列表不包含当前 invoker，则将其添加到 reselectInvokers 中</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">selected</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">selected</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">invoker</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">reselectInvokers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">invoker</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reselectInvokers</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// 通过负载均衡组件进行选择</span>
            <span class="k">return</span> <span class="n">loadbalance</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">reselectInvokers</span><span class="p">,</span> <span class="n">getUrl</span><span class="p">(),</span> <span class="n">invocation</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="p">{</span>
        <span class="c1">// 若线程走到此处，说明 reselectInvokers 集合为空，此时不会调用负载均衡组件进行筛选。</span>
        <span class="c1">// 这里从 selected 列表中查找可用的 Invoker，并将其添加到 reselectInvokers 集合中</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">selected</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="p">:</span> <span class="n">selected</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">invoker</span><span class="p">.</span><span class="na">isAvailable</span><span class="p">())</span>
                        <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">reselectInvokers</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">invoker</span><span class="p">))</span> <span class="p">{</span>
                    <span class="n">reselectInvokers</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">invoker</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">reselectInvokers</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// 再次进行选择，并返回选择结果</span>
            <span class="k">return</span> <span class="n">loadbalance</span><span class="p">.</span><span class="na">select</span><span class="p">(</span><span class="n">reselectInvokers</span><span class="p">,</span> <span class="n">getUrl</span><span class="p">(),</span> <span class="n">invocation</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>

<p>reselect 方法总结下来其实只做了两件事情，第一是查找可用的 Invoker，并将其添加到 reselectInvokers 集合中。第二，如果 reselectInvokers 不为空，则通过负载均衡组件再次进行选择。其中第一件事情又可进行细分，一开始，reselect 从 invokers 列表中查找有效可用的 Invoker，若未能找到，此时再到 selected 列表中继续查找。关于 reselect 方法就先分析到这，继续分析其他的 Cluster Invoker。</p>
<h4 id="322-failbackclusterinvoker">3.2.2 FailbackClusterInvoker<a class="headerlink" href="#322-failbackclusterinvoker" title="Permanent link">&para;</a></h4>
<p>FailbackClusterInvoker 会在调用失败后，返回一个空结果给服务消费者。并通过定时任务对失败的调用进行重传，适合执行消息通知等操作。下面来看一下它的实现逻辑。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FailbackClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">RETRY_FAILED_PERIOD</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ScheduledExecutorService</span> <span class="n">scheduledExecutorService</span> <span class="o">=</span> <span class="n">Executors</span><span class="p">.</span><span class="na">newScheduledThreadPool</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
            <span class="k">new</span> <span class="n">NamedInternalThreadFactory</span><span class="p">(</span><span class="s">&quot;failback-cluster-timer&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ConcurrentMap</span><span class="o">&lt;</span><span class="n">Invocation</span><span class="p">,</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">failed</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ConcurrentHashMap</span><span class="o">&lt;</span><span class="n">Invocation</span><span class="p">,</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;?&gt;&gt;</span><span class="p">();</span>
    <span class="kd">private</span> <span class="kd">volatile</span> <span class="n">ScheduledFuture</span><span class="o">&lt;?&gt;</span> <span class="n">retryFuture</span><span class="p">;</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">Result</span> <span class="nf">doInvoke</span><span class="p">(</span><span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">LoadBalance</span> <span class="n">loadbalance</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">checkInvokers</span><span class="p">(</span><span class="n">invokers</span><span class="p">,</span> <span class="n">invocation</span><span class="p">);</span>
            <span class="c1">// 选择 Invoker</span>
            <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">loadbalance</span><span class="p">,</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">invokers</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
            <span class="c1">// 进行调用</span>
            <span class="k">return</span> <span class="n">invoker</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 如果调用过程中发生异常，此时仅打印错误日志，不抛出异常</span>
            <span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Failback to invoke method ...&quot;</span><span class="p">);</span>

            <span class="c1">// 记录调用信息</span>
            <span class="n">addFailed</span><span class="p">(</span><span class="n">invocation</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="c1">// 返回一个空结果给服务消费者</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">RpcResult</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">addFailed</span><span class="p">(</span><span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;?&gt;</span> <span class="n">router</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">retryFuture</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">synchronized</span> <span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">retryFuture</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// 创建定时任务，每隔5秒执行一次</span>
                    <span class="n">retryFuture</span> <span class="o">=</span> <span class="n">scheduledExecutorService</span><span class="p">.</span><span class="na">scheduleWithFixedDelay</span><span class="p">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="p">()</span> <span class="p">{</span>

                        <span class="nd">@Override</span>
                        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
                            <span class="k">try</span> <span class="p">{</span>
                                <span class="c1">// 对失败的调用进行重试</span>
                                <span class="n">retryFailed</span><span class="p">();</span>
                            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Throwable</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
                                <span class="c1">// 如果发生异常，仅打印异常日志，不抛出</span>
                                <span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unexpected error occur at collect statistic&quot;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">},</span> <span class="n">RETRY_FAILED_PERIOD</span><span class="p">,</span> <span class="n">RETRY_FAILED_PERIOD</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// 添加 invocation 和 invoker 到 failed 中</span>
        <span class="n">failed</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">invocation</span><span class="p">,</span> <span class="n">router</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">retryFailed</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">failed</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// 遍历 failed，对失败的调用进行重试</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">Invocation</span><span class="p">,</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">entry</span> <span class="p">:</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">Invocation</span><span class="p">,</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;?&gt;&gt;</span><span class="p">(</span><span class="n">failed</span><span class="p">).</span><span class="na">entrySet</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">Invocation</span> <span class="n">invocation</span> <span class="o">=</span> <span class="n">entry</span><span class="p">.</span><span class="na">getKey</span><span class="p">();</span>
            <span class="n">Invoker</span><span class="o">&lt;?&gt;</span> <span class="n">invoker</span> <span class="o">=</span> <span class="n">entry</span><span class="p">.</span><span class="na">getValue</span><span class="p">();</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="c1">// 再次进行调用</span>
                <span class="n">invoker</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
                <span class="c1">// 调用成功后，从 failed 中移除 invoker</span>
                <span class="n">failed</span><span class="p">.</span><span class="na">remove</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// 仅打印异常，不抛出</span>
                <span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Failed retry to invoke method ...&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>这个类主要由3个方法组成，首先是 doInvoker，该方法负责初次的远程调用。若远程调用失败，则通过 addFailed 方法将调用信息存入到 failed 中，等待定时重试。addFailed 在开始阶段会根据 retryFuture 为空与否，来决定是否开启定时任务。retryFailed 方法则是包含了失败重试的逻辑，该方法会对 failed 进行遍历，然后依次对 Invoker 进行调用。调用成功则将 Invoker 从 failed 中移除，调用失败则忽略失败原因。</p>
<p>以上就是 FailbackClusterInvoker 的执行逻辑，不是很复杂，继续往下看。</p>
<h4 id="323-failfastclusterinvoker">3.2.3 FailfastClusterInvoker<a class="headerlink" href="#323-failfastclusterinvoker" title="Permanent link">&para;</a></h4>
<p>FailfastClusterInvoker 只会进行一次调用，失败后立即抛出异常。适用于幂等操作，比如新增记录。源码如下：</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FailfastClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Result</span> <span class="nf">doInvoke</span><span class="p">(</span><span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">LoadBalance</span> <span class="n">loadbalance</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
        <span class="n">checkInvokers</span><span class="p">(</span><span class="n">invokers</span><span class="p">,</span> <span class="n">invocation</span><span class="p">);</span>
        <span class="c1">// 选择 Invoker</span>
        <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">loadbalance</span><span class="p">,</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">invokers</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="c1">// 调用 Invoker</span>
            <span class="k">return</span> <span class="n">invoker</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="k">instanceof</span> <span class="n">RpcException</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">RpcException</span><span class="p">)</span> <span class="n">e</span><span class="p">).</span><span class="na">isBiz</span><span class="p">())</span> <span class="p">{</span>
                <span class="c1">// 抛出异常</span>
                <span class="k">throw</span> <span class="p">(</span><span class="n">RpcException</span><span class="p">)</span> <span class="n">e</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1">// 抛出异常</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">RpcException</span><span class="p">(...,</span> <span class="s">&quot;Failfast invoke providers ...&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>如上，首先是通过 select 方法选择 Invoker，然后进行远程调用。如果调用失败，则立即抛出异常。FailfastClusterInvoker 就先分析到这，下面分析 FailsafeClusterInvoker。</p>
<h4 id="324-failsafeclusterinvoker">3.2.4 FailsafeClusterInvoker<a class="headerlink" href="#324-failsafeclusterinvoker" title="Permanent link">&para;</a></h4>
<p>FailsafeClusterInvoker 是一种失败安全的 Cluster Invoker。所谓的失败安全是指，当调用过程中出现异常时，FailsafeClusterInvoker 仅会打印异常，而不会抛出异常。适用于写入审计日志等操作。下面分析源码。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FailsafeClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Result</span> <span class="nf">doInvoke</span><span class="p">(</span><span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">LoadBalance</span> <span class="n">loadbalance</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">checkInvokers</span><span class="p">(</span><span class="n">invokers</span><span class="p">,</span> <span class="n">invocation</span><span class="p">);</span>
            <span class="c1">// 选择 Invoker</span>
            <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">loadbalance</span><span class="p">,</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">invokers</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
            <span class="c1">// 进行远程调用</span>
            <span class="k">return</span> <span class="n">invoker</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// 打印错误日志，但不抛出</span>
            <span class="n">logger</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Failsafe ignore exception: &quot;</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span> <span class="n">e</span><span class="p">);</span>
            <span class="c1">// 返回空结果忽略错误</span>
            <span class="k">return</span> <span class="k">new</span> <span class="n">RpcResult</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>FailsafeClusterInvoker 的逻辑和 FailfastClusterInvoker 的逻辑一样简单，无需过多说明。继续向下分析。</p>
<h4 id="325-forkingclusterinvoker">3.2.5 ForkingClusterInvoker<a class="headerlink" href="#325-forkingclusterinvoker" title="Permanent link">&para;</a></h4>
<p>ForkingClusterInvoker 会在运行时通过线程池创建多个线程，并发调用多个服务提供者。只要有一个服务提供者成功返回了结果，doInvoke 方法就会立即结束运行。ForkingClusterInvoker 的应用场景是在一些对实时性要求比较高**读操作**（注意是读操作，并行写操作可能不安全）下使用，但这将会耗费更多的资源。下面来看该类的实现。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ForkingClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">ExecutorService</span> <span class="n">executor</span> <span class="o">=</span> <span class="n">Executors</span><span class="p">.</span><span class="na">newCachedThreadPool</span><span class="p">(</span>
            <span class="k">new</span> <span class="n">NamedInternalThreadFactory</span><span class="p">(</span><span class="s">&quot;forking-cluster-timer&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">));</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Result</span> <span class="nf">doInvoke</span><span class="p">(</span><span class="kd">final</span> <span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">LoadBalance</span> <span class="n">loadbalance</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">checkInvokers</span><span class="p">(</span><span class="n">invokers</span><span class="p">,</span> <span class="n">invocation</span><span class="p">);</span>
            <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">selected</span><span class="p">;</span>
            <span class="c1">// 获取 forks 配置</span>
            <span class="kd">final</span> <span class="kt">int</span> <span class="n">forks</span> <span class="o">=</span> <span class="n">getUrl</span><span class="p">().</span><span class="na">getParameter</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">FORKS_KEY</span><span class="p">,</span> <span class="n">Constants</span><span class="p">.</span><span class="na">DEFAULT_FORKS</span><span class="p">);</span>
            <span class="c1">// 获取超时配置</span>
            <span class="kd">final</span> <span class="kt">int</span> <span class="n">timeout</span> <span class="o">=</span> <span class="n">getUrl</span><span class="p">().</span><span class="na">getParameter</span><span class="p">(</span><span class="n">Constants</span><span class="p">.</span><span class="na">TIMEOUT_KEY</span><span class="p">,</span> <span class="n">Constants</span><span class="p">.</span><span class="na">DEFAULT_TIMEOUT</span><span class="p">);</span>
            <span class="c1">// 如果 forks 配置不合理，则直接将 invokers 赋值给 selected</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">forks</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">forks</span> <span class="o">&gt;=</span> <span class="n">invokers</span><span class="p">.</span><span class="na">size</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="n">invokers</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">selected</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">();</span>
                <span class="c1">// 循环选出 forks 个 Invoker，并添加到 selected 中</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">forks</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// 选择 Invoker</span>
                    <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">loadbalance</span><span class="p">,</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">selected</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">selected</span><span class="p">.</span><span class="na">contains</span><span class="p">(</span><span class="n">invoker</span><span class="p">))</span> <span class="p">{</span>
                        <span class="n">selected</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">invoker</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="c1">// ----------------------✨ 分割线1 ✨---------------------- //</span>

            <span class="n">RpcContext</span><span class="p">.</span><span class="na">getContext</span><span class="p">().</span><span class="na">setInvokers</span><span class="p">((</span><span class="n">List</span><span class="p">)</span> <span class="n">selected</span><span class="p">);</span>
            <span class="kd">final</span> <span class="n">AtomicInteger</span> <span class="n">count</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicInteger</span><span class="p">();</span>
            <span class="kd">final</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">ref</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedBlockingQueue</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
            <span class="c1">// 遍历 selected 列表</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">final</span> <span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="p">:</span> <span class="n">selected</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// 为每个 Invoker 创建一个执行线程</span>
                <span class="n">executor</span><span class="p">.</span><span class="na">execute</span><span class="p">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nd">@Override</span>
                    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">try</span> <span class="p">{</span>
                            <span class="c1">// 进行远程调用</span>
                            <span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="n">invoker</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
                            <span class="c1">// 将结果存到阻塞队列中</span>
                            <span class="n">ref</span><span class="p">.</span><span class="na">offer</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">count</span><span class="p">.</span><span class="na">incrementAndGet</span><span class="p">();</span>
                            <span class="c1">// 仅在 value 大于等于 selected.size() 时，才将异常对象</span>
                            <span class="c1">// 放入阻塞队列中，请大家思考一下为什么要这样做。</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">selected</span><span class="p">.</span><span class="na">size</span><span class="p">())</span> <span class="p">{</span>
                                <span class="c1">// 将异常对象存入到阻塞队列中</span>
                                <span class="n">ref</span><span class="p">.</span><span class="na">offer</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">}</span>

            <span class="c1">// ----------------------✨ 分割线2 ✨---------------------- //</span>

            <span class="k">try</span> <span class="p">{</span>
                <span class="c1">// 从阻塞队列中取出远程调用结果</span>
                <span class="n">Object</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">ref</span><span class="p">.</span><span class="na">poll</span><span class="p">(</span><span class="n">timeout</span><span class="p">,</span> <span class="n">TimeUnit</span><span class="p">.</span><span class="na">MILLISECONDS</span><span class="p">);</span>

                <span class="c1">// 如果结果类型为 Throwable，则抛出异常</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="k">instanceof</span> <span class="n">Throwable</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">Throwable</span> <span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">Throwable</span><span class="p">)</span> <span class="n">ret</span><span class="p">;</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="n">RpcException</span><span class="p">(...,</span> <span class="s">&quot;Failed to forking invoke provider ...&quot;</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">// 返回结果</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">Result</span><span class="p">)</span> <span class="n">ret</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">RpcException</span><span class="p">(</span><span class="s">&quot;Failed to forking invoke provider ...&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
            <span class="n">RpcContext</span><span class="p">.</span><span class="na">getContext</span><span class="p">().</span><span class="na">clearAttachments</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>ForkingClusterInvoker 的 doInvoker 方法比较长，这里通过两个分割线将整个方法划分为三个逻辑块。从方法开始到分割线1之间的代码主要是用于选出 forks 个 Invoker，为接下来的并发调用提供输入。分割线1和分割线2之间的逻辑通过线程池并发调用多个 Invoker，并将结果存储在阻塞队列中。分割线2到方法结尾之间的逻辑主要用于从阻塞队列中获取返回结果，并对返回结果类型进行判断。如果为异常类型，则直接抛出，否则返回。</p>
<p>以上就是ForkingClusterInvoker 的 doInvoker 方法大致过程。我们在分割线1和分割线2之间的代码上留了一个问题，问题是这样的：为什么要在<code>value &gt;= selected.size()</code>的情况下，才将异常对象添加到阻塞队列中？这里来解答一下。原因是这样的，在并行调用多个服务提供者的情况下，只要有一个服务提供者能够成功返回结果，而其他全部失败。此时 ForkingClusterInvoker 仍应该返回成功的结果，而非抛出异常。在<code>value &gt;= selected.size()</code>时将异常对象放入阻塞队列中，可以保证异常对象不会出现在正常结果的前面，这样可从阻塞队列中优先取出正常的结果。</p>
<p>关于 ForkingClusterInvoker 就先分析到这，接下来分析最后一个 Cluster Invoker。</p>
<h4 id="326-broadcastclusterinvoker">3.2.6 BroadcastClusterInvoker<a class="headerlink" href="#326-broadcastclusterinvoker" title="Permanent link">&para;</a></h4>
<p>本章的最后，我们再来看一下 BroadcastClusterInvoker。BroadcastClusterInvoker 会逐个调用每个服务提供者，如果其中一台报错，在循环调用结束后，BroadcastClusterInvoker 会抛出异常。该类通常用于通知所有提供者更新缓存或日志等本地资源信息。源码如下。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">BroadcastClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="kd">extends</span> <span class="n">AbstractClusterInvoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Result</span> <span class="nf">doInvoke</span><span class="p">(</span><span class="kd">final</span> <span class="n">Invocation</span> <span class="n">invocation</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">invokers</span><span class="p">,</span> <span class="n">LoadBalance</span> <span class="n">loadbalance</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">RpcException</span> <span class="p">{</span>
        <span class="n">checkInvokers</span><span class="p">(</span><span class="n">invokers</span><span class="p">,</span> <span class="n">invocation</span><span class="p">);</span>
        <span class="n">RpcContext</span><span class="p">.</span><span class="na">getContext</span><span class="p">().</span><span class="na">setInvokers</span><span class="p">((</span><span class="n">List</span><span class="p">)</span> <span class="n">invokers</span><span class="p">);</span>
        <span class="n">RpcException</span> <span class="n">exception</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="n">Result</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="c1">// 遍历 Invoker 列表，逐个调用</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Invoker</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">invoker</span> <span class="p">:</span> <span class="n">invokers</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="c1">// 进行远程调用</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">invoker</span><span class="p">.</span><span class="na">invoke</span><span class="p">(</span><span class="n">invocation</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">RpcException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">exception</span> <span class="o">=</span> <span class="n">e</span><span class="p">;</span>
                <span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span> <span class="n">e</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Throwable</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">exception</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RpcException</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span> <span class="n">e</span><span class="p">);</span>
                <span class="n">logger</span><span class="p">.</span><span class="na">warn</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">getMessage</span><span class="p">(),</span> <span class="n">e</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// exception 不为空，则抛出异常</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">exception</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="n">exception</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>

<p>以上就是 BroadcastClusterInvoker 的代码，比较简单，就不多说了。</p>
<h2 id="4">4.总结<a class="headerlink" href="#4" title="Permanent link">&para;</a></h2>
<p>本篇文章详细分析了集群容错的几种实现方式。集群容错对于 Dubbo 框架来说，是很重要的逻辑。集群模块处于服务提供者和消费者之间，对于服务消费者来说，集群可向其屏蔽服务提供者集群的情况，使其能够专心进行远程调用。除此之外，通过集群模块，我们还可以对服务之间的调用链路进行编排优化，治理服务。总的来说，对于 Dubbo 而言，集群容错相关逻辑是非常重要的。想要对 Dubbo 有比较深的理解，集群容错是必须要掌握的。</p>
<p>关于集群模块就先分析到这，感谢阅读。</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/squidfunk" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://gitter.im/squidfunk/mkdocs-material" target="_blank" rel="noopener" title="gitter.im" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://hub.docker.com/r/squidfunk/mkdocs-material/" target="_blank" rel="noopener" title="hub.docker.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/squidfunk" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://linkedin.com/in/squidfunk/" target="_blank" rel="noopener" title="linkedin.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://instagram.com/squidfunk" target="_blank" rel="noopener" title="instagram.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.d1f5a259.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.d5fec882.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.fae956e7.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>