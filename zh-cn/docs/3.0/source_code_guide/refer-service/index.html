<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="本文介绍了 Dubbo 服务引用的过程和实现细节"><link rel="shortcut icon" href=../../../../assets/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.5.3"><title>服务引用 - Apache Dubbo</title><link rel=stylesheet href=../../../../assets/stylesheets/main.6fb40bf7.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.cef4c379.min.css><meta name=theme-color content=#3f51b5><link rel=stylesheet href=../../../../css/dropdown.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#1 class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Application header --> <header class=md-header data-md-component=header> <!-- Top-level navigation --> <nav class="md-header-nav md-grid" aria-label=Header> <!-- Link to home --> <a href=../../../.. title="Apache Dubbo" class="md-header-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> <!-- Button to open drawer --> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <!-- Header title --> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Apache Dubbo </span> <span class="md-header-nav__topic md-ellipsis"> 服务引用 </span> </div> </div> <!-- Button to open search dialogue --> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div> <div class=langChange id=translate title=中文|English> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"> <path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"/> </svg> </div> <script>
    var translate = document.getElementById('translate');
    translate.addEventListener('click', changeHref, false);
    function changeHref() {
        if (window.location.href.search('en-us') !== -1) {
            var changeHref = window.location.href.replace('en-us', 'zh-cn');

        } else {
            var changeHref = window.location.href.replace('zh-cn', 'en-us');
        }
        window.location.href = changeHref
    }
</script> <style>
    .langChange {
        display: inline-block;
        width: 2.4rem;
        height: 2.4rem;
        vertical-align: middle;
        margin-left: .5rem;
    }

    .langChange svg {
        fill: rgba(255, 255, 255, 0.548);
        display: block;
        width: 1.2rem;
        height: 1.2rem;
        margin: 0 auto;
        margin-top: .6rem;
        margin-left: .6rem;
    }

    .langChange :hover {
        fill: white;
        cursor: pointer;
    }
</style> </div> <!-- Repository containing source --> <div class=md-header-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <!-- Home page --> <li class=md-tabs__item> <a href=../../../.. class="md-tabs__link md-tabs__link--active"> 首页 </a> </li> <!-- Main navigation item with nested items --> <!-- Home page --> <li class="md-tabs__item md-tabs_csr"> <a class="md-tabs__link md-tabs__link--active">文档</a> <ul class="md-tabs__list md-sub-tabs_bn"> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../2.7/user/preface/background/ class=md-tabs__link>2.7</a> </li> <!-- Render item --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../user/preface/background/ class=md-tabs__link>3.0</a> </li> <!-- Render item --> </ul> </li> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../../blog/apache-dubbo-2019-2020/ class=md-sub-tabs_link>Blog</a> </li> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <!-- Home page --> <!-- Recurse, if the first item has nested items --> <li class=md-tabs__item> <a href=../../../../developers/user-guide/faq_dev/ class=md-sub-tabs_link>Developers</a> </li> <!-- Render item --> <!-- Home page --> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Main navigation --> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <!-- Site title --> <label class=md-nav__title for=__drawer> <a href=../../../.. title="Apache Dubbo" class="md-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> Apache Dubbo </label> <!-- Repository containing source --> <div class=md-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <!-- Render item list --> <ul class=md-nav__list data-md-scrollfix> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../.. title=首页 class=md-nav__link> 首页 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 2.7 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=2.7 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 2.7 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/preface/requirements/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/quick-start/ title=快速启动 class=md-nav__link> 快速启动 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/dependencies/ title=依赖 class=md-nav__link> 依赖 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/maturity/ title=成熟度 class=md-nav__link> 成熟度 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-5 type=checkbox id=nav-1-1-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-5> 配置 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=配置 data-md-level=3> <label class=md-nav__title for=nav-1-1-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/xml/ title="XML 配置" class=md-nav__link> XML 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/api/ title="API 配置" class=md-nav__link> API 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/annotation/ title="Annotation 配置" class=md-nav__link> Annotation 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/annotation/ title=动态配置中心 class=md-nav__link> 动态配置中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/configuration-load-process/ title=配置加载流程 class=md-nav__link> 配置加载流程 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/configuration/environment-variables/ title=自动加载环境变量 class=md-nav__link> 自动加载环境变量 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-6 type=checkbox id=nav-1-1-6> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-6> 示例 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=示例 data-md-level=3> <label class=md-nav__title for=nav-1-1-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 示例 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/preflight-check/ title=启动时检查 class=md-nav__link> 启动时检查 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/fault-tolerent-strategy/ title=集群容错 class=md-nav__link> 集群容错 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/loadbalance/ title=负载均衡 class=md-nav__link> 负载均衡 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/thread-model/ title=线程模型 class=md-nav__link> 线程模型 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/explicit-target/ title=直连提供者 class=md-nav__link> 直连提供者 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/subscribe-only/ title=只订阅 class=md-nav__link> 只订阅 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/registry-only/ title=只注册 class=md-nav__link> 只注册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/static-service/ title=静态服务 class=md-nav__link> 静态服务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/multi-protocols/ title=多协议 class=md-nav__link> 多协议 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/multi-registry/ title=多注册中心 class=md-nav__link> 多注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/service-group/ title=服务分组 class=md-nav__link> 服务分组 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/multi-versions/ title=多版本 class=md-nav__link> 多版本 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/group-merger/ title=分组聚合 class=md-nav__link> 分组聚合 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/parameter-validation/ title=参数验证 class=md-nav__link> 参数验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/result-cache/ title=结果缓存 class=md-nav__link> 结果缓存 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/generic-reference/ title=泛化引用 class=md-nav__link> 泛化引用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/generic-service/ title=泛化实现 class=md-nav__link> 泛化实现 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/echo-service/ title=回声测试 class=md-nav__link> 回声测试 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/context/ title=上下文信息 class=md-nav__link> 上下文信息 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/attachment/ title=隐式参数 class=md-nav__link> 隐式参数 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/async-call/ title=异步调用 class=md-nav__link> 异步调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/async-execute-on-provider/ title=服务端异步 class=md-nav__link> 服务端异步 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/local-call/ title=本地调用 class=md-nav__link> 本地调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/callback-parameter/ title=参数回调 class=md-nav__link> 参数回调 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/events-notify/ title=事件通知 class=md-nav__link> 事件通知 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/local-stub/ title=本地存根 class=md-nav__link> 本地存根 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/local-mock/ title=本地伪装 class=md-nav__link> 本地伪装 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/delay-publish/ title=延迟暴露 class=md-nav__link> 延迟暴露 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/concurrency-control/ title=并发控制 class=md-nav__link> 并发控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/config-connection.md title=连接控制 class=md-nav__link> 连接控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/lazy-connect/ title=延迟连接 class=md-nav__link> 延迟连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/stickiness/ title=粘滞连接 class=md-nav__link> 粘滞连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/token-authorization/ title=令牌验证 class=md-nav__link> 令牌验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/routing-rule/ title=路由规则 class=md-nav__link> 路由规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/config-rule/ title=配置规则 class=md-nav__link> 配置规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/service-downgrade/ title=服务降级 class=md-nav__link> 服务降级 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/graceful-shutdown/ title=优雅停机 class=md-nav__link> 优雅停机 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/hostname-binding/ title=主机绑定 class=md-nav__link> 主机绑定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/logger-strategy/ title=日志适配 class=md-nav__link> 日志适配 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/accesslog/ title=访问日志 class=md-nav__link> 访问日志 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/service-container/ title=服务容器 class=md-nav__link> 服务容器 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/distributed-transaction/ title=分布式事务 class=md-nav__link> 分布式事务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/dump/ title=线程栈自动dump class=md-nav__link> 线程栈自动dump </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/netty4/ title=Netty4 class=md-nav__link> Netty4 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/serialization/ title=Kryo和FST序列化 class=md-nav__link> Kryo和FST序列化 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/simplify-registry-data/ title=简化注册中心URL class=md-nav__link> 简化注册中心URL </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/demos/api.md title="API 参考手册" class=md-nav__link> API 参考手册 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-7 type=checkbox id=nav-1-1-7> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-7> schema 配置参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="schema 配置参考手册" data-md-level=3> <label class=md-nav__title for=nav-1-1-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> schema 配置参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-service/ title=dubbo:service class=md-nav__link> dubbo:service </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-reference/ title=dubbo:reference class=md-nav__link> dubbo:reference </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-protocol/ title=dubbo:protocol class=md-nav__link> dubbo:protocol </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-registry/ title=dubbo:registry class=md-nav__link> dubbo:registry </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-monitor/ title=dubbo:monitor class=md-nav__link> dubbo:monitor </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-application/ title=dubbo:application class=md-nav__link> dubbo:application </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-module/ title=dubbo:module class=md-nav__link> dubbo:module </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-provider/ title=dubbo:provider class=md-nav__link> dubbo:provider </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-consumer/ title=dubbo:consumer class=md-nav__link> dubbo:consumer </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-method/ title=dubbo:method class=md-nav__link> dubbo:method </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-argument/ title=dubbo:argument class=md-nav__link> dubbo:argument </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-parameter/ title=dubbo:parameter class=md-nav__link> dubbo:parameter </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/xml/dubbo-config-center/ title=dubbo:config-center class=md-nav__link> dubbo:config-center </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-8 type=checkbox id=nav-1-1-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-8> 协议参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=协议参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 协议参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/dubbo/ title=dubbo:// class=md-nav__link> dubbo:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/rmi/ title=rmi:// class=md-nav__link> rmi:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/hessian/ title=hessian:// class=md-nav__link> hessian:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/http/ title=http:// class=md-nav__link> http:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/thrift/ title=thrift:// class=md-nav__link> thrift:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/protocol/rest/ title=rest:// class=md-nav__link> rest:// </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-9 type=checkbox id=nav-1-1-9> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-9> 注册中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=注册中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 注册中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/registry/multicast/ title="Multicast 注册中心" class=md-nav__link> Multicast 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/registry/zookeeper/ title="Zookeeper 注册中心" class=md-nav__link> Zookeeper 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/registry/redis/ title="Redis 注册中心" class=md-nav__link> Redis 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/registry/simple/ title="Simple 注册中心" class=md-nav__link> Simple 注册中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-10 type=checkbox id=nav-1-1-10> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-10> 元数据中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=元数据中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-10> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 元数据中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/metadata/metadata-redis/ title="Redis 元数据中心" class=md-nav__link> Redis 元数据中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/metadata/metadata-zookeeper/ title="Zookeeper 元数据中心" class=md-nav__link> Zookeeper 元数据中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/telnet/ title="telnet 命令参考手册" class=md-nav__link> telnet 命令参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/qos/ title=在线运维命令-QOS class=md-nav__link> 在线运维命令-QOS </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/references/maven/ title="maven 插件参考手册" class=md-nav__link> maven 插件参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/best-practice/ title=服务化最佳实践 class=md-nav__link> 服务化最佳实践 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/recommend/ title=推荐用法 class=md-nav__link> 推荐用法 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/capacity-plan/ title=容量规划 class=md-nav__link> 容量规划 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/perf-test/ title=性能测试报告 class=md-nav__link> 性能测试报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/covergence.md title=测试覆盖率报告 class=md-nav__link> 测试覆盖率报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-19 type=checkbox id=nav-1-1-19> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-19> 版本与升级 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=版本与升级 data-md-level=3> <label class=md-nav__title for=nav-1-1-19> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 版本与升级 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../2.7/user/versions/version-270/ title=2.7.x升级步骤及注意事项 class=md-nav__link> 2.7.x升级步骤及注意事项 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2> 开发手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=开发手册 data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 开发手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/build.md title=源码构建 class=md-nav__link> 源码构建 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/design.md title=框架设计 class=md-nav__link> 框架设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/SPI.md title=扩展点加载 class=md-nav__link> 扩展点加载 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/implementation.md title=实现细节 class=md-nav__link> 实现细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-5 type=checkbox id=nav-1-2-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-5> SPI 扩展实现 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="SPI 扩展实现" data-md-level=3> <label class=md-nav__title for=nav-1-2-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> SPI 扩展实现 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/protocol.md title=协议扩展 class=md-nav__link> 协议扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/filter.md title=调用拦截扩展 class=md-nav__link> 调用拦截扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/invoker-listener.md title=引用监听扩展 class=md-nav__link> 引用监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/exporter-listener.md title=暴露监听扩展 class=md-nav__link> 暴露监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/cluster.md title=集群扩展 class=md-nav__link> 集群扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/router.md title=路由扩展 class=md-nav__link> 路由扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/load-balance.md title=负载均衡扩展 class=md-nav__link> 负载均衡扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/merger.md title=合并结果扩展 class=md-nav__link> 合并结果扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/registry.md title=注册中心扩展 class=md-nav__link> 注册中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/monitor.md title=监控中心扩展 class=md-nav__link> 监控中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/extension-factory.md title=扩展点加载扩展 class=md-nav__link> 扩展点加载扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/proxy-factory.md title=动态代理扩展 class=md-nav__link> 动态代理扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/compiler.md title=编译器扩展 class=md-nav__link> 编译器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/dispatcher.md title=消息派发扩展 class=md-nav__link> 消息派发扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/threadpool.md title=线程池扩展 class=md-nav__link> 线程池扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/serialize.md title=序列化扩展 class=md-nav__link> 序列化扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/remoting.md title=网络传输扩展 class=md-nav__link> 网络传输扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/exchanger.md title=信息交换扩展 class=md-nav__link> 信息交换扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/networker.md title=组网扩展 class=md-nav__link> 组网扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/telnet-handler.md title="Telnet 命令扩展" class=md-nav__link> Telnet 命令扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/status-checker.md title=状态检查扩展 class=md-nav__link> 状态检查扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/container.md title=容器扩展 class=md-nav__link> 容器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/page.md title=页面扩展 class=md-nav__link> 页面扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/cache.md title=缓存扩展 class=md-nav__link> 缓存扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/validation.md title=验证扩展 class=md-nav__link> 验证扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/logger-adapter.md title=日志适配扩展 class=md-nav__link> 日志适配扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/impls/config-center.md title=配置中心 class=md-nav__link> 配置中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/contract.md title=公共契约 class=md-nav__link> 公共契约 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/coding.md title=编码约定 class=md-nav__link> 编码约定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-8 type=checkbox id=nav-1-2-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-8> 设计原则 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=设计原则 data-md-level=3> <label class=md-nav__title for=nav-1-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 设计原则 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/code-detail.md title=魔鬼在细节 class=md-nav__link> 魔鬼在细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/general-knowledge.md title=一些设计上的基本常识 class=md-nav__link> 一些设计上的基本常识 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/expansibility.md title=谈谈扩充式扩展与增量式扩展 class=md-nav__link> 谈谈扩充式扩展与增量式扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/configuration.md title=配置设计 class=md-nav__link> 配置设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/robustness.md title=设计实现的健壮性 class=md-nav__link> 设计实现的健壮性 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/dummy.md title=防痴呆设计 class=md-nav__link> 防痴呆设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/principals/extension.md title=扩展点重构 class=md-nav__link> 扩展点重构 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/release.md title=版本发布 class=md-nav__link> 版本发布 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/contribution.md title=贡献代码 class=md-nav__link> 贡献代码 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/checklist.md title=检查列表 class=md-nav__link> 检查列表 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/code-smell.md title=坏味道 class=md-nav__link> 坏味道 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../dev/TCK.md title=兼容性测试 class=md-nav__link> 兼容性测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-3> 管理者文档 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=管理者文档 data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 管理者文档 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/introduction.md title="Dubbo Admin介绍" class=md-nav__link> Dubbo Admin介绍 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/serviceSearch.md title=服务搜索和详情 class=md-nav__link> 服务搜索和详情 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/serviceGovernance.md title=服务治理 class=md-nav__link> 服务治理 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../admin/serviceTest.md title=服务测试 class=md-nav__link> 服务测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 3.0 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=3.0 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 3.0 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/preface/background/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../user/preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> Blog <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Blog data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/apache-dubbo-2019-2020/ title=2019-2020 class=md-nav__link> 2019-2020 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/service-test/ title=服务测试 class=md-nav__link> 服务测试 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubboAsync_server/ title="Implementation background and practice of Dubbo server asynchronous interface" class=md-nav__link> Implementation background and practice of Dubbo server asynchronous interface </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubboAsync_client/ title="Implementation background and practice of Dubbo client asynchronous interface" class=md-nav__link> Implementation background and practice of Dubbo client asynchronous interface </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-fescar/ title="How to use Fescar to ensure consistency between Dubbo Microservices" class=md-nav__link> How to use Fescar to ensure consistency between Dubbo Microservices </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/prepare-an-apache-release/ title="Prepare an Apache Release" class=md-nav__link> Prepare an Apache Release </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-protocol/ title="Dubbo protocol" class=md-nav__link> Dubbo protocol </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-101/ title="Your First Dubbo Demo" class=md-nav__link> Your First Dubbo Demo </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/first-dubbo-filter/ title="Your First Dubbo filter" class=md-nav__link> Your First Dubbo filter </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-zk/ title="Using Zookeeper in Dubbo" class=md-nav__link> Using Zookeeper in Dubbo </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-annotation/ title="Using annotation in Dubbo" class=md-nav__link> Using annotation in Dubbo </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/introduction-to-dubbo-spi/ title="Introduction to Dubbo spi" class=md-nav__link> Introduction to Dubbo spi </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/spring-boot-dubbo-start-stop-analysis/ title="Source code analysis of spring-boot+Dubbo App start and stop" class=md-nav__link> Source code analysis of spring-boot+Dubbo App start and stop </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/introduction-to-dubbo-spi-2/ title="Dubbo extensible mechanism source code analysis" class=md-nav__link> Dubbo extensible mechanism source code analysis </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/introduction-to-dubbo-qos/ title="Manipulating Services Dynamically via QoS" class=md-nav__link> Manipulating Services Dynamically via QoS </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/dubbo-loadbalance/ title="Dubbo Loadbalance" class=md-nav__link> Dubbo Loadbalance </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/sentinel-introduction-for-dubbo/ title="Sentinel: The flow sentinel of Dubbo service" class=md-nav__link> Sentinel: The flow sentinel of Dubbo service </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/pinpoint/ title="Tracking with Pinpoint" class=md-nav__link> Tracking with Pinpoint </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> Developers <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Developers data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Developers </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> User Guide <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="User Guide" data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> User Guide </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/user-guide/faq_dev/ title=faq class=md-nav__link> faq </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2> Contributor Guide <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Contributor Guide" data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Contributor Guide </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/new-contributor-guide_dev/ title="New contributor guide" class=md-nav__link> New contributor guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/software-donation-guide_dev/ title="Software donation guide" class=md-nav__link> Software donation guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/test-coverage-guide_dev/ title="Test coverage guide" class=md-nav__link> Test coverage guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/mailing-list-subscription-guide_dev/ title="Mailing list subscription guide" class=md-nav__link> Mailing list subscription guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/cla-signing-guide_dev/ title="CLA Signing Guide" class=md-nav__link> CLA Signing Guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/dubbo-extension-guide_dev/ title="Extension guide" class=md-nav__link> Extension guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/contributor-guide/become-a-committer_dev/ title="How to become a committer" class=md-nav__link> How to become a committer </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/reporting-security-issues_dev.md title="How to report security issues" class=md-nav__link> How to report security issues </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-3> Committer Guide <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="Committer Guide" data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Committer Guide </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/new-committer-guide_dev/ title="New Committer guide" class=md-nav__link> New Committer guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href="../../../../developers/Label an Issue.md" title="Label an Issue" class=md-nav__link> Label an Issue </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/website-guide_dev/ title="Website Guide" class=md-nav__link> Website Guide </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/apache-dubbo-page_dev/ title="Apache Dubbo Page Maintenance" class=md-nav__link> Apache Dubbo Page Maintenance </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/committer-guide/release-guide_dev/ title="Release Guide" class=md-nav__link> Release Guide </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/guide_dev/ title="How to contribute" class=md-nav__link> How to contribute </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../developers/developers_dev/ title=Developers class=md-nav__link> Developers </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../../../blog/downloads.md title=Downloads class=md-nav__link> Downloads </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1 class=md-nav__link> 1. 简介 </a> </li> <li class=md-nav__item> <a href=#2 class=md-nav__link> 2.服务引用原理 </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3.源码分析 </a> <nav class=md-nav aria-label=3.源码分析> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31 class=md-nav__link> 3.1 处理配置 </a> </li> <li class=md-nav__item> <a href=#32 class=md-nav__link> 3.2 引用服务 </a> <nav class=md-nav aria-label="3.2 引用服务"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#321-invoker class=md-nav__link> 3.2.1 创建 Invoker </a> </li> <li class=md-nav__item> <a href=#322 class=md-nav__link> 3.2.2 创建代理 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#4 class=md-nav__link> 4.总结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/apache/dubbo-website/edit/master/zh-cn/docs/3.0/source_code_guide/refer-service.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1>服务引用</h1> <h2 id=1>1. 简介<a class=headerlink href=#1 title="Permanent link">&para;</a></h2> <p>上一篇文章详细分析了服务导出的过程，本篇文章我们趁热打铁，继续分析服务引用过程。在 Dubbo 中，我们可以通过两种方式引用远程服务。第一种是使用服务直连的方式引用服务，第二种方式是基于注册中心进行引用。服务直连的方式仅适合在调试或测试服务的场景下使用，不适合在线上环境使用。因此，本文我将重点分析通过注册中心引用服务的过程。从注册中心中获取服务配置只是服务引用过程中的一环，除此之外，服务消费者还需要经历 Invoker 创建、代理类创建等步骤。这些步骤，将在后续章节中一一进行分析。</p> <h2 id=2>2.服务引用原理<a class=headerlink href=#2 title="Permanent link">&para;</a></h2> <p>Dubbo 服务引用的时机有两个，第一个是在 Spring 容器调用 ReferenceBean 的 afterPropertiesSet 方法时引用服务，第二个是在 ReferenceBean 对应的服务被注入到其他类中时引用。这两个引用服务的时机区别在于，第一个是饿汉式的，第二个是懒汉式的。默认情况下，Dubbo 使用懒汉式引用服务。如果需要使用饿汉式，可通过配置 \&lt;dubbo:reference> 的 init 属性开启。下面我们按照 Dubbo 默认配置进行分析，整个分析过程从 ReferenceBean 的 getObject 方法开始。当我们的服务被注入到其他类中时，Spring 会第一时间调用 getObject 方法，并由该方法执行服务引用逻辑。按照惯例，在进行具体工作之前，需先进行配置检查与收集工作。接着根据收集到的信息决定服务用的方式，有三种，第一种是引用本地 (JVM) 服务，第二是通过直连方式引用远程服务，第三是通过注册中心引用远程服务。不管是哪种引用方式，最后都会得到一个 Invoker 实例。如果有多个注册中心，多个服务提供者，这个时候会得到一组 Invoker 实例，此时需要通过集群管理类 Cluster 将多个 Invoker 合并成一个实例。合并后的 Invoker 实例已经具备调用本地或远程服务的能力了，但并不能将此实例暴露给用户使用，这会对用户业务代码造成侵入。此时框架还需要通过代理工厂类 (ProxyFactory) 为服务接口生成代理类，并让代理类去调用 Invoker 逻辑。避免了 Dubbo 框架代码对业务代码的侵入，同时也让框架更容易使用。</p> <p>以上就是服务引用的大致原理，下面我们深入到代码中，详细分析服务引用细节。</p> <h2 id=3>3.源码分析<a class=headerlink href=#3 title="Permanent link">&para;</a></h2> <p>服务引用的入口方法为 ReferenceBean 的 getObject 方法，该方法定义在 Spring 的 FactoryBean 接口中，ReferenceBean 实现了这个方法。实现代码如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>Object</span> <span class=nf>getObject</span><span class=p>()</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>get</span><span class=p>();</span>
<span class=p>}</span>

<span class=kd>public</span> <span class=kd>synchronized</span> <span class=n>T</span> <span class=nf>get</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>destroyed</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;Already destroyed!&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=c1>// 检测 ref 是否为空，为空则通过 init 方法创建</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ref</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// init 方法主要用于处理配置，以及调用 createProxy 生成代理类</span>
        <span class=n>init</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>ref</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>以上两个方法的代码比较简短，并不难理解。这里需要特别说明一下，如果你对 2.6.4 及以下版本的 getObject 方法进行调试时，会碰到比较奇怪的的问题。这里假设你使用 IDEA，且保持了 IDEA 的默认配置。当你面调试到 get 方法的<code>if (ref == null)</code>时，你会发现 ref 不为空，导致你无法进入到 init 方法中继续调试。导致这个现象的原因是 Dubbo 框架本身有一些小问题。该问题已经在 pull request <a href=https://github.com/apache/dubbo/pull/2754>#2754</a> 修复了此问题，并跟随 2.6.5 版本发布了。如果你正在学习 2.6.4 及以下版本，可通过修改 IDEA 配置规避这个问题。首先 IDEA 配置弹窗中搜索 toString，然后取消<code>Enable 'toString' object view</code>勾选。具体如下：</p> <p><img alt src=https://blog-pictures.oss-cn-shanghai.aliyuncs.com/15417503733794.jpg></p> <h3 id=31>3.1 处理配置<a class=headerlink href=#31 title="Permanent link">&para;</a></h3> <p>Dubbo 提供了丰富的配置，用于调整和优化框架行为，性能等。Dubbo 在引用或导出服务时，首先会对这些配置进行检查和处理，以保证配置的正确性。配置解析逻辑封装在 ReferenceConfig 的 init 方法中，下面进行分析。</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=kt>void</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
    <span class=c1>// 避免重复初始化</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>initialized</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=n>initialized</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
    <span class=c1>// 检测接口名合法性</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>interfaceName</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>interfaceName</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;interface not allow null!&quot;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 检测 consumer 变量是否为空，为空则创建</span>
    <span class=n>checkDefault</span><span class=p>();</span>
    <span class=n>appendProperties</span><span class=p>(</span><span class=k>this</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>getGeneric</span><span class=p>()</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>getConsumer</span><span class=p>()</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 设置 generic</span>
        <span class=n>setGeneric</span><span class=p>(</span><span class=n>getConsumer</span><span class=p>().</span><span class=na>getGeneric</span><span class=p>());</span>
    <span class=p>}</span>

    <span class=c1>// 检测是否为泛化接口</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ProtocolUtils</span><span class=p>.</span><span class=na>isGeneric</span><span class=p>(</span><span class=n>getGeneric</span><span class=p>()))</span> <span class=p>{</span>
        <span class=n>interfaceClass</span> <span class=o>=</span> <span class=n>GenericService</span><span class=p>.</span><span class=na>class</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=c1>// 加载类</span>
            <span class=n>interfaceClass</span> <span class=o>=</span> <span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=n>interfaceName</span><span class=p>,</span> <span class=kc>true</span><span class=p>,</span> <span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>()</span>
                    <span class=p>.</span><span class=na>getContextClassLoader</span><span class=p>());</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>ClassNotFoundException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span> <span class=n>e</span><span class=p>);</span>
        <span class=p>}</span>
        <span class=n>checkInterfaceAndMethods</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>,</span> <span class=n>methods</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// -------------------------------✨ 分割线1 ✨------------------------------</span>

    <span class=c1>// 从系统变量中获取与接口名对应的属性值</span>
    <span class=n>String</span> <span class=n>resolve</span> <span class=o>=</span> <span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=n>interfaceName</span><span class=p>);</span>
    <span class=n>String</span> <span class=n>resolveFile</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>resolve</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>resolve</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 从系统属性中获取解析文件路径</span>
        <span class=n>resolveFile</span> <span class=o>=</span> <span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=s>&quot;dubbo.resolve.file&quot;</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>resolveFile</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>resolveFile</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 从指定位置加载配置文件</span>
            <span class=n>File</span> <span class=n>userResolveFile</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=s>&quot;user.home&quot;</span><span class=p>)),</span> <span class=s>&quot;dubbo-resolve.properties&quot;</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>userResolveFile</span><span class=p>.</span><span class=na>exists</span><span class=p>())</span> <span class=p>{</span>
                <span class=c1>// 获取文件绝对路径</span>
                <span class=n>resolveFile</span> <span class=o>=</span> <span class=n>userResolveFile</span><span class=p>.</span><span class=na>getAbsolutePath</span><span class=p>();</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>resolveFile</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>resolveFile</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>Properties</span> <span class=n>properties</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Properties</span><span class=p>();</span>
            <span class=n>FileInputStream</span> <span class=n>fis</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
            <span class=k>try</span> <span class=p>{</span>
                <span class=n>fis</span> <span class=o>=</span> <span class=k>new</span> <span class=n>FileInputStream</span><span class=p>(</span><span class=k>new</span> <span class=n>File</span><span class=p>(</span><span class=n>resolveFile</span><span class=p>));</span>
                <span class=c1>// 从文件中加载配置</span>
                <span class=n>properties</span><span class=p>.</span><span class=na>load</span><span class=p>(</span><span class=n>fis</span><span class=p>);</span>
            <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;Unload ..., cause:...&quot;</span><span class=p>);</span>
            <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
                <span class=k>try</span> <span class=p>{</span>
                    <span class=k>if</span> <span class=p>(</span><span class=kc>null</span> <span class=o>!=</span> <span class=n>fis</span><span class=p>)</span> <span class=n>fis</span><span class=p>.</span><span class=na>close</span><span class=p>();</span>
                <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>IOException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>logger</span><span class=p>.</span><span class=na>warn</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span> <span class=n>e</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>
            <span class=c1>// 获取与接口名对应的配置</span>
            <span class=n>resolve</span> <span class=o>=</span> <span class=n>properties</span><span class=p>.</span><span class=na>getProperty</span><span class=p>(</span><span class=n>interfaceName</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>resolve</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>resolve</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 将 resolve 赋值给 url</span>
        <span class=n>url</span> <span class=o>=</span> <span class=n>resolve</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=c1>// -------------------------------✨ 分割线2 ✨------------------------------</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>consumer</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>application</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 从 consumer 中获取 Application 实例，下同</span>
            <span class=n>application</span> <span class=o>=</span> <span class=n>consumer</span><span class=p>.</span><span class=na>getApplication</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>module</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>module</span> <span class=o>=</span> <span class=n>consumer</span><span class=p>.</span><span class=na>getModule</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>registries</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>registries</span> <span class=o>=</span> <span class=n>consumer</span><span class=p>.</span><span class=na>getRegistries</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>monitor</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>monitor</span> <span class=o>=</span> <span class=n>consumer</span><span class=p>.</span><span class=na>getMonitor</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>module</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>registries</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>registries</span> <span class=o>=</span> <span class=n>module</span><span class=p>.</span><span class=na>getRegistries</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>monitor</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>monitor</span> <span class=o>=</span> <span class=n>module</span><span class=p>.</span><span class=na>getMonitor</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>application</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>registries</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>registries</span> <span class=o>=</span> <span class=n>application</span><span class=p>.</span><span class=na>getRegistries</span><span class=p>();</span>
        <span class=p>}</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>monitor</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>monitor</span> <span class=o>=</span> <span class=n>application</span><span class=p>.</span><span class=na>getMonitor</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// 检测 Application 合法性</span>
    <span class=n>checkApplication</span><span class=p>();</span>
    <span class=c1>// 检测本地存根配置合法性</span>
    <span class=n>checkStubAndMock</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>);</span>

    <span class=c1>// -------------------------------✨ 分割线3 ✨------------------------------</span>

    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span><span class=p>();</span>
    <span class=n>Map</span><span class=o>&lt;</span><span class=n>Object</span><span class=p>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>attributes</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>Object</span><span class=p>,</span> <span class=n>Object</span><span class=o>&gt;</span><span class=p>();</span>

    <span class=c1>// 添加 side、协议版本信息、时间戳和进程号等信息到 map 中</span>
    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>SIDE_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>CONSUMER_SIDE</span><span class=p>);</span>
    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>DUBBO_VERSION_KEY</span><span class=p>,</span> <span class=n>Version</span><span class=p>.</span><span class=na>getProtocolVersion</span><span class=p>());</span>
    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>TIMESTAMP_KEY</span><span class=p>,</span> <span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()));</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ConfigUtils</span><span class=p>.</span><span class=na>getPid</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>PID_KEY</span><span class=p>,</span> <span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>ConfigUtils</span><span class=p>.</span><span class=na>getPid</span><span class=p>()));</span>
    <span class=p>}</span>

    <span class=c1>// 非泛化服务</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>isGeneric</span><span class=p>())</span> <span class=p>{</span>
        <span class=c1>// 获取版本</span>
        <span class=n>String</span> <span class=n>revision</span> <span class=o>=</span> <span class=n>Version</span><span class=p>.</span><span class=na>getVersion</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>,</span> <span class=n>version</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>revision</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>revision</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;revision&quot;</span><span class=p>,</span> <span class=n>revision</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// 获取接口方法列表，并添加到 map 中</span>
        <span class=n>String</span><span class=o>[]</span> <span class=n>methods</span> <span class=o>=</span> <span class=n>Wrapper</span><span class=p>.</span><span class=na>getWrapper</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>).</span><span class=na>getMethodNames</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>methods</span><span class=p>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;methods&quot;</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>ANY_VALUE</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&quot;methods&quot;</span><span class=p>,</span> <span class=n>StringUtils</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>(</span><span class=n>Arrays</span><span class=p>.</span><span class=na>asList</span><span class=p>(</span><span class=n>methods</span><span class=p>)),</span> <span class=s>&quot;,&quot;</span><span class=p>));</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>INTERFACE_KEY</span><span class=p>,</span> <span class=n>interfaceName</span><span class=p>);</span>
    <span class=c1>// 将 ApplicationConfig、ConsumerConfig、ReferenceConfig 等对象的字段信息添加到 map 中</span>
    <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>application</span><span class=p>);</span>
    <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>module</span><span class=p>);</span>
    <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>consumer</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_KEY</span><span class=p>);</span>
    <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=k>this</span><span class=p>);</span>

    <span class=c1>// -------------------------------✨ 分割线4 ✨------------------------------</span>

    <span class=n>String</span> <span class=n>prefix</span> <span class=o>=</span> <span class=n>StringUtils</span><span class=p>.</span><span class=na>getServiceKey</span><span class=p>(</span><span class=n>map</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>methods</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>methods</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span> <span class=p>{</span>
        <span class=c1>// 遍历 MethodConfig 列表</span>
        <span class=k>for</span> <span class=p>(</span><span class=n>MethodConfig</span> <span class=n>method</span> <span class=p>:</span> <span class=n>methods</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>appendParameters</span><span class=p>(</span><span class=n>map</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>
            <span class=n>String</span> <span class=n>retryKey</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;.retry&quot;</span><span class=p>;</span>
            <span class=c1>// 检测 map 是否包含 methodName.retry</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>map</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=n>retryKey</span><span class=p>))</span> <span class=p>{</span>
                <span class=n>String</span> <span class=n>retryValue</span> <span class=o>=</span> <span class=n>map</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>retryKey</span><span class=p>);</span>
                <span class=k>if</span> <span class=p>(</span><span class=s>&quot;false&quot;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>retryValue</span><span class=p>))</span> <span class=p>{</span>
                    <span class=c1>// 添加重试次数配置 methodName.retries</span>
                    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;.retries&quot;</span><span class=p>,</span> <span class=s>&quot;0&quot;</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>

            <span class=c1>// 添加 MethodConfig 中的“属性”字段到 attributes</span>
            <span class=c1>// 比如 onreturn、onthrow、oninvoke 等</span>
            <span class=n>appendAttributes</span><span class=p>(</span><span class=n>attributes</span><span class=p>,</span> <span class=n>method</span><span class=p>,</span> <span class=n>prefix</span> <span class=o>+</span> <span class=s>&quot;.&quot;</span> <span class=o>+</span> <span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>
            <span class=n>checkAndConvertImplicitConfig</span><span class=p>(</span><span class=n>method</span><span class=p>,</span> <span class=n>map</span><span class=p>,</span> <span class=n>attributes</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// -------------------------------✨ 分割线5 ✨------------------------------</span>

    <span class=c1>// 获取服务消费者 ip 地址</span>
    <span class=n>String</span> <span class=n>hostToRegistry</span> <span class=o>=</span> <span class=n>ConfigUtils</span><span class=p>.</span><span class=na>getSystemProperty</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>DUBBO_IP_TO_REGISTRY</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>hostToRegistry</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>hostToRegistry</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>hostToRegistry</span> <span class=o>=</span> <span class=n>NetUtils</span><span class=p>.</span><span class=na>getLocalHost</span><span class=p>();</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>isInvalidLocalHost</span><span class=p>(</span><span class=n>hostToRegistry</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;Specified invalid registry ip from property...&quot;</span> <span class=p>);</span>
    <span class=p>}</span>
    <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REGISTER_IP_KEY</span><span class=p>,</span> <span class=n>hostToRegistry</span><span class=p>);</span>

    <span class=c1>// 存储 attributes 到系统上下文中</span>
    <span class=n>StaticContext</span><span class=p>.</span><span class=na>getSystemContext</span><span class=p>().</span><span class=na>putAll</span><span class=p>(</span><span class=n>attributes</span><span class=p>);</span>

    <span class=c1>// 创建代理类</span>
    <span class=n>ref</span> <span class=o>=</span> <span class=n>createProxy</span><span class=p>(</span><span class=n>map</span><span class=p>);</span>

    <span class=c1>// 根据服务名，ReferenceConfig，代理类构建 ConsumerModel，</span>
    <span class=c1>// 并将 ConsumerModel 存入到 ApplicationModel 中</span>
    <span class=n>ConsumerModel</span> <span class=n>consumerModel</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ConsumerModel</span><span class=p>(</span><span class=n>getUniqueServiceName</span><span class=p>(),</span> <span class=k>this</span><span class=p>,</span> <span class=n>ref</span><span class=p>,</span> <span class=n>interfaceClass</span><span class=p>.</span><span class=na>getMethods</span><span class=p>());</span>
    <span class=n>ApplicationModel</span><span class=p>.</span><span class=na>initConsumerModel</span><span class=p>(</span><span class=n>getUniqueServiceName</span><span class=p>(),</span> <span class=n>consumerModel</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>上面的代码很长，做的事情比较多。这里根据代码逻辑，对代码进行了分块，下面我们一起来看一下。</p> <p>首先是方法开始到分割线1之间的代码。这段代码主要用于检测 ConsumerConfig 实例是否存在，如不存在则创建一个新的实例，然后通过系统变量或 dubbo.properties 配置文件填充 ConsumerConfig 的字段。接着是检测泛化配置，并根据配置设置 interfaceClass 的值。接着来看分割线1到分割线2之间的逻辑。这段逻辑用于从系统属性或配置文件中加载与接口名相对应的配置，并将解析结果赋值给 url 字段。url 字段的作用一般是用于点对点调用。继续向下看，分割线2和分割线3之间的代码用于检测几个核心配置类是否为空，为空则尝试从其他配置类中获取。分割线3与分割线4之间的代码主要用于收集各种配置，并将配置存储到 map 中。分割线4和分割线5之间的代码用于处理 MethodConfig 实例。该实例包含了事件通知配置，比如 onreturn、onthrow、oninvoke 等。分割线5到方法结尾的代码主要用于解析服务消费者 ip，以及调用 createProxy 创建代理对象。关于该方法的详细分析，将会在接下来的章节中展开。</p> <h3 id=32>3.2 引用服务<a class=headerlink href=#32 title="Permanent link">&para;</a></h3> <p>本节我们要从 createProxy 开始看起。从字面意思上来看，createProxy 似乎只是用于创建代理对象的。但实际上并非如此，该方法还会调用其他方法构建以及合并 Invoker 实例。具体细节如下。</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=n>T</span> <span class=nf>createProxy</span><span class=p>(</span><span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>map</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>URL</span> <span class=n>tmpUrl</span> <span class=o>=</span> <span class=k>new</span> <span class=n>URL</span><span class=p>(</span><span class=s>&quot;temp&quot;</span><span class=p>,</span> <span class=s>&quot;localhost&quot;</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>map</span><span class=p>);</span>
    <span class=kd>final</span> <span class=kt>boolean</span> <span class=n>isJvmRefer</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>isInjvm</span><span class=p>()</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// url 配置被指定，则不做本地引用</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>url</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>url</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>isJvmRefer</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
        <span class=c1>// 根据 url 的协议、scope 以及 injvm 等参数检测是否需要本地引用</span>
        <span class=c1>// 比如如果用户显式配置了 scope=local，此时 isInjvmRefer 返回 true</span>
        <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>InjvmProtocol</span><span class=p>.</span><span class=na>getInjvmProtocol</span><span class=p>().</span><span class=na>isInjvmRefer</span><span class=p>(</span><span class=n>tmpUrl</span><span class=p>))</span> <span class=p>{</span>
            <span class=n>isJvmRefer</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=n>isJvmRefer</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// 获取 injvm 配置值</span>
        <span class=n>isJvmRefer</span> <span class=o>=</span> <span class=n>isInjvm</span><span class=p>().</span><span class=na>booleanValue</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=c1>// 本地引用</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>isJvmRefer</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 生成本地引用 URL，协议为 injvm</span>
        <span class=n>URL</span> <span class=n>url</span> <span class=o>=</span> <span class=k>new</span> <span class=n>URL</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>LOCAL_PROTOCOL</span><span class=p>,</span> <span class=n>NetUtils</span><span class=p>.</span><span class=na>LOCALHOST</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>interfaceClass</span><span class=p>.</span><span class=na>getName</span><span class=p>()).</span><span class=na>addParameters</span><span class=p>(</span><span class=n>map</span><span class=p>);</span>
        <span class=c1>// 调用 refer 方法构建 InjvmInvoker 实例</span>
        <span class=n>invoker</span> <span class=o>=</span> <span class=n>refprotocol</span><span class=p>.</span><span class=na>refer</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>,</span> <span class=n>url</span><span class=p>);</span>

    <span class=c1>// 远程引用</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// url 不为空，表明用户可能想进行点对点调用</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>url</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>url</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 当需要配置多个 url 时，可用分号进行分割，这里会进行切分</span>
            <span class=n>String</span><span class=o>[]</span> <span class=n>us</span> <span class=o>=</span> <span class=n>Constants</span><span class=p>.</span><span class=na>SEMICOLON_SPLIT_PATTERN</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>us</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>us</span><span class=p>.</span><span class=na>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>for</span> <span class=p>(</span><span class=n>String</span> <span class=n>u</span> <span class=p>:</span> <span class=n>us</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>URL</span> <span class=n>url</span> <span class=o>=</span> <span class=n>URL</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>u</span><span class=p>);</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getPath</span><span class=p>()</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>url</span><span class=p>.</span><span class=na>getPath</span><span class=p>().</span><span class=na>length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                        <span class=c1>// 设置接口全限定名为 url 路径</span>
                        <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>setPath</span><span class=p>(</span><span class=n>interfaceName</span><span class=p>);</span>
                    <span class=p>}</span>

                    <span class=c1>// 检测 url 协议是否为 registry，若是，表明用户想使用指定的注册中心</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REGISTRY_PROTOCOL</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getProtocol</span><span class=p>()))</span> <span class=p>{</span>
                        <span class=c1>// 将 map 转换为查询字符串，并作为 refer 参数的值添加到 url 中</span>
                        <span class=n>urls</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>addParameterAndEncoded</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REFER_KEY</span><span class=p>,</span> <span class=n>StringUtils</span><span class=p>.</span><span class=na>toQueryString</span><span class=p>(</span><span class=n>map</span><span class=p>)));</span>
                    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                        <span class=c1>// 合并 url，移除服务提供者的一些配置（这些配置来源于用户配置的 url 属性），</span>
                        <span class=c1>// 比如线程池相关配置。并保留服务提供者的部分配置，比如版本，group，时间戳等</span>
                        <span class=c1>// 最后将合并后的配置设置为 url 查询字符串中。</span>
                        <span class=n>urls</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>ClusterUtils</span><span class=p>.</span><span class=na>mergeUrl</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>map</span><span class=p>));</span>
                    <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=c1>// 加载注册中心 url</span>
            <span class=n>List</span><span class=o>&lt;</span><span class=n>URL</span><span class=o>&gt;</span> <span class=n>us</span> <span class=o>=</span> <span class=n>loadRegistries</span><span class=p>(</span><span class=kc>false</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>us</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>us</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span> <span class=p>{</span>
                <span class=k>for</span> <span class=p>(</span><span class=n>URL</span> <span class=n>u</span> <span class=p>:</span> <span class=n>us</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>URL</span> <span class=n>monitorUrl</span> <span class=o>=</span> <span class=n>loadMonitor</span><span class=p>(</span><span class=n>u</span><span class=p>);</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>monitorUrl</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                        <span class=n>map</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>MONITOR_KEY</span><span class=p>,</span> <span class=n>URL</span><span class=p>.</span><span class=na>encode</span><span class=p>(</span><span class=n>monitorUrl</span><span class=p>.</span><span class=na>toFullString</span><span class=p>()));</span>
                    <span class=p>}</span>
                    <span class=c1>// 添加 refer 参数到 url 中，并将 url 添加到 urls 中</span>
                    <span class=n>urls</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>u</span><span class=p>.</span><span class=na>addParameterAndEncoded</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REFER_KEY</span><span class=p>,</span> <span class=n>StringUtils</span><span class=p>.</span><span class=na>toQueryString</span><span class=p>(</span><span class=n>map</span><span class=p>)));</span>
                <span class=p>}</span>
            <span class=p>}</span>

            <span class=c1>// 未配置注册中心，抛出异常</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>urls</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>())</span> <span class=p>{</span>
                <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;No such any registry to reference...&quot;</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>

        <span class=c1>// 单个注册中心或服务提供者(服务直连，下同)</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>urls</span><span class=p>.</span><span class=na>size</span><span class=p>()</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 调用 RegistryProtocol 的 refer 构建 Invoker 实例</span>
            <span class=n>invoker</span> <span class=o>=</span> <span class=n>refprotocol</span><span class=p>.</span><span class=na>refer</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>,</span> <span class=n>urls</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=mi>0</span><span class=p>));</span>

        <span class=c1>// 多个注册中心或多个服务提供者，或者两者混合</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=n>List</span><span class=o>&lt;</span><span class=n>Invoker</span><span class=o>&lt;?&gt;&gt;</span> <span class=n>invokers</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Invoker</span><span class=o>&lt;?&gt;&gt;</span><span class=p>();</span>
            <span class=n>URL</span> <span class=n>registryURL</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>

            <span class=c1>// 获取所有的 Invoker</span>
            <span class=k>for</span> <span class=p>(</span><span class=n>URL</span> <span class=n>url</span> <span class=p>:</span> <span class=n>urls</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// 通过 refprotocol 调用 refer 构建 Invoker，refprotocol 会在运行时</span>
                <span class=c1>// 根据 url 协议头加载指定的 Protocol 实例，并调用实例的 refer 方法</span>
                <span class=n>invokers</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>refprotocol</span><span class=p>.</span><span class=na>refer</span><span class=p>(</span><span class=n>interfaceClass</span><span class=p>,</span> <span class=n>url</span><span class=p>));</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REGISTRY_PROTOCOL</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getProtocol</span><span class=p>()))</span> <span class=p>{</span>
                    <span class=n>registryURL</span> <span class=o>=</span> <span class=n>url</span><span class=p>;</span>
                <span class=p>}</span>
            <span class=p>}</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>registryURL</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// 如果注册中心链接不为空，则将使用 AvailableCluster</span>
                <span class=n>URL</span> <span class=n>u</span> <span class=o>=</span> <span class=n>registryURL</span><span class=p>.</span><span class=na>addParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CLUSTER_KEY</span><span class=p>,</span> <span class=n>AvailableCluster</span><span class=p>.</span><span class=na>NAME</span><span class=p>);</span>
                <span class=c1>// 创建 StaticDirectory 实例，并由 Cluster 对多个 Invoker 进行合并</span>
                <span class=n>invoker</span> <span class=o>=</span> <span class=n>cluster</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=k>new</span> <span class=n>StaticDirectory</span><span class=p>(</span><span class=n>u</span><span class=p>,</span> <span class=n>invokers</span><span class=p>));</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                <span class=n>invoker</span> <span class=o>=</span> <span class=n>cluster</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=k>new</span> <span class=n>StaticDirectory</span><span class=p>(</span><span class=n>invokers</span><span class=p>));</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=n>Boolean</span> <span class=n>c</span> <span class=o>=</span> <span class=n>check</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>consumer</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>c</span> <span class=o>=</span> <span class=n>consumer</span><span class=p>.</span><span class=na>isCheck</span><span class=p>();</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>c</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=c1>// invoker 可用性检查</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>c</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>invoker</span><span class=p>.</span><span class=na>isAvailable</span><span class=p>())</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalStateException</span><span class=p>(</span><span class=s>&quot;No provider available for the service...&quot;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 生成代理类</span>
    <span class=k>return</span> <span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=n>proxyFactory</span><span class=p>.</span><span class=na>getProxy</span><span class=p>(</span><span class=n>invoker</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码很多，不过逻辑比较清晰。首先根据配置检查是否为本地调用，若是，则调用 InjvmProtocol 的 refer 方法生成 InjvmInvoker 实例。若不是，则读取直连配置项，或注册中心 url，并将读取到的 url 存储到 urls 中。然后根据 urls 元素数量进行后续操作。若 urls 元素数量为1，则直接通过 Protocol 自适应拓展类构建 Invoker 实例接口。若 urls 元素数量大于1，即存在多个注册中心或服务直连 url，此时先根据 url 构建 Invoker。然后再通过 Cluster 合并多个 Invoker，最后调用 ProxyFactory 生成代理类。Invoker 的构建过程以及代理类的过程比较重要，因此接下来将分两小节对这两个过程进行分析。</p> <h4 id=321-invoker>3.2.1 创建 Invoker<a class=headerlink href=#321-invoker title="Permanent link">&para;</a></h4> <p>Invoker 是 Dubbo 的核心模型，代表一个可执行体。在服务提供方，Invoker 用于调用服务提供类。在服务消费方，Invoker 用于执行远程调用。Invoker 是由 Protocol 实现类构建而来。Protocol 实现类有很多，本节会分析最常用的两个，分别是 RegistryProtocol 和 DubboProtocol，其他的大家自行分析。下面先来分析 DubboProtocol 的 refer 方法源码。如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>refer</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>serviceType</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RpcException</span> <span class=p>{</span>
    <span class=n>optimizeSerialization</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=c1>// 创建 DubboInvoker</span>
    <span class=n>DubboInvoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>invoker</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DubboInvoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>serviceType</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>getClients</span><span class=p>(</span><span class=n>url</span><span class=p>),</span> <span class=n>invokers</span><span class=p>);</span>
    <span class=n>invokers</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>invoker</span><span class=p>);</span>
    <span class=k>return</span> <span class=n>invoker</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>上面方法看起来比较简单，不过这里有一个调用需要我们注意一下，即 getClients。这个方法用于获取客户端实例，实例类型为 ExchangeClient。ExchangeClient 实际上并不具备通信能力，它需要基于更底层的客户端实例进行通信。比如 NettyClient、MinaClient 等，默认情况下，Dubbo 使用 NettyClient 进行通信。接下来，我们简单看一下 getClients 方法的逻辑。</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=n>ExchangeClient</span><span class=o>[]</span> <span class=nf>getClients</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 是否共享连接</span>
    <span class=kt>boolean</span> <span class=n>service_share_connect</span> <span class=o>=</span> <span class=kc>false</span><span class=p>;</span>
    <span class=c1>// 获取连接数，默认为0，表示未配置</span>
    <span class=kt>int</span> <span class=n>connections</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CONNECTIONS_KEY</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
    <span class=c1>// 如果未配置 connections，则共享连接</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>connections</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>service_share_connect</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
        <span class=n>connections</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=n>ExchangeClient</span><span class=o>[]</span> <span class=n>clients</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ExchangeClient</span><span class=o>[</span><span class=n>connections</span><span class=o>]</span><span class=p>;</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>clients</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>service_share_connect</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 获取共享客户端</span>
            <span class=n>clients</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>getSharedClient</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=c1>// 初始化新的客户端</span>
            <span class=n>clients</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>=</span> <span class=n>initClient</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>clients</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>这里根据 connections 数量决定是获取共享客户端还是创建新的客户端实例，默认情况下，使用共享客户端实例。getSharedClient 方法中也会调用 initClient 方法，因此下面我们一起看一下这两个方法。</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=n>ExchangeClient</span> <span class=nf>getSharedClient</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getAddress</span><span class=p>();</span>
    <span class=c1>// 获取带有“引用计数”功能的 ExchangeClient</span>
    <span class=n>ReferenceCountExchangeClient</span> <span class=n>client</span> <span class=o>=</span> <span class=n>referenceClientMap</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>client</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>client</span><span class=p>.</span><span class=na>isClosed</span><span class=p>())</span> <span class=p>{</span>
            <span class=c1>// 增加引用计数</span>
            <span class=n>client</span><span class=p>.</span><span class=na>incrementAndGetCount</span><span class=p>();</span>
            <span class=k>return</span> <span class=n>client</span><span class=p>;</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=n>referenceClientMap</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=n>locks</span><span class=p>.</span><span class=na>putIfAbsent</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=k>new</span> <span class=n>Object</span><span class=p>());</span>
    <span class=kd>synchronized</span> <span class=p>(</span><span class=n>locks</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>key</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>referenceClientMap</span><span class=p>.</span><span class=na>containsKey</span><span class=p>(</span><span class=n>key</span><span class=p>))</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>referenceClientMap</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=c1>// 创建 ExchangeClient 客户端</span>
        <span class=n>ExchangeClient</span> <span class=n>exchangeClient</span> <span class=o>=</span> <span class=n>initClient</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
        <span class=c1>// 将 ExchangeClient 实例传给 ReferenceCountExchangeClient，这里使用了装饰模式</span>
        <span class=n>client</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ReferenceCountExchangeClient</span><span class=p>(</span><span class=n>exchangeClient</span><span class=p>,</span> <span class=n>ghostClientMap</span><span class=p>);</span>
        <span class=n>referenceClientMap</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>client</span><span class=p>);</span>
        <span class=n>ghostClientMap</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
        <span class=n>locks</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
        <span class=k>return</span> <span class=n>client</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>上面方法先访问缓存，若缓存未命中，则通过 initClient 方法创建新的 ExchangeClient 实例，并将该实例传给 ReferenceCountExchangeClient 构造方法创建一个带有引用计数功能的 ExchangeClient 实例。ReferenceCountExchangeClient 内部实现比较简单，就不分析了。下面我们再来看一下 initClient 方法的代码。</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=n>ExchangeClient</span> <span class=nf>initClient</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>

    <span class=c1>// 获取客户端类型，默认为 netty</span>
    <span class=n>String</span> <span class=n>str</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CLIENT_KEY</span><span class=p>,</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>SERVER_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_REMOTING_CLIENT</span><span class=p>));</span>

    <span class=c1>// 添加编解码和心跳包参数到 url 中</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>addParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CODEC_KEY</span><span class=p>,</span> <span class=n>DubboCodec</span><span class=p>.</span><span class=na>NAME</span><span class=p>);</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>addParameterIfAbsent</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>HEARTBEAT_KEY</span><span class=p>,</span> <span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_HEARTBEAT</span><span class=p>));</span>

    <span class=c1>// 检测客户端类型是否存在，不存在则抛出异常</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>str</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>str</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>ExtensionLoader</span><span class=p>.</span><span class=na>getExtensionLoader</span><span class=p>(</span><span class=n>Transporter</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>hasExtension</span><span class=p>(</span><span class=n>str</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>RpcException</span><span class=p>(</span><span class=s>&quot;Unsupported client type: ...&quot;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=n>ExchangeClient</span> <span class=n>client</span><span class=p>;</span>
    <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// 获取 lazy 配置，并根据配置值决定创建的客户端类型</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>LAZY_CONNECT_KEY</span><span class=p>,</span> <span class=kc>false</span><span class=p>))</span> <span class=p>{</span>
            <span class=c1>// 创建懒加载 ExchangeClient 实例</span>
            <span class=n>client</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LazyConnectExchangeClient</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>requestHandler</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=c1>// 创建普通 ExchangeClient 实例</span>
            <span class=n>client</span> <span class=o>=</span> <span class=n>Exchangers</span><span class=p>.</span><span class=na>connect</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>requestHandler</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>RemotingException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>RpcException</span><span class=p>(</span><span class=s>&quot;Fail to create remoting client for service...&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>client</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>initClient 方法首先获取用户配置的客户端类型，默认为 netty。然后检测用户配置的客户端类型是否存在，不存在则抛出异常。最后根据 lazy 配置决定创建什么类型的客户端。这里的 LazyConnectExchangeClient 代码并不是很复杂，该类会在 request 方法被调用时通过 Exchangers 的 connect 方法创建 ExchangeClient 客户端，该类的代码本节就不分析了。下面我们分析一下 Exchangers 的 connect 方法。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>static</span> <span class=n>ExchangeClient</span> <span class=nf>connect</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ExchangeHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>url</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;url == null&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>handler</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;handler == null&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>addParameterIfAbsent</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CODEC_KEY</span><span class=p>,</span> <span class=s>&quot;exchange&quot;</span><span class=p>);</span>
    <span class=c1>// 获取 Exchanger 实例，默认为 HeaderExchangeClient</span>
    <span class=k>return</span> <span class=n>getExchanger</span><span class=p>(</span><span class=n>url</span><span class=p>).</span><span class=na>connect</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>handler</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>如上，getExchanger 会通过 SPI 加载 HeaderExchangeClient 实例，这个方法比较简单，大家自己看一下吧。接下来分析 HeaderExchangeClient 的实现。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>ExchangeClient</span> <span class=nf>connect</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ExchangeHandler</span> <span class=n>handler</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span> <span class=p>{</span>
    <span class=c1>// 这里包含了多个调用，分别如下：</span>
    <span class=c1>// 1. 创建 HeaderExchangeHandler 对象</span>
    <span class=c1>// 2. 创建 DecodeHandler 对象</span>
    <span class=c1>// 3. 通过 Transporters 构建 Client 实例</span>
    <span class=c1>// 4. 创建 HeaderExchangeClient 对象</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>HeaderExchangeClient</span><span class=p>(</span><span class=n>Transporters</span><span class=p>.</span><span class=na>connect</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=k>new</span> <span class=n>DecodeHandler</span><span class=p>(</span><span class=k>new</span> <span class=n>HeaderExchangeHandler</span><span class=p>(</span><span class=n>handler</span><span class=p>))),</span> <span class=kc>true</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>这里的调用比较多，我们这里重点看一下 Transporters 的 connect 方法。如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>static</span> <span class=n>Client</span> <span class=nf>connect</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ChannelHandler</span><span class=p>...</span> <span class=n>handlers</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>url</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;url == null&quot;</span><span class=p>);</span>
    <span class=p>}</span>
    <span class=n>ChannelHandler</span> <span class=n>handler</span><span class=p>;</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>handlers</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>||</span> <span class=n>handlers</span><span class=p>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>handler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ChannelHandlerAdapter</span><span class=p>();</span>
    <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>handlers</span><span class=p>.</span><span class=na>length</span> <span class=o>==</span> <span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>handler</span> <span class=o>=</span> <span class=n>handlers</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=c1>// 如果 handler 数量大于1，则创建一个 ChannelHandler 分发器</span>
        <span class=n>handler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ChannelHandlerDispatcher</span><span class=p>(</span><span class=n>handlers</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 获取 Transporter 自适应拓展类，并调用 connect 方法生成 Client 实例</span>
    <span class=k>return</span> <span class=n>getTransporter</span><span class=p>().</span><span class=na>connect</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>handler</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>如上，getTransporter 方法返回的是自适应拓展类，该类会在运行时根据客户端类型加载指定的 Transporter 实现类。若用户未配置客户端类型，则默认加载 NettyTransporter，并调用该类的 connect 方法。如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=n>Client</span> <span class=nf>connect</span><span class=p>(</span><span class=n>URL</span> <span class=n>url</span><span class=p>,</span> <span class=n>ChannelHandler</span> <span class=n>listener</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RemotingException</span> <span class=p>{</span>
    <span class=c1>// 创建 NettyClient 对象</span>
    <span class=k>return</span> <span class=k>new</span> <span class=n>NettyClient</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>listener</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>到这里就不继续跟下去了，在往下就是通过 Netty 提供的 API 构建 Netty 客户端了，大家有兴趣自己看看。到这里，关于 DubboProtocol 的 refer 方法就分析完了。接下来，继续分析 RegistryProtocol 的 refer 方法逻辑。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>refer</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>type</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RpcException</span> <span class=p>{</span>
    <span class=c1>// 取 registry 参数值，并将其设置为协议头</span>
    <span class=n>url</span> <span class=o>=</span> <span class=n>url</span><span class=p>.</span><span class=na>setProtocol</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REGISTRY_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>DEFAULT_REGISTRY</span><span class=p>)).</span><span class=na>removeParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REGISTRY_KEY</span><span class=p>);</span>
    <span class=c1>// 获取注册中心实例</span>
    <span class=n>Registry</span> <span class=n>registry</span> <span class=o>=</span> <span class=n>registryFactory</span><span class=p>.</span><span class=na>getRegistry</span><span class=p>(</span><span class=n>url</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>RegistryService</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>type</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>proxyFactory</span><span class=p>.</span><span class=na>getInvoker</span><span class=p>((</span><span class=n>T</span><span class=p>)</span> <span class=n>registry</span><span class=p>,</span> <span class=n>type</span><span class=p>,</span> <span class=n>url</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 将 url 查询字符串转为 Map</span>
    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>qs</span> <span class=o>=</span> <span class=n>StringUtils</span><span class=p>.</span><span class=na>parseQueryString</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getParameterAndDecoded</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REFER_KEY</span><span class=p>));</span>
    <span class=c1>// 获取 group 配置</span>
    <span class=n>String</span> <span class=n>group</span> <span class=o>=</span> <span class=n>qs</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>GROUP_KEY</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>group</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>group</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>((</span><span class=n>Constants</span><span class=p>.</span><span class=na>COMMA_SPLIT_PATTERN</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=n>group</span><span class=p>)).</span><span class=na>length</span> <span class=o>&gt;</span> <span class=mi>1</span>
                <span class=o>||</span> <span class=s>&quot;*&quot;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>group</span><span class=p>))</span> <span class=p>{</span>
            <span class=c1>// 通过 SPI 加载 MergeableCluster 实例，并调用 doRefer 继续执行服务引用逻辑</span>
            <span class=k>return</span> <span class=n>doRefer</span><span class=p>(</span><span class=n>getMergeableCluster</span><span class=p>(),</span> <span class=n>registry</span><span class=p>,</span> <span class=n>type</span><span class=p>,</span> <span class=n>url</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=c1>// 调用 doRefer 继续执行服务引用逻辑</span>
    <span class=k>return</span> <span class=n>doRefer</span><span class=p>(</span><span class=n>cluster</span><span class=p>,</span> <span class=n>registry</span><span class=p>,</span> <span class=n>type</span><span class=p>,</span> <span class=n>url</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码首先为 url 设置协议头，然后根据 url 参数加载注册中心实例。然后获取 group 配置，根据 group 配置决定 doRefer 第一个参数的类型。这里的重点是 doRefer 方法，如下：</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=nf>doRefer</span><span class=p>(</span><span class=n>Cluster</span> <span class=n>cluster</span><span class=p>,</span> <span class=n>Registry</span> <span class=n>registry</span><span class=p>,</span> <span class=n>Class</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>type</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 创建 RegistryDirectory 实例</span>
    <span class=n>RegistryDirectory</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>directory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>RegistryDirectory</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span><span class=p>(</span><span class=n>type</span><span class=p>,</span> <span class=n>url</span><span class=p>);</span>
    <span class=c1>// 设置注册中心和协议</span>
    <span class=n>directory</span><span class=p>.</span><span class=na>setRegistry</span><span class=p>(</span><span class=n>registry</span><span class=p>);</span>
    <span class=n>directory</span><span class=p>.</span><span class=na>setProtocol</span><span class=p>(</span><span class=n>protocol</span><span class=p>);</span>
    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>parameters</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>String</span><span class=o>&gt;</span><span class=p>(</span><span class=n>directory</span><span class=p>.</span><span class=na>getUrl</span><span class=p>().</span><span class=na>getParameters</span><span class=p>());</span>
    <span class=c1>// 生成服务消费者链接</span>
    <span class=n>URL</span> <span class=n>subscribeUrl</span> <span class=o>=</span> <span class=k>new</span> <span class=n>URL</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CONSUMER_PROTOCOL</span><span class=p>,</span> <span class=n>parameters</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REGISTER_IP_KEY</span><span class=p>),</span> <span class=mi>0</span><span class=p>,</span> <span class=n>type</span><span class=p>.</span><span class=na>getName</span><span class=p>(),</span> <span class=n>parameters</span><span class=p>);</span>

    <span class=c1>// 注册服务消费者，在 consumers 目录下新节点</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>Constants</span><span class=p>.</span><span class=na>ANY_VALUE</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getServiceInterface</span><span class=p>())</span>
            <span class=o>&amp;&amp;</span> <span class=n>url</span><span class=p>.</span><span class=na>getParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>REGISTER_KEY</span><span class=p>,</span> <span class=kc>true</span><span class=p>))</span> <span class=p>{</span>
        <span class=n>registry</span><span class=p>.</span><span class=na>register</span><span class=p>(</span><span class=n>subscribeUrl</span><span class=p>.</span><span class=na>addParameters</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CATEGORY_KEY</span><span class=p>,</span> <span class=n>Constants</span><span class=p>.</span><span class=na>CONSUMERS_CATEGORY</span><span class=p>,</span>
                <span class=n>Constants</span><span class=p>.</span><span class=na>CHECK_KEY</span><span class=p>,</span> <span class=n>String</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=kc>false</span><span class=p>)));</span>
    <span class=p>}</span>

    <span class=c1>// 订阅 providers、configurators、routers 等节点数据</span>
    <span class=n>directory</span><span class=p>.</span><span class=na>subscribe</span><span class=p>(</span><span class=n>subscribeUrl</span><span class=p>.</span><span class=na>addParameter</span><span class=p>(</span><span class=n>Constants</span><span class=p>.</span><span class=na>CATEGORY_KEY</span><span class=p>,</span>
            <span class=n>Constants</span><span class=p>.</span><span class=na>PROVIDERS_CATEGORY</span>
                    <span class=o>+</span> <span class=s>&quot;,&quot;</span> <span class=o>+</span> <span class=n>Constants</span><span class=p>.</span><span class=na>CONFIGURATORS_CATEGORY</span>
                    <span class=o>+</span> <span class=s>&quot;,&quot;</span> <span class=o>+</span> <span class=n>Constants</span><span class=p>.</span><span class=na>ROUTERS_CATEGORY</span><span class=p>));</span>

    <span class=c1>// 一个注册中心可能有多个服务提供者，因此这里需要将多个服务提供者合并为一个</span>
    <span class=n>Invoker</span> <span class=n>invoker</span> <span class=o>=</span> <span class=n>cluster</span><span class=p>.</span><span class=na>join</span><span class=p>(</span><span class=n>directory</span><span class=p>);</span>
    <span class=n>ProviderConsumerRegTable</span><span class=p>.</span><span class=na>registerConsumer</span><span class=p>(</span><span class=n>invoker</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>subscribeUrl</span><span class=p>,</span> <span class=n>directory</span><span class=p>);</span>
    <span class=k>return</span> <span class=n>invoker</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>如上，doRefer 方法创建一个 RegistryDirectory 实例，然后生成服务者消费者链接，并向注册中心进行注册。注册完毕后，紧接着订阅 providers、configurators、routers 等节点下的数据。完成订阅后，RegistryDirectory 会收到这几个节点下的子节点信息。由于一个服务可能部署在多台服务器上，这样就会在 providers 产生多个节点，这个时候就需要 Cluster 将多个服务节点合并为一个，并生成一个 Invoker。关于 RegistryDirectory 和 Cluster，本文不打算进行分析，相关分析将会在随后的文章中展开。</p> <h4 id=322>3.2.2 创建代理<a class=headerlink href=#322 title="Permanent link">&para;</a></h4> <p>Invoker 创建完毕后，接下来要做的事情是为服务接口生成代理对象。有了代理对象，即可进行远程调用。代理对象生成的入口方法为 ProxyFactory 的 getProxy，接下来进行分析。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>T</span> <span class=nf>getProxy</span><span class=p>(</span><span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>invoker</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RpcException</span> <span class=p>{</span>
    <span class=c1>// 调用重载方法</span>
    <span class=k>return</span> <span class=n>getProxy</span><span class=p>(</span><span class=n>invoker</span><span class=p>,</span> <span class=kc>false</span><span class=p>);</span>
<span class=p>}</span>

<span class=kd>public</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>T</span> <span class=nf>getProxy</span><span class=p>(</span><span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>invoker</span><span class=p>,</span> <span class=kt>boolean</span> <span class=n>generic</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>RpcException</span> <span class=p>{</span>
    <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>interfaces</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
    <span class=c1>// 获取接口列表</span>
    <span class=n>String</span> <span class=n>config</span> <span class=o>=</span> <span class=n>invoker</span><span class=p>.</span><span class=na>getUrl</span><span class=p>().</span><span class=na>getParameter</span><span class=p>(</span><span class=s>&quot;interfaces&quot;</span><span class=p>);</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>config</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>config</span><span class=p>.</span><span class=na>length</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
        <span class=c1>// 切分接口列表</span>
        <span class=n>String</span><span class=o>[]</span> <span class=n>types</span> <span class=o>=</span> <span class=n>Constants</span><span class=p>.</span><span class=na>COMMA_SPLIT_PATTERN</span><span class=p>.</span><span class=na>split</span><span class=p>(</span><span class=n>config</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>types</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>types</span><span class=p>.</span><span class=na>length</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>interfaces</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Class</span><span class=o>&lt;?&gt;[</span><span class=n>types</span><span class=p>.</span><span class=na>length</span> <span class=o>+</span> <span class=mi>2</span><span class=o>]</span><span class=p>;</span>
            <span class=c1>// 设置服务接口类和 EchoService.class 到 interfaces 中</span>
            <span class=n>interfaces</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=o>=</span> <span class=n>invoker</span><span class=p>.</span><span class=na>getInterface</span><span class=p>();</span>
            <span class=n>interfaces</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span> <span class=o>=</span> <span class=n>EchoService</span><span class=p>.</span><span class=na>class</span><span class=p>;</span>
            <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>types</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// 加载接口类</span>
                <span class=n>interfaces</span><span class=o>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=o>]</span> <span class=o>=</span> <span class=n>ReflectUtils</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=n>types</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span>
            <span class=p>}</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>interfaces</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>interfaces</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Class</span><span class=o>&lt;?&gt;[]</span><span class=p>{</span><span class=n>invoker</span><span class=p>.</span><span class=na>getInterface</span><span class=p>(),</span> <span class=n>EchoService</span><span class=p>.</span><span class=na>class</span><span class=p>};</span>
    <span class=p>}</span>

    <span class=c1>// 为 http 和 hessian 协议提供泛化调用支持，参考 pull request #1827</span>
    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>invoker</span><span class=p>.</span><span class=na>getInterface</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=n>GenericService</span><span class=p>.</span><span class=na>class</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>generic</span><span class=p>)</span> <span class=p>{</span>
        <span class=kt>int</span> <span class=n>len</span> <span class=o>=</span> <span class=n>interfaces</span><span class=p>.</span><span class=na>length</span><span class=p>;</span>
        <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>temp</span> <span class=o>=</span> <span class=n>interfaces</span><span class=p>;</span>
        <span class=c1>// 创建新的 interfaces 数组</span>
        <span class=n>interfaces</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Class</span><span class=o>&lt;?&gt;[</span><span class=n>len</span> <span class=o>+</span> <span class=mi>1</span><span class=o>]</span><span class=p>;</span>
        <span class=n>System</span><span class=p>.</span><span class=na>arraycopy</span><span class=p>(</span><span class=n>temp</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>interfaces</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>len</span><span class=p>);</span>
        <span class=c1>// 设置 GenericService.class 到数组中</span>
        <span class=n>interfaces</span><span class=o>[</span><span class=n>len</span><span class=o>]</span> <span class=o>=</span> <span class=n>GenericService</span><span class=p>.</span><span class=na>class</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=c1>// 调用重载方法</span>
    <span class=k>return</span> <span class=n>getProxy</span><span class=p>(</span><span class=n>invoker</span><span class=p>,</span> <span class=n>interfaces</span><span class=p>);</span>
<span class=p>}</span>

<span class=kd>public</span> <span class=kd>abstract</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>T</span> <span class=nf>getProxy</span><span class=p>(</span><span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>invoker</span><span class=p>,</span> <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>types</span><span class=p>);</span>
</code></pre></div> <p>如上，上面大段代码都是用来获取 interfaces 数组的，我们继续往下看。getProxy(Invoker, Class&lt;?&gt;[]) 这个方法是一个抽象方法，下面我们到 JavassistProxyFactory 类中看一下该方法的实现代码。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>T</span> <span class=nf>getProxy</span><span class=p>(</span><span class=n>Invoker</span><span class=o>&lt;</span><span class=n>T</span><span class=o>&gt;</span> <span class=n>invoker</span><span class=p>,</span> <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>interfaces</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 生成 Proxy 子类（Proxy 是抽象类）。并调用 Proxy 子类的 newInstance 方法创建 Proxy 实例</span>
    <span class=k>return</span> <span class=p>(</span><span class=n>T</span><span class=p>)</span> <span class=n>Proxy</span><span class=p>.</span><span class=na>getProxy</span><span class=p>(</span><span class=n>interfaces</span><span class=p>).</span><span class=na>newInstance</span><span class=p>(</span><span class=k>new</span> <span class=n>InvokerInvocationHandler</span><span class=p>(</span><span class=n>invoker</span><span class=p>));</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码并不多，首先是通过 Proxy 的 getProxy 方法获取 Proxy 子类，然后创建 InvokerInvocationHandler 对象，并将该对象传给 newInstance 生成 Proxy 实例。InvokerInvocationHandler 实现 JDK 的 InvocationHandler 接口，具体的用途是拦截接口类调用。该类逻辑比较简单，这里就不分析了。下面我们重点关注一下 Proxy 的 getProxy 方法，如下。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>static</span> <span class=n>Proxy</span> <span class=nf>getProxy</span><span class=p>(</span><span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=p>...</span> <span class=n>ics</span><span class=p>)</span> <span class=p>{</span>
    <span class=c1>// 调用重载方法</span>
    <span class=k>return</span> <span class=n>getProxy</span><span class=p>(</span><span class=n>ClassHelper</span><span class=p>.</span><span class=na>getClassLoader</span><span class=p>(</span><span class=n>Proxy</span><span class=p>.</span><span class=na>class</span><span class=p>),</span> <span class=n>ics</span><span class=p>);</span>
<span class=p>}</span>

<span class=kd>public</span> <span class=kd>static</span> <span class=n>Proxy</span> <span class=nf>getProxy</span><span class=p>(</span><span class=n>ClassLoader</span> <span class=n>cl</span><span class=p>,</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span><span class=p>...</span> <span class=n>ics</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>if</span> <span class=p>(</span><span class=n>ics</span><span class=p>.</span><span class=na>length</span> <span class=o>&gt;</span> <span class=mi>65535</span><span class=p>)</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;interface limit exceeded&quot;</span><span class=p>);</span>

    <span class=n>StringBuilder</span> <span class=n>sb</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>();</span>
    <span class=c1>// 遍历接口列表</span>
    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>ics</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>String</span> <span class=n>itf</span> <span class=o>=</span> <span class=n>ics</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getName</span><span class=p>();</span>
        <span class=c1>// 检测类型是否为接口</span>
        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>ics</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>isInterface</span><span class=p>())</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>itf</span> <span class=o>+</span> <span class=s>&quot; is not a interface.&quot;</span><span class=p>);</span>

        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>tmp</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=c1>// 重新加载接口类</span>
            <span class=n>tmp</span> <span class=o>=</span> <span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=n>itf</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=n>cl</span><span class=p>);</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>ClassNotFoundException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=p>}</span>

        <span class=c1>// 检测接口是否相同，这里 tmp 有可能为空</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>tmp</span> <span class=o>!=</span> <span class=n>ics</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>)</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=n>ics</span><span class=o>[</span><span class=n>i</span><span class=o>]</span> <span class=o>+</span> <span class=s>&quot; is not visible from class loader&quot;</span><span class=p>);</span>

        <span class=c1>// 拼接接口全限定名，分隔符为 ;</span>
        <span class=n>sb</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=n>itf</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=sc>&#39;;&#39;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=c1>// 使用拼接后的接口名作为 key</span>
    <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>sb</span><span class=p>.</span><span class=na>toString</span><span class=p>();</span>

    <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>Object</span><span class=o>&gt;</span> <span class=n>cache</span><span class=p>;</span>
    <span class=kd>synchronized</span> <span class=p>(</span><span class=n>ProxyCacheMap</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>cache</span> <span class=o>=</span> <span class=n>ProxyCacheMap</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>cl</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>cache</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=n>cache</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashMap</span><span class=o>&lt;</span><span class=n>String</span><span class=p>,</span> <span class=n>Object</span><span class=o>&gt;</span><span class=p>();</span>
            <span class=n>ProxyCacheMap</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>cl</span><span class=p>,</span> <span class=n>cache</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

    <span class=n>Proxy</span> <span class=n>proxy</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
    <span class=kd>synchronized</span> <span class=p>(</span><span class=n>cache</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>do</span> <span class=p>{</span>
            <span class=c1>// 从缓存中获取 Reference&lt;Proxy&gt; 实例</span>
            <span class=n>Object</span> <span class=n>value</span> <span class=o>=</span> <span class=n>cache</span><span class=p>.</span><span class=na>get</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>value</span> <span class=k>instanceof</span> <span class=n>Reference</span><span class=o>&lt;?&gt;</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>proxy</span> <span class=o>=</span> <span class=p>(</span><span class=n>Proxy</span><span class=p>)</span> <span class=p>((</span><span class=n>Reference</span><span class=o>&lt;?&gt;</span><span class=p>)</span> <span class=n>value</span><span class=p>).</span><span class=na>get</span><span class=p>();</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>proxy</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                    <span class=k>return</span> <span class=n>proxy</span><span class=p>;</span>
                <span class=p>}</span>
            <span class=p>}</span>

            <span class=c1>// 并发控制，保证只有一个线程可以进行后续操作</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>value</span> <span class=o>==</span> <span class=n>PendingGenerationMarker</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>try</span> <span class=p>{</span>
                    <span class=c1>// 其他线程在此处进行等待</span>
                    <span class=n>cache</span><span class=p>.</span><span class=na>wait</span><span class=p>();</span>
                <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
                <span class=p>}</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                <span class=c1>// 放置标志位到缓存中，并跳出 while 循环进行后续操作</span>
                <span class=n>cache</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>PendingGenerationMarker</span><span class=p>);</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>
        <span class=k>while</span> <span class=p>(</span><span class=kc>true</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kt>long</span> <span class=n>id</span> <span class=o>=</span> <span class=n>PROXY_CLASS_COUNTER</span><span class=p>.</span><span class=na>getAndIncrement</span><span class=p>();</span>
    <span class=n>String</span> <span class=n>pkg</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
    <span class=n>ClassGenerator</span> <span class=n>ccp</span> <span class=o>=</span> <span class=kc>null</span><span class=p>,</span> <span class=n>ccm</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
    <span class=k>try</span> <span class=p>{</span>
        <span class=c1>// 创建 ClassGenerator 对象</span>
        <span class=n>ccp</span> <span class=o>=</span> <span class=n>ClassGenerator</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=n>cl</span><span class=p>);</span>

        <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>worked</span> <span class=o>=</span> <span class=k>new</span> <span class=n>HashSet</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span><span class=p>();</span>
        <span class=n>List</span><span class=o>&lt;</span><span class=n>Method</span><span class=o>&gt;</span> <span class=n>methods</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>Method</span><span class=o>&gt;</span><span class=p>();</span>

        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>ics</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// 检测接口访问级别是否为 protected 或 privete</span>
            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>Modifier</span><span class=p>.</span><span class=na>isPublic</span><span class=p>(</span><span class=n>ics</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>()))</span> <span class=p>{</span>
                <span class=c1>// 获取接口包名</span>
                <span class=n>String</span> <span class=n>npkg</span> <span class=o>=</span> <span class=n>ics</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getPackage</span><span class=p>().</span><span class=na>getName</span><span class=p>();</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>pkg</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                    <span class=n>pkg</span> <span class=o>=</span> <span class=n>npkg</span><span class=p>;</span>
                <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>pkg</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>npkg</span><span class=p>))</span>
                        <span class=c1>// 非 public 级别的接口必须在同一个包下，否者抛出异常</span>
                        <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=p>(</span><span class=s>&quot;non-public interfaces from different packages&quot;</span><span class=p>);</span>
                <span class=p>}</span>
            <span class=p>}</span>

            <span class=c1>// 添加接口到 ClassGenerator 中</span>
            <span class=n>ccp</span><span class=p>.</span><span class=na>addInterface</span><span class=p>(</span><span class=n>ics</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span>

            <span class=c1>// 遍历接口方法</span>
            <span class=k>for</span> <span class=p>(</span><span class=n>Method</span> <span class=n>method</span> <span class=p>:</span> <span class=n>ics</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>.</span><span class=na>getMethods</span><span class=p>())</span> <span class=p>{</span>
                <span class=c1>// 获取方法描述，可理解为方法签名</span>
                <span class=n>String</span> <span class=n>desc</span> <span class=o>=</span> <span class=n>ReflectUtils</span><span class=p>.</span><span class=na>getDesc</span><span class=p>(</span><span class=n>method</span><span class=p>);</span>
                <span class=c1>// 如果方法描述字符串已在 worked 中，则忽略。考虑这种情况，</span>
                <span class=c1>// A 接口和 B 接口中包含一个完全相同的方法</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>worked</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>desc</span><span class=p>))</span>
                    <span class=k>continue</span><span class=p>;</span>
                <span class=n>worked</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>desc</span><span class=p>);</span>

                <span class=kt>int</span> <span class=n>ix</span> <span class=o>=</span> <span class=n>methods</span><span class=p>.</span><span class=na>size</span><span class=p>();</span>
                <span class=c1>// 获取方法返回值类型</span>
                <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>rt</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getReturnType</span><span class=p>();</span>
                <span class=c1>// 获取参数列表</span>
                <span class=n>Class</span><span class=o>&lt;?&gt;[]</span> <span class=n>pts</span> <span class=o>=</span> <span class=n>method</span><span class=p>.</span><span class=na>getParameterTypes</span><span class=p>();</span>

                <span class=c1>// 生成 Object[] args = new Object[1...N]</span>
                <span class=n>StringBuilder</span> <span class=n>code</span> <span class=o>=</span> <span class=k>new</span> <span class=n>StringBuilder</span><span class=p>(</span><span class=s>&quot;Object[] args = new Object[&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>pts</span><span class=p>.</span><span class=na>length</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;];&quot;</span><span class=p>);</span>
                <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>pts</span><span class=p>.</span><span class=na>length</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span>
                    <span class=c1>// 生成 args[1...N] = ($w)$1...N;</span>
                    <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; args[&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>j</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;] = ($w)$&quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>j</span> <span class=o>+</span> <span class=mi>1</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;;&quot;</span><span class=p>);</span>
                <span class=c1>// 生成 InvokerHandler 接口的 invoker 方法调用语句，如下：</span>
                <span class=c1>// Object ret = handler.invoke(this, methods[1...N], args);</span>
                <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; Object ret = handler.invoke(this, methods[&quot;</span> <span class=o>+</span> <span class=n>ix</span> <span class=o>+</span> <span class=s>&quot;], args);&quot;</span><span class=p>);</span>

                <span class=c1>// 返回值不为 void</span>
                <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>Void</span><span class=p>.</span><span class=na>TYPE</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>rt</span><span class=p>))</span>
                    <span class=c1>// 生成返回语句，形如 return (java.lang.String) ret;</span>
                    <span class=n>code</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&quot; return &quot;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>asArgument</span><span class=p>(</span><span class=n>rt</span><span class=p>,</span> <span class=s>&quot;ret&quot;</span><span class=p>)).</span><span class=na>append</span><span class=p>(</span><span class=s>&quot;;&quot;</span><span class=p>);</span>

                <span class=n>methods</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>method</span><span class=p>);</span>
                <span class=c1>// 添加方法名、访问控制符、参数列表、方法代码等信息到 ClassGenerator 中 </span>
                <span class=n>ccp</span><span class=p>.</span><span class=na>addMethod</span><span class=p>(</span><span class=n>method</span><span class=p>.</span><span class=na>getName</span><span class=p>(),</span> <span class=n>method</span><span class=p>.</span><span class=na>getModifiers</span><span class=p>(),</span> <span class=n>rt</span><span class=p>,</span> <span class=n>pts</span><span class=p>,</span> <span class=n>method</span><span class=p>.</span><span class=na>getExceptionTypes</span><span class=p>(),</span> <span class=n>code</span><span class=p>.</span><span class=na>toString</span><span class=p>());</span>
            <span class=p>}</span>
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>pkg</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
            <span class=n>pkg</span> <span class=o>=</span> <span class=n>PACKAGE_NAME</span><span class=p>;</span>

        <span class=c1>// 构建接口代理类名称：pkg + &quot;.proxy&quot; + id，比如 org.apache.dubbo.proxy0</span>
        <span class=n>String</span> <span class=n>pcn</span> <span class=o>=</span> <span class=n>pkg</span> <span class=o>+</span> <span class=s>&quot;.proxy&quot;</span> <span class=o>+</span> <span class=n>id</span><span class=p>;</span>
        <span class=n>ccp</span><span class=p>.</span><span class=na>setClassName</span><span class=p>(</span><span class=n>pcn</span><span class=p>);</span>
        <span class=n>ccp</span><span class=p>.</span><span class=na>addField</span><span class=p>(</span><span class=s>&quot;public static java.lang.reflect.Method[] methods;&quot;</span><span class=p>);</span>
        <span class=c1>// 生成 private java.lang.reflect.InvocationHandler handler;</span>
        <span class=n>ccp</span><span class=p>.</span><span class=na>addField</span><span class=p>(</span><span class=s>&quot;private &quot;</span> <span class=o>+</span> <span class=n>InvocationHandler</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot; handler;&quot;</span><span class=p>);</span>

        <span class=c1>// 为接口代理类添加带有 InvocationHandler 参数的构造方法，比如：</span>
        <span class=c1>// porxy0(java.lang.reflect.InvocationHandler arg0) {</span>
        <span class=c1>//     handler=$1;</span>
        <span class=c1>// }</span>
        <span class=n>ccp</span><span class=p>.</span><span class=na>addConstructor</span><span class=p>(</span><span class=n>Modifier</span><span class=p>.</span><span class=na>PUBLIC</span><span class=p>,</span> <span class=k>new</span> <span class=n>Class</span><span class=o>&lt;?&gt;[]</span><span class=p>{</span><span class=n>InvocationHandler</span><span class=p>.</span><span class=na>class</span><span class=p>},</span> <span class=k>new</span> <span class=n>Class</span><span class=o>&lt;?&gt;[</span><span class=mi>0</span><span class=o>]</span><span class=p>,</span> <span class=s>&quot;handler=$1;&quot;</span><span class=p>);</span>
        <span class=c1>// 为接口代理类添加默认构造方法</span>
        <span class=n>ccp</span><span class=p>.</span><span class=na>addDefaultConstructor</span><span class=p>();</span>

        <span class=c1>// 生成接口代理类</span>
        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>clazz</span> <span class=o>=</span> <span class=n>ccp</span><span class=p>.</span><span class=na>toClass</span><span class=p>();</span>
        <span class=n>clazz</span><span class=p>.</span><span class=na>getField</span><span class=p>(</span><span class=s>&quot;methods&quot;</span><span class=p>).</span><span class=na>set</span><span class=p>(</span><span class=kc>null</span><span class=p>,</span> <span class=n>methods</span><span class=p>.</span><span class=na>toArray</span><span class=p>(</span><span class=k>new</span> <span class=n>Method</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>));</span>

        <span class=c1>// 构建 Proxy 子类名称，比如 Proxy1，Proxy2 等</span>
        <span class=n>String</span> <span class=n>fcn</span> <span class=o>=</span> <span class=n>Proxy</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=n>id</span><span class=p>;</span>
        <span class=n>ccm</span> <span class=o>=</span> <span class=n>ClassGenerator</span><span class=p>.</span><span class=na>newInstance</span><span class=p>(</span><span class=n>cl</span><span class=p>);</span>
        <span class=n>ccm</span><span class=p>.</span><span class=na>setClassName</span><span class=p>(</span><span class=n>fcn</span><span class=p>);</span>
        <span class=n>ccm</span><span class=p>.</span><span class=na>addDefaultConstructor</span><span class=p>();</span>
        <span class=n>ccm</span><span class=p>.</span><span class=na>setSuperClass</span><span class=p>(</span><span class=n>Proxy</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
        <span class=c1>// 为 Proxy 的抽象方法 newInstance 生成实现代码，形如：</span>
        <span class=c1>// public Object newInstance(java.lang.reflect.InvocationHandler h) { </span>
        <span class=c1>//     return new org.apache.dubbo.proxy0($1);</span>
        <span class=c1>// }</span>
        <span class=n>ccm</span><span class=p>.</span><span class=na>addMethod</span><span class=p>(</span><span class=s>&quot;public Object newInstance(&quot;</span> <span class=o>+</span> <span class=n>InvocationHandler</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot; h){ return new &quot;</span> <span class=o>+</span> <span class=n>pcn</span> <span class=o>+</span> <span class=s>&quot;($1); }&quot;</span><span class=p>);</span>
        <span class=c1>// 生成 Proxy 实现类</span>
        <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>pc</span> <span class=o>=</span> <span class=n>ccm</span><span class=p>.</span><span class=na>toClass</span><span class=p>();</span>
        <span class=c1>// 通过反射创建 Proxy 实例</span>
        <span class=n>proxy</span> <span class=o>=</span> <span class=p>(</span><span class=n>Proxy</span><span class=p>)</span> <span class=n>pc</span><span class=p>.</span><span class=na>newInstance</span><span class=p>();</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>RuntimeException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=n>e</span><span class=p>;</span>
    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>throw</span> <span class=k>new</span> <span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>.</span><span class=na>getMessage</span><span class=p>(),</span> <span class=n>e</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>finally</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>ccp</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span>
            <span class=c1>// 释放资源</span>
            <span class=n>ccp</span><span class=p>.</span><span class=na>release</span><span class=p>();</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>ccm</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span>
            <span class=n>ccm</span><span class=p>.</span><span class=na>release</span><span class=p>();</span>
        <span class=kd>synchronized</span> <span class=p>(</span><span class=n>cache</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>proxy</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
                <span class=n>cache</span><span class=p>.</span><span class=na>remove</span><span class=p>(</span><span class=n>key</span><span class=p>);</span>
            <span class=k>else</span>
                <span class=c1>// 写缓存</span>
                <span class=n>cache</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=k>new</span> <span class=n>WeakReference</span><span class=o>&lt;</span><span class=n>Proxy</span><span class=o>&gt;</span><span class=p>(</span><span class=n>proxy</span><span class=p>));</span>
            <span class=c1>// 唤醒其他等待线程</span>
            <span class=n>cache</span><span class=p>.</span><span class=na>notifyAll</span><span class=p>();</span>
        <span class=p>}</span>
    <span class=p>}</span>
    <span class=k>return</span> <span class=n>proxy</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div> <p>上面代码比较复杂，我们写了大量的注释。大家在阅读这段代码时，要搞清楚 ccp 和 ccm 的用途，不然会被搞晕。ccp 用于为服务接口生成代理类，比如我们有一个 DemoService 接口，这个接口代理类就是由 ccp 生成的。ccm 则是用于为 org.apache.dubbo.common.bytecode.Proxy 抽象类生成子类，主要是实现 Proxy 类的抽象方法。下面以 org.apache.dubbo.demo.DemoService 这个接口为例，来看一下该接口代理类代码大致是怎样的（忽略 EchoService 接口）。</p> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>org.apache.dubbo.common.bytecode</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>proxy0</span> <span class=kd>implements</span> <span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>demo</span><span class=p>.</span><span class=na>DemoService</span> <span class=p>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>Method</span><span class=o>[]</span> <span class=n>methods</span><span class=p>;</span>

    <span class=kd>private</span> <span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>InvocationHandler</span> <span class=n>handler</span><span class=p>;</span>

    <span class=kd>public</span> <span class=nf>proxy0</span><span class=p>()</span> <span class=p>{</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=nf>proxy0</span><span class=p>(</span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>reflect</span><span class=p>.</span><span class=na>InvocationHandler</span> <span class=n>arg0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>handler</span> <span class=o>=</span> <span class=n>$1</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span> <span class=nf>sayHello</span><span class=p>(</span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span> <span class=n>arg0</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>Object</span><span class=o>[]</span> <span class=n>args</span> <span class=o>=</span> <span class=k>new</span> <span class=n>Object</span><span class=o>[</span><span class=mi>1</span><span class=o>]</span><span class=p>;</span>
        <span class=n>args</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>$w</span><span class=p>)</span> <span class=n>$1</span><span class=p>;</span>
        <span class=n>Object</span> <span class=n>ret</span> <span class=o>=</span> <span class=n>handler</span><span class=p>.</span><span class=na>invoke</span><span class=p>(</span><span class=k>this</span><span class=p>,</span> <span class=n>methods</span><span class=o>[</span><span class=mi>0</span><span class=o>]</span><span class=p>,</span> <span class=n>args</span><span class=p>);</span>
        <span class=k>return</span> <span class=p>(</span><span class=n>java</span><span class=p>.</span><span class=na>lang</span><span class=p>.</span><span class=na>String</span><span class=p>)</span> <span class=n>ret</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>好了，到这里代理类生成逻辑就分析完了。整个过程比较复杂，大家需要耐心看一下。</p> <h2 id=4>4.总结<a class=headerlink href=#4 title="Permanent link">&para;</a></h2> <p>本篇文章对服务引用的过程进行了较为详尽的分析，还有一些逻辑暂时没有分析到，比如 Directory、Cluster。这些接口及实现类功能比较独立，后续会单独成文进行分析。暂时我们可以先把这些类看成黑盒，只要知道这些类的用途即可。关于服务引用过程就分析到这里。</p> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/squidfunk target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://gitter.im/squidfunk/mkdocs-material target=_blank rel=noopener title=gitter.im class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"/></svg> </a> <a href=https://hub.docker.com/r/squidfunk/mkdocs-material/ target=_blank rel=noopener title=hub.docker.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=https://twitter.com/squidfunk target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/squidfunk/ target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://instagram.com/squidfunk target=_blank rel=noopener title=instagram.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../../../assets/javascripts/vendor.c3dc8c49.min.js></script> <script src=../../../../assets/javascripts/bundle.30071cf1.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script> <script>
        app = initialize({
          base: "../../../..",
          features: ["tabs", "search.highlight"],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.8e2cddea.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>