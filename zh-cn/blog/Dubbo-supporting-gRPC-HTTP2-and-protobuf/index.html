<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Apache Dubbo™ 是一款微服务框架（Microservices Framework），它提供高性能 RPC 通信、服务发现、流量管理等服务治理能力，为你提供构建大规模微服务集群所需的全套解决方案。"><link rel="shortcut icon" href=../../assets/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.1.0"><title>Dubbo 在跨语言和协议穿透性方向上的探索：支持 HTTP/2 gRPC 和 Protobuf - Apache Dubbo</title><link rel=stylesheet href=../../assets/stylesheets/main.bc7e593a.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.ab28b872.min.css><meta name=theme-color content=#4051b5><link rel=stylesheet href=../../css/dropdown.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#dubbo-http2-grpc-protobuf class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Application header --> <header class=md-header data-md-component=header> <!-- Top-level navigation --> <nav class="md-header-nav md-grid" aria-label=Header> <!-- Link to home --> <a href=../.. title="Apache Dubbo" class="md-header-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> <!-- Button to open drawer --> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <!-- Header title --> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Apache Dubbo </span> <span class="md-header-nav__topic md-ellipsis"> Dubbo 在跨语言和协议穿透性方向上的探索：支持 HTTP/2 gRPC 和 Protobuf </span> </div> </div> <!-- Button to open search dialogue --> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div> <div class=langChange id=translate title=中文|English> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"> <path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"/> </svg> </div> <script>
    var translate = document.getElementById('translate');
    translate.addEventListener('click', changeHref, false);
    function changeHref() {
        if (window.location.href.search('en-us') !== -1) {
            var changeHref = window.location.href.replace('en-us', 'zh-cn');

        } else {
            var changeHref = window.location.href.replace('zh-cn', 'en-us');
        }
        window.location.href = changeHref
    }
</script> <style>
    .langChange {
        display: inline-block;
        width: 2.4rem;
        height: 2.4rem;
        vertical-align: middle;
        margin-left: .5rem;
    }

    .langChange svg {
        fill: rgba(255, 255, 255, 0.548);
        display: block;
        width: 1.2rem;
        height: 1.2rem;
        margin: 0 auto;
        margin-top: .6rem;
        margin-left: .6rem;
    }

    .langChange :hover {
        fill: white;
        cursor: pointer;
    }
</style> </div> <!-- Repository containing source --> <div class=md-header-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Main navigation --> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <!-- Site title --> <label class=md-nav__title for=__drawer> <a href=../.. title="Apache Dubbo" class="md-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> Apache Dubbo </label> <!-- Repository containing source --> <div class=md-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <!-- Render item list --> <ul class=md-nav__list data-md-scrollfix> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../.. title=首页 class=md-nav__link> 首页 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 2.7 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=2.7 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 2.7 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/preface/requirements/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/quick-start/ title=快速启动 class=md-nav__link> 快速启动 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/dependencies/ title=依赖 class=md-nav__link> 依赖 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/maturity/ title=成熟度 class=md-nav__link> 成熟度 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-5 type=checkbox id=nav-1-1-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-5> 配置 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=配置 data-md-level=3> <label class=md-nav__title for=nav-1-1-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/xml/ title="XML 配置" class=md-nav__link> XML 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/api/ title="API 配置" class=md-nav__link> API 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/annotation/ title="Annotation 配置" class=md-nav__link> Annotation 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/annotation/ title=动态配置中心 class=md-nav__link> 动态配置中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/configuration-load-process/ title=配置加载流程 class=md-nav__link> 配置加载流程 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/environment-variables/ title=自动加载环境变量 class=md-nav__link> 自动加载环境变量 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-6 type=checkbox id=nav-1-1-6> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-6> 示例 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=示例 data-md-level=3> <label class=md-nav__title for=nav-1-1-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 示例 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/preflight-check/ title=启动时检查 class=md-nav__link> 启动时检查 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/fault-tolerent-strategy/ title=集群容错 class=md-nav__link> 集群容错 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/loadbalance/ title=负载均衡 class=md-nav__link> 负载均衡 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/thread-model/ title=线程模型 class=md-nav__link> 线程模型 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/explicit-target/ title=直连提供者 class=md-nav__link> 直连提供者 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/subscribe-only/ title=只订阅 class=md-nav__link> 只订阅 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/registry-only/ title=只注册 class=md-nav__link> 只注册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/static-service/ title=静态服务 class=md-nav__link> 静态服务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/multi-protocols/ title=多协议 class=md-nav__link> 多协议 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/multi-registry/ title=多注册中心 class=md-nav__link> 多注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/service-group/ title=服务分组 class=md-nav__link> 服务分组 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/multi-versions/ title=多版本 class=md-nav__link> 多版本 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/group-merger/ title=分组聚合 class=md-nav__link> 分组聚合 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/parameter-validation/ title=参数验证 class=md-nav__link> 参数验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/result-cache/ title=结果缓存 class=md-nav__link> 结果缓存 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/generic-reference/ title=泛化引用 class=md-nav__link> 泛化引用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/generic-service/ title=泛化实现 class=md-nav__link> 泛化实现 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/echo-service/ title=回声测试 class=md-nav__link> 回声测试 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/context/ title=上下文信息 class=md-nav__link> 上下文信息 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/attachment/ title=隐式参数 class=md-nav__link> 隐式参数 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/async-call/ title=异步调用 class=md-nav__link> 异步调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/async-execute-on-provider/ title=服务端异步 class=md-nav__link> 服务端异步 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/local-call/ title=本地调用 class=md-nav__link> 本地调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/callback-parameter/ title=参数回调 class=md-nav__link> 参数回调 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/events-notify/ title=事件通知 class=md-nav__link> 事件通知 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/local-stub/ title=本地存根 class=md-nav__link> 本地存根 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/local-mock/ title=本地伪装 class=md-nav__link> 本地伪装 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/delay-publish/ title=延迟暴露 class=md-nav__link> 延迟暴露 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/concurrency-control/ title=并发控制 class=md-nav__link> 并发控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/config-connection.md title=连接控制 class=md-nav__link> 连接控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/lazy-connect/ title=延迟连接 class=md-nav__link> 延迟连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/stickiness/ title=粘滞连接 class=md-nav__link> 粘滞连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/token-authorization/ title=令牌验证 class=md-nav__link> 令牌验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/routing-rule/ title=路由规则 class=md-nav__link> 路由规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/config-rule/ title=配置规则 class=md-nav__link> 配置规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/service-downgrade/ title=服务降级 class=md-nav__link> 服务降级 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/graceful-shutdown/ title=优雅停机 class=md-nav__link> 优雅停机 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/hostname-binding/ title=主机绑定 class=md-nav__link> 主机绑定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/logger-strategy/ title=日志适配 class=md-nav__link> 日志适配 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/accesslog/ title=访问日志 class=md-nav__link> 访问日志 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/service-container/ title=服务容器 class=md-nav__link> 服务容器 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/distributed-transaction/ title=分布式事务 class=md-nav__link> 分布式事务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/dump/ title=线程栈自动dump class=md-nav__link> 线程栈自动dump </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/netty4/ title=Netty4 class=md-nav__link> Netty4 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/serialization/ title=Kryo和FST序列化 class=md-nav__link> Kryo和FST序列化 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/simplify-registry-data/ title=简化注册中心URL class=md-nav__link> 简化注册中心URL </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/api.md title="API 参考手册" class=md-nav__link> API 参考手册 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-7 type=checkbox id=nav-1-1-7> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-7> schema 配置参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="schema 配置参考手册" data-md-level=3> <label class=md-nav__title for=nav-1-1-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> schema 配置参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-service/ title=dubbo:service class=md-nav__link> dubbo:service </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-reference/ title=dubbo:reference class=md-nav__link> dubbo:reference </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-protocol/ title=dubbo:protocol class=md-nav__link> dubbo:protocol </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-registry/ title=dubbo:registry class=md-nav__link> dubbo:registry </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-monitor/ title=dubbo:monitor class=md-nav__link> dubbo:monitor </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-application/ title=dubbo:application class=md-nav__link> dubbo:application </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-module/ title=dubbo:module class=md-nav__link> dubbo:module </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-provider/ title=dubbo:provider class=md-nav__link> dubbo:provider </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-consumer/ title=dubbo:consumer class=md-nav__link> dubbo:consumer </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-method/ title=dubbo:method class=md-nav__link> dubbo:method </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-argument/ title=dubbo:argument class=md-nav__link> dubbo:argument </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-parameter/ title=dubbo:parameter class=md-nav__link> dubbo:parameter </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-config-center/ title=dubbo:config-center class=md-nav__link> dubbo:config-center </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-8 type=checkbox id=nav-1-1-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-8> 协议参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=协议参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 协议参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/dubbo/ title=dubbo:// class=md-nav__link> dubbo:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/rmi/ title=rmi:// class=md-nav__link> rmi:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/hessian/ title=hessian:// class=md-nav__link> hessian:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/http/ title=http:// class=md-nav__link> http:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/thrift/ title=thrift:// class=md-nav__link> thrift:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/rest/ title=rest:// class=md-nav__link> rest:// </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-9 type=checkbox id=nav-1-1-9> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-9> 注册中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=注册中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 注册中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/registry/multicast/ title="Multicast 注册中心" class=md-nav__link> Multicast 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/registry/zookeeper/ title="Zookeeper 注册中心" class=md-nav__link> Zookeeper 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/registry/redis/ title="Redis 注册中心" class=md-nav__link> Redis 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/registry/simple/ title="Simple 注册中心" class=md-nav__link> Simple 注册中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-10 type=checkbox id=nav-1-1-10> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-10> 元数据中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=元数据中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-10> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 元数据中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/metadata/metadata-redis/ title="Redis 元数据中心" class=md-nav__link> Redis 元数据中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/metadata/metadata-zookeeper/ title="Zookeeper 元数据中心" class=md-nav__link> Zookeeper 元数据中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/telnet/ title="telnet 命令参考手册" class=md-nav__link> telnet 命令参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/qos/ title=在线运维命令-QOS class=md-nav__link> 在线运维命令-QOS </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/maven/ title="maven 插件参考手册" class=md-nav__link> maven 插件参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/best-practice/ title=服务化最佳实践 class=md-nav__link> 服务化最佳实践 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/recommend/ title=推荐用法 class=md-nav__link> 推荐用法 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/capacity-plan/ title=容量规划 class=md-nav__link> 容量规划 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/perf-test/ title=性能测试报告 class=md-nav__link> 性能测试报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/covergence.md title=测试覆盖率报告 class=md-nav__link> 测试覆盖率报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-19 type=checkbox id=nav-1-1-19> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-19> 版本与升级 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=版本与升级 data-md-level=3> <label class=md-nav__title for=nav-1-1-19> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 版本与升级 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/versions/version-270/ title=2.7.x升级步骤及注意事项 class=md-nav__link> 2.7.x升级步骤及注意事项 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2> 开发手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=开发手册 data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 开发手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/build.md title=源码构建 class=md-nav__link> 源码构建 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/design.md title=框架设计 class=md-nav__link> 框架设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/SPI.md title=扩展点加载 class=md-nav__link> 扩展点加载 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/implementation.md title=实现细节 class=md-nav__link> 实现细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-5 type=checkbox id=nav-1-2-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-5> SPI 扩展实现 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="SPI 扩展实现" data-md-level=3> <label class=md-nav__title for=nav-1-2-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> SPI 扩展实现 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/protocol.md title=协议扩展 class=md-nav__link> 协议扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/filter.md title=调用拦截扩展 class=md-nav__link> 调用拦截扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/invoker-listener.md title=引用监听扩展 class=md-nav__link> 引用监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/exporter-listener.md title=暴露监听扩展 class=md-nav__link> 暴露监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/cluster.md title=集群扩展 class=md-nav__link> 集群扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/router.md title=路由扩展 class=md-nav__link> 路由扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/load-balance.md title=负载均衡扩展 class=md-nav__link> 负载均衡扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/merger.md title=合并结果扩展 class=md-nav__link> 合并结果扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/registry.md title=注册中心扩展 class=md-nav__link> 注册中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/monitor.md title=监控中心扩展 class=md-nav__link> 监控中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/extension-factory.md title=扩展点加载扩展 class=md-nav__link> 扩展点加载扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/proxy-factory.md title=动态代理扩展 class=md-nav__link> 动态代理扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/compiler.md title=编译器扩展 class=md-nav__link> 编译器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/dispatcher.md title=消息派发扩展 class=md-nav__link> 消息派发扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/threadpool.md title=线程池扩展 class=md-nav__link> 线程池扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/serialize.md title=序列化扩展 class=md-nav__link> 序列化扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/remoting.md title=网络传输扩展 class=md-nav__link> 网络传输扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/exchanger.md title=信息交换扩展 class=md-nav__link> 信息交换扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/networker.md title=组网扩展 class=md-nav__link> 组网扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/telnet-handler.md title="Telnet 命令扩展" class=md-nav__link> Telnet 命令扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/status-checker.md title=状态检查扩展 class=md-nav__link> 状态检查扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/container.md title=容器扩展 class=md-nav__link> 容器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/page.md title=页面扩展 class=md-nav__link> 页面扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/cache.md title=缓存扩展 class=md-nav__link> 缓存扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/validation.md title=验证扩展 class=md-nav__link> 验证扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/logger-adapter.md title=日志适配扩展 class=md-nav__link> 日志适配扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/config-center.md title=配置中心 class=md-nav__link> 配置中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/contract.md title=公共契约 class=md-nav__link> 公共契约 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/coding.md title=编码约定 class=md-nav__link> 编码约定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-8 type=checkbox id=nav-1-2-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-8> 设计原则 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=设计原则 data-md-level=3> <label class=md-nav__title for=nav-1-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 设计原则 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/code-detail.md title=魔鬼在细节 class=md-nav__link> 魔鬼在细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/general-knowledge.md title=一些设计上的基本常识 class=md-nav__link> 一些设计上的基本常识 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/expansibility.md title=谈谈扩充式扩展与增量式扩展 class=md-nav__link> 谈谈扩充式扩展与增量式扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/configuration.md title=配置设计 class=md-nav__link> 配置设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/robustness.md title=设计实现的健壮性 class=md-nav__link> 设计实现的健壮性 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/dummy.md title=防痴呆设计 class=md-nav__link> 防痴呆设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/extension.md title=扩展点重构 class=md-nav__link> 扩展点重构 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/release.md title=版本发布 class=md-nav__link> 版本发布 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/contribution.md title=贡献代码 class=md-nav__link> 贡献代码 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/checklist.md title=检查列表 class=md-nav__link> 检查列表 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/code-smell.md title=坏味道 class=md-nav__link> 坏味道 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/TCK.md title=兼容性测试 class=md-nav__link> 兼容性测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-3> 管理者文档 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=管理者文档 data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 管理者文档 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../admin/introduction.md title="Dubbo Admin介绍" class=md-nav__link> Dubbo Admin介绍 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../admin/serviceSearch.md title=服务搜索和详情 class=md-nav__link> 服务搜索和详情 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../admin/serviceGovernance.md title=服务治理 class=md-nav__link> 服务治理 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../admin/serviceTest.md title=服务测试 class=md-nav__link> 服务测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 3.0 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=3.0 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 3.0 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/3.0/user/preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/3.0/user/preface/background/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/3.0/user/preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/3.0/user/preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 博客 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=博客 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 博客 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../apache-dubbo-2019-2020/ title="2019-2020 回顾" class=md-nav__link> 2019-2020 回顾 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 开发者指南 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=开发者指南 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 开发者指南 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../developers/developers_dev/ title=开发者指引 class=md-nav__link> 开发者指引 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 基本介绍 </a> <nav class=md-nav aria-label=基本介绍> <ul class=md-nav__list> <li class=md-nav__item> <a href=#dubbo class=md-nav__link> Dubbo 协议 </a> </li> <li class=md-nav__item> <a href=#http1 class=md-nav__link> HTTP/1 </a> </li> <li class=md-nav__item> <a href=#http2 class=md-nav__link> HTTP/2 </a> </li> <li class=md-nav__item> <a href=#grpc class=md-nav__link> gRPC </a> </li> <li class=md-nav__item> <a href=#protobuf class=md-nav__link> Protobuf </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#dubbo_1 class=md-nav__link> Dubbo 所做的支持 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 示例 </a> <nav class=md-nav aria-label=示例> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-dubbo-grpc class=md-nav__link> 示例 1，使用 Dubbo 开发 gRPC 服务 </a> <nav class=md-nav aria-label="示例 1，使用 Dubbo 开发 gRPC 服务"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-idl class=md-nav__link> 1. 定义服务 IDL </a> </li> <li class=md-nav__item> <a href=#2-pcompiler-stub class=md-nav__link> 2. PCompiler 生成 Stub </a> </li> <li class=md-nav__item> <a href=#3 class=md-nav__link> 3. 业务逻辑开发 </a> </li> <li class=md-nav__item> <a href=#4-provider-dubbo class=md-nav__link> 4. Provider 端暴露 Dubbo 服务 </a> </li> <li class=md-nav__item> <a href=#5-dubbo class=md-nav__link> 5. 引用 Dubbo 服务 </a> </li> <li class=md-nav__item> <a href=#1 class=md-nav__link> 示例1附：高级用法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-protobuf-dubbo class=md-nav__link> 示例 2， 使用 Protobuf 开发 Dubbo 服务 </a> <nav class=md-nav aria-label="示例 2， 使用 Protobuf 开发 Dubbo 服务"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1_1 class=md-nav__link> 1. 定义服务 </a> </li> <li class=md-nav__item> <a href=#2-compiler class=md-nav__link> 2. Compiler 编译服务 </a> </li> <li class=md-nav__item> <a href=#3_1 class=md-nav__link> 3. 开发业务逻辑 </a> </li> <li class=md-nav__item> <a href=#4-provider class=md-nav__link> 4. 配置 Provider </a> </li> <li class=md-nav__item> <a href=#5-consumer class=md-nav__link> 5. 配置 Consumer </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/apache/dubbo-website/edit/master/zh-cn/blog/Dubbo-supporting-gRPC-HTTP2-and-protobuf.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=dubbo-http2-grpc-protobuf>Dubbo 在跨语言和协议穿透性方向上的探索：支持 HTTP/2 gRPC 和 Protobuf<a class=headerlink href=#dubbo-http2-grpc-protobuf title="Permanent link">&para;</a></h1> <p>本文整理自刘军在 Dubbo 成都 meetup 上分享的《Dubbo 在多语言和协议穿透性方向上的探索》。</p> <p>本文总体上可分为基础产品简介、Dubbo 对 gRPC (HTTP/2) 和 Protobuf 的支持及示例演示三部分，在简介部分介绍了 Dubbo、HTTP/2、gRPC、Protobuf 的基本概念和特点；第二部分介绍了 Dubbo 为何要支持 gRPC (HTTP/2) 和 Protobuf，以及这种支持为 gRPC 和 Dubbo 开发带来的好处与不同；第三部分通过两个实例分别演示了 Dubbo gRPC 和 Dubbo Protobuf 的使用方式。</p> <h2 id=_1>基本介绍<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <h3 id=dubbo>Dubbo 协议<a class=headerlink href=#dubbo title="Permanent link">&para;</a></h3> <p>从协议层面展开，以下是当前 2.7 版本支持的 Dubbo 协议</p> <p><img alt=image-20191029103919557 src=img/blog/grpc/dubbo-ptotocol.png></p> <p>众所周知，Dubbo 协议是直接定义在 TCP 传输层协议之上，由于 TCP 高可靠全双工的特点，为 Dubbo 协议的定义提供了最大的灵活性，但同时也正是因为这样的灵活性，RPC 协议普遍都是定制化的私有协议，Dubbo 同样也面临这个问题。在这里我们着重讲一下 Dubbo 在协议通用性方面值得改进的地方，关于协议详细解析请参见<a href=http://dubbo.apache.org/zh-cn/blog/dubbo-protocol.html>官网博客</a></p> <ul> <li>Dubbo 协议体 Body 中有一个可扩展的 attachments 部分，这给 RPC 方法之外额外传递附加属性提供了可能，是一个很好的设计。但是类似的 Header 部分，却缺少类似的可扩展 attachments，这点可参考 HTTP 定义的 Ascii Header 设计，将 Body Attachments 和 Header Attachments 做职责划分。</li> <li>Body 协议体中的一些 RPC 请求定位符如 Service Name、Method Name、Version 等，可以提到 Header 中，和具体的序列化协议解耦，以更好的被网络基础设施识别或用于流量管控。</li> <li>扩展性不够好，欠缺协议升级方面的设计，如 Header 头中没有预留的状态标识位，或者像 HTTP 有专为协议升级或协商设计的特殊 packet。</li> <li>在 Java 版本的代码实现上，不够精简和通用。如在链路传输中，存在一些语言绑定的内容；消息体中存在冗余内容，如 Service Name 在 Body 和 Attachments 中都存在。</li> </ul> <h3 id=http1>HTTP/1<a class=headerlink href=#http1 title="Permanent link">&para;</a></h3> <p>相比于直接构建与 TPC 传输层的私有 RPC 协议，构建于 HTTP 之上的远程调用解决方案会有更好的通用性，如WebServices 或 REST 架构，使用 HTTP + JSON 可以说是一个事实标准的解决方案。</p> <p>之所有选择构建在 HTTP 之上，我认为有两个最大的优势：</p> <ol> <li>HTTP 的语义和可扩展性能很好的满足 RPC 调用需求。</li> <li>通用性，HTTP 协议几乎被网络上的所有设备所支持，具有很好的协议穿透性。</li> </ol> <p><img alt=image-20191029113404906 src=../../img/blog/grpc/http1.png></p> <p>具体来说，HTTP/1 的优势和限制是：</p> <ul> <li> <p>典型的 Request – Response 模型，一个链路上一次只能有一个等待的 Request 请求</p> </li> <li> <p>HTTP/1 支持 Keep-Alive 链接，避免了链接重复创建开销</p> </li> <li> <p>Human Readable Headers，使用更通用、更易于人类阅读的头部传输格式</p> </li> <li> <p>无直接 Server Push 支持，需要使用 Polling Long-Polling 等变通模式</p> </li> </ul> <h3 id=http2>HTTP/2<a class=headerlink href=#http2 title="Permanent link">&para;</a></h3> <p>HTTP/2 保留了 HTTP/1 的所有语义，在保持兼容的同时，在通信模型和传输效率上做了很大的改进。</p> <p><img alt=image-20191029113416731 src=../../img/blog/grpc/http2.png></p> <ul> <li> <p>支持单条链路上的 Multiplexing，相比于 Request - Response 独占链路，基于 Frame 实现更高效利用链路</p> </li> <li> <p>Request - Stream 语义，原生支持 Server Push 和 Stream 数据传输</p> </li> <li> <p>Flow Control，单条 Stream 粒度的和整个链路粒度的流量控制</p> </li> <li> <p>头部压缩 HPACK</p> </li> <li> <p>Binary Frame</p> </li> <li> <p>原生 TLS 支持</p> </li> </ul> <h3 id=grpc>gRPC<a class=headerlink href=#grpc title="Permanent link">&para;</a></h3> <p>上面提到了在 HTTP 及 TCP 协议之上构建 RPC 协议各自的优缺点，相比于 Dubbo 构建于 TPC 传输层之上，Google 选择将 gRPC 直接定义在 HTTP/2 协议之上，关于 gRPC 的 <a href="https://platformlab.stanford.edu/Seminar Talks/gRPC.pdf">基本介绍</a>和 <a href="https://grpc.io/blog/principles/?spm=ata.13261165.0.0.2be55017XbUhs8">设计愿景</a> 请参考以上两篇文章，我这里仅摘取 设计愿景 中几个能反映 gRPC 设计目的特性来做简单说明。</p> <ul> <li> <p>Coverage &amp; Simplicity，协议设计和框架实现要足够通用和简单，能运行在任何设备之上，甚至一些资源首先的如 IoT、Mobile 等设备。</p> </li> <li> <p>Interoperability &amp; Reach，要构建在更通用的协议之上，协议本身要能被网络上几乎所有的基础设施所支持。</p> </li> <li> <p>General Purpose &amp; Performant，要在场景和性能间做好平衡，首先协议本身要是适用于各种场景的，同时也要尽量有高的性能。</p> </li> <li> <p>Payload Agnostic，协议上传输的负载要保持语言和平台中立。</p> </li> <li> <p>Streaming，要支持 Request - Response、Request - Stream、Bi-Steam 等通信模型。</p> </li> <li> <p>Flow Control，协议自身具备流量感知和限制的能力。</p> </li> <li> <p>Metadata Exchange，在 RPC 服务定义之外，提供额外附加数据传输的能力。</p> </li> </ul> <p>总的来说，在这样的设计理念指导下，gRPC 最终被设计为一个跨语言、跨平台的、通用的、高性能的、基于 HTTP/2 的 RPC 协议和框架。</p> <h3 id=protobuf>Protobuf<a class=headerlink href=#protobuf title="Permanent link">&para;</a></h3> <p><a href=https://developers.google.com/protocol-buffers/docs/overview>Protocol buffers (Protobuf)</a> 是 Google 推出的一个跨平台、语言中立的结构化数据描述和序列化的产品，它定义了一套结构化数据定义的协议，同时也提供了相应的 <a href=https://github.com/protocolbuffers/protobuf/releases/tag/v3.10.0>Compiler</a> 工具，用来将语言中立的描述转化为相应语言的具体描述。</p> <p>它的一些特性包括：</p> <ul> <li> <p>跨语言 跨平台，语言中立的数据描述格式，默认提供了生成多种语言的 Compiler 工具。</p> </li> <li> <p>安全性，由于反序列化的范围和输出内容格式都是 Compiler 在编译时预生成的，因此绕过了类似 Java Deserialization Vulnarability 的问题。</p> </li> <li> <p>二进制 高性能</p> </li> <li> <p>强类型</p> </li> <li> <p>字段变更向后兼容</p> </li> </ul> <div class=highlight><pre><span></span><code><span class=nb>message</span> Person {
  required <span class=nb>string</span> name <span class=o>=</span> <span class=mi>1</span>;
  required int32 id <span class=o>=</span> <span class=mi>2</span>;
  optional <span class=nb>string</span> email <span class=o>=</span> <span class=mi>3</span>;

  enum PhoneType {
    MOBILE <span class=o>=</span> <span class=mi>0</span>;
    HOME <span class=o>=</span> <span class=mi>1</span>;
    WORK <span class=o>=</span> <span class=mi>2</span>;
  }

  <span class=nb>message</span> PhoneNumber {
    required <span class=nb>string</span> number <span class=o>=</span> <span class=mi>1</span>;
    optional PhoneType type <span class=o>=</span> <span class=mi>2</span> [default <span class=o>=</span> HOME];
  }

  repeated PhoneNumber phone <span class=o>=</span> <span class=mi>4</span>;
}
</code></pre></div> <p>除了结构化数据描述之外，Protobuf 还支持定义 RPC 服务，它允许我们定义一个 <code>.proto</code> 的服务描述文件，进而利用 Protobuf Compiler 工具生成特定语言和 RPC 框架的接口和 stub。后续将要具体讲到的 gRPC + Protobuf、Dubbo-gRPC + Protobuf 以及 Dubbo + Protobuf 都是通过定制 Compiler 类实现的。</p> <p><code>idl service SearchService { rpc Search (SearchRequest) returns (SearchResponse); }</code></p> <h2 id=dubbo_1>Dubbo 所做的支持<a class=headerlink href=#dubbo_1 title="Permanent link">&para;</a></h2> <p>跨语言的服务开发涉及到多个方面，从服务定义、RPC 协议到序列化协议都要做到语言中立，同时还针对每种语言有对应的 SDK 实现。虽然得益于社区的贡献，现在 Dubbo 在多语言 SDK 实现上逐步有了起色，已经提供了包括 Java, Go, PHP, C#, Python, NodeJs, C 等版本的客户端或全量实现版本，但在以上提到的跨语言友好型方面，以上三点还是有很多可改进之处。</p> <ul> <li> <p>协议，上面我们已经分析过 Dubbo 协议既有的缺点，如果能在 HTTP/2 之上构建应用层协议，则无疑能避免这些弊端，同时最大可能的提高协议的穿透性，避免网关等协议转换组件的存在，更有利于链路上的流量管控。考虑到 gRPC 是构建在 HTTP/2 之上，并且已经是云原生领域推荐的通信协议，Dubbo 在第一阶段选择了直接支持 gRPC 协议作为当前的 HTTP/2 解决方案。我们也知道 gRPC 框架自身的弊端在于易用性不足以及服务治理能力欠缺（这也是目前绝大多数厂商不会直接裸用 gRPC 框架的原因），通过将其集成进 Dubbo 框架，用户可以方便的使用 Dubbo 编程模型 + Dubbo 服务治理 + gRPC 协议通信的组合。</p> </li> <li> <p>服务定义，当前 Dubbo 的服务定义和具体的编程语言绑定，没有提供一种语言中立的服务描述格式，比如 Java 就是定义 Interface 接口，到了其他语言又得重新以另外的格式定义一遍。因此 Dubbo 通过支持 Protobuf 实现了语言中立的服务定义。</p> </li> <li>序列化，Dubbo 当前支持的序列化包括 Json、Hessian2、Kryo、FST、Java 等，而这其中支持跨语言的只有 Json、Hessian2，通用的 Json 有固有的性能问题，而 Hessian2 无论在效率还是多语言 SDK 方面都有所欠缺。为此，Dubbo 通过支持 Protobuf 序列化来提供更高效、易用的跨语言序列化方案。</li> </ul> <h2 id=_2>示例<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <h3 id=1-dubbo-grpc>示例 1，使用 Dubbo 开发 gRPC 服务<a class=headerlink href=#1-dubbo-grpc title="Permanent link">&para;</a></h3> <p><a href=https://grpc.io/ >gRPC</a> 是 Google 开源的构建在 HTTP/2 之上的一个 PRC 通信协议。Dubbo 依赖其灵活的协议扩展机制，增加了对 gRPC (HTTP/2) 协议的支持。</p> <p>目前的支持限定在 Dubbo Java 语言版本，后续 Go 语言或其他语言版本将会以类似方式提供支持。下面，通过一个<a href=https://github.com/apache/dubbo-samples/tree/master/dubbo-samples-grpc>简单的示例</a>来演示如何在 Dubbo 中使用 gRPC 协议通信。</p> <h4 id=1-idl>1. 定义服务 IDL<a class=headerlink href=#1-idl title="Permanent link">&para;</a></h4> <p>首先，通过标准的 Protobuf 协议定义服务如下：</p> <div class=highlight><pre><span></span><code>syntax <span class=o>=</span> <span class=s2>&quot;proto3&quot;</span>;

option java_multiple_files <span class=o>=</span> true;
option java_package <span class=o>=</span> <span class=s2>&quot;io.grpc.examples.helloworld&quot;</span>;
option java_outer_classname <span class=o>=</span> <span class=s2>&quot;HelloWorldProto&quot;</span>;
option objc_class_prefix <span class=o>=</span> <span class=s2>&quot;HLW&quot;</span>;

package helloworld;

<span class=o>//</span> The greeting service definition.
service Greeter {
  <span class=o>//</span> Sends a greeting
  rpc SayHello (HelloRequest) returns (HelloReply) {}
}

<span class=o>//</span> The request <span class=nb>message</span> containing the user&#39;s name.
<span class=nb>message</span> HelloRequest {
  <span class=nb>string</span> name <span class=o>=</span> <span class=mi>1</span>;
}

<span class=o>//</span> The response <span class=nb>message</span> containing the greetings
<span class=nb>message</span> HelloReply {
  <span class=nb>string</span> <span class=nb>message</span> <span class=o>=</span> <span class=mi>1</span>;
}
</code></pre></div> <p>在此，我们定义了一个只有一个方法 sayHello 的 Greeter 服务，同时定义了方法的入参和出参，</p> <h4 id=2-pcompiler-stub>2. PCompiler 生成 Stub<a class=headerlink href=#2-pcompiler-stub title="Permanent link">&para;</a></h4> <ol> <li>定义 Maven Protobuf Compiler 插件工具。这里我们扩展了 Protobuf 的 Compiler 工具，以用来生成 Dubbo 特有的 RPC stub，此当前以 Maven 插件的形式发布。</li> </ol> <div class=highlight><pre><span></span><code><span class=nt>&lt;plugin&gt;</span>
  <span class=nt>&lt;groupId&gt;</span>org.xolstice.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
  <span class=nt>&lt;artifactId&gt;</span>protobuf-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
  <span class=nt>&lt;version&gt;</span>0.5.1<span class=nt>&lt;/version&gt;</span>
  <span class=nt>&lt;configuration&gt;</span>
    <span class=nt>&lt;protocArtifact&gt;</span>com.google.protobuf:protoc:3.7.1:exe:${os.detected.classifier}  
    <span class=nt>&lt;/protocArtifact&gt;</span>
    <span class=nt>&lt;pluginId&gt;</span>dubbo-grpc-java<span class=nt>&lt;/pluginId&gt;</span>
    <span class=nt>&lt;pluginArtifact&gt;</span>org.apache.dubbo:protoc-gen-dubbo-java:1.19.0-SNAPSHOT:exe:${os.detected.classifier}<span class=nt>&lt;/pluginArtifact&gt;</span>
    <span class=nt>&lt;outputDirectory&gt;</span>build/generated/source/proto/main/java<span class=nt>&lt;/outputDirectory&gt;</span>
    <span class=nt>&lt;clearOutputDirectory&gt;</span>false<span class=nt>&lt;/clearOutputDirectory&gt;</span>
    <span class=nt>&lt;pluginParameter&gt;</span>grpc<span class=nt>&lt;/pluginParameter&gt;</span>
  <span class=nt>&lt;/configuration&gt;</span>
  <span class=nt>&lt;executions&gt;</span>
    <span class=nt>&lt;execution&gt;</span>
      <span class=nt>&lt;goals&gt;</span>
        <span class=nt>&lt;goal&gt;</span>compile<span class=nt>&lt;/goal&gt;</span>
        <span class=nt>&lt;goal&gt;</span>compile-custom<span class=nt>&lt;/goal&gt;</span>
      <span class=nt>&lt;/goals&gt;</span>
    <span class=nt>&lt;/execution&gt;</span>
  <span class=nt>&lt;/executions&gt;</span>
<span class=nt>&lt;/plugin&gt;</span>
</code></pre></div> <p>其中，</p> <p>pluginArtifact 指定了 Dubbo 定制版本的 Java Protobuf Compiler 插件，通过这个插件来在编译过程中生成 Dubbo 定制版本的 gRPC stub。 </p> <div class=highlight><pre><span></span><code> <span class=nt>&lt;pluginArtifact&gt;</span>org.apache.dubbo:protoc-gen-dubbo-java:1.19.0-SNAPSHOT:exe:${os.detected.classifier}<span class=nt>&lt;/pluginArtifact&gt;</span>
</code></pre></div> <p>由于 <code>protoc-gen-dubbo-java</code> 支持 gRPC 和 Dubbo 两种协议，可生成的 stub 类型，默认值是 gRPC，关于 dubbo 协议的使用可参见 <a href>使用 Protobuf 开发 Dubbo 服务</a>。</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;pluginParameter&gt;</span>grpc<span class=nt>&lt;/pluginParameter&gt;</span>
</code></pre></div> <ol> <li>生成 Java Bean 和 Dubbo-gRPC stub</li> </ol> <div class=highlight><pre><span></span><code><span class=c1># 运行以下 maven 命令</span>
$ mvn clean compile
</code></pre></div> <p>生成的 Stub 和消息类 如下： <img alt=image-20191026130516896 src=../../img/blog/grpc/compiler-classes.png></p> <p>重点关注 GreeterGrpc ，包含了所有 gRPC 标准的 stub 类/方法，同时增加了 Dubbo 特定的接口，之后 Provider 端的服务暴露和 Consumer 端的服务调用都将依赖这个接口。</p> <div class=highlight><pre><span></span><code><span class=cm>/**</span>
<span class=cm> * Code generated for Dubbo</span>
<span class=cm> */</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>IGreeter</span> <span class=p>{</span>

<span class=k>default</span> <span class=kd>public</span> <span class=n>io</span><span class=p>.</span><span class=na>grpc</span><span class=p>.</span><span class=na>examples</span><span class=p>.</span><span class=na>helloworld</span><span class=p>.</span><span class=na>HelloReply</span>    <span class=nf>sayHello</span><span class=p>(</span><span class=n>io</span><span class=p>.</span><span class=na>grpc</span><span class=p>.</span><span class=na>examples</span><span class=p>.</span><span class=na>helloworld</span><span class=p>.</span><span class=na>HelloRequest</span> <span class=n>request</span><span class=p>)</span> <span class=p>{</span>
   <span class=k>throw</span> <span class=k>new</span> <span class=n>UnsupportedOperationException</span><span class=p>(</span><span class=s>&quot;No need to override this method, extend XxxImplBase and override all methods it allows.&quot;</span><span class=p>);</span>
<span class=p>}</span>

<span class=k>default</span> <span class=kd>public</span> <span class=n>com</span><span class=p>.</span><span class=na>google</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>concurrent</span><span class=p>.</span><span class=na>ListenableFuture</span><span class=o>&lt;</span><span class=n>io</span><span class=p>.</span><span class=na>grpc</span><span class=p>.</span><span class=na>examples</span><span class=p>.</span><span class=na>helloworld</span><span class=p>.</span><span class=na>HelloReply</span><span class=o>&gt;</span> <span class=nf>sayHelloAsync</span><span class=p>(</span>
    <span class=n>io</span><span class=p>.</span><span class=na>grpc</span><span class=p>.</span><span class=na>examples</span><span class=p>.</span><span class=na>helloworld</span><span class=p>.</span><span class=na>HelloRequest</span> <span class=n>request</span><span class=p>)</span> <span class=p>{</span>
   <span class=k>throw</span> <span class=k>new</span> <span class=n>UnsupportedOperationException</span><span class=p>(</span><span class=s>&quot;No need to override this method, extend XxxImplBase and override all methods it allows.&quot;</span><span class=p>);</span>
<span class=p>}</span>

<span class=kd>public</span> <span class=kt>void</span> <span class=nf>sayHello</span><span class=p>(</span><span class=n>io</span><span class=p>.</span><span class=na>grpc</span><span class=p>.</span><span class=na>examples</span><span class=p>.</span><span class=na>helloworld</span><span class=p>.</span><span class=na>HelloRequest</span> <span class=n>request</span><span class=p>,</span>
    <span class=n>io</span><span class=p>.</span><span class=na>grpc</span><span class=p>.</span><span class=na>stub</span><span class=p>.</span><span class=na>StreamObserver</span><span class=o>&lt;</span><span class=n>io</span><span class=p>.</span><span class=na>grpc</span><span class=p>.</span><span class=na>examples</span><span class=p>.</span><span class=na>helloworld</span><span class=p>.</span><span class=na>HelloReply</span><span class=o>&gt;</span> <span class=n>responseObserver</span><span class=p>);</span>

<span class=p>}</span>
</code></pre></div> <h4 id=3>3. 业务逻辑开发<a class=headerlink href=#3 title="Permanent link">&para;</a></h4> <p>继承 <code>GreeterGrpc.GreeterImplBase</code> （来自第 2 步），编写业务逻辑，这点和原生 gRPC 是一致的。</p> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>org.apache.dubbo.samples.basic.impl</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>io.grpc.examples.helloworld.GreeterGrpc</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>io.grpc.examples.helloworld.HelloReply</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>io.grpc.examples.helloworld.HelloRequest</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>io.grpc.stub.StreamObserver</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>GrpcGreeterImpl</span> <span class=kd>extends</span> <span class=n>GreeterGrpc</span><span class=p>.</span><span class=na>GreeterImplBase</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>sayHello</span><span class=p>(</span><span class=n>HelloRequest</span> <span class=n>request</span><span class=p>,</span> <span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>HelloReply</span><span class=o>&gt;</span> <span class=n>responseObserver</span><span class=p>)</span>         <span class=p>{</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Received request from client.&quot;</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Executing thread is &quot;</span> <span class=o>+</span> <span class=n>Thread</span><span class=p>.</span><span class=na>currentThread</span><span class=p>().</span><span class=na>getName</span><span class=p>());</span>
        <span class=n>HelloReply</span> <span class=n>reply</span> <span class=o>=</span> <span class=n>HelloReply</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span>
          <span class=p>.</span><span class=na>setMessage</span><span class=p>(</span><span class=s>&quot;Hello &quot;</span> <span class=o>+</span>    <span class=n>request</span><span class=p>.</span><span class=na>getName</span><span class=p>()).</span><span class=na>build</span><span class=p>();</span>
        <span class=n>responseObserver</span><span class=p>.</span><span class=na>onNext</span><span class=p>(</span><span class=n>reply</span><span class=p>);</span>
        <span class=n>responseObserver</span><span class=p>.</span><span class=na>onCompleted</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <h4 id=4-provider-dubbo>4. Provider 端暴露 Dubbo 服务<a class=headerlink href=#4-provider-dubbo title="Permanent link">&para;</a></h4> <p>以 Spring XML 为例</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:application</span> <span class=na>name=</span><span class=s>&quot;demo-provider&quot;</span><span class=nt>/&gt;</span>

<span class=c>&lt;!-- 指定服务暴露协议为 gRPC --&gt;</span>
<span class=nt>&lt;dubbo:protocol</span> <span class=na>id=</span><span class=s>&quot;grpc&quot;</span> <span class=na>name=</span><span class=s>&quot;grpc&quot;</span><span class=nt>/&gt;</span>

<span class=nt>&lt;dubbo:registry</span> <span class=na>address=</span><span class=s>&quot;zookeeper://${zookeeper.address:127.0.0.1}:2181&quot;</span><span class=nt>/&gt;</span>

<span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&quot;greeter&quot;</span> <span class=na>class=</span><span class=s>&quot;org.apache.dubbo.samples.basic.impl.GrpcGreeterImpl&quot;</span><span class=nt>/&gt;</span>

<span class=c>&lt;!-- 指定 protoc-gen-dubbo-java 生成的接口 --&gt;</span>
<span class=nt>&lt;dubbo:service</span> <span class=na>interface=</span><span class=s>&quot;io.grpc.examples.helloworld.GreeterGrpc$IGreeter&quot;</span> <span class=na>ref=</span><span class=s>&quot;greeter&quot;</span> <span class=na>protocol=</span><span class=s>&quot;grpc&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
  <span class=n>ClassPathXmlApplicationContext</span> <span class=n>context</span> <span class=o>=</span>
    <span class=k>new</span> <span class=n>ClassPathXmlApplicationContext</span><span class=p>(</span><span class=s>&quot;spring/dubbo-demo-provider.xml&quot;</span><span class=p>);</span>
  <span class=n>context</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>

  <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;dubbo service started&quot;</span><span class=p>);</span>
  <span class=k>new</span> <span class=n>CountDownLatch</span><span class=p>(</span><span class=mi>1</span><span class=p>).</span><span class=na>await</span><span class=p>();</span>
<span class=p>}</span>
</code></pre></div> <h4 id=5-dubbo>5. 引用 Dubbo 服务<a class=headerlink href=#5-dubbo title="Permanent link">&para;</a></h4> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:application</span> <span class=na>name=</span><span class=s>&quot;demo-consumer&quot;</span><span class=nt>/&gt;</span>

<span class=nt>&lt;dubbo:registry</span> <span class=na>address=</span><span class=s>&quot;zookeeper://${zookeeper.address:127.0.0.1}:2181&quot;</span><span class=nt>/&gt;</span>

<span class=c>&lt;!-- 指定 protoc-gen-dubbo-java 生成的接口 --&gt;</span>
<span class=nt>&lt;dubbo:reference</span> <span class=na>id=</span><span class=s>&quot;greeter&quot;</span> <span class=na>interface=</span><span class=s>&quot;io.grpc.examples.helloworld.GreeterGrpc$IGreeter&quot;</span> <span class=na>protocol=</span><span class=s>&quot;grpc&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
  <span class=n>ClassPathXmlApplicationContext</span> <span class=n>context</span> <span class=o>=</span>
    <span class=k>new</span> <span class=n>ClassPathXmlApplicationContext</span><span class=p>(</span><span class=s>&quot;spring/dubbo-demo-consumer.xml&quot;</span><span class=p>);</span>
  <span class=n>context</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>

  <span class=n>GreeterGrpc</span><span class=p>.</span><span class=na>IGreeter</span> <span class=n>greeter</span> <span class=o>=</span> <span class=p>(</span><span class=n>GreeterGrpc</span><span class=p>.</span><span class=na>IGreeter</span><span class=p>)</span> <span class=n>context</span><span class=p>.</span><span class=na>getBean</span><span class=p>(</span><span class=s>&quot;greeter&quot;</span><span class=p>);</span>

  <span class=n>HelloReply</span> <span class=n>reply</span> <span class=o>=</span> <span class=n>greeter</span><span class=p>.</span><span class=na>sayHello</span><span class=p>(</span><span class=n>HelloRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>().</span><span class=na>setName</span><span class=p>(</span><span class=s>&quot;world!&quot;</span><span class=p>).</span><span class=na>build</span><span class=p>());</span>
  <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Result: &quot;</span> <span class=o>+</span> <span class=n>reply</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span>

  <span class=n>System</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>read</span><span class=p>();</span>
<span class=p>}</span>
</code></pre></div> <h4 id=1>示例1附：高级用法<a class=headerlink href=#1 title="Permanent link">&para;</a></h4> <p><strong>一、异步调用</strong></p> <p>再来看一遍 <code>protoc-gen-dubbo-java</code> 生成的接口：</p> <div class=highlight><pre><span></span><code><span class=cm>/**</span>
<span class=cm> * Code generated for Dubbo</span>
<span class=cm> */</span>
<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>IGreeter</span> <span class=p>{</span>
  <span class=k>default</span> <span class=kd>public</span> <span class=n>HelloReply</span> <span class=nf>sayHello</span><span class=p>(</span><span class=n>HelloRequest</span> <span class=n>request</span><span class=p>)</span> <span class=p>{</span>
     <span class=c1>// ......</span>
  <span class=p>}</span>
  <span class=k>default</span> <span class=kd>public</span> <span class=n>ListenableFuture</span><span class=o>&lt;</span><span class=n>HelloReply</span><span class=o>&gt;</span> <span class=nf>sayHelloAsync</span><span class=p>(</span><span class=n>HelloRequest</span> <span class=n>request</span><span class=p>)</span> <span class=p>{</span>
     <span class=c1>// ......</span>
  <span class=p>}</span>
  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>sayHello</span><span class=p>(</span><span class=n>HelloRequest</span> <span class=n>request</span><span class=p>,</span> <span class=n>StreamObserver</span><span class=o>&lt;</span><span class=n>HelloReply</span><span class=o>&gt;</span> <span class=n>responseObserver</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <p>这里为 sayHello 方法生成了三种类型的重载方法，分别用于同步调用、异步调用和流式调用，如果消费端要进行异步调用，直接调用 sayHelloAsync() 即可：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
    <span class=c1>// ...</span>
  <span class=n>GreeterGrpc</span><span class=p>.</span><span class=na>IGreeter</span> <span class=n>greeter</span> <span class=o>=</span> <span class=p>(</span><span class=n>GreeterGrpc</span><span class=p>.</span><span class=na>IGreeter</span><span class=p>)</span> <span class=n>context</span><span class=p>.</span><span class=na>getBean</span><span class=p>(</span><span class=s>&quot;greeter&quot;</span><span class=p>);</span>
  <span class=n>ListenableFuture</span><span class=o>&lt;</span><span class=n>HelloReply</span><span class=o>&gt;</span> <span class=n>future</span> <span class=o>=</span>   
        <span class=n>greeter</span><span class=p>.</span><span class=na>sayHAsyncello</span><span class=p>(</span><span class=n>HelloRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>().</span><span class=na>setName</span><span class=p>(</span><span class=s>&quot;world!&quot;</span><span class=p>).</span><span class=na>build</span><span class=p>());</span>
  <span class=c1>// ...</span>
<span class=p>}</span>
</code></pre></div> <p><strong>二、高级配置</strong></p> <p>由于当前实现方式是直接集成了 gRPC-java SDK，因此很多配置还没有和 Dubbo 侧对齐，或者还没有以 Dubbo 的配置形式开放，因此，为了提供最大的灵活性，我们直接把 gRPC-java 的配置接口暴露了出来。</p> <p>绝大多数场景下，你可能并不会用到以下扩展，因为它们更多的是对 gRPC 协议的拦截或者 HTTP/2 层面的配置。同时使用这些扩展点可能需要对 HTTP/2 或 gRPC 有基本的了解。</p> <p><strong>扩展点</strong></p> <p>目前支持的扩展点如下：</p> <ul> <li> <p>org.apache.dubbo.rpc.protocol.grpc.interceptors.ClientInterceptor</p> </li> <li> <p>org.apache.dubbo.rpc.protocol.grpc.interceptors.GrpcConfigurator</p> </li> <li> <p>org.apache.dubbo.rpc.protocol.grpc.interceptors.ServerInterceptor</p> </li> <li> <p>org.apache.dubbo.rpc.protocol.grpc.interceptors.ServerTransportFilter</p> </li> </ul> <p>GrpcConfigurator 是最通用的扩展点，我们以此为例来说明一下，其基本定义如下：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>GrpcConfigurator</span> <span class=p>{</span>
    <span class=c1>// 用来定制 gRPC NettyServerBuilder</span>
    <span class=k>default</span> <span class=n>NettyServerBuilder</span> <span class=nf>configureServerBuilder</span><span class=p>(</span><span class=n>NettyServerBuilder</span> <span class=n>builder</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>builder</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=c1>// 用来定制 gRPC NettyChannelBuilder</span>
    <span class=k>default</span> <span class=n>NettyChannelBuilder</span> <span class=nf>configureChannelBuilder</span><span class=p>(</span><span class=n>NettyChannelBuilder</span> <span class=n>builder</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>builder</span><span class=p>;</span>
    <span class=p>}</span>
    <span class=c1>// 用来定制 gRPC CallOptions, 定义某个服务在每次请求间传递数据</span>
    <span class=k>default</span> <span class=n>CallOptions</span> <span class=nf>configureCallOptions</span><span class=p>(</span><span class=n>CallOptions</span> <span class=n>options</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>options</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>以下是一个示例扩展实现：</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>MyGrpcConfigurator</span> <span class=kd>implements</span> <span class=n>GrpcConfigurator</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kd>final</span> <span class=n>ExecutorService</span> <span class=n>executor</span> <span class=o>=</span> <span class=n>Executors</span>
            <span class=p>.</span><span class=na>newFixedThreadPool</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=k>new</span> <span class=n>NamedThreadFactory</span><span class=p>(</span><span class=s>&quot;Customized-grpc&quot;</span><span class=p>,</span> <span class=kc>true</span><span class=p>));</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>NettyServerBuilder</span> <span class=nf>configureServerBuilder</span><span class=p>(</span><span class=n>NettyServerBuilder</span> <span class=n>builder</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>builder</span><span class=p>.</span><span class=na>executor</span><span class=p>(</span><span class=n>executor</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>NettyChannelBuilder</span> <span class=nf>configureChannelBuilder</span><span class=p>(</span><span class=n>NettyChannelBuilder</span> <span class=n>builder</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>return</span> <span class=n>builder</span><span class=p>.</span><span class=na>flowControlWindow</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>CallOptions</span> <span class=nf>configureCallOptions</span><span class=p>(</span><span class=n>CallOptions</span> <span class=n>options</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>options</span><span class=p>.</span><span class=na>withOption</span><span class=p>(</span><span class=n>CallOptions</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=s>&quot;key&quot;</span><span class=p>),</span> <span class=s>&quot;value&quot;</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>配置为 Dubbo SPI，`resources/META-INF/services 增加配置文件</p> <div class=highlight><pre><span></span><code><span class=na>default</span><span class=o>=</span><span class=s>org.apache.dubbo.samples.basic.comtomize.MyGrpcConfigurator</span>
</code></pre></div> <ol> <li>指定 Provider 端线程池</li> </ol> <p>默认用的是 Dubbo 的线程池，有 fixed (默认)、cached、direct 等类型。以下演示了切换为业务自定义线程池。</p> <div class=highlight><pre><span></span><code><span class=kd>private</span> <span class=kd>final</span> <span class=n>ExecutorService</span> <span class=n>executor</span> <span class=o>=</span> <span class=n>Executors</span>
      <span class=p>.</span><span class=na>newFixedThreadPool</span><span class=p>(</span><span class=mi>200</span><span class=p>,</span> <span class=k>new</span> <span class=n>NamedThreadFactory</span><span class=p>(</span><span class=s>&quot;Customized-grpc&quot;</span><span class=p>,</span> <span class=kc>true</span><span class=p>));</span>

<span class=kd>public</span> <span class=n>NettyServerBuilder</span> <span class=nf>configureServerBuilder</span><span class=p>(</span><span class=n>NettyServerBuilder</span> <span class=n>builder</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> 
<span class=p>{</span>
  <span class=k>return</span> <span class=n>builder</span><span class=p>.</span><span class=na>executor</span><span class=p>(</span><span class=n>executor</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <ol> <li>指定 Consumer 端限流值</li> </ol> <p>设置 Consumer 限流值为 10</p> <div class=highlight><pre><span></span><code><span class=nd>@Override</span>
<span class=kd>public</span> <span class=n>NettyChannelBuilder</span> <span class=nf>configureChannelBuilder</span><span class=p>(</span><span class=n>NettyChannelBuilder</span> <span class=n>builder</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span>
<span class=p>{</span>
  <span class=k>return</span> <span class=n>builder</span><span class=p>.</span><span class=na>flowControlWindow</span><span class=p>(</span><span class=mi>10</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <ol> <li>传递附加参数</li> </ol> <p>DemoService 服务调用传递 key </p> <div class=highlight><pre><span></span><code><span class=nd>@Override</span>
<span class=kd>public</span> <span class=n>CallOptions</span> <span class=nf>configureCallOptions</span><span class=p>(</span><span class=n>CallOptions</span> <span class=n>options</span><span class=p>,</span> <span class=n>URL</span> <span class=n>url</span><span class=p>)</span> <span class=p>{</span>
  <span class=k>if</span> <span class=p>(</span><span class=n>url</span><span class=p>.</span><span class=na>getServiceInterface</span><span class=p>().</span><span class=na>equals</span><span class=p>(</span><span class=s>&quot;xxx.DemoService&quot;</span><span class=p>))</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>options</span><span class=p>.</span><span class=na>withOption</span><span class=p>(</span><span class=n>CallOptions</span><span class=p>.</span><span class=na>Key</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=s>&quot;key&quot;</span><span class=p>),</span> <span class=s>&quot;value&quot;</span><span class=p>);</span>
  <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>options</span><span class=p>;</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p><strong>三、TLS 配置</strong></p> <p>配置方式和 Dubbo 提供的通用的 <a href>TLS 支持</a>一致，具体请参见文档</p> <h3 id=2-protobuf-dubbo>示例 2， 使用 Protobuf 开发 Dubbo 服务<a class=headerlink href=#2-protobuf-dubbo title="Permanent link">&para;</a></h3> <p>下面，我们以一个<a href=https://github.com/apache/dubbo-samples/tree/master/dubbo-samples-protobuf>具体的示例</a>来看一下基于 Protobuf 的 Dubbo 服务开发流程。</p> <h4 id=1_1>1. 定义服务<a class=headerlink href=#1_1 title="Permanent link">&para;</a></h4> <p>通过标准 Protobuf 定义服务</p> <div class=highlight><pre><span></span><code>syntax <span class=o>=</span> <span class=s2>&quot;proto3&quot;</span>;

option java_multiple_files <span class=o>=</span> true;
option java_package <span class=o>=</span> <span class=s2>&quot;org.apache.dubbo.demo&quot;</span>;
option java_outer_classname <span class=o>=</span> <span class=s2>&quot;DemoServiceProto&quot;</span>;
option objc_class_prefix <span class=o>=</span> <span class=s2>&quot;DEMOSRV&quot;</span>;

package demoservice;

<span class=o>//</span> The demo service definition.
service DemoService {
  rpc SayHello (HelloRequest) returns (HelloReply) {}
}

<span class=o>//</span> The request <span class=nb>message</span> containing the user&#39;s name.
<span class=nb>message</span> HelloRequest {
  <span class=nb>string</span> name <span class=o>=</span> <span class=mi>1</span>;
}

<span class=o>//</span> The response <span class=nb>message</span> containing the greetings
<span class=nb>message</span> HelloReply {
  <span class=nb>string</span> <span class=nb>message</span> <span class=o>=</span> <span class=mi>1</span>;
}
</code></pre></div> <p>这里定义了一个 DemoService 服务，服务只包含一个 sayHello 方法，同时定义了方法的入参和出参。</p> <h4 id=2-compiler>2. Compiler 编译服务<a class=headerlink href=#2-compiler title="Permanent link">&para;</a></h4> <ol> <li>引入 Protobuf Compiler Maven 插件，同时指定 <code>protoc-gen-dubbo-java</code> RPC 扩展</li> </ol> <div class=highlight><pre><span></span><code><span class=nt>&lt;plugin&gt;</span>
  <span class=nt>&lt;groupId&gt;</span>org.xolstice.maven.plugins<span class=nt>&lt;/groupId&gt;</span>
  <span class=nt>&lt;artifactId&gt;</span>protobuf-maven-plugin<span class=nt>&lt;/artifactId&gt;</span>
  <span class=nt>&lt;version&gt;</span>0.5.1<span class=nt>&lt;/version&gt;</span>
  <span class=nt>&lt;configuration&gt;</span>
    <span class=nt>&lt;protocArtifact&gt;</span>com.google.protobuf:protoc:3.7.1:exe:${os.detected.classifier}  
    <span class=nt>&lt;/protocArtifact&gt;</span>
    <span class=nt>&lt;pluginId&gt;</span>dubbo-grpc-java<span class=nt>&lt;/pluginId&gt;</span>
    <span class=nt>&lt;pluginArtifact&gt;</span>org.apache.dubbo:protoc-gen-dubbo-java:1.19.0-SNAPSHOT:exe:${os.detected.classifier}<span class=nt>&lt;/pluginArtifact&gt;</span>
    <span class=nt>&lt;outputDirectory&gt;</span>build/generated/source/proto/main/java<span class=nt>&lt;/outputDirectory&gt;</span>
    <span class=nt>&lt;clearOutputDirectory&gt;</span>false<span class=nt>&lt;/clearOutputDirectory&gt;</span>
    <span class=nt>&lt;pluginParameter&gt;</span>dubbo<span class=nt>&lt;/pluginParameter&gt;</span>
  <span class=nt>&lt;/configuration&gt;</span>
  <span class=nt>&lt;executions&gt;</span>
    <span class=nt>&lt;execution&gt;</span>
      <span class=nt>&lt;goals&gt;</span>
        <span class=nt>&lt;goal&gt;</span>compile<span class=nt>&lt;/goal&gt;</span>
        <span class=nt>&lt;goal&gt;</span>compile-custom<span class=nt>&lt;/goal&gt;</span>
      <span class=nt>&lt;/goals&gt;</span>
    <span class=nt>&lt;/execution&gt;</span>
  <span class=nt>&lt;/executions&gt;</span>
<span class=nt>&lt;/plugin&gt;</span>
</code></pre></div> <p>注意，这里与 <a href=https://github.com/apache/dubbo-samples/tree/master/dubbo-samples-grpc>Dubbo 对 gRPC</a> 支持部分的区别在于： <code>&lt;pluginParameter&gt;dubbo&lt;/pluginParameter&gt;</code> </p> <ol> <li>生成 Dubbo stub</li> </ol> <div class=highlight><pre><span></span><code><span class=c1># 运行以下 maven 命令</span>
<span class=nv>$mvn</span> clean compile
</code></pre></div> <p>生成的 Java 类如下：</p> <p><img alt=image-20191028201240976 src=../../img/blog/grpc/compiler-protobuf.png></p> <p>DemoServiceDubbo 为 Dubbo 定制的 stub</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>final</span> <span class=kd>class</span> <span class=nc>DemoServiceDubbo</span> <span class=p>{</span>

  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>AtomicBoolean</span> <span class=n>registered</span> <span class=o>=</span> <span class=k>new</span> <span class=n>AtomicBoolean</span><span class=p>();</span>

  <span class=kd>private</span> <span class=kd>static</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>init</span><span class=p>()</span> <span class=p>{</span>
      <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>clazz</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>
      <span class=k>try</span> <span class=p>{</span>
          <span class=n>clazz</span> <span class=o>=</span> <span class=n>Class</span><span class=p>.</span><span class=na>forName</span><span class=p>(</span><span class=n>DemoServiceDubbo</span><span class=p>.</span><span class=na>class</span><span class=p>.</span><span class=na>getName</span><span class=p>());</span>
          <span class=k>if</span> <span class=p>(</span><span class=n>registered</span><span class=p>.</span><span class=na>compareAndSet</span><span class=p>(</span><span class=kc>false</span><span class=p>,</span> <span class=kc>true</span><span class=p>))</span> <span class=p>{</span>
              <span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>serialize</span><span class=p>.</span><span class=na>protobuf</span><span class=p>.</span><span class=na>support</span><span class=p>.</span><span class=na>ProtobufUtils</span><span class=p>.</span><span class=na>marshaller</span><span class=p>(</span>
                  <span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>demo</span><span class=p>.</span><span class=na>HelloRequest</span><span class=p>.</span><span class=na>getDefaultInstance</span><span class=p>());</span>
              <span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>common</span><span class=p>.</span><span class=na>serialize</span><span class=p>.</span><span class=na>protobuf</span><span class=p>.</span><span class=na>support</span><span class=p>.</span><span class=na>ProtobufUtils</span><span class=p>.</span><span class=na>marshaller</span><span class=p>(</span>
                  <span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>demo</span><span class=p>.</span><span class=na>HelloReply</span><span class=p>.</span><span class=na>getDefaultInstance</span><span class=p>());</span>
          <span class=p>}</span>
       <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>ClassNotFoundException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
          <span class=c1>// ignore </span>
       <span class=p>}</span>
       <span class=k>return</span> <span class=n>clazz</span><span class=p>;</span>
  <span class=p>}</span>

  <span class=kd>private</span> <span class=nf>DemoServiceDubbo</span><span class=p>()</span> <span class=p>{}</span>

  <span class=kd>public</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>SERVICE_NAME</span> <span class=o>=</span> <span class=s>&quot;demoservice.DemoService&quot;</span><span class=p>;</span>

  <span class=cm>/**</span>
<span class=cm>   * Code generated for Dubbo</span>
<span class=cm>   */</span>
  <span class=kd>public</span> <span class=kd>interface</span> <span class=nc>IDemoService</span> <span class=p>{</span>

     <span class=kd>static</span> <span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>clazz</span> <span class=o>=</span> <span class=n>init</span><span class=p>();</span>
     <span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>demo</span><span class=p>.</span><span class=na>HelloReply</span> <span class=nf>sayHello</span><span class=p>(</span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>demo</span><span class=p>.</span><span class=na>HelloRequest</span> <span class=n>request</span><span class=p>);</span>

     <span class=n>java</span><span class=p>.</span><span class=na>util</span><span class=p>.</span><span class=na>concurrent</span><span class=p>.</span><span class=na>CompletableFuture</span><span class=o>&lt;</span><span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>demo</span><span class=p>.</span><span class=na>HelloReply</span><span class=o>&gt;</span> <span class=nf>sayHelloAsync</span><span class=p>(</span>
  <span class=n>org</span><span class=p>.</span><span class=na>apache</span><span class=p>.</span><span class=na>dubbo</span><span class=p>.</span><span class=na>demo</span><span class=p>.</span><span class=na>HelloRequest</span> <span class=n>request</span><span class=p>);</span>

 <span class=p>}</span>

<span class=p>}</span>
</code></pre></div> <p>最值得注意的是 <code>IDemoService</code> 接口，它会作为 Dubbo 服务定义基础接口。</p> <h4 id=3_1>3. 开发业务逻辑<a class=headerlink href=#3_1 title="Permanent link">&para;</a></h4> <p>从这一步开始，所有开发流程就和直接定义 Java 接口一样了。实现接口定义业务逻辑。</p> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DemoServiceImpl</span> <span class=kd>implements</span> <span class=n>DemoServiceDubbo</span><span class=p>.</span><span class=na>IDemoService</span> <span class=p>{</span>
    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Logger</span> <span class=n>logger</span> <span class=o>=</span> <span class=n>LoggerFactory</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>DemoServiceImpl</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>HelloReply</span> <span class=nf>sayHello</span><span class=p>(</span><span class=n>HelloRequest</span> <span class=n>request</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>logger</span><span class=p>.</span><span class=na>info</span><span class=p>(</span><span class=s>&quot;Hello &quot;</span> <span class=o>+</span> <span class=n>request</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;, request from consumer: &quot;</span> <span class=o>+</span> <span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getRemoteAddress</span><span class=p>());</span>
        <span class=k>return</span> <span class=n>HelloReply</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span>
                <span class=p>.</span><span class=na>setMessage</span><span class=p>(</span><span class=s>&quot;Hello &quot;</span> <span class=o>+</span> <span class=n>request</span><span class=p>.</span><span class=na>getName</span><span class=p>()</span> <span class=o>+</span> <span class=s>&quot;, response from provider: &quot;</span>
                        <span class=o>+</span> <span class=n>RpcContext</span><span class=p>.</span><span class=na>getContext</span><span class=p>().</span><span class=na>getLocalAddress</span><span class=p>())</span>
                <span class=p>.</span><span class=na>build</span><span class=p>();</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>CompletableFuture</span><span class=o>&lt;</span><span class=n>HelloReply</span><span class=o>&gt;</span> <span class=nf>sayHelloAsync</span><span class=p>(</span><span class=n>HelloRequest</span> <span class=n>request</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>CompletableFuture</span><span class=p>.</span><span class=na>completedFuture</span><span class=p>(</span><span class=n>sayHello</span><span class=p>(</span><span class=n>request</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <h4 id=4-provider>4. 配置 Provider<a class=headerlink href=#4-provider title="Permanent link">&para;</a></h4> <p>暴露 Dubbo 服务</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:application</span> <span class=na>name=</span><span class=s>&quot;demo-provider&quot;</span><span class=nt>/&gt;</span>

<span class=nt>&lt;dubbo:registry</span> <span class=na>address=</span><span class=s>&quot;zookeeper://127.0.0.1:2181&quot;</span><span class=nt>/&gt;</span>

<span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;dubbo&quot;</span><span class=nt>/&gt;</span>

<span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&quot;demoService&quot;</span> <span class=na>class=</span><span class=s>&quot;org.apache.dubbo.demo.provider.DemoServiceImpl&quot;</span><span class=nt>/&gt;</span>

<span class=nt>&lt;dubbo:service</span> <span class=na>interface=</span><span class=s>&quot;org.apache.dubbo.demo.DemoServiceDubbo$IDemoService&quot;</span> <span class=na>ref=</span><span class=s>&quot;demoService&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
  <span class=n>ClassPathXmlApplicationContext</span> <span class=n>context</span> <span class=o>=</span> 
    <span class=k>new</span> <span class=n>ClassPathXmlApplicationContext</span><span class=p>(</span><span class=s>&quot;spring/dubbo-provider.xml&quot;</span><span class=p>);</span>
  <span class=n>context</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
  <span class=n>System</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>read</span><span class=p>();</span>
<span class=p>}</span>
</code></pre></div> <h4 id=5-consumer>5. 配置 Consumer<a class=headerlink href=#5-consumer title="Permanent link">&para;</a></h4> <p>引用 Dubbo 服务</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;dubbo:application</span> <span class=na>name=</span><span class=s>&quot;demo-consumer&quot;</span><span class=nt>/&gt;</span>

<span class=nt>&lt;dubbo:registry</span> <span class=na>address=</span><span class=s>&quot;zookeeper://127.0.0.1:2181&quot;</span><span class=nt>/&gt;</span>

<span class=nt>&lt;dubbo:reference</span> <span class=na>id=</span><span class=s>&quot;demoService&quot;</span> <span class=na>check=</span><span class=s>&quot;false&quot;</span> <span class=na>interface=</span><span class=s>&quot;org.apache.dubbo.demo.DemoServiceDubbo$IDemoService&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <div class=highlight><pre><span></span><code><span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=p>{</span>
  <span class=n>ClassPathXmlApplicationContext</span> <span class=n>context</span> <span class=o>=</span> 
    <span class=k>new</span> <span class=n>ClassPathXmlApplicationContext</span><span class=p>(</span><span class=s>&quot;spring/dubbo-consumer.xml&quot;</span><span class=p>);</span>
  <span class=n>context</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
  <span class=n>IDemoService</span> <span class=n>demoService</span> <span class=o>=</span> <span class=n>context</span><span class=p>.</span><span class=na>getBean</span><span class=p>(</span><span class=s>&quot;demoService&quot;</span><span class=p>,</span> <span class=n>IDemoService</span><span class=p>.</span><span class=na>class</span><span class=p>);</span>
  <span class=n>HelloRequest</span> <span class=n>request</span> <span class=o>=</span> <span class=n>HelloRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>().</span><span class=na>setName</span><span class=p>(</span><span class=s>&quot;Hello&quot;</span><span class=p>).</span><span class=na>build</span><span class=p>();</span>
  <span class=n>HelloReply</span> <span class=n>reply</span> <span class=o>=</span> <span class=n>demoService</span><span class=p>.</span><span class=na>sayHello</span><span class=p>(</span><span class=n>request</span><span class=p>);</span>
  <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;result: &quot;</span> <span class=o>+</span> <span class=n>reply</span><span class=p>.</span><span class=na>getMessage</span><span class=p>());</span>
  <span class=n>System</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>read</span><span class=p>();</span>
<span class=p>}</span>
</code></pre></div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/squidfunk target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://gitter.im/squidfunk/mkdocs-material target=_blank rel=noopener title=gitter.im class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"/></svg> </a> <a href=https://hub.docker.com/r/squidfunk/mkdocs-material/ target=_blank rel=noopener title=hub.docker.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=https://twitter.com/squidfunk target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/squidfunk/ target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://instagram.com/squidfunk target=_blank rel=noopener title=instagram.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.6a3d08fc.min.js></script> <script src=../../assets/javascripts/bundle.71201edf.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../..",
          features: ['tabs', 'search.highlight'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>