<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="如何在 Dubbo 中使用 Zipkin 进行全链路追踪"><link rel="shortcut icon" href=../../assets/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.0.2"><title>在 Dubbo 中使用 Zipkin - Apache Dubbo</title><link rel=stylesheet href=../../assets/stylesheets/main.38780c08.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.3f72e892.min.css><meta name=theme-color content=#4051b5><link rel=stylesheet href=../../css/dropdown.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#dubbo-zipkin class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Application header --> <header class=md-header data-md-component=header> <!-- Top-level navigation --> <nav class="md-header-nav md-grid" aria-label=Header> <!-- Link to home --> <a href=../.. title="Apache Dubbo" class="md-header-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> <!-- Button to open drawer --> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <!-- Header title --> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Apache Dubbo </span> <span class="md-header-nav__topic md-ellipsis"> 在 Dubbo 中使用 Zipkin </span> </div> </div> <!-- Button to open search dialogue --> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <!-- Search interface --> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div> <div class=langChange id=translate title=中文|English> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"> <path d="M12.87 15.07l-2.54-2.51.03-.03A17.52 17.52 0 0014.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7l1.62-4.33L19.12 17h-3.24z"/> </svg> </div> <script>
    var translate = document.getElementById('translate');
    translate.addEventListener('click', changeHref, false);
    function changeHref() {
        if (window.location.href.search('en-us') !== -1) {
            var changeHref = window.location.href.replace('en-us', 'zh-cn');

        } else {
            var changeHref = window.location.href.replace('zh-cn', 'en-us');
        }
        window.location.href = changeHref
    }
</script> <style>
    .langChange {
        display: inline-block;
        width: 2.4rem;
        height: 2.4rem;
        vertical-align: middle;
        margin-left: .5rem;
    }

    .langChange svg {
        fill: rgba(255, 255, 255, 0.548);
        display: block;
        width: 1.2rem;
        height: 1.2rem;
        margin: 0 auto;
        margin-top: .6rem;
        margin-left: .6rem;
    }

    .langChange :hover {
        fill: white;
        cursor: pointer;
    }
</style> </div> <!-- Repository containing source --> <div class=md-header-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Main navigation --> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <!-- Site title --> <label class=md-nav__title for=__drawer> <a href=../.. title="Apache Dubbo" class="md-nav__button md-logo" aria-label="Apache Dubbo"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> Apache Dubbo </label> <!-- Repository containing source --> <div class=md-nav__source> <a href=https://github.com/apache/dubbo/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <!-- Render item list --> <ul class=md-nav__list data-md-scrollfix> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../.. title=首页 class=md-nav__link> 首页 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 2.7 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=2.7 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 2.7 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/preface/requirements/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/quick-start/ title=快速启动 class=md-nav__link> 快速启动 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/dependencies/ title=依赖 class=md-nav__link> 依赖 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/maturity/ title=成熟度 class=md-nav__link> 成熟度 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-5 type=checkbox id=nav-1-1-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-5> 配置 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=配置 data-md-level=3> <label class=md-nav__title for=nav-1-1-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 配置 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/xml/ title="XML 配置" class=md-nav__link> XML 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/api/ title="API 配置" class=md-nav__link> API 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/annotation/ title="Annotation 配置" class=md-nav__link> Annotation 配置 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/annotation/ title=动态配置中心 class=md-nav__link> 动态配置中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/configuration-load-process/ title=配置加载流程 class=md-nav__link> 配置加载流程 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/configuration/environment-variables/ title=自动加载环境变量 class=md-nav__link> 自动加载环境变量 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-6 type=checkbox id=nav-1-1-6> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-6> 示例 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=示例 data-md-level=3> <label class=md-nav__title for=nav-1-1-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 示例 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/preflight-check/ title=启动时检查 class=md-nav__link> 启动时检查 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/fault-tolerent-strategy/ title=集群容错 class=md-nav__link> 集群容错 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/loadbalance/ title=负载均衡 class=md-nav__link> 负载均衡 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/thread-model/ title=线程模型 class=md-nav__link> 线程模型 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/explicit-target/ title=直连提供者 class=md-nav__link> 直连提供者 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/subscribe-only/ title=只订阅 class=md-nav__link> 只订阅 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/registry-only/ title=只注册 class=md-nav__link> 只注册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/static-service/ title=静态服务 class=md-nav__link> 静态服务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/multi-protocols/ title=多协议 class=md-nav__link> 多协议 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/multi-registry/ title=多注册中心 class=md-nav__link> 多注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/service-group/ title=服务分组 class=md-nav__link> 服务分组 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/multi-versions/ title=多版本 class=md-nav__link> 多版本 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/group-merger/ title=分组聚合 class=md-nav__link> 分组聚合 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/parameter-validation/ title=参数验证 class=md-nav__link> 参数验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/result-cache/ title=结果缓存 class=md-nav__link> 结果缓存 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/generic-reference/ title=泛化引用 class=md-nav__link> 泛化引用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/generic-service/ title=泛化实现 class=md-nav__link> 泛化实现 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/echo-service/ title=回声测试 class=md-nav__link> 回声测试 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/context/ title=上下文信息 class=md-nav__link> 上下文信息 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/attachment/ title=隐式参数 class=md-nav__link> 隐式参数 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/async-call/ title=异步调用 class=md-nav__link> 异步调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/async-execute-on-provider/ title=服务端异步 class=md-nav__link> 服务端异步 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/local-call/ title=本地调用 class=md-nav__link> 本地调用 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/callback-parameter/ title=参数回调 class=md-nav__link> 参数回调 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/events-notify/ title=事件通知 class=md-nav__link> 事件通知 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/local-stub/ title=本地存根 class=md-nav__link> 本地存根 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/local-mock/ title=本地伪装 class=md-nav__link> 本地伪装 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/delay-publish/ title=延迟暴露 class=md-nav__link> 延迟暴露 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/concurrency-control/ title=并发控制 class=md-nav__link> 并发控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/config-connection.md title=连接控制 class=md-nav__link> 连接控制 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/lazy-connect/ title=延迟连接 class=md-nav__link> 延迟连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/stickiness/ title=粘滞连接 class=md-nav__link> 粘滞连接 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/token-authorization/ title=令牌验证 class=md-nav__link> 令牌验证 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/routing-rule/ title=路由规则 class=md-nav__link> 路由规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/config-rule/ title=配置规则 class=md-nav__link> 配置规则 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/service-downgrade/ title=服务降级 class=md-nav__link> 服务降级 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/graceful-shutdown/ title=优雅停机 class=md-nav__link> 优雅停机 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/hostname-binding/ title=主机绑定 class=md-nav__link> 主机绑定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/logger-strategy/ title=日志适配 class=md-nav__link> 日志适配 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/accesslog/ title=访问日志 class=md-nav__link> 访问日志 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/service-container/ title=服务容器 class=md-nav__link> 服务容器 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/distributed-transaction/ title=分布式事务 class=md-nav__link> 分布式事务 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/dump/ title=线程栈自动dump class=md-nav__link> 线程栈自动dump </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/netty4/ title=Netty4 class=md-nav__link> Netty4 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/serialization/ title=Kryo和FST序列化 class=md-nav__link> Kryo和FST序列化 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/simplify-registry-data/ title=简化注册中心URL class=md-nav__link> 简化注册中心URL </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/demos/api.md title="API 参考手册" class=md-nav__link> API 参考手册 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-7 type=checkbox id=nav-1-1-7> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-7> schema 配置参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="schema 配置参考手册" data-md-level=3> <label class=md-nav__title for=nav-1-1-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> schema 配置参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-service/ title=dubbo:service class=md-nav__link> dubbo:service </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-reference/ title=dubbo:reference class=md-nav__link> dubbo:reference </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-protocol/ title=dubbo:protocol class=md-nav__link> dubbo:protocol </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-registry/ title=dubbo:registry class=md-nav__link> dubbo:registry </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-monitor/ title=dubbo:monitor class=md-nav__link> dubbo:monitor </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-application/ title=dubbo:application class=md-nav__link> dubbo:application </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-module/ title=dubbo:module class=md-nav__link> dubbo:module </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-provider/ title=dubbo:provider class=md-nav__link> dubbo:provider </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-consumer/ title=dubbo:consumer class=md-nav__link> dubbo:consumer </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-method/ title=dubbo:method class=md-nav__link> dubbo:method </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-argument/ title=dubbo:argument class=md-nav__link> dubbo:argument </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-parameter/ title=dubbo:parameter class=md-nav__link> dubbo:parameter </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/xml/dubbo-config-center/ title=dubbo:config-center class=md-nav__link> dubbo:config-center </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-8 type=checkbox id=nav-1-1-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-8> 协议参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=协议参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 协议参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/dubbo/ title=dubbo:// class=md-nav__link> dubbo:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/rmi/ title=rmi:// class=md-nav__link> rmi:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/hessian/ title=hessian:// class=md-nav__link> hessian:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/http/ title=http:// class=md-nav__link> http:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/thrift/ title=thrift:// class=md-nav__link> thrift:// </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/protocol/rest/ title=rest:// class=md-nav__link> rest:// </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-9 type=checkbox id=nav-1-1-9> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-9> 注册中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=注册中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 注册中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/registry/multicast/ title="Multicast 注册中心" class=md-nav__link> Multicast 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/registry/zookeeper/ title="Zookeeper 注册中心" class=md-nav__link> Zookeeper 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/registry/redis/ title="Redis 注册中心" class=md-nav__link> Redis 注册中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/registry/simple/ title="Simple 注册中心" class=md-nav__link> Simple 注册中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-10 type=checkbox id=nav-1-1-10> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-10> 元数据中心参考手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=元数据中心参考手册 data-md-level=3> <label class=md-nav__title for=nav-1-1-10> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 元数据中心参考手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/metadata/metadata-redis/ title="Redis 元数据中心" class=md-nav__link> Redis 元数据中心 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/metadata/metadata-zookeeper/ title="Zookeeper 元数据中心" class=md-nav__link> Zookeeper 元数据中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/telnet/ title="telnet 命令参考手册" class=md-nav__link> telnet 命令参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/qos/ title=在线运维命令-QOS class=md-nav__link> 在线运维命令-QOS </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/references/maven/ title="maven 插件参考手册" class=md-nav__link> maven 插件参考手册 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/best-practice/ title=服务化最佳实践 class=md-nav__link> 服务化最佳实践 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/recommend/ title=推荐用法 class=md-nav__link> 推荐用法 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/capacity-plan/ title=容量规划 class=md-nav__link> 容量规划 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/perf-test/ title=性能测试报告 class=md-nav__link> 性能测试报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/covergence.md title=测试覆盖率报告 class=md-nav__link> 测试覆盖率报告 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-19 type=checkbox id=nav-1-1-19> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-19> 版本与升级 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=版本与升级 data-md-level=3> <label class=md-nav__title for=nav-1-1-19> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 版本与升级 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/2.7/user/versions/version-270/ title=2.7.x升级步骤及注意事项 class=md-nav__link> 2.7.x升级步骤及注意事项 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2 type=checkbox id=nav-1-2> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2> 开发手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=开发手册 data-md-level=2> <label class=md-nav__title for=nav-1-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 开发手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/build.md title=源码构建 class=md-nav__link> 源码构建 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/design.md title=框架设计 class=md-nav__link> 框架设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/SPI.md title=扩展点加载 class=md-nav__link> 扩展点加载 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/implementation.md title=实现细节 class=md-nav__link> 实现细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-5 type=checkbox id=nav-1-2-5> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-5> SPI 扩展实现 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="SPI 扩展实现" data-md-level=3> <label class=md-nav__title for=nav-1-2-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> SPI 扩展实现 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/protocol.md title=协议扩展 class=md-nav__link> 协议扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/filter.md title=调用拦截扩展 class=md-nav__link> 调用拦截扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/invoker-listener.md title=引用监听扩展 class=md-nav__link> 引用监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/exporter-listener.md title=暴露监听扩展 class=md-nav__link> 暴露监听扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/cluster.md title=集群扩展 class=md-nav__link> 集群扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/router.md title=路由扩展 class=md-nav__link> 路由扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/load-balance.md title=负载均衡扩展 class=md-nav__link> 负载均衡扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/merger.md title=合并结果扩展 class=md-nav__link> 合并结果扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/registry.md title=注册中心扩展 class=md-nav__link> 注册中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/monitor.md title=监控中心扩展 class=md-nav__link> 监控中心扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/extension-factory.md title=扩展点加载扩展 class=md-nav__link> 扩展点加载扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/proxy-factory.md title=动态代理扩展 class=md-nav__link> 动态代理扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/compiler.md title=编译器扩展 class=md-nav__link> 编译器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/dispatcher.md title=消息派发扩展 class=md-nav__link> 消息派发扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/threadpool.md title=线程池扩展 class=md-nav__link> 线程池扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/serialize.md title=序列化扩展 class=md-nav__link> 序列化扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/remoting.md title=网络传输扩展 class=md-nav__link> 网络传输扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/exchanger.md title=信息交换扩展 class=md-nav__link> 信息交换扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/networker.md title=组网扩展 class=md-nav__link> 组网扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/telnet-handler.md title="Telnet 命令扩展" class=md-nav__link> Telnet 命令扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/status-checker.md title=状态检查扩展 class=md-nav__link> 状态检查扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/container.md title=容器扩展 class=md-nav__link> 容器扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/page.md title=页面扩展 class=md-nav__link> 页面扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/cache.md title=缓存扩展 class=md-nav__link> 缓存扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/validation.md title=验证扩展 class=md-nav__link> 验证扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/logger-adapter.md title=日志适配扩展 class=md-nav__link> 日志适配扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/impls/config-center.md title=配置中心 class=md-nav__link> 配置中心 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/contract.md title=公共契约 class=md-nav__link> 公共契约 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/coding.md title=编码约定 class=md-nav__link> 编码约定 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-2-8 type=checkbox id=nav-1-2-8> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-2-8> 设计原则 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=设计原则 data-md-level=3> <label class=md-nav__title for=nav-1-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 设计原则 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/code-detail.md title=魔鬼在细节 class=md-nav__link> 魔鬼在细节 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/general-knowledge.md title=一些设计上的基本常识 class=md-nav__link> 一些设计上的基本常识 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/expansibility.md title=谈谈扩充式扩展与增量式扩展 class=md-nav__link> 谈谈扩充式扩展与增量式扩展 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/configuration.md title=配置设计 class=md-nav__link> 配置设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/robustness.md title=设计实现的健壮性 class=md-nav__link> 设计实现的健壮性 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/dummy.md title=防痴呆设计 class=md-nav__link> 防痴呆设计 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/principals/extension.md title=扩展点重构 class=md-nav__link> 扩展点重构 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/release.md title=版本发布 class=md-nav__link> 版本发布 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/contribution.md title=贡献代码 class=md-nav__link> 贡献代码 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/checklist.md title=检查列表 class=md-nav__link> 检查列表 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/code-smell.md title=坏味道 class=md-nav__link> 坏味道 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../dev/TCK.md title=兼容性测试 class=md-nav__link> 兼容性测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-3 type=checkbox id=nav-1-3> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-3> 管理者文档 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=管理者文档 data-md-level=2> <label class=md-nav__title for=nav-1-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 管理者文档 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../admin/introduction.md title="Dubbo Admin介绍" class=md-nav__link> Dubbo Admin介绍 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../admin/serviceSearch.md title=服务搜索和详情 class=md-nav__link> 服务搜索和详情 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../admin/serviceGovernance.md title=服务治理 class=md-nav__link> 服务治理 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../admin/serviceTest.md title=服务测试 class=md-nav__link> 服务测试 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 3.0 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=3.0 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 3.0 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1 type=checkbox id=nav-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1> 用户手册 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=用户手册 data-md-level=2> <label class=md-nav__title for=nav-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 用户手册 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1-1-1 type=checkbox id=nav-1-1-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1-1-1> 入门 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=入门 data-md-level=3> <label class=md-nav__title for=nav-1-1-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 入门 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/3.0/user/preface/background/ title=背景 class=md-nav__link> 背景 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/3.0/user/preface/background/ title=需求 class=md-nav__link> 需求 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/3.0/user/preface/architecture/ title=架构 class=md-nav__link> 架构 </a> </li> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../docs/3.0/user/preface/usage/ title=用法 class=md-nav__link> 用法 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 博客 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=博客 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 博客 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../apache-dubbo-2019-2020/ title="2019-2020 回顾" class=md-nav__link> 2019-2020 回顾 </a> </li> </ul> </nav> </li> <!-- Currently active page --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class="md-nav__item md-nav__item--nested"> <!-- Active checkbox expands items contained within nested section --> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <!-- Expand active pages --> <label class=md-nav__link for=nav-1> 开发者指南 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=开发者指南 data-md-level=1> <label class=md-nav__title for=nav-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 开发者指南 </label> <ul class=md-nav__list data-md-scrollfix> <!-- Render nested item list --> <!-- Determine class according to level --> <!-- Main navigation item with nested items --> <li class=md-nav__item> <a href=../../developers/developers_dev/ title=开发者指引 class=md-nav__link> 开发者指引 </a> </li> </ul> </nav> </li> <!-- Currently active page --> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#zipkin class=md-nav__link> Zipkin 简介 </a> <nav class=md-nav aria-label="Zipkin 简介"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#zipkin_1 class=md-nav__link> Zipkin 架构 </a> </li> <li class=md-nav__item> <a href=#zipkin_2 class=md-nav__link> Zipkin 的工作过程 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#dubbo class=md-nav__link> 在 Dubbo 中使用 </a> <nav class=md-nav aria-label="在 Dubbo 中使用"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#zipkin-server class=md-nav__link> 安装 Zipkin Server </a> </li> <li class=md-nav__item> <a href=#maven class=md-nav__link> 配置 Maven 依赖 </a> <nav class=md-nav aria-label="配置 Maven 依赖"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#brave class=md-nav__link> 引入 Brave 依赖 </a> </li> <li class=md-nav__item> <a href=#dubbo_1 class=md-nav__link> 引入 Dubbo 相关依赖 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 实现 </a> <nav class=md-nav aria-label=实现> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 定义服务接口 </a> </li> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 实现服务接口 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 配置 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 运行 </a> <nav class=md-nav aria-label=运行> <ul class=md-nav__list> <li class=md-nav__item> <a href=#zookeeper-server class=md-nav__link> 启动 Zookeeper Server </a> </li> <li class=md-nav__item> <a href=#zipkin-server_1 class=md-nav__link> 启动 Zipkin Server </a> </li> <li class=md-nav__item> <a href=#helloservice class=md-nav__link> 启动 HelloService </a> </li> <li class=md-nav__item> <a href=#greetingservice class=md-nav__link> 启动 GreetingService </a> </li> <li class=md-nav__item> <a href=#dubbo_2 class=md-nav__link> 运行 Dubbo 客户端 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 链路追踪 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 总结 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/apache/dubbo-website/edit/master/zh-cn/blog/use-zipkin-in-dubbo.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=dubbo-zipkin>在 Dubbo 中使用 Zipkin<a class=headerlink href=#dubbo-zipkin title="Permanent link">&para;</a></h1> <p>随着业务的发展，应用的规模不断的扩大，传统的应用架构无法满足诉求，服务化架构改造势在必行，以 Dubbo 为代表的分布式服务框架成为了服务化改造架构中的基石。随着微服务理念逐渐被大众接受，应用进一步向更细粒度拆分，并且，不同的应用由不同的开发团队独立负责，整个分布式系统变得十分复杂。没有人能够清晰及时的知道当前系统整体的依赖关系。当出现问题时，也无法及时知道具体是链路上的哪个环节出了问题。</p> <p>在这个背景下，Google 发表了 <a href=https://ai.google/research/pubs/pub36356>Dapper</a> 的论文，描述了如何通过一个分布式追踪系统解决上述问题。基于该论文，各大互联网公司实现并部署了自己的分布式追踪系统，其中比较出名的有阿里巴巴的 EagleEye。本文中提到的 Zipkin 是 Twitter 公司开源的分布式追踪系统。下面会详细介绍如何在 Dubbo 中使用 Zipkin 来实现分布式追踪。</p> <h2 id=zipkin>Zipkin 简介<a class=headerlink href=#zipkin title="Permanent link">&para;</a></h2> <p>Zipkin 是基于 <a href=https://ai.google/research/pubs/pub36356>Dapper</a> 论文实现，由 Twitter 开源的分布式追踪系统，通过收集分布式服务执行时间的信息来达到追踪服务调用链路、以及分析服务执行延迟等目的。</p> <h3 id=zipkin_1>Zipkin 架构<a class=headerlink href=#zipkin_1 title="Permanent link">&para;</a></h3> <p><img alt="Zipkin architecture" src=../../img/blog/zipkin-architecture.png></p> <p>Collector 收集器、Storage 存储、API、UI 用户界面等几部分构成了 Zipkin Server 部分，对应于 GitHub 上 <a href=https://github.com/openzipkin/zipkin>openzipkin/zipkin</a> 这个项目。而收集应用中调用的耗时信息并将其上报的组件与应用共生，并拥有各个语言的实现版本，其中 Java 的实现是 GitHub 上 <a href=https://github.com/openzipkin/brave>openzipkin/brave</a>。除了 Java 客户端实现之外，openzipkin 还提供了许多其他语言的实现，其中包括了 go、php、JavaScript、.net、ruby 等，具体列表可以参阅 Zipkin 的 <a href=https://zipkin.io/pages/existing_instrumentations>Exiting instrumentations</a>。</p> <h3 id=zipkin_2>Zipkin 的工作过程<a class=headerlink href=#zipkin_2 title="Permanent link">&para;</a></h3> <p>当用户发起一次调用时，Zipkin 的客户端会在入口处为整条调用链路生成一个全局唯一的 trace id，并为这条链路中的每一次分布式调用生成一个 span id。span 与 span 之间可以有父子嵌套关系，代表分布式调用中的上下游关系。span 和 span 之间可以是兄弟关系，代表当前调用下的两次子调用。一个 trace 由一组 span 组成，可以看成是由 trace 为根节点，span 为若干个子节点的一棵树。</p> <p><img alt="Related image" src=../../img/blog/trace-sample.png></p> <p>Span 由调用边界来分隔，在 Zipkin 中，调用边界由以下四个 annotation 来表示：</p> <ul> <li>cs - Clent Sent 客户端发送了请求</li> <li>sr - Server Receive 服务端接受到请求</li> <li>ss - Server Send 服务端处理完毕，向客户端发送回应</li> <li>cr - Client Receive 客户端收到结果</li> </ul> <p>显然，通过这四个 annotation 上的时间戳，可以轻易的知道一次完整的调用在不同阶段的耗时，比如：</p> <ul> <li>sr - cs 代表了请求在网络上的耗时</li> <li>ss - sr 代表了服务端处理请求的耗时</li> <li>cr - ss 代表了回应在网络上的耗时</li> <li>cr - cs 代表了一次调用的整体耗时</li> </ul> <p>Zipkin 会将 trace 相关的信息在调用链路上传递，并在每个调用边界结束时异步的把当前调用的耗时信息上报给 Zipkin Server。Zipkin Server 在收到 trace 信息后，将其存储起来，Zipkin 支持的存储类型有 inMemory、MySql、Cassandra、以及 ElasticsSearch 几种方式。随后 Zipkin 的 Web UI 会通过 API 访问的方式从存储中将 trace 信息提取出来分析并展示，如下图所示：</p> <p><img alt="Web interface screenshot" src=../../img/blog/zipkin-web-screenshot.png></p> <h2 id=dubbo>在 Dubbo 中使用<a class=headerlink href=#dubbo title="Permanent link">&para;</a></h2> <p>由于 <a href=https://github.com/openzipkin/brave>Brave</a> 对 Dubbo 已经主动做了支持，在 Dubbo 中集成基于 Zipkin 的链路追踪变的十分简单。下面会按照 Brave 中关于 <a href=https://github.com/openzipkin/brave/blob/master/instrumentation/dubbo-rpc/README.md>Dubbo RPC 支持的指引</a>来说明如何在 Dubbo 中使用 Zipkin。</p> <h3 id=zipkin-server>安装 Zipkin Server<a class=headerlink href=#zipkin-server title="Permanent link">&para;</a></h3> <p>按照 <a href=https://github.com/openzipkin/zipkin/tree/master/zipkin-server#quick-start>Zipkin 官方文档中的快速开始</a> 来安装 Zipkin，如下所示：</p> <div class=highlight><pre><span></span><code>$ curl -sSL https://zipkin.io/quickstart.sh <span class=p>|</span> bash -s
$ java -jar zipkin.jar
</code></pre></div> <p>按照这种方式安装的 Zipkin Server 使用的存储类型是 inMemory 的。当服务器停机之后，所有收集到的 trace 信息会丢失，不适用于生产系统。如果在生产系统中使用，需要配置另外的存储类型。Zipkin 支持 MySql、Cassandra、和 ElasticSearch。推荐使用 Cassandra 和 ElasticSearch，相关的配置请自行查阅<a href=https://github.com/openzipkin/zipkin/tree/master/zipkin-server>官方文档</a>。</p> <p>本文为了演示方便，使用的存储是 inMemory 类型。成功启动之后，可以在终端看到如下的提示：</p> <div class=highlight><pre><span></span><code>$ java -jar zipkin.jar
Picked up JAVA_TOOL_OPTIONS: -Djava.awt.headless<span class=o>=</span><span class=nb>true</span>
                                    ********
                                  **        **
                                 *            *
                                **            **
                                **            **
                                 **          **
                                  **        **
                                    ********
                                      ****
                                      ****
        ****                          ****
     ******                           ****                                 ***
  ****************************************************************************
    *******                           ****                                 ***
        ****                          ****
                                       **
                                       **


             *****      **     *****     ** **       **     **   **
               **       **     **  *     ***         **     **** **
              **        **     *****     ****        **     **  ***
             ******     **     **        **  **      **     **   **

:: Powered by Spring Boot ::         <span class=o>(</span>v2.0.5.RELEASE<span class=o>)</span>

...

o.s.b.w.e.u.UndertowServletWebServer     : Undertow started on port<span class=o>(</span>s<span class=o>)</span> <span class=m>9411</span> <span class=o>(</span>http<span class=o>)</span> with context path <span class=s1>&#39;&#39;</span>
<span class=m>2018</span>-10-10 <span class=m>18</span>:40:31.605  INFO <span class=m>21072</span> --- <span class=o>[</span>           main<span class=o>]</span> z.s.ZipkinServer                         : Started ZipkinServer in <span class=m>6</span>.835 seconds <span class=o>(</span>JVM running <span class=k>for</span> <span class=m>8</span>.35<span class=o>)</span>
</code></pre></div> <p>然后在浏览器中访问 <a href=http://localhost:9411>http://localhost:9411</a> 验证 WEB 界面。</p> <h3 id=maven>配置 Maven 依赖<a class=headerlink href=#maven title="Permanent link">&para;</a></h3> <h4 id=brave>引入 Brave 依赖<a class=headerlink href=#brave title="Permanent link">&para;</a></h4> <p>新建一个新的 Java 工程，并在 pom.xml 中引入 Brave 相关的依赖如下：</p> <div class=highlight><pre><span></span><code>    <span class=nt>&lt;properties&gt;</span>
        <span class=nt>&lt;brave.version&gt;</span>5.4.2<span class=nt>&lt;/brave.version&gt;</span>
        <span class=nt>&lt;zipkin-reporter.version&gt;</span>2.7.9<span class=nt>&lt;/zipkin-reporter.version&gt;</span>
    <span class=nt>&lt;/properties&gt;</span>

    <span class=nt>&lt;dependencyManagement&gt;</span>
        <span class=nt>&lt;dependencies&gt;</span>
            <span class=c>&lt;!-- 引入 zipkin brave 的 BOM 文件 --&gt;</span>
            <span class=nt>&lt;dependency&gt;</span>
                <span class=nt>&lt;groupId&gt;</span>io.zipkin.brave<span class=nt>&lt;/groupId&gt;</span>
                <span class=nt>&lt;artifactId&gt;</span>brave-bom<span class=nt>&lt;/artifactId&gt;</span>
                <span class=nt>&lt;version&gt;</span>${brave.version}<span class=nt>&lt;/version&gt;</span>
                <span class=nt>&lt;type&gt;</span>pom<span class=nt>&lt;/type&gt;</span>
                <span class=nt>&lt;scope&gt;</span>import<span class=nt>&lt;/scope&gt;</span>
            <span class=nt>&lt;/dependency&gt;</span>

            <span class=c>&lt;!-- 引入 zipkin repoter 的 BOM 文件 --&gt;</span>
            <span class=nt>&lt;dependency&gt;</span>
                <span class=nt>&lt;groupId&gt;</span>io.zipkin.reporter2<span class=nt>&lt;/groupId&gt;</span>
                <span class=nt>&lt;artifactId&gt;</span>zipkin-reporter-bom<span class=nt>&lt;/artifactId&gt;</span>
                <span class=nt>&lt;version&gt;</span>${zipkin-reporter.version}<span class=nt>&lt;/version&gt;</span>
                <span class=nt>&lt;type&gt;</span>pom<span class=nt>&lt;/type&gt;</span>
                <span class=nt>&lt;scope&gt;</span>import<span class=nt>&lt;/scope&gt;</span>
            <span class=nt>&lt;/dependency&gt;</span>
        <span class=nt>&lt;/dependencies&gt;</span>
    <span class=nt>&lt;/dependencyManagement&gt;</span>

    <span class=nt>&lt;dependencies&gt;</span>
        <span class=c>&lt;!-- 1. brave 对 dubbo 的集成 --&gt;</span>
        <span class=nt>&lt;dependency&gt;</span>
            <span class=nt>&lt;groupId&gt;</span>io.zipkin.brave<span class=nt>&lt;/groupId&gt;</span>
            <span class=nt>&lt;artifactId&gt;</span>brave-instrumentation-dubbo-rpc<span class=nt>&lt;/artifactId&gt;</span>
        <span class=nt>&lt;/dependency&gt;</span>

        <span class=c>&lt;!-- 2. brave 的 spring bean 支持 --&gt;</span>
        <span class=nt>&lt;dependency&gt;</span>
            <span class=nt>&lt;groupId&gt;</span>io.zipkin.brave<span class=nt>&lt;/groupId&gt;</span>
            <span class=nt>&lt;artifactId&gt;</span>brave-spring-beans<span class=nt>&lt;/artifactId&gt;</span>
        <span class=nt>&lt;/dependency&gt;</span>

        <span class=c>&lt;!-- 3. 在 SLF4J 的 MDC (Mapped Diagnostic Context) 中支持 traceId 和 spanId --&gt;</span>
        <span class=nt>&lt;dependency&gt;</span>
            <span class=nt>&lt;groupId&gt;</span>io.zipkin.brave<span class=nt>&lt;/groupId&gt;</span>
            <span class=nt>&lt;artifactId&gt;</span>brave-context-slf4j<span class=nt>&lt;/artifactId&gt;</span>
        <span class=nt>&lt;/dependency&gt;</span>

        <span class=c>&lt;!-- 4. 使用 okhttp3 作为 reporter --&gt;</span>
        <span class=nt>&lt;dependency&gt;</span>
            <span class=nt>&lt;groupId&gt;</span>io.zipkin.reporter2<span class=nt>&lt;/groupId&gt;</span>
            <span class=nt>&lt;artifactId&gt;</span>zipkin-sender-okhttp3<span class=nt>&lt;/artifactId&gt;</span>
        <span class=nt>&lt;/dependency&gt;</span>
    <span class=nt>&lt;/dependencies&gt;</span>
</code></pre></div> <p>其中：</p> <ol> <li>引入 brave-instrumentation-dubbo-rpc，brave 对 dubbo 的支持：<a href=https://github.com/openzipkin/brave/blob/master/instrumentation/dubbo-rpc/README.md>https://github.com/openzipkin/brave/blob/master/instrumentation/dubbo-rpc/README.md</a></li> <li>引入 brave-spring-beans，brave 对 spring bean 的支持：<a href=https://github.com/openzipkin/brave/blob/master/spring-beans/README.md>https://github.com/openzipkin/brave/blob/master/spring-beans/README.md</a></li> <li>引入 brave-context-slf4j，brave 对 SLF4J 的支持，可以在 MDC 中使用 traceId 和 spanId：<a href=https://github.com/openzipkin/brave/blob/master/context/slf4j/README.md>https://github.com/openzipkin/brave/blob/master/context/slf4j/README.md</a></li> <li>引入 zipkin-sender-okhttp3，使用 okhttp3 上报数据：<a href=https://github.com/openzipkin/zipkin-reporter-java>https://github.com/openzipkin/zipkin-reporter-java</a></li> </ol> <h4 id=dubbo_1>引入 Dubbo 相关依赖<a class=headerlink href=#dubbo_1 title="Permanent link">&para;</a></h4> <p>Dubbo 相关的依赖是 Dubbo 本身以及 Zookeeper 客户端，在下面的例子中，我们将会使用独立的 Zookeeper Server 作为服务发现。</p> <div class=highlight><pre><span></span><code>    <span class=nt>&lt;dependencies&gt;</span>
        <span class=c>&lt;!-- 1. Zookeeper 客户端依赖 --&gt;</span>
        <span class=nt>&lt;dependency&gt;</span>
            <span class=nt>&lt;groupId&gt;</span>org.apache.curator<span class=nt>&lt;/groupId&gt;</span>
            <span class=nt>&lt;artifactId&gt;</span>curator-framework<span class=nt>&lt;/artifactId&gt;</span>
            <span class=nt>&lt;version&gt;</span>2.12.0<span class=nt>&lt;/version&gt;</span>
            <span class=nt>&lt;exclusions&gt;</span>
                <span class=nt>&lt;exclusion&gt;</span>
                    <span class=nt>&lt;groupId&gt;</span>io.netty<span class=nt>&lt;/groupId&gt;</span>
                    <span class=nt>&lt;artifactId&gt;</span>netty<span class=nt>&lt;/artifactId&gt;</span>
                <span class=nt>&lt;/exclusion&gt;</span>
            <span class=nt>&lt;/exclusions&gt;</span>
        <span class=nt>&lt;/dependency&gt;</span>
        <span class=c>&lt;!-- 2. Dubbo 依赖 --&gt;</span>
        <span class=nt>&lt;dependency&gt;</span>
            <span class=nt>&lt;groupId&gt;</span>com.alibaba<span class=nt>&lt;/groupId&gt;</span>
            <span class=nt>&lt;artifactId&gt;</span>dubbo<span class=nt>&lt;/artifactId&gt;</span>
            <span class=nt>&lt;version&gt;</span>2.6.2<span class=nt>&lt;/version&gt;</span>
        <span class=nt>&lt;/dependency&gt;</span>
    <span class=nt>&lt;/dependencies&gt;</span>
</code></pre></div> <p>其中：</p> <ol> <li>Dubbo 这里依赖独立的 Zookeeper Server 做服务发现，这里使用的客户端是 Curator</li> <li>引入 Dubbo 框架的依赖，原则上 2.6 的任何版本都是工作的，这里使用的是 2.6.2 版本</li> </ol> <h3 id=_1>实现<a class=headerlink href=#_1 title="Permanent link">&para;</a></h3> <p>我们这里构造的场景是一个有两个节点的服务依赖链，也就是，当一个 Dubbo 客户端调用服务 A 时，服务 A 将会继续调用服务 B。在这个例子中，服务 A 是 greeting service，它所依赖的下游服务服务 B 是 hello service。</p> <h4 id=_2>定义服务接口<a class=headerlink href=#_2 title="Permanent link">&para;</a></h4> <p>为此需要事先定义两个服务接口 GreetingService 以及 HelloService</p> <ol> <li> <p>com.alibaba.dubbo.samples.api.GreetingService</p> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>com.alibaba.dubbo.samples.api</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>GreetingService</span> <span class=p>{</span>
    <span class=n>String</span> <span class=nf>greeting</span><span class=p>(</span><span class=n>String</span> <span class=n>message</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> </li> <li> <p>com.alibaba.dubbo.samples.api.HelloService</p> </li> </ol> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>com.alibaba.dubbo.samples.api</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>interface</span> <span class=nc>HelloService</span> <span class=p>{</span>
    <span class=n>String</span> <span class=nf>hello</span><span class=p>(</span><span class=n>String</span> <span class=n>message</span><span class=p>);</span>
<span class=p>}</span>
</code></pre></div> <h4 id=_3>实现服务接口<a class=headerlink href=#_3 title="Permanent link">&para;</a></h4> <p>为了区分对待，所有和 HelloService 相关的实现代码都放在 hello 子包下，同理 GreetingService 相关的放在 greeting 子包下。</p> <ol> <li> <p>实现 com.alibaba.dubbo.samples.api.HelloService</p> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>com.alibaba.dubbo.samples.service.hello</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>com.alibaba.dubbo.samples.api.HelloService</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>java.util.Random</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>HelloServiceImpl</span> <span class=kd>implements</span> <span class=n>HelloService</span> <span class=p>{</span>
    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>hello</span><span class=p>(</span><span class=n>String</span> <span class=n>message</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=c1>// 通过 sleep 模拟业务逻辑处理时间</span>
            <span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()).</span><span class=na>nextInt</span><span class=p>(</span><span class=mi>1000</span><span class=p>));</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// no op</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=s>&quot;hello, &quot;</span> <span class=o>+</span> <span class=n>message</span><span class=p>;</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> </li> <li> <p>实现 com.alibaba.dubbo.samples.api.GreetingService</p> </li> </ol> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>com.alibaba.dubbo.samples.service.greeting</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>com.alibaba.dubbo.samples.api.GreetingService</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>com.alibaba.dubbo.samples.api.HelloService</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>java.util.Random</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>GreetingServiceImpl</span> <span class=kd>implements</span> <span class=n>GreetingService</span> <span class=p>{</span>
 <span class=c1>// 下游依赖服务，运行时靠 spring 容器注入 HelloService 的服务代理</span>
    <span class=kd>private</span> <span class=n>HelloService</span> <span class=n>helloService</span><span class=p>;</span>

    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setHelloService</span><span class=p>(</span><span class=n>HelloService</span> <span class=n>helloService</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=na>helloService</span> <span class=o>=</span> <span class=n>helloService</span><span class=p>;</span>
    <span class=p>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>greeting</span><span class=p>(</span><span class=n>String</span> <span class=n>message</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>try</span> <span class=p>{</span>
            <span class=c1>// 通过 sleep 模拟业务逻辑处理时间</span>
            <span class=n>Thread</span><span class=p>.</span><span class=na>sleep</span><span class=p>(</span><span class=k>new</span> <span class=n>Random</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>currentTimeMillis</span><span class=p>()).</span><span class=na>nextInt</span><span class=p>(</span><span class=mi>1000</span><span class=p>));</span>
        <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=n>InterruptedException</span> <span class=n>e</span><span class=p>)</span> <span class=p>{</span>
            <span class=c1>// no op</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=s>&quot;greeting, &quot;</span> <span class=o>+</span> <span class=n>helloService</span><span class=p>.</span><span class=na>hello</span><span class=p>(</span><span class=n>message</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>这里需要注意的是，GreetingServiceImpl 的实现中声明了一个类型是 HelloService 的成员变量，并在 greeting 方法中，执行完自己逻辑之后又调用了 HelloService 上的 hello 方法。这里的 helloService 的实现将会在运行态由外部注入，注入的不是 HelloServiceImpl 的实现，而是 HelloService 的远程调用代理。通过这样的方式，完成了在一个 Dubbo 服务中继续调用另一个远程 Dubbo 服务的目的。从链路追踪的角度来说，客户端调用 GreetingService 是一个 span，GreetingService 调用 HelloService 是另一个 span，并且两者有父子关系，同属于一个 trace，也就是属于同一条调用链路。</p> <p>另外，在 GreetingServiceImpl 和 HelloServiceImpl 的实现中，通过 Thread.sleep 来模拟了处理业务逻辑的耗时，以便在 Zipkin UI 上更好的展示。</p> <h4 id=_4>配置<a class=headerlink href=#_4 title="Permanent link">&para;</a></h4> <p>为了专注在展示如何使用 Zipkin 这一点上，本文在配置和编程模型上没有采用更多的高级技术，而是使用了最传统的 Spring XML 的配置方式，帮助读者理解。更高级的通过 annotation 甚至 spring boot 的方式，读者可以自行查阅 Dubbo 和 Zipkin 相关的文档。</p> <ol> <li>暴露 HelloService 服务</li> </ol> <p>在 resouces/spring/hello-service.xml 中增加以下的配置来将 HelloServiceImpl 暴露成一个 Dubbo 服务：</p> <ul> <li>使用了本地启动的 Zookeeper Server 作为注册中心，地址为默认值 zookeeper://127.0.0.1:2181</li> <li>用 Dubbo 原生服务在端口 20880 上暴露服务</li> <li>将 HelloServiceImpl 注册成 id 是 <code>helloService</code> 的 Spring Bean，这样就可以在后续的 <code>&lt;dubbo:service&gt;</code> 中引用到这个实现类</li> <li>通过 <code>&lt;dubbo:service&gt;</code> 将 HelloServiceImpl 暴露成 Dubbo 服务</li> </ul> <div class=highlight><pre><span></span><code>    <span class=c>&lt;!-- 定义 HelloService 的应用名 --&gt;</span>
    <span class=nt>&lt;dubbo:application</span> <span class=na>name=</span><span class=s>&quot;hello-service-provider&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 指定注册中心地址 --&gt;</span>
    <span class=nt>&lt;dubbo:registry</span> <span class=na>address=</span><span class=s>&quot;zookeeper://127.0.0.1:2181&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 使用 Dubbo 原生协议在 20880 端口上暴露服务 --&gt;</span>
    <span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;dubbo&quot;</span> <span class=na>port=</span><span class=s>&quot;20880&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 将 HelloServiceImpl 的实现声明成一个 spring bean --&gt;</span>
    <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&quot;helloService&quot;</span> <span class=na>class=</span><span class=s>&quot;com.alibaba.dubbo.samples.service.hello.HelloServiceImpl&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 将 HelloServiceImpl 声明成一个 Dubbo 服务 --&gt;</span>
    <span class=nt>&lt;dubbo:service</span> <span class=na>interface=</span><span class=s>&quot;com.alibaba.dubbo.samples.api.HelloService&quot;</span> <span class=na>ref=</span><span class=s>&quot;helloService&quot;</span><span class=nt>/&gt;</span>
</code></pre></div> <ol> <li>增加 Zipkin 相关的配置</li> </ol> <p>在 resources/spring/hello-service.xml 中增加 Zipkin 相关的配置：</p> <ul> <li>修改 dubbo 服务暴露的配置，添加 Zipkin 的 tracing filter 到 Dubbo 的 filter chain 中</li> <li>按照 <a href=https://github.com/openzipkin/brave/blob/master/spring-beans/README.md>https://github.com/openzipkin/brave/blob/master/spring-beans/README.md</a> 来配置 Zipkin 的 sender 和 tracing 的 spring bean</li> </ul> <div class=highlight><pre><span></span><code>    <span class=c>&lt;!-- 1. 修改 dubbo 服务暴露配置，在 filter chain 中增加 zipkin 的 tracing 过滤器 --&gt;</span>
    <span class=nt>&lt;dubbo:service</span> <span class=na>interface=</span><span class=s>&quot;com.alibaba.dubbo.samples.api.HelloService&quot;</span> <span class=na>ref=</span><span class=s>&quot;helloService&quot;</span> <span class=na>filter=</span><span class=s>&quot;tracing&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 2. zipkin 相关的配置 --&gt;</span>
    <span class=c>&lt;!-- 使用 OKHttp 来发送 trace 信息到 Zipkin Server。这里的 Zipkin Server 启动在本地 --&gt;</span>
    <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&quot;sender&quot;</span> <span class=na>class=</span><span class=s>&quot;zipkin2.reporter.beans.OkHttpSenderFactoryBean&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;endpoint&quot;</span> <span class=na>value=</span><span class=s>&quot;http://localhost:9411/api/v2/spans&quot;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;/bean&gt;</span>

    <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&quot;tracing&quot;</span> <span class=na>class=</span><span class=s>&quot;brave.spring.beans.TracingFactoryBean&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;localServiceName&quot;</span> <span class=na>value=</span><span class=s>&quot;hello-service&quot;</span><span class=nt>/&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;spanReporter&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;bean</span> <span class=na>class=</span><span class=s>&quot;zipkin2.reporter.beans.AsyncReporterFactoryBean&quot;</span><span class=nt>&gt;</span>
                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;sender&quot;</span> <span class=na>ref=</span><span class=s>&quot;sender&quot;</span><span class=nt>/&gt;</span>
                <span class=c>&lt;!-- wait up to half a second for any in-flight spans on close --&gt;</span>
                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;closeTimeout&quot;</span> <span class=na>value=</span><span class=s>&quot;500&quot;</span><span class=nt>/&gt;</span>
            <span class=nt>&lt;/bean&gt;</span>
        <span class=nt>&lt;/property&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;currentTraceContext&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;bean</span> <span class=na>class=</span><span class=s>&quot;brave.spring.beans.CurrentTraceContextFactoryBean&quot;</span><span class=nt>&gt;</span>
                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;scopeDecorators&quot;</span><span class=nt>&gt;</span>
                    <span class=nt>&lt;bean</span> <span class=na>class=</span><span class=s>&quot;brave.context.slf4j.MDCScopeDecorator&quot;</span> <span class=na>factory-method=</span><span class=s>&quot;create&quot;</span><span class=nt>/&gt;</span>
                <span class=nt>&lt;/property&gt;</span>
            <span class=nt>&lt;/bean&gt;</span>
        <span class=nt>&lt;/property&gt;</span>
    <span class=nt>&lt;/bean&gt;</span>
</code></pre></div> <ol> <li>增加 HelloService 的启动类</li> </ol> <p>在 com.alibaba.dubbo.samples.service.hello.Application 中通过 ClassPathXmlApplicationContext 读取 刚才配置的 spring/hello-service.xml 来初始化一个 spring context 并启动</p> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>com.alibaba.dubbo.samples.service.hello</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>org.springframework.context.support.ClassPathXmlApplicationContext</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Application</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
        <span class=n>ClassPathXmlApplicationContext</span> <span class=n>context</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ClassPathXmlApplicationContext</span><span class=p>(</span><span class=s>&quot;spring/hello-service.xml&quot;</span><span class=p>);</span>
        <span class=n>context</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>

        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Hello service started&quot;</span><span class=p>);</span>
        <span class=c1>// press any key to exit</span>
        <span class=n>System</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>read</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <ol> <li>暴露 GreetingService 服务，并使用 Zipkin</li> </ol> <p>在 resources/spring/greeting-service.xml 中配置 GreetingService。相关步骤与 HelloService 类似，不再赘述，重点关注如何在 GreetingService 中配置下游服务的依赖。完整的 XML 配置如下：</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;beans</span> <span class=na>xmlns:xsi=</span><span class=s>&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class=na>xmlns:dubbo=</span><span class=s>&quot;http://dubbo.apache.org/schema/dubbo&quot;</span>
       <span class=na>xmlns=</span><span class=s>&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class=na>xsi:schemaLocation=</span><span class=s>&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class=s>       http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;</span><span class=nt>&gt;</span>

    <span class=c>&lt;!-- 1. 定义 GreetingService 的应用名 --&gt;</span>
    <span class=nt>&lt;dubbo:application</span> <span class=na>name=</span><span class=s>&quot;greeting-service-provider&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 2. 指定注册中心地址 --&gt;</span>
    <span class=nt>&lt;dubbo:registry</span> <span class=na>address=</span><span class=s>&quot;zookeeper://127.0.0.1:2181&quot;</span><span class=nt>/&gt;</span>

     <span class=c>&lt;!-- 3. 使用 Dubbo 原生协议在 20881 端口上暴露服务 --&gt;</span>
    <span class=nt>&lt;dubbo:protocol</span> <span class=na>name=</span><span class=s>&quot;dubbo&quot;</span> <span class=na>port=</span><span class=s>&quot;20881&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 4. 声明 HelloService 的远程代理，并在 Dubbo 的 filter chain 中增加 tracing filter --&gt;</span>
    <span class=nt>&lt;dubbo:reference</span> <span class=na>id=</span><span class=s>&quot;helloService&quot;</span> <span class=na>check=</span><span class=s>&quot;false&quot;</span> <span class=na>interface=</span><span class=s>&quot;com.alibaba.dubbo.samples.api.HelloService&quot;</span> <span class=na>filter=</span><span class=s>&quot;tracing&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 5. 将 GreetingServiceImpl 的实现声明成一个 spring bean，并将 HelloService 的远程代理装配进去 --&gt;</span>
    <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&quot;greetingService&quot;</span> <span class=na>class=</span><span class=s>&quot;com.alibaba.dubbo.samples.service.greeting.GreetingServiceImpl&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;helloService&quot;</span> <span class=na>ref=</span><span class=s>&quot;helloService&quot;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;/bean&gt;</span>

    <span class=c>&lt;!-- 6. 将 GreetingServiceImpl 声明成一个 Dubbo 服务，并在 Dubbo 的 filter chain 中增加 tracing filter --&gt;</span>
    <span class=nt>&lt;dubbo:service</span> <span class=na>interface=</span><span class=s>&quot;com.alibaba.dubbo.samples.api.GreetingService&quot;</span> <span class=na>ref=</span><span class=s>&quot;greetingService&quot;</span> <span class=na>filter=</span><span class=s>&quot;tracing&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 7. zipkin 相关的配置 --&gt;</span>
    <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&quot;sender&quot;</span> <span class=na>class=</span><span class=s>&quot;zipkin2.reporter.beans.OkHttpSenderFactoryBean&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;endpoint&quot;</span> <span class=na>value=</span><span class=s>&quot;http://localhost:9411/api/v2/spans&quot;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;/bean&gt;</span>

    <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&quot;tracing&quot;</span> <span class=na>class=</span><span class=s>&quot;brave.spring.beans.TracingFactoryBean&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;localServiceName&quot;</span> <span class=na>value=</span><span class=s>&quot;greeting-service&quot;</span><span class=nt>/&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;spanReporter&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;bean</span> <span class=na>class=</span><span class=s>&quot;zipkin2.reporter.beans.AsyncReporterFactoryBean&quot;</span><span class=nt>&gt;</span>
                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;sender&quot;</span> <span class=na>ref=</span><span class=s>&quot;sender&quot;</span><span class=nt>/&gt;</span>
                <span class=c>&lt;!-- wait up to half a second for any in-flight spans on close --&gt;</span>
                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;closeTimeout&quot;</span> <span class=na>value=</span><span class=s>&quot;500&quot;</span><span class=nt>/&gt;</span>
            <span class=nt>&lt;/bean&gt;</span>
        <span class=nt>&lt;/property&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;currentTraceContext&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;bean</span> <span class=na>class=</span><span class=s>&quot;brave.spring.beans.CurrentTraceContextFactoryBean&quot;</span><span class=nt>&gt;</span>
                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;scopeDecorators&quot;</span><span class=nt>&gt;</span>
                    <span class=nt>&lt;bean</span> <span class=na>class=</span><span class=s>&quot;brave.context.slf4j.MDCScopeDecorator&quot;</span> <span class=na>factory-method=</span><span class=s>&quot;create&quot;</span><span class=nt>/&gt;</span>
                <span class=nt>&lt;/property&gt;</span>
            <span class=nt>&lt;/bean&gt;</span>
        <span class=nt>&lt;/property&gt;</span>
    <span class=nt>&lt;/bean&gt;</span>
<span class=nt>&lt;/beans&gt;</span>
</code></pre></div> <p>这里的配置与上面的 HelloService 类似，需要重点关注的有两点：</p> <ul> <li> <p>第 3 步中注意服务需要暴露在不同的端口上，否则会和 HelloService 冲突，本例中选择的是 20881 这个端口</p> </li> <li> <p>通过第 4 步先声明 HelloService 的远程代理，然后在第 5 步中将其组装给 GreetingService 来完成服务上下游依赖的声明</p> </li> </ul> <p>增加 GreeeingService 的启动类，与 HelloService 类似，通过 spring/greeting-service.xml 的配置来初始化一个新的 spring context 来完成。</p> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>com.alibaba.dubbo.samples.service.greeting</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>org.springframework.context.support.ClassPathXmlApplicationContext</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>java.io.IOException</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Application</span> <span class=p>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=kd>throws</span> <span class=n>IOException</span> <span class=p>{</span>
        <span class=n>ClassPathXmlApplicationContext</span> <span class=n>context</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ClassPathXmlApplicationContext</span><span class=p>(</span><span class=s>&quot;spring/greeting-service.xml&quot;</span><span class=p>);</span>
        <span class=n>context</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>

        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&quot;Greeting service started&quot;</span><span class=p>);</span>
        <span class=c1>// press any key to exit</span>
        <span class=n>System</span><span class=p>.</span><span class=na>in</span><span class=p>.</span><span class=na>read</span><span class=p>();</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <ol> <li>实现客户端</li> </ol> <p>通过 resources/spring/client.xml 初始化一个 spring context，从其中获取 GreetingService 的远程代理，发起远程调用。</p> <div class=highlight><pre><span></span><code><span class=kn>package</span> <span class=nn>com.alibaba.dubbo.samples.client</span><span class=p>;</span>

<span class=kn>import</span> <span class=nn>com.alibaba.dubbo.samples.api.GreetingService</span><span class=p>;</span>
<span class=kn>import</span> <span class=nn>org.springframework.context.support.ClassPathXmlApplicationContext</span><span class=p>;</span>

<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Application</span> <span class=p>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>{</span>
        <span class=n>ClassPathXmlApplicationContext</span> <span class=n>context</span> <span class=o>=</span> <span class=k>new</span> <span class=n>ClassPathXmlApplicationContext</span><span class=p>(</span><span class=s>&quot;spring/client.xml&quot;</span><span class=p>);</span>
        <span class=n>context</span><span class=p>.</span><span class=na>start</span><span class=p>();</span>
        <span class=c1>// 获取远程代理并发起调用</span>
        <span class=n>GreetingService</span> <span class=n>greetingService</span> <span class=o>=</span> <span class=p>(</span><span class=n>GreetingService</span><span class=p>)</span> <span class=n>context</span><span class=p>.</span><span class=na>getBean</span><span class=p>(</span><span class=s>&quot;greetingService&quot;</span><span class=p>);</span>
        <span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>greetingService</span><span class=p>.</span><span class=na>greeting</span><span class=p>(</span><span class=s>&quot;world&quot;</span><span class=p>));</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div> <p>resource/spring/client.xml 中的配置与 Dubbo 服务的配置类似，主要是配置远程代理，以及配置 Zipkin</p> <div class=highlight><pre><span></span><code><span class=nt>&lt;beans</span> <span class=na>xmlns:xsi=</span><span class=s>&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class=na>xmlns:dubbo=</span><span class=s>&quot;http://dubbo.apache.org/schema/dubbo&quot;</span>
       <span class=na>xmlns=</span><span class=s>&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class=na>xsi:schemaLocation=</span><span class=s>&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span>
<span class=s>       http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;</span><span class=nt>&gt;</span>

   <span class=c>&lt;!-- 1. 定义 dubbo 客户端的应用名 --&gt;</span>
    <span class=nt>&lt;dubbo:application</span> <span class=na>name=</span><span class=s>&quot;dubbo-client&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 2. 指定注册中心地址 --&gt;</span>
    <span class=nt>&lt;dubbo:registry</span> <span class=na>address=</span><span class=s>&quot;zookeeper://127.0.0.1:2181&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 3. 声明 GreetingService 的远程代理，并在 Dubbo 的 filter chain 中增加 tracing filter --&gt;</span>
    <span class=nt>&lt;dubbo:reference</span> <span class=na>id=</span><span class=s>&quot;greetingService&quot;</span> <span class=na>check=</span><span class=s>&quot;false&quot;</span> <span class=na>interface=</span><span class=s>&quot;com.alibaba.dubbo.samples.api.GreetingService&quot;</span> <span class=na>filter=</span><span class=s>&quot;tracing&quot;</span><span class=nt>/&gt;</span>

    <span class=c>&lt;!-- 4. zipkin 相关的配置 --&gt;</span>
    <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&quot;sender&quot;</span> <span class=na>class=</span><span class=s>&quot;zipkin2.reporter.beans.OkHttpSenderFactoryBean&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;endpoint&quot;</span> <span class=na>value=</span><span class=s>&quot;http://localhost:9411/api/v2/spans&quot;</span><span class=nt>/&gt;</span>
    <span class=nt>&lt;/bean&gt;</span>

    <span class=nt>&lt;bean</span> <span class=na>id=</span><span class=s>&quot;tracing&quot;</span> <span class=na>class=</span><span class=s>&quot;brave.spring.beans.TracingFactoryBean&quot;</span><span class=nt>&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;localServiceName&quot;</span> <span class=na>value=</span><span class=s>&quot;client&quot;</span><span class=nt>/&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;spanReporter&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;bean</span> <span class=na>class=</span><span class=s>&quot;zipkin2.reporter.beans.AsyncReporterFactoryBean&quot;</span><span class=nt>&gt;</span>
                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;sender&quot;</span> <span class=na>ref=</span><span class=s>&quot;sender&quot;</span><span class=nt>/&gt;</span>
                <span class=c>&lt;!-- wait up to half a second for any in-flight spans on close --&gt;</span>
                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;closeTimeout&quot;</span> <span class=na>value=</span><span class=s>&quot;500&quot;</span><span class=nt>/&gt;</span>
            <span class=nt>&lt;/bean&gt;</span>
        <span class=nt>&lt;/property&gt;</span>
        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;currentTraceContext&quot;</span><span class=nt>&gt;</span>
            <span class=nt>&lt;bean</span> <span class=na>class=</span><span class=s>&quot;brave.spring.beans.CurrentTraceContextFactoryBean&quot;</span><span class=nt>&gt;</span>
                <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&quot;scopeDecorators&quot;</span><span class=nt>&gt;</span>
                    <span class=nt>&lt;bean</span> <span class=na>class=</span><span class=s>&quot;brave.context.slf4j.MDCScopeDecorator&quot;</span> <span class=na>factory-method=</span><span class=s>&quot;create&quot;</span><span class=nt>/&gt;</span>
                <span class=nt>&lt;/property&gt;</span>
            <span class=nt>&lt;/bean&gt;</span>
        <span class=nt>&lt;/property&gt;</span>
    <span class=nt>&lt;/bean&gt;</span>
<span class=nt>&lt;/beans&gt;</span>
</code></pre></div> <p>完成之后的工程的目录结构如下：</p> <p><img alt="zipkin dubbo project structure" src=../../img/blog/zipkin-dubbo-project.png></p> <h3 id=_5>运行<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <p>现在让我们把整个链路运行起来，看看 Zipkin 链路追踪的效果。</p> <h4 id=zookeeper-server>启动 Zookeeper Server<a class=headerlink href=#zookeeper-server title="Permanent link">&para;</a></h4> <p>执行以下命令在本地启动一个 Zookeeper Server，如果没有安装，请自行从 <a href=https://zookeeper.apache.org>ZooKeeper 官网</a> 下载：</p> <div class=highlight><pre><span></span><code>$ zkServer start
</code></pre></div> <h4 id=zipkin-server_1>启动 Zipkin Server<a class=headerlink href=#zipkin-server_1 title="Permanent link">&para;</a></h4> <p>执行以下命令在本地启动一个 Zipkin Server：</p> <div class=highlight><pre><span></span><code>$ curl -sSL https://zipkin.io/quickstart.sh <span class=p>|</span> bash -s
$ java -jar zipkin.jar
</code></pre></div> <h4 id=helloservice>启动 HelloService<a class=headerlink href=#helloservice title="Permanent link">&para;</a></h4> <p>使用下面的命令启动 HelloService，当然也可以直接在 IDE 中启动：</p> <div class=highlight><pre><span></span><code>$ mvn exec:java -Dexec.mainClass<span class=o>=</span>com.alibaba.dubbo.samples.service.hello.Application
</code></pre></div> <p>启动成功后应该可以在终端上看到 “Hello service started” 的字样。</p> <h4 id=greetingservice>启动 GreetingService<a class=headerlink href=#greetingservice title="Permanent link">&para;</a></h4> <p>使用下面的命令启动 GreetingService，当然也可以直接在 IDE 中启动：</p> <div class=highlight><pre><span></span><code>$ mvn exec:java -Dexec.mainClass<span class=o>=</span>com.alibaba.dubbo.samples.service.greeting.Application
</code></pre></div> <p>启动成功后应该可以在终端上看到 “Greeting service started” 的字样。</p> <h4 id=dubbo_2>运行 Dubbo 客户端<a class=headerlink href=#dubbo_2 title="Permanent link">&para;</a></h4> <p>使用下面的命令运行 Dubbo 客户端向 GreetingService 发起远程调用，当然也可以直接在 IDE 中运行：</p> <div class=highlight><pre><span></span><code>$ mvn exec:java -Dexec.mainClass<span class=o>=</span>com.alibaba.dubbo.samples.client.Application
</code></pre></div> <p>执行成功后，客户端会在终端上输出 “greeting, hello, world”。</p> <h4 id=_6>链路追踪<a class=headerlink href=#_6 title="Permanent link">&para;</a></h4> <p>打开浏览器访问 "<a href=http://localhost:9411>http://localhost:9411</a>" 并通过 "Find Traces" 按钮来搜索，可以找到刚刚调用的链路追踪，效果如下图所示：</p> <p><img alt="zipkin trace" src=../../img/blog/zipkin-trace.png></p> <p>还可以进一步的选择每一个 span 来查看本次调用边界内的详情，比如，hello-service 这个 span 的详情如下：</p> <p><img alt="zipkin span" src=../../img/blog/zipkin-span.png></p> <h2 id=_7>总结<a class=headerlink href=#_7 title="Permanent link">&para;</a></h2> <p>本文介绍了链路追踪的基本概念以及 Zipkin 的基本用法，然后用 Dubbo 构建了一条最简单的调用链路，并引入了 Zipkin 做全链路追踪。由于 Zipkin 对 Dubbo 做了很好的支持，整个集成的过程还是十分简单明了的。</p> <p>Zipkin 对 Dubbo 的支持是构建在 Dubbo 的 filter 扩展机制上的，有兴趣的读者可以通过 <a href=https://github.com/openzipkin/brave/blob/master/instrumentation/dubbo-rpc/src/main/java/brave/dubbo/rpc/TracingFilter.java>https://github.com/openzipkin/brave/blob/master/instrumentation/dubbo-rpc/src/main/java/brave/dubbo/rpc/TracingFilter.java</a> 了解其实现细节。</p> <p>本文中涉及的例子可以从 <a href=https://github.com/dubbo/dubbo-samples>https://github.com/dubbo/dubbo-samples</a> 中的 "dubbo-samples-zipkin" 子模块中获取。另外，spring-cloud-sleth 2.0 中开始 <a href=https://cloud.spring.io/spring-cloud-static/spring-cloud-sleuth/2.0.2.RELEASE/single/spring-cloud-sleuth.html#_dubbo_rpc_support>正式支持 Dubbo</a>，相关的文章和例子后续计划提供。</p> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/squidfunk target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://gitter.im/squidfunk/mkdocs-material target=_blank rel=noopener title=gitter.im class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"/></svg> </a> <a href=https://hub.docker.com/r/squidfunk/mkdocs-material/ target=_blank rel=noopener title=hub.docker.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=https://twitter.com/squidfunk target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://linkedin.com/in/squidfunk/ target=_blank rel=noopener title=linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> <a href=https://instagram.com/squidfunk target=_blank rel=noopener title=instagram.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.77e55a48.min.js></script> <script src=../../assets/javascripts/bundle.9554a270.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "../..",
          features: ['tabs', 'search.highlight'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>